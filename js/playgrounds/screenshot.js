/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";function svgToPng_(e,t,n,r){var o=document.createElement("canvas"),a=o.getContext("2d"),i=new Image;o.width=10*t,o.height=10*n,i.onload=function(){a.drawImage(i,0,0,t,n,0,0,o.width,o.height);try{var e=o.toDataURL("image/png");r(e)}catch(e){console.warn("Error converting the workspace svg to a png"),r("")}},i.src=e}function workspaceToSvg_(e,t,n){for(var r=document.getElementsByTagName("textarea"),o=0;o<r.length;o++)r[o].innerHTML=r[o].value;var a=e.getBlocksBoundingBox(),i=a.x||a.left,c=a.y||a.top,l=a.width||a.right-i,s=a.height||a.bottom-c,g=e.getCanvas().cloneNode(!0);g.removeAttribute("transform");var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("xmlns","http://www.w3.org/2000/svg"),d.appendChild(g),d.setAttribute("viewBox",i+" "+c+" "+l+" "+s),d.setAttribute("class","blocklySvg "+(e.options.renderer||"geras")+"-renderer "+(e.getTheme?e.getTheme().name+"-theme":"")),d.setAttribute("width",l),d.setAttribute("height",s),d.setAttribute("style","background-color: transparent");var h=[].slice.call(document.head.querySelectorAll("style")).filter(function(e){return/\.blocklySvg/.test(e.innerText)||0===e.id.indexOf("blockly-")}).map(function(e){return e.innerText}).join("\n"),m=document.createElement("style");m.innerHTML=h+"\n"+n,d.insertBefore(m,d.firstChild);var u=(new XMLSerializer).serializeToString(d);u=u.replace(/&nbsp/g,"&#160"),svgToPng_("data:image/svg+xml,"+encodeURIComponent(u),l,s,t)}Blockly.downloadScreenshot=function(e){workspaceToSvg_(e,function(e){var t=document.createElement("a");t.download="screenshot.png",t.target="_self",t.href=e,document.body.appendChild(t),t.click(),t.parentNode.removeChild(t)})};