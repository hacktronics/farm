/**
 * @license
 * PXT Blockly
 *
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * https://github.com/Microsoft/pxt-blockly
 *
 * See LICENSE file for details.
 */
"use strict";goog.provide("Blockly.FieldSlider"),goog.require("Blockly.FieldNumber"),goog.require("Blockly.utils.object"),goog.require("goog.math"),goog.require("goog.dom"),goog.require("goog.events"),goog.require("goog.style"),goog.require("goog.ui.Slider"),Blockly.FieldSlider=function(e,l,t,i,o,s,r){Blockly.FieldSlider.superClass_.constructor.call(this,e,null,null,null,r),this.setConstraints(l,t,i),this.step_=parseFloat(o)||void 0,this.labelText_=s},Blockly.utils.object.inherits(Blockly.FieldSlider,Blockly.FieldNumber),Blockly.FieldSlider.prototype.min_=null,Blockly.FieldSlider.prototype.max_=null,Blockly.FieldSlider.prototype.step_=null,Blockly.FieldSlider.prototype.precision_=null,Blockly.FieldSlider.prototype.labelText_=null,Blockly.FieldSlider.fromJson=function(e){return new Blockly.FieldSlider(e.value,e.min,e.max,e.precision,e.step,e.labelText)},Blockly.FieldSlider.prototype.setOptions=function(e,l,t,i){this.setConstraints(e,l,i),this.step_=parseFloat(t)||void 0;var o=this.getNumRestrictor(this.min_,this.max_,this.precision_);this.setRestrictor(o)},Blockly.FieldSlider.prototype.setLabel=function(e){null!=e&&(this.labelText_=e)},Blockly.FieldSlider.prototype.setColor=function(e){null!=e&&(this.sliderColor_=e)},Blockly.FieldSlider.prototype.init=function(){Blockly.FieldTextInput.superClass_.init.call(this),this.setValue(this.getValue()),this.sourceBlock_.isEditable()&&(this.mouseOverWrapper_=Blockly.bindEvent_(this.getClickTarget_(),"mouseover",this,this.onMouseOver_),this.mouseOutWrapper_=Blockly.bindEvent_(this.getClickTarget_(),"mouseout",this,this.onMouseOut_))},Blockly.FieldSlider.prototype.showEditor_=function(e){Blockly.FieldSlider.superClass_.showEditor_.call(this,e),this.max_!=1/0&&this.min_!=-1/0&&(this.showSlider_(),this.setValue(this.getValue()))},Blockly.FieldSlider.prototype.showSlider_=function(){Blockly.DropDownDiv.hideWithoutAnimation(),Blockly.DropDownDiv.clearContent();var e=Blockly.DropDownDiv.getContentDiv();e.setAttribute("role","menu"),e.setAttribute("aria-haspopup","true"),this.addSlider_(e),Blockly.DropDownDiv.setColour("#ffffff","#dddddd"),Blockly.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_),this.slider_&&this.slider_.setVisible(!0)},Blockly.FieldSlider.prototype.addSlider_=function(e){if(this.labelText_){var l=this.createLabelDom_(this.labelText_);e.appendChild(l[0]),this.readout_=l[1]}this.slider_=new goog.ui.Slider,this.slider_.setMinimum(this.min_),this.slider_.setMaximum(this.max_),this.slider_.setMoveToPointEnabled(!this.step_),this.step_&&this.slider_.setBlockIncrement(this.step_),this.slider_.setRightToLeft(this.sourceBlock_.RTL);var t=parseFloat(this.getValue());t=isNaN(t)?0:t,this.slider_.setValue(t),this.slider_.render(e);var i=this;Blockly.FieldSlider.changeEventKey_=goog.events.listen(this.slider_,goog.ui.Component.EventType.CHANGE,function(e){var l=e.target.getValue()||0;if(null!==l){i.setValue(l);var t=i.htmlInput_;t&&(t.value=l,t.focus())}}),Blockly.FieldSlider.focusEventKey_=goog.events.listen(this.slider_.getElement(),goog.ui.Component.EventType.FOCUS,function(){i.htmlInput_.focus()})},Blockly.FieldSlider.prototype.createLabelDom_=function(e){var l=document.createElement("div");l.setAttribute("class","blocklyFieldSliderLabel");var t=document.createElement("span");t.setAttribute("class","blocklyFieldSliderReadout");var i=document.createElement("span");return i.setAttribute("class","blocklyFieldSliderLabelText"),i.innerHTML=e,l.appendChild(i),l.appendChild(t),[l,t]},Blockly.FieldSlider.prototype.setValue=function(e){Blockly.FieldSlider.superClass_.setValue.call(this,e),this.updateSliderHandles_(),this.updateDom_()},Blockly.FieldSlider.prototype.updateDom_=function(){this.slider_&&this.readout_&&(this.setBackground_(this.slider_.getElement()),this.setReadout_(this.readout_,this.getValue()))},Blockly.FieldSlider.prototype.setBackground_=function(e){this.sliderColor_?goog.style.setStyle(e,"background",this.sliderColor_):this.sourceBlock_.isShadow()&&this.sourceBlock_.parentBlock_&&goog.style.setStyle(e,"background",this.sourceBlock_.parentBlock_.getColourTertiary())},Blockly.FieldSlider.prototype.setReadout_=function(e,l){e.innerHTML=l},Blockly.FieldSlider.prototype.updateSliderHandles_=function(){this.slider_&&this.slider_.setValue(parseFloat(this.getValue()))},Blockly.FieldSlider.prototype.onHtmlInputChange_=function(e){Blockly.FieldSlider.superClass_.onHtmlInputChange_.call(this,e),this.slider_&&this.slider_.setValue(parseFloat(this.getValue()))},Blockly.FieldSlider.prototype.dispose=function(){Blockly.FieldSlider.changeEventKey_&&goog.events.unlistenByKey(Blockly.FieldSlider.changeEventKey_),Blockly.FieldSlider.focusEventKey_&&goog.events.unlistenByKey(Blockly.FieldSlider.focusEventKey_),Blockly.Events.setGroup(!1),Blockly.FieldSlider.superClass_.dispose.call(this)},Blockly.fieldRegistry.register("field_slider",Blockly.FieldSlider);