/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.utils.toolbox"),goog.require("Blockly.constants"),goog.require("Blockly.Xml"),goog.requireType("Blockly.ToolboxCategory"),goog.requireType("Blockly.ToolboxSeparator"),Blockly.utils.toolbox.BlockInfo,Blockly.utils.toolbox.SeparatorInfo,Blockly.utils.toolbox.ButtonInfo,Blockly.utils.toolbox.LabelInfo,Blockly.utils.toolbox.ButtonOrLabelInfo,Blockly.utils.toolbox.StaticCategoryInfo,Blockly.utils.toolbox.DynamicCategoryInfo,Blockly.utils.toolbox.CategoryInfo,Blockly.utils.toolbox.ToolboxItemInfo,Blockly.utils.toolbox.FlyoutItemInfo,Blockly.utils.toolbox.ToolboxInfo,Blockly.utils.toolbox.FlyoutItemInfoArray,Blockly.utils.toolbox.ToolboxDefinition,Blockly.utils.toolbox.FlyoutDefinition,Blockly.utils.toolbox.CATEGORY_TOOLBOX_KIND="categoryToolbox",Blockly.utils.toolbox.FLYOUT_TOOLBOX_KIND="flyoutToolbox",Blockly.utils.toolbox.Position={TOP:0,BOTTOM:1,LEFT:2,RIGHT:3},Blockly.utils.toolbox.convertToolboxDefToJson=function(o){if(!o)return null;(o instanceof Element||"string"==typeof o)&&(o=Blockly.utils.toolbox.parseToolboxTree(o),o=Blockly.utils.toolbox.convertToToolboxJson_(o));var l=o;return Blockly.utils.toolbox.validateToolbox_(l),l},Blockly.utils.toolbox.validateToolbox_=function(o){var l=o.kind,t=o.contents;if(l&&l!=Blockly.utils.toolbox.FLYOUT_TOOLBOX_KIND&&l!=Blockly.utils.toolbox.CATEGORY_TOOLBOX_KIND)throw Error("Invalid toolbox kind "+l+". Please supply either "+Blockly.utils.toolbox.FLYOUT_TOOLBOX_KIND+" or "+Blockly.utils.toolbox.CATEGORY_TOOLBOX_KIND);if(!t)throw Error("Toolbox must have a contents attribute.")},Blockly.utils.toolbox.convertFlyoutDefToJsonArray=function(o){return o?o.contents?o.contents:Array.isArray(o)&&o.length>0&&!o[0].nodeType?o:Blockly.utils.toolbox.xmlToJsonArray_(o):[]},Blockly.utils.toolbox.hasCategories=function(o){if(!o)return!1;var l=o.kind;return l?l==Blockly.utils.toolbox.CATEGORY_TOOLBOX_KIND:!!o.contents.filter(function(o){return"CATEGORY"==o.kind.toUpperCase()}).length},Blockly.utils.toolbox.isCategoryCollapsible=function(o){return!(!o||!o.contents)&&!!o.contents.filter(function(o){return"CATEGORY"==o.kind.toUpperCase()}).length},Blockly.utils.toolbox.convertToToolboxJson_=function(o){var l={contents:Blockly.utils.toolbox.xmlToJsonArray_(o)};return o instanceof Node&&Blockly.utils.toolbox.addAttributes_(o,l),l},Blockly.utils.toolbox.xmlToJsonArray_=function(o){var l=[],t=o.childNodes;t||(t=o);for(var e,n=0;e=t[n];n++)if(e.tagName){var r={},i=e.tagName.toUpperCase();r.kind=i,"BLOCK"==i?r.blockxml=e:e.childNodes&&e.childNodes.length>0&&(r.contents=Blockly.utils.toolbox.xmlToJsonArray_(e)),Blockly.utils.toolbox.addAttributes_(e,r),l.push(r)}return l},Blockly.utils.toolbox.addAttributes_=function(o,l){for(var t=0;t<o.attributes.length;t++){var e=o.attributes[t];e.nodeName.indexOf("css-")>-1?(l.cssconfig=l.cssconfig||{},l.cssconfig[e.nodeName.replace("css-","")]=e.value):l[e.nodeName]=e.value}},Blockly.utils.toolbox.parseToolboxTree=function(o){if(o){if("string"!=typeof o&&(Blockly.utils.userAgent.IE&&o.outerHTML?o=o.outerHTML:o instanceof Element||(o=null)),"string"==typeof o&&"xml"!=(o=Blockly.Xml.textToDom(o)).nodeName.toLowerCase())throw TypeError("Toolbox should be an <xml> document.")}else o=null;return o};