/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.utils.dom"),goog.require("Blockly.utils.Svg"),goog.require("Blockly.utils.userAgent"),Blockly.utils.dom.SVG_NS="http://www.w3.org/2000/svg",Blockly.utils.dom.HTML_NS="http://www.w3.org/1999/xhtml",Blockly.utils.dom.XLINK_NS="http://www.w3.org/1999/xlink",Blockly.utils.dom.NodeType={ELEMENT_NODE:1,TEXT_NODE:3,COMMENT_NODE:8,DOCUMENT_POSITION_CONTAINED_BY:16},Blockly.utils.dom.cacheWidths_=null,Blockly.utils.dom.cacheReference_=0,Blockly.utils.dom.canvasContext_=null,Blockly.utils.dom.createSvgElement=function(t,e,l){var o=document.createElementNS(Blockly.utils.dom.SVG_NS,String(t));for(var s in e)o.setAttribute(s,e[s]);return document.body.runtimeStyle&&(o.runtimeStyle=o.currentStyle=o.style),l&&l.appendChild(o),o},Blockly.utils.dom.addClass=function(t,e){var l=t.getAttribute("class")||"";return-1==(" "+l+" ").indexOf(" "+e+" ")&&(l&&(l+=" "),t.setAttribute("class",l+e),!0)},Blockly.utils.dom.removeClasses=function(t,e){for(var l=e.split(" "),o=0;o<l.length;o++){var s=l[o];Blockly.utils.dom.removeClass(t,s)}},Blockly.utils.dom.removeClass=function(t,e){var l=t.getAttribute("class");if(-1==(" "+l+" ").indexOf(" "+e+" "))return!1;for(var o=l.split(/\s+/),s=0;s<o.length;s++)o[s]&&o[s]!=e||(o.splice(s,1),s--);return o.length?t.setAttribute("class",o.join(" ")):t.removeAttribute("class"),!0},Blockly.utils.dom.hasClass=function(t,e){return-1!=(" "+t.getAttribute("class")+" ").indexOf(" "+e+" ")},Blockly.utils.dom.removeNode=function(t){return t&&t.parentNode?t.parentNode.removeChild(t):null},Blockly.utils.dom.insertAfter=function(t,e){var l=e.nextSibling,o=e.parentNode;if(!o)throw Error("Reference node has no parent.");l?o.insertBefore(t,l):o.appendChild(t)},Blockly.utils.dom.containsNode=function(t,e){return!!(t.compareDocumentPosition(e)&Blockly.utils.dom.NodeType.DOCUMENT_POSITION_CONTAINED_BY)},Blockly.utils.dom.setCssTransform=function(t,e){t.style.transform=e,t.style["-webkit-transform"]=e},Blockly.utils.dom.startTextWidthCache=function(){Blockly.utils.dom.cacheReference_++,Blockly.utils.dom.cacheWidths_||(Blockly.utils.dom.cacheWidths_=Object.create(null))},Blockly.utils.dom.stopTextWidthCache=function(){Blockly.utils.dom.cacheReference_--,Blockly.utils.dom.cacheReference_||(Blockly.utils.dom.cacheWidths_=null)},Blockly.utils.dom.getTextWidth=function(t){var e,l=t.textContent+"\n"+t.className.baseVal;if(Blockly.utils.dom.cacheWidths_&&(e=Blockly.utils.dom.cacheWidths_[l]))return e;try{e=Blockly.utils.userAgent.IE||Blockly.utils.userAgent.EDGE?t.getBBox().width:t.getComputedTextLength()}catch(e){return 8*t.textContent.length}return Blockly.utils.dom.cacheWidths_&&(Blockly.utils.dom.cacheWidths_[l]=e),e},Blockly.utils.dom.getFastTextWidth=function(t,e,l,o){return Blockly.utils.dom.getFastTextWidthWithSizeString(t,e+"pt",l,o)},Blockly.utils.dom.getFastTextWidthWithSizeString=function(t,e,l,o){var s,i=t.textContent,n=i+"\n"+t.className.baseVal;if(Blockly.utils.dom.cacheWidths_&&(s=Blockly.utils.dom.cacheWidths_[n]))return s;if(!Blockly.utils.dom.canvasContext_){var c=document.createElement("canvas");c.className="blocklyComputeCanvas",document.body.appendChild(c),Blockly.utils.dom.canvasContext_=c.getContext("2d")}return Blockly.utils.dom.canvasContext_.font=l+" "+e+" "+o,s=Blockly.utils.dom.canvasContext_.measureText(i).width,Blockly.utils.dom.cacheWidths_&&(Blockly.utils.dom.cacheWidths_[n]=s),s},Blockly.utils.dom.measureFontMetrics=function(t,e,l,o){var s=document.createElement("span");s.style.font=l+" "+e+" "+o,s.textContent=t;var i=document.createElement("div");i.style.width="1px",i.style.height="0px";var n=document.createElement("div");n.setAttribute("style","position: fixed; top: 0; left: 0; display: flex;"),n.appendChild(s),n.appendChild(i),document.body.appendChild(n);try{var c={};n.style.alignItems="baseline",c.baseline=i.offsetTop-s.offsetTop,n.style.alignItems="flex-end",c.height=i.offsetTop-s.offsetTop}finally{document.body.removeChild(n)}return c};