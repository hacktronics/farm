/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.thrasos"),goog.provide("Blockly.thrasos.RenderInfo"),goog.require("Blockly.blockRendering.InRowSpacer"),goog.require("Blockly.blockRendering.RenderInfo"),goog.require("Blockly.blockRendering.Types"),goog.require("Blockly.utils.object"),goog.requireType("Blockly.blockRendering.Field"),goog.requireType("Blockly.BlockSvg"),goog.requireType("Blockly.thrasos.Renderer"),Blockly.thrasos.RenderInfo=function(e,n){Blockly.thrasos.RenderInfo.superClass_.constructor.call(this,e,n)},Blockly.utils.object.inherits(Blockly.thrasos.RenderInfo,Blockly.blockRendering.RenderInfo),Blockly.thrasos.RenderInfo.prototype.getRenderer=function(){return this.renderer_},Blockly.thrasos.RenderInfo.prototype.addElemSpacing_=function(){for(var e=!1,n=0;t=this.rows[n];n++)t.hasExternalInput&&(e=!0);var t;for(n=0;t=this.rows[n];n++){var s=t.elements;t.elements=[],t.startsWithElemSpacer()&&t.elements.push(new Blockly.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,s[0])));for(var o=0;o<s.length-1;o++){t.elements.push(s[o]);var i=this.getInRowSpacing_(s[o],s[o+1]);t.elements.push(new Blockly.blockRendering.InRowSpacer(this.constants_,i))}if(t.elements.push(s[s.length-1]),t.endsWithElemSpacer()){i=this.getInRowSpacing_(s[s.length-1],null);e&&t.hasDummyInput&&(i+=this.constants_.TAB_WIDTH),t.elements.push(new Blockly.blockRendering.InRowSpacer(this.constants_,i))}}},Blockly.thrasos.RenderInfo.prototype.getInRowSpacing_=function(e,n){if(!e)return n&&Blockly.blockRendering.Types.isField(n)&&n.isEditable?this.constants_.MEDIUM_PADDING:n&&Blockly.blockRendering.Types.isInlineInput(n)?this.constants_.MEDIUM_LARGE_PADDING:n&&Blockly.blockRendering.Types.isStatementInput(n)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!Blockly.blockRendering.Types.isInput(e)&&!n)return Blockly.blockRendering.Types.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:Blockly.blockRendering.Types.isIcon(e)?2*this.constants_.LARGE_PADDING+1:Blockly.blockRendering.Types.isHat(e)?this.constants_.NO_PADDING:Blockly.blockRendering.Types.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:Blockly.blockRendering.Types.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:Blockly.blockRendering.Types.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(Blockly.blockRendering.Types.isInput(e)&&!n){if(Blockly.blockRendering.Types.isExternalInput(e))return this.constants_.NO_PADDING;if(Blockly.blockRendering.Types.isInlineInput(e))return this.constants_.LARGE_PADDING;if(Blockly.blockRendering.Types.isStatementInput(e))return this.constants_.NO_PADDING}if(!Blockly.blockRendering.Types.isInput(e)&&n&&Blockly.blockRendering.Types.isInput(n)){if(Blockly.blockRendering.Types.isField(e)&&e.isEditable){if(Blockly.blockRendering.Types.isInlineInput(n))return this.constants_.SMALL_PADDING;if(Blockly.blockRendering.Types.isExternalInput(n))return this.constants_.SMALL_PADDING}else{if(Blockly.blockRendering.Types.isInlineInput(n))return this.constants_.MEDIUM_LARGE_PADDING;if(Blockly.blockRendering.Types.isExternalInput(n))return this.constants_.MEDIUM_LARGE_PADDING;if(Blockly.blockRendering.Types.isStatementInput(n))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(Blockly.blockRendering.Types.isIcon(e)&&n&&!Blockly.blockRendering.Types.isInput(n))return this.constants_.LARGE_PADDING;if(Blockly.blockRendering.Types.isInlineInput(e)&&n&&Blockly.blockRendering.Types.isField(n))return n.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(Blockly.blockRendering.Types.isLeftSquareCorner(e)&&n){if(Blockly.blockRendering.Types.isHat(n))return this.constants_.NO_PADDING;if(Blockly.blockRendering.Types.isPreviousConnection(n)||Blockly.blockRendering.Types.isNextConnection(n))return n.notchOffset}return Blockly.blockRendering.Types.isLeftRoundedCorner(e)&&n?n.notchOffset-this.constants_.CORNER_RADIUS:Blockly.blockRendering.Types.isField(e)&&n&&Blockly.blockRendering.Types.isField(n)&&e.isEditable==n.isEditable||n&&Blockly.blockRendering.Types.isJaggedEdge(n)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING},Blockly.thrasos.RenderInfo.prototype.getSpacerRowHeight_=function(e,n){return Blockly.blockRendering.Types.isTopRow(e)&&Blockly.blockRendering.Types.isBottomRow(n)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:Blockly.blockRendering.Types.isTopRow(e)||Blockly.blockRendering.Types.isBottomRow(n)?this.constants_.NO_PADDING:e.hasExternalInput&&n.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&n.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&n.hasStatement||e.hasDummyInput||n.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING},Blockly.thrasos.RenderInfo.prototype.getElemCenterline_=function(e,n){if(Blockly.blockRendering.Types.isSpacer(n))return e.yPos+n.height/2;if(Blockly.blockRendering.Types.isBottomRow(e)){var t=e.yPos+e.height-e.descenderHeight;return Blockly.blockRendering.Types.isNextConnection(n)?t+n.height/2:t-n.height/2}if(Blockly.blockRendering.Types.isTopRow(e))return Blockly.blockRendering.Types.isHat(n)?e.capline-n.height/2:e.capline+n.height/2;var s=e.yPos;Blockly.blockRendering.Types.isField(n)&&e.hasStatement?s+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y+n.height/2:s+=e.height/2;return s},Blockly.thrasos.RenderInfo.prototype.finalize_=function(){for(var e,n=0,t=0,s=0;e=this.rows[s];s++){e.yPos=t,e.xPos=this.startX,t+=e.height,n=Math.max(n,e.widthWithConnectedBlocks);var o=t-this.topRow.ascenderHeight;if(e==this.bottomRow&&o<this.constants_.MIN_BLOCK_HEIGHT){var i=this.constants_.MIN_BLOCK_HEIGHT-o;this.bottomRow.height+=i,t+=i}this.recordElemPositions_(e)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(n=Math.max(n,this.block_.nextConnection.targetBlock().getHeightWidth().width)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=n+this.startX,this.height=t,this.startY=this.topRow.capline};