/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.geras.Highlighter"),goog.require("Blockly.blockRendering.Types"),goog.require("Blockly.utils.svgPaths"),goog.requireType("Blockly.blockRendering.ConstantProvider"),goog.requireType("Blockly.geras.HighlightConstantProvider"),goog.requireType("Blockly.geras.Renderer"),goog.requireType("Blockly.geras.RenderInfo"),Blockly.geras.Highlighter=function(t){this.info_=t,this.steps_="",this.inlineSteps_="",this.RTL_=this.info_.RTL;var s=t.getRenderer();this.constants_=s.getConstants(),this.highlightConstants_=s.getHighlightConstants(),this.highlightOffset_=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH},Blockly.geras.Highlighter.prototype.getPath=function(){return this.steps_+"\n"+this.inlineSteps_},Blockly.geras.Highlighter.prototype.drawTopCorner=function(t){this.steps_+=Blockly.utils.svgPaths.moveBy(t.xPos,this.info_.startY);for(var s,i=0;s=t.elements[i];i++)Blockly.blockRendering.Types.isLeftSquareCorner(s)?this.steps_+=this.highlightConstants_.START_POINT:Blockly.blockRendering.Types.isLeftRoundedCorner(s)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):Blockly.blockRendering.Types.isPreviousConnection(s)?this.steps_+=this.notchPaths_.pathLeft:Blockly.blockRendering.Types.isHat(s)?this.steps_+=this.startPaths_.path(this.RTL_):Blockly.blockRendering.Types.isSpacer(s)&&0!=s.width&&(this.steps_+=Blockly.utils.svgPaths.lineOnAxis("H",s.xPos+s.width-this.highlightOffset_));var h=t.xPos+t.width-this.highlightOffset_;this.steps_+=Blockly.utils.svgPaths.lineOnAxis("H",h)},Blockly.geras.Highlighter.prototype.drawJaggedEdge_=function(t){if(this.info_.RTL){var s=t.height-this.jaggedTeethPaths_.height-this.highlightOffset_;this.steps_+=this.jaggedTeethPaths_.pathLeft+Blockly.utils.svgPaths.lineOnAxis("v",s)}},Blockly.geras.Highlighter.prototype.drawValueInput=function(t){var s=t.getLastInput();if(this.RTL_){var i=t.height-s.connectionHeight;this.steps_+=Blockly.utils.svgPaths.moveTo(s.xPos+s.width-this.highlightOffset_,t.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+Blockly.utils.svgPaths.lineOnAxis("v",i)}else this.steps_+=Blockly.utils.svgPaths.moveTo(s.xPos+s.width,t.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)},Blockly.geras.Highlighter.prototype.drawStatementInput=function(t){var s=t.getLastInput();if(this.RTL_){var i=t.height-2*this.insideCornerPaths_.height;this.steps_+=Blockly.utils.svgPaths.moveTo(s.xPos,t.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+Blockly.utils.svgPaths.lineOnAxis("v",i)+this.insideCornerPaths_.pathBottom(this.RTL_)+Blockly.utils.svgPaths.lineTo(t.width-s.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=Blockly.utils.svgPaths.moveTo(s.xPos,t.yPos+t.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+Blockly.utils.svgPaths.lineTo(t.width-s.xPos-this.insideCornerPaths_.width,0)},Blockly.geras.Highlighter.prototype.drawRightSideRow=function(t){var s=t.xPos+t.width-this.highlightOffset_;t.followsStatement&&(this.steps_+=Blockly.utils.svgPaths.lineOnAxis("H",s)),this.RTL_&&(this.steps_+=Blockly.utils.svgPaths.lineOnAxis("H",s),t.height>this.highlightOffset_&&(this.steps_+=Blockly.utils.svgPaths.lineOnAxis("V",t.yPos+t.height-this.highlightOffset_)))},Blockly.geras.Highlighter.prototype.drawBottomRow=function(t){if(this.RTL_)this.steps_+=Blockly.utils.svgPaths.lineOnAxis("V",t.baseline-this.highlightOffset_);else{var s=this.info_.bottomRow.elements[0];Blockly.blockRendering.Types.isLeftSquareCorner(s)?this.steps_+=Blockly.utils.svgPaths.moveTo(t.xPos+this.highlightOffset_,t.baseline-this.highlightOffset_):Blockly.blockRendering.Types.isLeftRoundedCorner(s)&&(this.steps_+=Blockly.utils.svgPaths.moveTo(t.xPos,t.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}},Blockly.geras.Highlighter.prototype.drawLeft=function(){var t=this.info_.outputConnection;if(t){var s=t.connectionOffsetY+t.height;if(this.RTL_)this.steps_+=Blockly.utils.svgPaths.moveTo(this.info_.startX,s);else{var i=this.info_.startX+this.highlightOffset_,h=this.info_.bottomRow.baseline-this.highlightOffset_;this.steps_+=Blockly.utils.svgPaths.moveTo(i,h),this.steps_+=Blockly.utils.svgPaths.lineOnAxis("V",s)}this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)}if(!this.RTL_){var e=this.info_.topRow;Blockly.blockRendering.Types.isLeftRoundedCorner(e.elements[0])?this.steps_+=Blockly.utils.svgPaths.lineOnAxis("V",this.outsideCornerPaths_.height):this.steps_+=Blockly.utils.svgPaths.lineOnAxis("V",e.capline+this.highlightOffset_)}},Blockly.geras.Highlighter.prototype.drawInlineInput=function(t){var s=this.highlightOffset_,i=t.xPos+t.connectionWidth,h=t.centerline-t.height/2,e=t.width-t.connectionWidth,o=h+s;if(this.RTL_){var l=t.connectionOffsetY-s,n=t.height-(t.connectionOffsetY+t.connectionHeight)+s,g=i-s;this.inlineSteps_+=Blockly.utils.svgPaths.moveTo(g,o)+Blockly.utils.svgPaths.lineOnAxis("v",l)+this.puzzleTabPaths_.pathDown(this.RTL_)+Blockly.utils.svgPaths.lineOnAxis("v",n)+Blockly.utils.svgPaths.lineOnAxis("h",e)}else this.inlineSteps_+=Blockly.utils.svgPaths.moveTo(t.xPos+t.width+s,o)+Blockly.utils.svgPaths.lineOnAxis("v",t.height)+Blockly.utils.svgPaths.lineOnAxis("h",-e)+Blockly.utils.svgPaths.moveTo(i,h+t.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)};