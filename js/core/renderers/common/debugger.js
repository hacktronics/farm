/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.blockRendering.Debug"),goog.require("Blockly.blockRendering.Measurable"),goog.require("Blockly.blockRendering.RenderInfo"),goog.require("Blockly.blockRendering.Row"),goog.require("Blockly.blockRendering.Types"),goog.require("Blockly.connectionTypes"),goog.require("Blockly.constants"),goog.require("Blockly.utils.dom"),goog.require("Blockly.utils.Svg"),goog.requireType("Blockly.blockRendering.ConstantProvider"),goog.requireType("Blockly.blockRendering.InRowSpacer"),goog.requireType("Blockly.BlockSvg"),goog.requireType("Blockly.RenderedConnection"),Blockly.blockRendering.Debug=function(e){this.debugElements_=[],this.svgRoot_=null,this.constants_=e},Blockly.blockRendering.Debug.config={rowSpacers:!0,elemSpacers:!0,rows:!0,elems:!0,connections:!0,blockBounds:!0,connectedBlockBounds:!0,render:!0},Blockly.blockRendering.Debug.prototype.clearElems=function(){for(var e,o=0;e=this.debugElements_[o];o++)Blockly.utils.dom.removeNode(e);this.debugElements_=[]},Blockly.blockRendering.Debug.prototype.drawSpacerRow=function(e,o,t){if(Blockly.blockRendering.Debug.config.rowSpacers){var l=Math.abs(e.height),n=e.height<0;n&&(o-=l),this.debugElements_.push(Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{class:"rowSpacerRect blockRenderDebug",x:t?-(e.xPos+e.width):e.xPos,y:o,width:e.width,height:l,stroke:n?"black":"blue",fill:"blue","fill-opacity":"0.5","stroke-width":"1px"},this.svgRoot_))}},Blockly.blockRendering.Debug.prototype.drawSpacerElem=function(e,o,t){if(Blockly.blockRendering.Debug.config.elemSpacers){var l=Math.abs(e.width),n=e.width<0,i=n?e.xPos-l:e.xPos;t&&(i=-(i+l));var c=e.centerline-e.height/2;this.debugElements_.push(Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{class:"elemSpacerRect blockRenderDebug",x:i,y:c,width:l,height:e.height,stroke:"pink",fill:n?"black":"pink","fill-opacity":"0.5","stroke-width":"1px"},this.svgRoot_))}},Blockly.blockRendering.Debug.prototype.drawRenderedElem=function(e,o){if(Blockly.blockRendering.Debug.config.elems){var t=e.xPos;o&&(t=-(t+e.width));var l=e.centerline-e.height/2;if(this.debugElements_.push(Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{class:"rowRenderingRect blockRenderDebug",x:t,y:l,width:e.width,height:e.height,stroke:"black",fill:"none","stroke-width":"1px"},this.svgRoot_)),Blockly.blockRendering.Types.isField(e)&&e.field instanceof Blockly.FieldLabel){var n=this.constants_.FIELD_TEXT_BASELINE;this.debugElements_.push(Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{class:"rowRenderingRect blockRenderDebug",x:t,y:l+n,width:e.width,height:"0.1px",stroke:"red",fill:"none","stroke-width":"0.5px"},this.svgRoot_))}}Blockly.blockRendering.Types.isInput(e)&&Blockly.blockRendering.Debug.config.connections&&this.drawConnection(e.connectionModel)},Blockly.blockRendering.Debug.prototype.drawConnection=function(e){var o,t,l;Blockly.blockRendering.Debug.config.connections&&(e.type==Blockly.connectionTypes.INPUT_VALUE?(t=4,o="magenta",l="none"):e.type==Blockly.connectionTypes.OUTPUT_VALUE?(t=2,l=o="magenta"):e.type==Blockly.connectionTypes.NEXT_STATEMENT?(t=4,o="goldenrod",l="none"):e.type==Blockly.connectionTypes.PREVIOUS_STATEMENT&&(t=2,l=o="goldenrod"),this.debugElements_.push(Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.CIRCLE,{class:"blockRenderDebug",cx:e.offsetInBlock_.x,cy:e.offsetInBlock_.y,r:t,fill:l,stroke:o},this.svgRoot_)))},Blockly.blockRendering.Debug.prototype.drawRenderedRow=function(e,o,t){Blockly.blockRendering.Debug.config.rows&&(this.debugElements_.push(Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{class:"elemRenderingRect blockRenderDebug",x:t?-(e.xPos+e.width):e.xPos,y:e.yPos,width:e.width,height:e.height,stroke:"red",fill:"none","stroke-width":"1px"},this.svgRoot_)),Blockly.blockRendering.Types.isTopOrBottomRow(e)||Blockly.blockRendering.Debug.config.connectedBlockBounds&&this.debugElements_.push(Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{class:"connectedBlockWidth blockRenderDebug",x:t?-(e.xPos+e.widthWithConnectedBlocks):e.xPos,y:e.yPos,width:e.widthWithConnectedBlocks,height:e.height,stroke:this.randomColour_,fill:"none","stroke-width":"1px","stroke-dasharray":"3,3"},this.svgRoot_)))},Blockly.blockRendering.Debug.prototype.drawRowWithElements=function(e,o,t){for(var l=0,n=e.elements.length;l<n;l++){var i=e.elements[l];i?Blockly.blockRendering.Types.isSpacer(i)?this.drawSpacerElem(i,e.height,t):this.drawRenderedElem(i,t):console.warn("A row has an undefined or null element.",e,i)}this.drawRenderedRow(e,o,t)},Blockly.blockRendering.Debug.prototype.drawBoundingBox=function(e){if(Blockly.blockRendering.Debug.config.blockBounds){var o=e.RTL?-e.width:0;this.debugElements_.push(Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{class:"blockBoundingBox blockRenderDebug",x:o,y:0,width:e.width,height:e.height,stroke:"black",fill:"none","stroke-width":"1px","stroke-dasharray":"5,5"},this.svgRoot_)),Blockly.blockRendering.Debug.config.connectedBlockBounds&&(o=e.RTL?-e.widthWithChildren:0,this.debugElements_.push(Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{class:"blockRenderDebug",x:o,y:0,width:e.widthWithChildren,height:e.height,stroke:"#DF57BC",fill:"none","stroke-width":"1px","stroke-dasharray":"3,3"},this.svgRoot_)))}},Blockly.blockRendering.Debug.prototype.drawDebug=function(e,o){this.clearElems(),this.svgRoot_=e.getSvgRoot(),this.randomColour_="#"+Math.floor(16777215*Math.random()).toString(16);for(var t,l=0,n=0;t=o.rows[n];n++)Blockly.blockRendering.Types.isBetweenRowSpacer(t)?this.drawSpacerRow(t,l,o.RTL):this.drawRowWithElements(t,l,o.RTL),l+=t.height;e.previousConnection&&this.drawConnection(e.previousConnection),e.nextConnection&&this.drawConnection(e.nextConnection),e.outputConnection&&this.drawConnection(e.outputConnection),o.rightSide&&this.drawRenderedElem(o.rightSide,o.RTL),this.drawBoundingBox(o),this.drawRender(e.pathObject.svgPath)},Blockly.blockRendering.Debug.prototype.drawRender=function(e){Blockly.blockRendering.Debug.config.render&&(e.setAttribute("filter","url(#"+this.constants_.debugFilterId+")"),setTimeout(function(){e.setAttribute("filter","")},100))};