/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.blockRendering.Renderer"),goog.require("Blockly.blockRendering.ConstantProvider"),goog.require("Blockly.blockRendering.Debug"),goog.require("Blockly.blockRendering.Drawer"),goog.require("Blockly.blockRendering.IPathObject"),goog.require("Blockly.blockRendering.MarkerSvg"),goog.require("Blockly.blockRendering.PathObject"),goog.require("Blockly.blockRendering.RenderInfo"),goog.require("Blockly.connectionTypes"),goog.require("Blockly.constants"),goog.require("Blockly.InsertionMarkerManager"),goog.require("Blockly.IRegistrable"),goog.requireType("Blockly.Block"),goog.requireType("Blockly.BlockSvg"),goog.requireType("Blockly.Connection"),goog.requireType("Blockly.Marker"),goog.requireType("Blockly.RenderedConnection"),goog.requireType("Blockly.Theme"),goog.requireType("Blockly.utils.object"),goog.requireType("Blockly.WorkspaceSvg"),Blockly.blockRendering.Renderer=function(e){this.name=e,this.constants_=null,this.overrides=null},Blockly.blockRendering.Renderer.prototype.getClassName=function(){return this.name+"-renderer"},Blockly.blockRendering.Renderer.prototype.init=function(e,n){this.constants_=this.makeConstants_(),n&&(this.overrides=n,Blockly.utils.object.mixin(this.constants_,n)),this.constants_.setTheme(e),this.constants_.init()},Blockly.blockRendering.Renderer.prototype.createDom=function(e,n){this.constants_.createDom(e,this.name+"-"+n.name,"."+this.getClassName()+"."+n.getClassName())},Blockly.blockRendering.Renderer.prototype.refreshDom=function(e,n){var o=this.getConstants();o.dispose(),this.constants_=this.makeConstants_(),this.overrides&&Blockly.utils.object.mixin(this.constants_,this.overrides),this.constants_.randomIdentifier=o.randomIdentifier,this.constants_.setTheme(n),this.constants_.init(),this.createDom(e,n)},Blockly.blockRendering.Renderer.prototype.dispose=function(){this.constants_&&this.constants_.dispose()},Blockly.blockRendering.Renderer.prototype.makeConstants_=function(){return new Blockly.blockRendering.ConstantProvider},Blockly.blockRendering.Renderer.prototype.makeRenderInfo_=function(e){return new Blockly.blockRendering.RenderInfo(this,e)},Blockly.blockRendering.Renderer.prototype.makeDrawer_=function(e,n){return new Blockly.blockRendering.Drawer(e,n)},Blockly.blockRendering.Renderer.prototype.makeDebugger_=function(){if(!Blockly.blockRendering.Debug)throw Error("Missing require for Blockly.blockRendering.Debug");return new Blockly.blockRendering.Debug(this.getConstants())},Blockly.blockRendering.Renderer.prototype.makeMarkerDrawer=function(e,n){return new Blockly.blockRendering.MarkerSvg(e,this.getConstants(),n)},Blockly.blockRendering.Renderer.prototype.makePathObject=function(e,n){return new Blockly.blockRendering.PathObject(e,n,this.constants_)},Blockly.blockRendering.Renderer.prototype.getConstants=function(){return this.constants_},Blockly.blockRendering.Renderer.prototype.shouldHighlightConnection=function(e){return!0},Blockly.blockRendering.Renderer.prototype.orphanCanConnectAtEnd=function(e,n,o){var r=o===Blockly.connectionTypes.OUTPUT_VALUE?n.outputConnection:n.previousConnection;return!!Blockly.Connection.getConnectionForOrphanedConnection(e,r)},Blockly.blockRendering.Renderer.prototype.getConnectionPreviewMethod=function(e,n,o){return n.type==Blockly.connectionTypes.OUTPUT_VALUE||n.type==Blockly.connectionTypes.PREVIOUS_STATEMENT?!e.isConnected()||this.orphanCanConnectAtEnd(o,e.targetBlock(),n.type)?Blockly.InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:Blockly.InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:Blockly.InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER},Blockly.blockRendering.Renderer.prototype.render=function(e){Blockly.blockRendering.useDebugger&&!e.renderingDebugger&&(e.renderingDebugger=this.makeDebugger_());var n=this.makeRenderInfo_(e);n.measure(),this.makeDrawer_(e,n).draw()};