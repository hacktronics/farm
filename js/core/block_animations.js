/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.blockAnimations"),goog.require("Blockly.utils.dom"),goog.require("Blockly.utils.Svg"),goog.requireType("Blockly.BlockSvg"),Blockly.blockAnimations.disconnectPid_=0,Blockly.blockAnimations.disconnectGroup_=null,Blockly.blockAnimations.disposeUiEffect=function(o){var t=o.workspace,e=o.getSvgRoot();t.getAudioManager().play("delete");var n=t.getSvgXY(e),i=e.cloneNode(!0);i.translateX_=n.x,i.translateY_=n.y,i.setAttribute("transform","translate("+n.x+","+n.y+")"),t.getParentSvg().appendChild(i),i.bBox_=i.getBBox(),Blockly.blockAnimations.disposeUiStep_(i,t.RTL,new Date,t.scale)},Blockly.blockAnimations.disposeUiStep_=function(o,t,e,n){var i=(new Date-e)/150;if(i>1)Blockly.utils.dom.removeNode(o);else{var c=o.translateX_+(t?-1:1)*o.bBox_.width*n/2*i,l=o.translateY_+o.bBox_.height*n*i,s=(1-i)*n;o.setAttribute("transform","translate("+c+","+l+") scale("+s+")"),setTimeout(Blockly.blockAnimations.disposeUiStep_,10,o,t,e,n)}},Blockly.blockAnimations.connectionUiEffect=function(o){var t=o.workspace,e=t.scale;if(t.getAudioManager().play("click"),!(e<1)){var n=t.getSvgXY(o.getSvgRoot());o.outputConnection?(n.x+=(o.RTL?3:-3)*e,n.y+=13*e):o.previousConnection&&(n.x+=(o.RTL?-23:23)*e,n.y+=3*e);var i=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.CIRCLE,{cx:n.x,cy:n.y,r:0,fill:"none",stroke:"#888","stroke-width":10},t.getParentSvg());Blockly.blockAnimations.connectionUiStep_(i,new Date,e)}},Blockly.blockAnimations.connectionUiStep_=function(o,t,e){var n=(new Date-t)/150;n>1?Blockly.utils.dom.removeNode(o):(o.setAttribute("r",25*n*e),o.style.opacity=1-n,Blockly.blockAnimations.disconnectPid_=setTimeout(Blockly.blockAnimations.connectionUiStep_,10,o,t,e))},Blockly.blockAnimations.disconnectUiEffect=function(o){if(o.workspace.getAudioManager().play("disconnect"),!(o.workspace.scale<1)){var t=o.getHeightWidth().height,e=Math.atan(10/t)/Math.PI*180;o.RTL||(e*=-1),Blockly.blockAnimations.disconnectUiStep_(o.getSvgRoot(),e,new Date)}},Blockly.blockAnimations.disconnectUiStep_=function(o,t,e){var n=(new Date-e)/200;if(n>1)o.skew_="";else{var i=Math.round(Math.sin(n*Math.PI*3)*(1-n)*t);o.skew_="skewX("+i+")",Blockly.blockAnimations.disconnectGroup_=o,Blockly.blockAnimations.disconnectPid_=setTimeout(Blockly.blockAnimations.disconnectUiStep_,10,o,t,e)}o.setAttribute("transform",o.translate_+o.skew_)},Blockly.blockAnimations.disconnectUiStop=function(){if(Blockly.blockAnimations.disconnectGroup_){clearTimeout(Blockly.blockAnimations.disconnectPid_);var o=Blockly.blockAnimations.disconnectGroup_;o.skew_="",o.setAttribute("transform",o.translate_),Blockly.blockAnimations.disconnectGroup_=null}};