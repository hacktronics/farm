/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.WorkspaceComment"),goog.require("Blockly.Events"),goog.require("Blockly.Events.CommentChange"),goog.require("Blockly.Events.CommentCreate"),goog.require("Blockly.Events.CommentDelete"),goog.require("Blockly.Events.CommentMove"),goog.require("Blockly.utils"),goog.require("Blockly.utils.Coordinate"),goog.require("Blockly.utils.xml"),Blockly.WorkspaceComment=function(t,e,o,n,i,s){this.id=i&&!t.getCommentById(i)?i:Blockly.utils.genUid(),t.addTopComment(this),this.xy_=new Blockly.utils.Coordinate(0,0),this.height_=o,this.width_=n,this.isMinimized_=s,this.workspace=t,this.RTL=t.RTL,this.deletable_=!0,this.movable_=!0,this.editable_=!0,this.content_=e.trim(),this.isComment=!0,Blockly.WorkspaceComment.fireCreateEvent(this)},Blockly.WorkspaceComment.MAX_LABEL_LENGTH=12,Blockly.WorkspaceComment.COMMENT_TEXT_LIMIT=8e3,Blockly.WorkspaceComment.prototype.data=null,Blockly.WorkspaceComment.prototype.dispose=function(){this.workspace&&(Blockly.Events.isEnabled()&&Blockly.Events.fire(new(Blockly.Events.get(Blockly.Events.COMMENT_DELETE))(this)),this.workspace.removeTopComment(this),this.workspace=null)},Blockly.WorkspaceComment.prototype.getHeight=function(){return this.height_},Blockly.WorkspaceComment.prototype.setHeight=function(t){this.height_=t},Blockly.WorkspaceComment.prototype.getWidth=function(){return this.width_},Blockly.WorkspaceComment.prototype.setWidth=function(t){this.width_=t},Blockly.WorkspaceComment.prototype.getXY=function(){return new Blockly.utils.Coordinate(this.xy_.x,this.xy_.y)},Blockly.WorkspaceComment.prototype.moveBy=function(t,e){var o=new(Blockly.Events.get(Blockly.Events.COMMENT_MOVE))(this);this.xy_.translate(t,e),o.recordNew(),Blockly.Events.fire(o)},Blockly.WorkspaceComment.prototype.isDeletable=function(){return this.deletable_&&!(this.workspace&&this.workspace.options.readOnly)},Blockly.WorkspaceComment.prototype.setDeletable=function(t){this.deletable_=t},Blockly.WorkspaceComment.prototype.isMovable=function(){return this.movable_&&!(this.workspace&&this.workspace.options.readOnly)},Blockly.WorkspaceComment.prototype.setMovable=function(t){this.movable_=t},Blockly.WorkspaceComment.prototype.isEditable=function(){return this.editable_&&!(this.workspace&&this.workspace.options.readOnly)},Blockly.WorkspaceComment.prototype.setEditable=function(t){this.editable_=t},Blockly.WorkspaceComment.prototype.getContent=function(){return this.content_},Blockly.WorkspaceComment.prototype.setContent=function(t){this.content_!=t&&(t=t.trim(),Blockly.Events.fire(new(Blockly.Events.get(Blockly.Events.COMMENT_CHANGE))(this,this.content_,t)),this.content_=t)},Blockly.WorkspaceComment.prototype.isMinimized=function(){return this.isMinimized_},Blockly.WorkspaceComment.prototype.getRelativeToSurfaceXY=function(){return this.xy_},Blockly.WorkspaceComment.prototype.toXmlWithXY=function(t){var e=this.toXml(t);return e.setAttribute("x",Math.round(this.xy_.x)),e.setAttribute("y",Math.round(this.xy_.y)),e.setAttribute("h",this.height_),e.setAttribute("w",this.width_),e},Blockly.WorkspaceComment.prototype.getLabelText=function(){return this.content_.length>Blockly.WorkspaceComment.MAX_LABEL_LENGTH?this.RTL?"…"+this.content_.slice(0,Blockly.WorkspaceComment.MAX_LABEL_LENGTH):this.content_.slice(0,Blockly.WorkspaceComment.MAX_LABEL_LENGTH)+"…":this.content_},Blockly.WorkspaceComment.prototype.toXml=function(t){var e=Blockly.utils.xml.createElement("comment");return t||(e.id=this.id),e.textContent=this.getContent(),this.isMinimized_&&e.setAttribute("minimized",!0),this.data&&e.setAttribute("data",this.data),e},Blockly.WorkspaceComment.fireCreateEvent=function(t){if(Blockly.Events.isEnabled()){var e=Blockly.Events.getGroup();e||Blockly.Events.setGroup(!0);try{Blockly.Events.fire(new(Blockly.Events.get(Blockly.Events.COMMENT_CREATE))(t))}finally{e||Blockly.Events.setGroup(!1)}}},Blockly.WorkspaceComment.fromXml=function(t,e){var o=Blockly.WorkspaceComment.parseAttributes(t),n=new Blockly.WorkspaceComment(e,o.content,o.h,o.w,o.id,o.minimized);n.data=t.getAttribute("data");var i=parseInt(t.getAttribute("x"),10),s=parseInt(t.getAttribute("y"),10);return isNaN(i)||isNaN(s)||n.moveBy(i,s),Blockly.WorkspaceComment.fireCreateEvent(n),n},Blockly.WorkspaceComment.parseAttributes=function(t){var e=t.getAttribute("h"),o=t.getAttribute("w");return{id:t.getAttribute("id"),h:e?parseInt(e,10):100,w:o?parseInt(o,10):100,x:parseInt(t.getAttribute("x"),10),y:parseInt(t.getAttribute("y"),10),minimized:"true"==t.getAttribute("minimized")||!1,content:t.textContent}};