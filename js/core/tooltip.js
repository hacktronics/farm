/**
 * @license
 * Copyright 2011 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Tooltip"),goog.require("Blockly.browserEvents"),goog.require("Blockly.utils.string"),Blockly.Tooltip.TipInfo,Blockly.Tooltip.visible=!1,Blockly.Tooltip.blocked_=!1,Blockly.Tooltip.LIMIT=50,Blockly.Tooltip.mouseOutPid_=0,Blockly.Tooltip.showPid_=0,Blockly.Tooltip.lastX_=0,Blockly.Tooltip.lastY_=0,Blockly.Tooltip.element_=null,Blockly.Tooltip.poisonedElement_=null,Blockly.Tooltip.OFFSET_X=0,Blockly.Tooltip.OFFSET_Y=10,Blockly.Tooltip.RADIUS_OK=10,Blockly.Tooltip.HOVER_MS=750,Blockly.Tooltip.MARGINS=5,Blockly.Tooltip.DIV=null,Blockly.Tooltip.getTooltipOfObject=function(o){var l=Blockly.Tooltip.getTargetObject_(o);if(l){for(var t=l.tooltip;"function"==typeof t;)t=t();if("string"!=typeof t)throw Error("Tooltip function must return a string.");return t}return""},Blockly.Tooltip.getTargetObject_=function(o){for(;o&&o.tooltip;){if("string"==typeof o.tooltip||"function"==typeof o.tooltip)return o;o=o.tooltip}return null},Blockly.Tooltip.createDom=function(){Blockly.Tooltip.DIV||(Blockly.Tooltip.DIV=document.createElement("div"),Blockly.Tooltip.DIV.className="blocklyTooltipDiv",(Blockly.parentContainer||document.body).appendChild(Blockly.Tooltip.DIV))},Blockly.Tooltip.bindMouseEvents=function(o){o.mouseOverWrapper_=Blockly.browserEvents.bind(o,"mouseover",null,Blockly.Tooltip.onMouseOver_),o.mouseOutWrapper_=Blockly.browserEvents.bind(o,"mouseout",null,Blockly.Tooltip.onMouseOut_),o.addEventListener("mousemove",Blockly.Tooltip.onMouseMove_,!1)},Blockly.Tooltip.unbindMouseEvents=function(o){o&&(Blockly.browserEvents.unbind(o.mouseOverWrapper_),Blockly.browserEvents.unbind(o.mouseOutWrapper_),o.removeEventListener("mousemove",Blockly.Tooltip.onMouseMove_))},Blockly.Tooltip.onMouseOver_=function(o){if(!Blockly.Tooltip.blocked_){var l=Blockly.Tooltip.getTargetObject_(o.currentTarget);Blockly.Tooltip.element_!=l&&(Blockly.Tooltip.hide(),Blockly.Tooltip.poisonedElement_=null,Blockly.Tooltip.element_=l),clearTimeout(Blockly.Tooltip.mouseOutPid_)}},Blockly.Tooltip.onMouseOut_=function(o){Blockly.Tooltip.blocked_||(Blockly.Tooltip.mouseOutPid_=setTimeout(function(){Blockly.Tooltip.element_=null,Blockly.Tooltip.poisonedElement_=null,Blockly.Tooltip.hide()},1),clearTimeout(Blockly.Tooltip.showPid_))},Blockly.Tooltip.onMouseMove_=function(o){if(Blockly.Tooltip.element_&&Blockly.Tooltip.element_.tooltip&&!Blockly.Tooltip.blocked_)if(Blockly.Tooltip.visible){var l=Blockly.Tooltip.lastX_-o.pageX,t=Blockly.Tooltip.lastY_-o.pageY;Math.sqrt(l*l+t*t)>Blockly.Tooltip.RADIUS_OK&&Blockly.Tooltip.hide()}else Blockly.Tooltip.poisonedElement_!=Blockly.Tooltip.element_&&(clearTimeout(Blockly.Tooltip.showPid_),Blockly.Tooltip.lastX_=o.pageX,Blockly.Tooltip.lastY_=o.pageY,Blockly.Tooltip.showPid_=setTimeout(Blockly.Tooltip.show_,Blockly.Tooltip.HOVER_MS))},Blockly.Tooltip.dispose=function(){Blockly.Tooltip.element_=null,Blockly.Tooltip.poisonedElement_=null,Blockly.Tooltip.hide()},Blockly.Tooltip.hide=function(){Blockly.Tooltip.visible&&(Blockly.Tooltip.visible=!1,Blockly.Tooltip.DIV&&(Blockly.Tooltip.DIV.style.display="none")),Blockly.Tooltip.showPid_&&clearTimeout(Blockly.Tooltip.showPid_)},Blockly.Tooltip.block=function(){Blockly.Tooltip.hide(),Blockly.Tooltip.blocked_=!0},Blockly.Tooltip.unblock=function(){Blockly.Tooltip.blocked_=!1},Blockly.Tooltip.show_=function(){if(!Blockly.Tooltip.blocked_&&(Blockly.Tooltip.poisonedElement_=Blockly.Tooltip.element_,Blockly.Tooltip.DIV)){Blockly.Tooltip.DIV.textContent="";for(var o=Blockly.Tooltip.getTooltipOfObject(Blockly.Tooltip.element_),l=(o=Blockly.utils.string.wrap(o,Blockly.Tooltip.LIMIT)).split("\n"),t=0;t<l.length;t++){var e=document.createElement("div");e.appendChild(document.createTextNode(l[t])),Blockly.Tooltip.DIV.appendChild(e)}var i=Blockly.Tooltip.element_.RTL,c=document.documentElement.clientWidth,p=document.documentElement.clientHeight;Blockly.Tooltip.DIV.style.direction=i?"rtl":"ltr",Blockly.Tooltip.DIV.style.display="block",Blockly.Tooltip.visible=!0;var n=Blockly.Tooltip.lastX_;i?n-=Blockly.Tooltip.OFFSET_X+Blockly.Tooltip.DIV.offsetWidth:n+=Blockly.Tooltip.OFFSET_X;var T=Blockly.Tooltip.lastY_+Blockly.Tooltip.OFFSET_Y;T+Blockly.Tooltip.DIV.offsetHeight>p+window.scrollY&&(T-=Blockly.Tooltip.DIV.offsetHeight+2*Blockly.Tooltip.OFFSET_Y),i?n=Math.max(Blockly.Tooltip.MARGINS-window.scrollX,n):n+Blockly.Tooltip.DIV.offsetWidth>c+window.scrollX-2*Blockly.Tooltip.MARGINS&&(n=c-Blockly.Tooltip.DIV.offsetWidth-2*Blockly.Tooltip.MARGINS),Blockly.Tooltip.DIV.style.top=T+"px",Blockly.Tooltip.DIV.style.left=n+"px"}};