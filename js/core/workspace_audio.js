/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.WorkspaceAudio"),goog.require("Blockly.constants"),goog.require("Blockly.utils"),goog.require("Blockly.utils.global"),goog.require("Blockly.utils.userAgent"),goog.requireType("Blockly.WorkspaceSvg"),Blockly.WorkspaceAudio=function(o){this.parentWorkspace_=o,this.SOUNDS_=Object.create(null)},Blockly.WorkspaceAudio.prototype.lastSound_=null,Blockly.WorkspaceAudio.prototype.dispose=function(){this.parentWorkspace_=null,this.SOUNDS_=null},Blockly.WorkspaceAudio.prototype.load=function(o,l){if(o.length){try{var e=new Blockly.utils.global.Audio}catch(o){return}for(var t,r=0;r<o.length;r++){var i=o[r],a=i.match(/\.(\w+)$/);if(a&&e.canPlayType("audio/"+a[1])){t=new Blockly.utils.global.Audio(i);break}}t&&t.play&&(this.SOUNDS_[l]=t)}},Blockly.WorkspaceAudio.prototype.preload=function(){for(var o in this.SOUNDS_){var l=this.SOUNDS_[o];l.volume=.01;var e=l.play();if(void 0!==e?e.then(l.pause).catch(function(){}):l.pause(),Blockly.utils.userAgent.IPAD||Blockly.utils.userAgent.IPHONE)break}},Blockly.WorkspaceAudio.prototype.play=function(o,l){var e=this.SOUNDS_[o];if(e){var t,r=new Date;if(null!=this.lastSound_&&r-this.lastSound_<Blockly.SOUND_LIMIT)return;this.lastSound_=r,(t=Blockly.utils.userAgent.IPAD||Blockly.utils.userAgent.ANDROID?e:e.cloneNode()).volume=void 0===l?1:l,t.play()}else this.parentWorkspace_&&this.parentWorkspace_.getAudioManager().play(o,l)};