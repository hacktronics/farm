/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.ContextMenuItems"),goog.require("Blockly.constants"),goog.require("Blockly.ContextMenuRegistry"),goog.require("Blockly.Events"),goog.require("Blockly.inputTypes"),goog.requireType("Blockly.BlockSvg"),Blockly.ContextMenuItems.registerUndo=function(){var e={displayText:function(){return Blockly.Msg.UNDO},preconditionFn:function(e){return e.workspace.getUndoStack().length>0?"enabled":"disabled"},callback:function(e){e.workspace.undo(!1)},scopeType:Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerRedo=function(){var e={displayText:function(){return Blockly.Msg.REDO},preconditionFn:function(e){return e.workspace.getRedoStack().length>0?"enabled":"disabled"},callback:function(e){e.workspace.undo(!0)},scopeType:Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerCleanup=function(){var e={displayText:function(){return Blockly.Msg.CLEAN_UP},preconditionFn:function(e){return e.workspace.isMovable()?e.workspace.getTopBlocks(!1).length>1?"enabled":"disabled":"hidden"},callback:function(e){e.workspace.cleanUp()},scopeType:Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.toggleOption_=function(e,t){for(var o=0,l=0;l<t.length;l++)for(var n=t[l];n;)setTimeout(n.setCollapsed.bind(n,e),o),n=n.getNextBlock(),o+=10},Blockly.ContextMenuItems.registerCollapse=function(){var e={displayText:function(){return Blockly.Msg.COLLAPSE_ALL},preconditionFn:function(e){if(e.workspace.options.collapse){for(var t=e.workspace.getTopBlocks(!1),o=0;o<t.length;o++){var l=t[o];if(!l.isCollapsed()&&null==l.previousConnection&&null==l.outputConnection)return"enabled"}return"disabled"}return"hidden"},callback:function(e){Blockly.ContextMenuItems.toggleOption_(!0,e.workspace.getTopBlocks(!0))},scopeType:Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerExpand=function(){var e={displayText:function(){return Blockly.Msg.EXPAND_ALL},preconditionFn:function(e){if(e.workspace.options.collapse){for(var t=e.workspace.getTopBlocks(!1),o=0;o<t.length;o++)for(var l=t[o];l;){if(l.isCollapsed())return"enabled";l=l.getNextBlock()}return"disabled"}return"hidden"},callback:function(e){Blockly.ContextMenuItems.toggleOption_(!1,e.workspace.getTopBlocks(!0))},scopeType:Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.addDeletableBlocks_=function(e,t){if(e.isDeletable())Array.prototype.push.apply(t,e.getDescendants(!1));else for(var o=e.getChildren(!1),l=0;l<o.length;l++)Blockly.ContextMenuItems.addDeletableBlocks_(o[l],t)},Blockly.ContextMenuItems.getDeletableBlocks_=function(e){for(var t=[],o=e.getTopBlocks(!0),l=0;l<o.length;l++)Blockly.ContextMenuItems.addDeletableBlocks_(o[l],t);return t},Blockly.ContextMenuItems.deleteNext_=function(e,t){Blockly.Events.setGroup(t);var o=e.shift();o&&(o.workspace?(o.dispose(!1,!0),setTimeout(Blockly.ContextMenuItems.deleteNext_,10,e,t)):Blockly.ContextMenuItems.deleteNext_(e,t)),Blockly.Events.setGroup(!1)},Blockly.ContextMenuItems.registerDeleteAll=function(){var e={displayText:function(e){if(e.workspace){var t=Blockly.ContextMenuItems.getDeletableBlocks_(e.workspace).length;return 1==t?Blockly.Msg.DELETE_BLOCK:Blockly.Msg.DELETE_X_BLOCKS.replace("%1",String(t))}},preconditionFn:function(e){if(e.workspace)return Blockly.ContextMenuItems.getDeletableBlocks_(e.workspace).length>0?"enabled":"disabled"},callback:function(e){if(e.workspace){e.workspace.cancelCurrentGesture();var t=Blockly.ContextMenuItems.getDeletableBlocks_(e.workspace),o=Blockly.utils.genUid();t.length<2?Blockly.ContextMenuItems.deleteNext_(t,o):Blockly.confirm(Blockly.Msg.DELETE_ALL_BLOCKS.replace("%1",t.length),function(e){e&&Blockly.ContextMenuItems.deleteNext_(t,o)})}},scopeType:Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerWorkspaceOptions_=function(){Blockly.ContextMenuItems.registerUndo(),Blockly.ContextMenuItems.registerRedo(),Blockly.ContextMenuItems.registerCleanup(),Blockly.ContextMenuItems.registerCollapse(),Blockly.ContextMenuItems.registerExpand(),Blockly.ContextMenuItems.registerDeleteAll()},Blockly.ContextMenuItems.registerDuplicate=function(){var e={displayText:function(){return Blockly.Msg.DUPLICATE_BLOCK},preconditionFn:function(e){var t=e.block;return!t.isInFlyout&&t.isDeletable()&&t.isMovable()?t.isDuplicatable()?"enabled":"disabled":"hidden"},callback:function(e){e.block&&Blockly.duplicate(e.block)},scopeType:Blockly.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDuplicate",weight:1};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerComment=function(){var e={displayText:function(e){return e.block.getCommentIcon()?Blockly.Msg.REMOVE_COMMENT:Blockly.Msg.ADD_COMMENT},preconditionFn:function(e){var t=e.block;return Blockly.utils.userAgent.IE||t.isInFlyout||!t.workspace.options.comments||t.isCollapsed()||!t.isEditable()?"hidden":"enabled"},callback:function(e){var t=e.block;t.getCommentIcon()?t.setCommentText(null):t.setCommentText("")},scopeType:Blockly.ContextMenuRegistry.ScopeType.BLOCK,id:"blockComment",weight:2};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerInline=function(){var e={displayText:function(e){return e.block.getInputsInline()?Blockly.Msg.EXTERNAL_INPUTS:Blockly.Msg.INLINE_INPUTS},preconditionFn:function(e){var t=e.block;if(!t.isInFlyout&&t.isMovable()&&!t.isCollapsed())for(var o=1;o<t.inputList.length;o++)if(t.inputList[o-1].type!=Blockly.inputTypes.STATEMENT&&t.inputList[o].type!=Blockly.inputTypes.STATEMENT)return"enabled";return"hidden"},callback:function(e){e.block.setInputsInline(!e.block.getInputsInline())},scopeType:Blockly.ContextMenuRegistry.ScopeType.BLOCK,id:"blockInline",weight:3};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerCollapseExpandBlock=function(){var e={displayText:function(e){return e.block.isCollapsed()?Blockly.Msg.EXPAND_BLOCK:Blockly.Msg.COLLAPSE_BLOCK},preconditionFn:function(e){var t=e.block;return!t.isInFlyout&&t.isMovable()&&t.workspace.options.collapse&&null==e.block.previousConnection&&null==e.block.outputConnection?"enabled":"hidden"},callback:function(e){e.block.setCollapsed(!e.block.isCollapsed())},scopeType:Blockly.ContextMenuRegistry.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerDisable=function(){var e={displayText:function(e){return e.block.isEnabled()?Blockly.Msg.DISABLE_BLOCK:Blockly.Msg.ENABLE_BLOCK},preconditionFn:function(e){var t=e.block;return!t.isInFlyout&&t.workspace.options.disable&&t.isEditable()?t.getInheritedDisabled()?"disabled":"enabled":"hidden"},callback:function(e){var t=e.block,o=Blockly.Events.getGroup();o||Blockly.Events.setGroup(!0),t.setEnabled(!t.isEnabled()),o||Blockly.Events.setGroup(!1)},scopeType:Blockly.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDisable",weight:5};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerDelete=function(){var e={displayText:function(e){var t=e.block,o=t.getDescendants(!1).length,l=t.getNextBlock();return l&&(o-=l.getDescendants(!1).length),1==o?Blockly.Msg.DELETE_BLOCK:Blockly.Msg.DELETE_X_BLOCKS.replace("%1",String(o))},preconditionFn:function(e){return!e.block.isInFlyout&&e.block.isDeletable()?"enabled":"hidden"},callback:function(e){Blockly.Events.setGroup(!0),e.block&&Blockly.deleteBlock(e.block),Blockly.Events.setGroup(!1)},scopeType:Blockly.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDelete",weight:6};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerHelp=function(){var e={displayText:function(){return Blockly.Msg.HELP},preconditionFn:function(e){var t=e.block;return("function"==typeof t.helpUrl?t.helpUrl():t.helpUrl)?"enabled":"hidden"},callback:function(e){e.block.showHelp()},scopeType:Blockly.ContextMenuRegistry.ScopeType.BLOCK,id:"blockHelp",weight:7};Blockly.ContextMenuRegistry.registry.register(e)},Blockly.ContextMenuItems.registerBlockOptions_=function(){Blockly.ContextMenuItems.registerDuplicate(),Blockly.ContextMenuItems.registerComment(),Blockly.ContextMenuItems.registerCollapseExpandBlock(),Blockly.ContextMenuItems.registerDisable(),Blockly.ContextMenuItems.registerDelete(),Blockly.ContextMenuItems.registerHelp()},Blockly.ContextMenuItems.registerDefaultOptions=function(){Blockly.ContextMenuItems.registerWorkspaceOptions_(),Blockly.ContextMenuItems.registerBlockOptions_()},Blockly.ContextMenuItems.registerDefaultOptions();