/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Grid"),goog.require("Blockly.utils.dom"),goog.require("Blockly.utils.Svg"),goog.require("Blockly.utils.userAgent"),Blockly.Grid=function(t,i){this.gridPattern_=t,this.spacing_=i.spacing,this.length_=i.length,this.line1_=t.firstChild,this.line2_=this.line1_&&this.line1_.nextSibling,this.snapToGrid_=i.snap,this.imageOptions_=i.image},Blockly.Grid.prototype.scale_=1,Blockly.Grid.prototype.dispose=function(){this.gridPattern_=null},Blockly.Grid.prototype.shouldSnap=function(){return this.snapToGrid_},Blockly.Grid.prototype.getSpacing=function(){return this.spacing_},Blockly.Grid.prototype.getPatternId=function(){return this.gridPattern_.id},Blockly.Grid.prototype.update=function(t){this.scale_=t;var i=this.spacing_*t||100;this.gridPattern_.setAttribute("width",this.imageOptions_&&this.imageOptions_.width?this.imageOptions_.width:i),this.gridPattern_.setAttribute("height",this.imageOptions_&&this.imageOptions_.height?this.imageOptions_.height:i);var e=Math.floor(this.spacing_/2)+.5,s=e-this.length_/2,l=e+this.length_/2;e*=t,s*=t,l*=t,this.imageOptions_?this.gridPattern_.setAttribute("patternTransform","scale("+t+")"):(this.setLineAttributes_(this.line1_,t,s,l,e,e),this.setLineAttributes_(this.line2_,t,e,e,s,l))},Blockly.Grid.prototype.setLineAttributes_=function(t,i,e,s,l,r){t&&(t.setAttribute("stroke-width",i),t.setAttribute("x1",e),t.setAttribute("y1",l),t.setAttribute("x2",s),t.setAttribute("y2",r))},Blockly.Grid.prototype.moveTo=function(t,i){this.gridPattern_.setAttribute("x",t),this.gridPattern_.setAttribute("y",i),(Blockly.utils.userAgent.IE||Blockly.utils.userAgent.EDGE)&&this.update(this.scale_)},Blockly.Grid.createDom=function(t,i,e){var s=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.PATTERN,{id:"blocklyGridPattern"+t,patternUnits:"userSpaceOnUse"},e);if(i.length>0&&i.spacing>0)Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.LINE,{stroke:i.colour},s),i.length>1&&Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.LINE,{stroke:i.colour},s);else if(i.image&&i.image.path){var l=i.image,r=JSON.parse(JSON.stringify(l));delete r.path,Blockly.utils.dom.createSvgElement("image",r,s).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l.path),this.imageOptions_=l}else Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.LINE,{},s);return s};