/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.CollapsibleToolboxCategory"),goog.require("Blockly.ICollapsibleToolboxItem"),goog.require("Blockly.registry"),goog.require("Blockly.ToolboxCategory"),goog.require("Blockly.ToolboxItem"),goog.require("Blockly.ToolboxSeparator"),goog.require("Blockly.utils.aria"),goog.require("Blockly.utils.dom"),goog.require("Blockly.utils.object"),goog.require("Blockly.utils.toolbox"),goog.requireType("Blockly.IToolbox"),goog.requireType("Blockly.IToolboxItem"),Blockly.CollapsibleToolboxCategory=function(o,l,e){this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[],Blockly.CollapsibleToolboxCategory.superClass_.constructor.call(this,o,l,e)},Blockly.utils.object.inherits(Blockly.CollapsibleToolboxCategory,Blockly.ToolboxCategory),Blockly.CollapsibleToolboxCategory.CssConfig,Blockly.CollapsibleToolboxCategory.registrationName="collapsibleCategory",Blockly.CollapsibleToolboxCategory.prototype.makeDefaultCssConfig_=function(){var o=Blockly.CollapsibleToolboxCategory.superClass_.makeDefaultCssConfig_.call(this);return o.contents="blocklyToolboxContents",o},Blockly.CollapsibleToolboxCategory.prototype.parseContents_=function(o){var l=o.contents,e=!0;if(o.custom)this.flyoutItems_=o.custom;else if(l)for(var t,i=0;t=l[i];i++)if(!Blockly.registry.hasItem(Blockly.registry.Type.TOOLBOX_ITEM,t.kind)||t.kind.toLowerCase()==Blockly.ToolboxSeparator.registrationName&&e){var s=t;this.flyoutItems_.push(s),e=!0}else this.createToolboxItem_(t),e=!1},Blockly.CollapsibleToolboxCategory.prototype.createToolboxItem_=function(o){var l=o.kind,e=o;"CATEGORY"==l.toUpperCase()&&Blockly.utils.toolbox.isCategoryCollapsible(e)&&(l=Blockly.CollapsibleToolboxCategory.registrationName);var t=new(Blockly.registry.getClass(Blockly.registry.Type.TOOLBOX_ITEM,l))(o,this.parentToolbox_,this);this.toolboxItems_.push(t)},Blockly.CollapsibleToolboxCategory.prototype.init=function(){Blockly.CollapsibleToolboxCategory.superClass_.init.call(this),this.setExpanded("true"==this.toolboxItemDef_.expanded||this.toolboxItemDef_.expanded)},Blockly.CollapsibleToolboxCategory.prototype.createDom_=function(){Blockly.CollapsibleToolboxCategory.superClass_.createDom_.call(this);var o=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(o),Blockly.utils.aria.setRole(this.subcategoriesDiv_,Blockly.utils.aria.Role.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.htmlDiv_},Blockly.CollapsibleToolboxCategory.prototype.createIconDom_=function(){var o=document.createElement("span");return this.parentToolbox_.isHorizontal()||(Blockly.utils.dom.addClass(o,this.cssConfig_.icon),o.style.visibility="visible"),o.style.display="inline-block",o},Blockly.CollapsibleToolboxCategory.prototype.createSubCategoriesDom_=function(o){var l=document.createElement("div");Blockly.utils.dom.addClass(l,this.cssConfig_.contents);for(var e=0;e<o.length;e++){var t=o[e];t.init();var i=t.getDiv();l.appendChild(i),t.getClickTarget&&t.getClickTarget().setAttribute("id",t.getId())}return l},Blockly.CollapsibleToolboxCategory.prototype.setExpanded=function(o){this.expanded_!=o&&(this.expanded_=o,o?(this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_)):(this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)),Blockly.utils.aria.setState(this.htmlDiv_,Blockly.utils.aria.State.EXPANDED,o),this.parentToolbox_.handleToolboxItemResize())},Blockly.CollapsibleToolboxCategory.prototype.setVisible_=function(o){this.htmlDiv_.style.display=o?"block":"none";for(var l,e=0;l=this.getChildToolboxItems()[e];e++)l.setVisible_(o);this.isHidden_=!o,this.parentToolbox_.getSelectedItem()==this&&this.parentToolbox_.clearSelection()},Blockly.CollapsibleToolboxCategory.prototype.isExpanded=function(){return this.expanded_},Blockly.CollapsibleToolboxCategory.prototype.isCollapsible=function(){return!0},Blockly.CollapsibleToolboxCategory.prototype.onClick=function(o){this.toggleExpanded()},Blockly.CollapsibleToolboxCategory.prototype.toggleExpanded=function(){this.setExpanded(!this.expanded_)},Blockly.CollapsibleToolboxCategory.prototype.getDiv=function(){return this.htmlDiv_},Blockly.CollapsibleToolboxCategory.prototype.getChildToolboxItems=function(){return this.toolboxItems_},Blockly.registry.register(Blockly.registry.Type.TOOLBOX_ITEM,Blockly.CollapsibleToolboxCategory.registrationName,Blockly.CollapsibleToolboxCategory);