/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.ToolboxCategory"),goog.require("Blockly.ISelectableToolboxItem"),goog.require("Blockly.registry"),goog.require("Blockly.ToolboxItem"),goog.require("Blockly.utils"),goog.require("Blockly.utils.aria"),goog.require("Blockly.utils.dom"),goog.require("Blockly.utils.object"),goog.require("Blockly.utils.toolbox"),goog.requireType("Blockly.ICollapsibleToolboxItem"),goog.requireType("Blockly.IToolbox"),Blockly.ToolboxCategory=function(o,t,e){Blockly.ToolboxCategory.superClass_.constructor.call(this,o,t,e),this.name_=Blockly.utils.replaceMessageReferences(o.name),this.colour_=this.getColour_(o),this.htmlDiv_=null,this.rowDiv_=null,this.rowContents_=null,this.iconDom_=null,this.labelDom_=null,this.cssConfig_=this.makeDefaultCssConfig_();var l=o.cssconfig||o.cssConfig;Blockly.utils.object.mixin(this.cssConfig_,l),this.isHidden_=!1,this.isDisabled_=!1,this.flyoutItems_=[],this.parseContents_(o)},Blockly.utils.object.inherits(Blockly.ToolboxCategory,Blockly.ToolboxItem),Blockly.ToolboxCategory.CssConfig,Blockly.ToolboxCategory.registrationName="category",Blockly.ToolboxCategory.nestedPadding=19,Blockly.ToolboxCategory.borderWidth=8,Blockly.ToolboxCategory.defaultBackgroundColour="#57e",Blockly.ToolboxCategory.prototype.makeDefaultCssConfig_=function(){return{container:"blocklyToolboxCategory",row:"blocklyTreeRow",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyTreeIcon",label:"blocklyTreeLabel",contents:"blocklyToolboxContents",selected:"blocklyTreeSelected",openicon:"blocklyTreeIconOpen",closedicon:"blocklyTreeIconClosed"}},Blockly.ToolboxCategory.prototype.parseContents_=function(o){var t=o.contents;if(o.custom)this.flyoutItems_=o.custom;else if(t)for(var e,l=0;e=t[l];l++){var i=e;this.flyoutItems_.push(i)}},Blockly.ToolboxCategory.prototype.init=function(){this.createDom_(),"true"==this.toolboxItemDef_.hidden&&this.hide()},Blockly.ToolboxCategory.prototype.createDom_=function(){return this.htmlDiv_=this.createContainer_(),Blockly.utils.aria.setRole(this.htmlDiv_,Blockly.utils.aria.Role.TREEITEM),Blockly.utils.aria.setState(this.htmlDiv_,Blockly.utils.aria.State.SELECTED,!1),Blockly.utils.aria.setState(this.htmlDiv_,Blockly.utils.aria.State.LEVEL,this.level_),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),Blockly.utils.aria.setRole(this.iconDom_,Blockly.utils.aria.Role.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_),Blockly.utils.aria.setState(this.htmlDiv_,Blockly.utils.aria.State.LABELLEDBY,this.labelDom_.getAttribute("id")),this.addColourBorder_(this.colour_),this.htmlDiv_},Blockly.ToolboxCategory.prototype.createContainer_=function(){var o=document.createElement("div");return Blockly.utils.dom.addClass(o,this.cssConfig_.container),o},Blockly.ToolboxCategory.prototype.createRowContainer_=function(){var o=document.createElement("div");Blockly.utils.dom.addClass(o,this.cssConfig_.row);var t=Blockly.ToolboxCategory.nestedPadding*this.getLevel();return t=t.toString()+"px",this.workspace_.RTL?o.style.paddingRight=t:o.style.paddingLeft=t,o},Blockly.ToolboxCategory.prototype.createRowContentsContainer_=function(){var o=document.createElement("div");return Blockly.utils.dom.addClass(o,this.cssConfig_.rowcontentcontainer),o},Blockly.ToolboxCategory.prototype.createIconDom_=function(){var o=document.createElement("span");return this.parentToolbox_.isHorizontal()||Blockly.utils.dom.addClass(o,this.cssConfig_.icon),o.style.display="inline-block",o},Blockly.ToolboxCategory.prototype.createLabelDom_=function(o){var t=document.createElement("span");return t.setAttribute("id",this.getId()+".label"),t.textContent=o,Blockly.utils.dom.addClass(t,this.cssConfig_.label),t},Blockly.ToolboxCategory.prototype.refreshTheme=function(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)},Blockly.ToolboxCategory.prototype.addColourBorder_=function(o){if(o){var t=Blockly.ToolboxCategory.borderWidth+"px solid "+(o||"#ddd");this.workspace_.RTL?this.rowDiv_.style.borderRight=t:this.rowDiv_.style.borderLeft=t}},Blockly.ToolboxCategory.prototype.getColour_=function(o){var t=o.categorystyle||o.categoryStyle,e=o.colour;return e&&t?(console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour'),""):t?this.getColourfromStyle_(t):this.parseColour_(e)},Blockly.ToolboxCategory.prototype.getColourfromStyle_=function(o){var t=this.workspace_.getTheme();if(o&&t){var e=t.categoryStyles[o];if(e&&e.colour)return this.parseColour_(e.colour);console.warn('Style "'+o+'" must exist and contain a colour value')}return""},Blockly.ToolboxCategory.prototype.getClickTarget=function(){return this.rowDiv_},Blockly.ToolboxCategory.prototype.parseColour_=function(o){var t=Blockly.utils.replaceMessageReferences(o);if(null==t||""===t)return"";var e=Number(t);if(isNaN(e)){var l=Blockly.utils.colour.parse(t);return l||(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+t),"")}return Blockly.hueToHex(e)},Blockly.ToolboxCategory.prototype.openIcon_=function(o){o&&(Blockly.utils.dom.removeClasses(o,this.cssConfig_.closedicon),Blockly.utils.dom.addClass(o,this.cssConfig_.openicon))},Blockly.ToolboxCategory.prototype.closeIcon_=function(o){o&&(Blockly.utils.dom.removeClasses(o,this.cssConfig_.openicon),Blockly.utils.dom.addClass(o,this.cssConfig_.closedicon))},Blockly.ToolboxCategory.prototype.setVisible_=function(o){this.htmlDiv_.style.display=o?"block":"none",this.isHidden_=!o,this.parentToolbox_.getSelectedItem()==this&&this.parentToolbox_.clearSelection()},Blockly.ToolboxCategory.prototype.hide=function(){this.setVisible_(!1)},Blockly.ToolboxCategory.prototype.show=function(){this.setVisible_(!0)},Blockly.ToolboxCategory.prototype.isVisible=function(){return!this.isHidden_&&this.allAncestorsExpanded_()},Blockly.ToolboxCategory.prototype.allAncestorsExpanded_=function(){for(var o=this;o.getParent();)if(!(o=o.getParent()).isExpanded())return!1;return!0},Blockly.ToolboxCategory.prototype.isSelectable=function(){return this.isVisible()&&!this.isDisabled_},Blockly.ToolboxCategory.prototype.onClick=function(o){},Blockly.ToolboxCategory.prototype.setSelected=function(o){if(o){var t=this.parseColour_(Blockly.ToolboxCategory.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||t,Blockly.utils.dom.addClass(this.rowDiv_,this.cssConfig_.selected)}else this.rowDiv_.style.backgroundColor="",Blockly.utils.dom.removeClass(this.rowDiv_,this.cssConfig_.selected);Blockly.utils.aria.setState(this.htmlDiv_,Blockly.utils.aria.State.SELECTED,o)},Blockly.ToolboxCategory.prototype.setDisabled=function(o){this.isDisabled_=o,this.getDiv().setAttribute("disabled",o),o?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")},Blockly.ToolboxCategory.prototype.getName=function(){return this.name_},Blockly.ToolboxCategory.prototype.getParent=function(){return this.parent_},Blockly.ToolboxCategory.prototype.getDiv=function(){return this.htmlDiv_},Blockly.ToolboxCategory.prototype.getContents=function(){return this.flyoutItems_},Blockly.ToolboxCategory.prototype.updateFlyoutContents=function(o){this.flyoutItems_=[],"string"==typeof o?this.toolboxItemDef_.custom=o:(delete this.toolboxItemDef_.custom,this.toolboxItemDef_.contents=Blockly.utils.toolbox.convertFlyoutDefToJsonArray(o)),this.parseContents_(this.toolboxItemDef_)},Blockly.ToolboxCategory.prototype.dispose=function(){Blockly.utils.dom.removeNode(this.htmlDiv_)},Blockly.Css.register([".blocklyTreeRow:not(.blocklyTreeSelected):hover {","background-color: rgba(255, 255, 255, 0.2);","}",'.blocklyToolboxDiv[layout="h"] .blocklyToolboxCategory {',"margin: 1px 5px 1px 0;","}",'.blocklyToolboxDiv[dir="RTL"][layout="h"] .blocklyToolboxCategory {',"margin: 1px 0 1px 5px;","}",".blocklyTreeRow {","height: 22px;","line-height: 22px;","margin-bottom: 3px;","padding-right: 8px;","white-space: nowrap;","}",'.blocklyToolboxDiv[dir="RTL"] .blocklyTreeRow {',"margin-left: 8px;","padding-right: 0px","}",".blocklyTreeIcon {","background-image: url(<<<PATH>>>/sprites.png);","height: 16px;","vertical-align: middle;","visibility: hidden;","width: 16px;","}",".blocklyTreeIconClosed {","background-position: -32px -1px;","}",'.blocklyToolboxDiv[dir="RTL"] .blocklyTreeIconClosed {',"background-position: 0 -1px;","}",".blocklyTreeSelected>.blocklyTreeIconClosed {","background-position: -32px -17px;","}",'.blocklyToolboxDiv[dir="RTL"] .blocklyTreeSelected>.blocklyTreeIconClosed {',"background-position: 0 -17px;","}",".blocklyTreeIconOpen {","background-position: -16px -1px;","}",".blocklyTreeSelected>.blocklyTreeIconOpen {","background-position: -16px -17px;","}",".blocklyTreeLabel {","cursor: default;","font: 16px sans-serif;","padding: 0 3px;","vertical-align: middle;","}",".blocklyToolboxDelete .blocklyTreeLabel {",'cursor: url("<<<PATH>>>/handdelete.cur"), auto;',"}",".blocklyTreeSelected .blocklyTreeLabel {","color: #fff;","}"]),Blockly.registry.register(Blockly.registry.Type.TOOLBOX_ITEM,Blockly.ToolboxCategory.registrationName,Blockly.ToolboxCategory);