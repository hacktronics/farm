/**
 * @license
 * Copyright 2012 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Generator"),goog.require("Blockly.Block"),goog.require("Blockly.constants"),goog.require("Blockly.utils.deprecation"),goog.requireType("Blockly.Names"),goog.requireType("Blockly.Workspace"),Blockly.Generator=function(e){this.name_=e,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")},Blockly.Generator.prototype.INFINITE_LOOP_TRAP=null,Blockly.Generator.prototype.STATEMENT_PREFIX=null,Blockly.Generator.prototype.STATEMENT_SUFFIX=null,Blockly.Generator.prototype.INDENT="  ",Blockly.Generator.prototype.COMMENT_WRAP=60,Blockly.Generator.prototype.ORDER_OVERRIDES=[],Blockly.Generator.prototype.isInitialized=null,Blockly.Generator.prototype.workspaceToCode=function(e){e||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),e=Blockly.getMainWorkspace());var t=[];this.init(e);for(var r,o=e.getTopBlocks(!0),i=0;r=o[i];i++){var n=this.blockToCode(r);Array.isArray(n)&&(n=n[0]),n&&(r.outputConnection&&(n=this.scrubNakedValue(n),this.STATEMENT_PREFIX&&!r.suppressPrefixSuffix&&(n=this.injectId(this.STATEMENT_PREFIX,r)+n),this.STATEMENT_SUFFIX&&!r.suppressPrefixSuffix&&(n+=this.injectId(this.STATEMENT_SUFFIX,r))),t.push(n))}return t=t.join("\n"),t=(t=(t=(t=this.finish(t)).replace(/^\s+\n/,"")).replace(/\n\s+$/,"\n")).replace(/[ \t]+\n/g,"\n")},Blockly.Generator.prototype.prefixLines=function(e,t){return t+e.replace(/(?!\n$)\n/g,"\n"+t)},Blockly.Generator.prototype.allNestedComments=function(e){for(var t=[],r=e.getDescendants(!0),o=0;o<r.length;o++){var i=r[o].getCommentText();i&&t.push(i)}return t.length&&t.push(""),t.join("\n")},Blockly.Generator.prototype.blockToCode=function(e,t){if(!1===this.isInitialized&&console.warn("Generator init was not called before blockToCode was called."),!e)return"";if(!e.isEnabled())return t?"":this.blockToCode(e.getNextBlock());if(e.isInsertionMarker())return t?"":this.blockToCode(e.getChildren(!1)[0]);var r=this[e.type];if("function"!=typeof r)throw Error('Language "'+this.name_+'" does not know how to generate code for block type "'+e.type+'".');var o=r.call(e,e);if(Array.isArray(o)){if(!e.outputConnection)throw TypeError("Expecting string from statement block: "+e.type);return[this.scrub_(e,o[0],t),o[1]]}if("string"==typeof o)return this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(o=this.injectId(this.STATEMENT_PREFIX,e)+o),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(o+=this.injectId(this.STATEMENT_SUFFIX,e)),this.scrub_(e,o,t);if(null===o)return"";throw SyntaxError("Invalid code generated: "+o)},Blockly.Generator.prototype.valueToCode=function(e,t,r){if(isNaN(r))throw TypeError("Expecting valid order from block: "+e.type);var o=e.getInputTargetBlock(t);if(!o)return"";var i=this.blockToCode(o);if(""===i)return"";if(!Array.isArray(i))throw TypeError("Expecting tuple from value block: "+o.type);var n=i[0],l=i[1];if(isNaN(l))throw TypeError("Expecting valid order from value block: "+o.type);if(!n)return"";var s=!1,a=Math.floor(r),c=Math.floor(l);if(a<=c)if(a!=c||0!=a&&99!=a){s=!0;for(var p=0;p<this.ORDER_OVERRIDES.length;p++)if(this.ORDER_OVERRIDES[p][0]==r&&this.ORDER_OVERRIDES[p][1]==l){s=!1;break}}else;return s&&(n="("+n+")"),n},Blockly.Generator.prototype.statementToCode=function(e,t){var r=e.getInputTargetBlock(t),o=this.blockToCode(r);if("string"!=typeof o)throw TypeError("Expecting code from statement block: "+(r&&r.type));return o&&(o=this.prefixLines(o,this.INDENT)),o},Blockly.Generator.prototype.addLoopTrap=function(e,t){return this.INFINITE_LOOP_TRAP&&(e=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,t),this.INDENT)+e),this.STATEMENT_SUFFIX&&!t.suppressPrefixSuffix&&(e=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+e),this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(e+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,t),this.INDENT)),e},Blockly.Generator.prototype.injectId=function(e,t){var r=t.id.replace(/\$/g,"$$$$");return e.replace(/%1/g,"'"+r+"'")},Blockly.Generator.prototype.RESERVED_WORDS_="",Blockly.Generator.prototype.addReservedWords=function(e){this.RESERVED_WORDS_+=e+","},Blockly.Generator.prototype.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",Blockly.Generator.prototype.definitions_,Blockly.Generator.prototype.functionNames_,Blockly.Generator.prototype.nameDB_,Object.defineProperty(Blockly.Generator.prototype,"variableDB_",{get:function(){return Blockly.utils.deprecation.warn("variableDB_","May 2021","May 2026","nameDB_"),this.nameDB_},set:function(e){Blockly.utils.deprecation.warn("variableDB_","May 2021","May 2026","nameDB_"),this.nameDB_=e}}),Blockly.Generator.prototype.provideFunction_=function(e,t){if(!this.definitions_[e]){var r=this.nameDB_.getDistinctName(e,Blockly.PROCEDURE_CATEGORY_NAME);this.functionNames_[e]=r;for(var o,i=t.join("\n").replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,r);o!=i;)o=i,i=i.replace(/^(( {2})*) {2}/gm,"$1\0");i=i.replace(/\0/g,this.INDENT),this.definitions_[e]=i}return this.functionNames_[e]},Blockly.Generator.prototype.init=function(e){this.definitions_=Object.create(null),this.functionNames_=Object.create(null)},Blockly.Generator.prototype.scrub_=function(e,t,r){return t},Blockly.Generator.prototype.finish=function(e){return delete this.definitions_,delete this.functionNames_,e},Blockly.Generator.prototype.scrubNakedValue=function(e){return e};