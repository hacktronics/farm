/**
 * @license
 * Copyright 2015 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.ZoomControls"),goog.require("Blockly.browserEvents"),goog.require("Blockly.ComponentManager"),goog.require("Blockly.constants"),goog.require("Blockly.Css"),goog.require("Blockly.Events"),goog.require("Blockly.Events.Click"),goog.require("Blockly.IPositionable"),goog.require("Blockly.Touch"),goog.require("Blockly.uiPosition"),goog.require("Blockly.utils"),goog.require("Blockly.utils.dom"),goog.require("Blockly.utils.Rect"),goog.require("Blockly.utils.Svg"),goog.requireType("Blockly.WorkspaceSvg"),Blockly.ZoomControls=function(o){this.workspace_=o,this.id="zoomControls",this.onZoomResetWrapper_=null,this.onZoomInWrapper_=null,this.onZoomOutWrapper_=null,this.zoomInGroup_=null,this.zoomOutGroup_=null,this.zoomResetGroup_=null},Blockly.ZoomControls.prototype.WIDTH_=32,Blockly.ZoomControls.prototype.HEIGHT_=32,Blockly.ZoomControls.prototype.SMALL_SPACING_=2,Blockly.ZoomControls.prototype.LARGE_SPACING_=11,Blockly.ZoomControls.prototype.MARGIN_VERTICAL_=20,Blockly.ZoomControls.prototype.MARGIN_HORIZONTAL_=20,Blockly.ZoomControls.prototype.svgGroup_=null,Blockly.ZoomControls.prototype.left_=0,Blockly.ZoomControls.prototype.top_=0,Blockly.ZoomControls.prototype.initialized_=!1,Blockly.ZoomControls.prototype.createDom=function(){this.svgGroup_=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.G,{},null);var o=String(Math.random()).substring(2);return this.createZoomOutSvg_(o),this.createZoomInSvg_(o),this.workspace_.isMovable()&&this.createZoomResetSvg_(o),this.svgGroup_},Blockly.ZoomControls.prototype.init=function(){this.workspace_.getComponentManager().addComponent({component:this,weight:2,capabilities:[Blockly.ComponentManager.Capability.POSITIONABLE]}),this.initialized_=!0},Blockly.ZoomControls.prototype.dispose=function(){this.workspace_.getComponentManager().removeComponent("zoomControls"),this.svgGroup_&&Blockly.utils.dom.removeNode(this.svgGroup_),this.onZoomResetWrapper_&&Blockly.browserEvents.unbind(this.onZoomResetWrapper_),this.onZoomInWrapper_&&Blockly.browserEvents.unbind(this.onZoomInWrapper_),this.onZoomOutWrapper_&&Blockly.browserEvents.unbind(this.onZoomOutWrapper_)},Blockly.ZoomControls.prototype.getBoundingRectangle=function(){var o=this.SMALL_SPACING_+2*this.HEIGHT_;this.zoomResetGroup_&&(o+=this.LARGE_SPACING_+this.HEIGHT_);var t=this.top_+o,l=this.left_+this.WIDTH_;return new Blockly.utils.Rect(this.top_,t,this.left_,l)},Blockly.ZoomControls.prototype.position=function(o,t){if(this.initialized_){var l=Blockly.uiPosition.getCornerOppositeToolbox(this.workspace_,o),e=this.SMALL_SPACING_+2*this.HEIGHT_;this.zoomResetGroup_&&(e+=this.LARGE_SPACING_+this.HEIGHT_);var i=Blockly.uiPosition.getStartPositionRect(l,new Blockly.utils.Size(this.WIDTH_,e),this.MARGIN_HORIZONTAL_,this.MARGIN_VERTICAL_,o,this.workspace_),s=l.vertical,r=s===Blockly.uiPosition.verticalPosition.TOP?Blockly.uiPosition.bumpDirection.DOWN:Blockly.uiPosition.bumpDirection.UP,n=Blockly.uiPosition.bumpPositionRect(i,this.MARGIN_VERTICAL_,r,t);if(s===Blockly.uiPosition.verticalPosition.TOP){var c=this.SMALL_SPACING_+this.HEIGHT_;if(this.zoomInGroup_.setAttribute("transform","translate(0, "+c+")"),this.zoomResetGroup_){var p=c+this.LARGE_SPACING_+this.HEIGHT_;this.zoomResetGroup_.setAttribute("transform","translate(0, "+p+")")}}else{c=this.zoomResetGroup_?this.LARGE_SPACING_+this.HEIGHT_:0;this.zoomInGroup_.setAttribute("transform","translate(0, "+c+")");var u=c+this.SMALL_SPACING_+this.HEIGHT_;this.zoomOutGroup_.setAttribute("transform","translate(0, "+u+")")}this.top_=n.top,this.left_=n.left,this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")")}},Blockly.ZoomControls.prototype.createZoomOutSvg_=function(o){this.zoomOutGroup_=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.G,{class:"blocklyZoom"},this.svgGroup_);var t=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.CLIPPATH,{id:"blocklyZoomoutClipPath"+o},this.zoomOutGroup_);Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{width:32,height:32},t),Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.IMAGE,{width:Blockly.SPRITE.width,height:Blockly.SPRITE.height,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+o+")"},this.zoomOutGroup_).setAttributeNS(Blockly.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+Blockly.SPRITE.url),this.onZoomOutWrapper_=Blockly.browserEvents.conditionalBind(this.zoomOutGroup_,"mousedown",null,this.zoom_.bind(this,-1))},Blockly.ZoomControls.prototype.createZoomInSvg_=function(o){this.zoomInGroup_=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.G,{class:"blocklyZoom"},this.svgGroup_);var t=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.CLIPPATH,{id:"blocklyZoominClipPath"+o},this.zoomInGroup_);Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{width:32,height:32},t),Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.IMAGE,{width:Blockly.SPRITE.width,height:Blockly.SPRITE.height,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+o+")"},this.zoomInGroup_).setAttributeNS(Blockly.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+Blockly.SPRITE.url),this.onZoomInWrapper_=Blockly.browserEvents.conditionalBind(this.zoomInGroup_,"mousedown",null,this.zoom_.bind(this,1))},Blockly.ZoomControls.prototype.zoom_=function(o,t){this.workspace_.markFocused(),this.workspace_.zoomCenter(o),this.fireZoomEvent_(),Blockly.Touch.clearTouchIdentifier(),t.stopPropagation(),t.preventDefault()},Blockly.ZoomControls.prototype.createZoomResetSvg_=function(o){this.zoomResetGroup_=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.G,{class:"blocklyZoom"},this.svgGroup_);var t=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.CLIPPATH,{id:"blocklyZoomresetClipPath"+o},this.zoomResetGroup_);Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{width:32,height:32},t),Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.IMAGE,{width:Blockly.SPRITE.width,height:Blockly.SPRITE.height,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+o+")"},this.zoomResetGroup_).setAttributeNS(Blockly.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+Blockly.SPRITE.url),this.onZoomResetWrapper_=Blockly.browserEvents.conditionalBind(this.zoomResetGroup_,"mousedown",null,this.resetZoom_.bind(this))},Blockly.ZoomControls.prototype.resetZoom_=function(o){this.workspace_.markFocused();var t=this.workspace_.options.zoomOptions.startScale,l=this.workspace_.scale,e=this.workspace_.options.zoomOptions.scaleSpeed,i=Math.log(t/l)/Math.log(e);this.workspace_.beginCanvasTransition(),this.workspace_.zoomCenter(i),this.workspace_.scrollCenter(),setTimeout(this.workspace_.endCanvasTransition.bind(this.workspace_),500),this.fireZoomEvent_(),Blockly.Touch.clearTouchIdentifier(),o.stopPropagation(),o.preventDefault()},Blockly.ZoomControls.prototype.fireZoomEvent_=function(){var o=new(Blockly.Events.get(Blockly.Events.CLICK))(null,this.workspace_.id,"zoom_controls");Blockly.Events.fire(o)},Blockly.Css.register([".blocklyZoom>image, .blocklyZoom>svg>image {","opacity: .4;","}",".blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {","opacity: .6;","}",".blocklyZoom>image:active, .blocklyZoom>svg>image:active {","opacity: .8;","}"]);