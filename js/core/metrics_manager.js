/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.FlyoutMetricsManager"),goog.provide("Blockly.MetricsManager"),goog.require("Blockly.IMetricsManager"),goog.require("Blockly.registry"),goog.require("Blockly.utils.Size"),goog.require("Blockly.utils.toolbox"),goog.requireType("Blockly.IFlyout"),goog.requireType("Blockly.IToolbox"),goog.requireType("Blockly.utils.Metrics"),goog.requireType("Blockly.WorkspaceSvg"),Blockly.MetricsManager=function(t){this.workspace_=t},Blockly.MetricsManager.ToolboxMetrics,Blockly.MetricsManager.AbsoluteMetrics,Blockly.MetricsManager.ContainerRegion,Blockly.MetricsManager.FixedEdges,Blockly.MetricsManager.UiMetrics,Blockly.MetricsManager.prototype.getDimensionsPx_=function(t){var o=0,e=0;return t&&(o=t.getWidth(),e=t.getHeight()),new Blockly.utils.Size(o,e)},Blockly.MetricsManager.prototype.getFlyoutMetrics=function(t){var o=this.getDimensionsPx_(this.workspace_.getFlyout(t));return{width:o.width,height:o.height,position:this.workspace_.toolboxPosition}},Blockly.MetricsManager.prototype.getToolboxMetrics=function(){var t=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:t.width,height:t.height,position:this.workspace_.toolboxPosition}},Blockly.MetricsManager.prototype.getSvgMetrics=function(){return this.workspace_.getCachedParentSvgSize()},Blockly.MetricsManager.prototype.getAbsoluteMetrics=function(){var t=0,o=this.getToolboxMetrics(),e=this.getFlyoutMetrics(!0),i=!!this.workspace_.getToolbox(),r=!!this.workspace_.getFlyout(!0),l=i?o.position:e.position,s=l==Blockly.utils.toolbox.Position.LEFT,c=l==Blockly.utils.toolbox.Position.TOP;i&&s?t=o.width:r&&s&&(t=e.width);var h=0;return i&&c?h=o.height:r&&c&&(h=e.height),{top:h,left:t}},Blockly.MetricsManager.prototype.getViewMetrics=function(t){var o=t?this.workspace_.scale:1,e=this.getSvgMetrics(),i=this.getToolboxMetrics(),r=this.getFlyoutMetrics(!0),l=!!this.workspace_.getToolbox()?i.position:r.position;return this.workspace_.getToolbox()?l==Blockly.utils.toolbox.Position.TOP||l==Blockly.utils.toolbox.Position.BOTTOM?e.height-=i.height:l!=Blockly.utils.toolbox.Position.LEFT&&l!=Blockly.utils.toolbox.Position.RIGHT||(e.width-=i.width):this.workspace_.getFlyout(!0)&&(l==Blockly.utils.toolbox.Position.TOP||l==Blockly.utils.toolbox.Position.BOTTOM?e.height-=r.height:l!=Blockly.utils.toolbox.Position.LEFT&&l!=Blockly.utils.toolbox.Position.RIGHT||(e.width-=r.width)),{height:e.height/o,width:e.width/o,top:-this.workspace_.scrollY/o,left:-this.workspace_.scrollX/o}},Blockly.MetricsManager.prototype.getContentMetrics=function(t){var o=t?1:this.workspace_.scale,e=this.workspace_.getBlocksBoundingBox();return{height:(e.bottom-e.top)*o,width:(e.right-e.left)*o,top:e.top*o,left:e.left*o}},Blockly.MetricsManager.prototype.hasFixedEdges=function(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()},Blockly.MetricsManager.prototype.getComputedFixedEdges_=function(t){if(!this.hasFixedEdges())return{};var o=this.workspace_.isMovableHorizontally(),e=this.workspace_.isMovableVertically(),i=t||this.getViewMetrics(!1),r={};return e||(r.top=i.top,r.bottom=i.top+i.height),o||(r.left=i.left,r.right=i.left+i.width),r},Blockly.MetricsManager.prototype.getPaddedContent_=function(t,o){var e=o.top+o.height,i=o.left+o.width,r=t.width,l=t.height,s=r/2,c=l/2,h=Math.min(o.top-c,e-l),g=Math.min(o.left-s,i-r);return{top:h,bottom:Math.max(e+c,o.top+l),left:g,right:Math.max(i+s,o.left+r)}},Blockly.MetricsManager.prototype.getScrollMetrics=function(t,o,e){var i=t?this.workspace_.scale:1,r=o||this.getViewMetrics(!1),l=e||this.getContentMetrics(),s=this.getComputedFixedEdges_(r),c=this.getPaddedContent_(r,l),h=void 0!==s.top?s.top:c.top,g=void 0!==s.left?s.left:c.left,n=void 0!==s.bottom?s.bottom:c.bottom;return{top:h/i,left:g/i,width:((void 0!==s.right?s.right:c.right)-g)/i,height:(n-h)/i}},Blockly.MetricsManager.prototype.getUiMetrics=function(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}},Blockly.MetricsManager.prototype.getMetrics=function(){var t=this.getToolboxMetrics(),o=this.getFlyoutMetrics(!0),e=this.getSvgMetrics(),i=this.getAbsoluteMetrics(),r=this.getViewMetrics(),l=this.getContentMetrics(),s=this.getScrollMetrics(!1,r,l);return{contentHeight:l.height,contentWidth:l.width,contentTop:l.top,contentLeft:l.left,scrollHeight:s.height,scrollWidth:s.width,scrollTop:s.top,scrollLeft:s.left,viewHeight:r.height,viewWidth:r.width,viewTop:r.top,viewLeft:r.left,absoluteTop:i.top,absoluteLeft:i.left,svgHeight:e.height,svgWidth:e.width,toolboxWidth:t.width,toolboxHeight:t.height,toolboxPosition:t.position,flyoutWidth:o.width,flyoutHeight:o.height}},Blockly.registry.register(Blockly.registry.Type.METRICS_MANAGER,Blockly.registry.DEFAULT,Blockly.MetricsManager),Blockly.FlyoutMetricsManager=function(t,o){this.flyout_=o,Blockly.FlyoutMetricsManager.superClass_.constructor.call(this,t)},Blockly.utils.object.inherits(Blockly.FlyoutMetricsManager,Blockly.MetricsManager),Blockly.FlyoutMetricsManager.prototype.getBoundingBox_=function(){try{var t=this.workspace_.getCanvas().getBBox()}catch(o){t={height:0,y:0,width:0,x:0}}return t},Blockly.FlyoutMetricsManager.prototype.getContentMetrics=function(t){var o=this.getBoundingBox_(),e=t?1:this.workspace_.scale;return{height:o.height*e,width:o.width*e,top:o.y*e,left:o.x*e}},Blockly.FlyoutMetricsManager.prototype.getScrollMetrics=function(t,o,e){var i=e||this.getContentMetrics(),r=this.flyout_.MARGIN*this.workspace_.scale,l=t?this.workspace_.scale:1,s=i.left;return{height:(i.height+2*r)/l,width:(i.width+s+r)/l,top:0,left:0}};