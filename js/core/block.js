/**
 * @license
 * Copyright 2011 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Block"),goog.require("Blockly.ASTNode"),goog.require("Blockly.Blocks"),goog.require("Blockly.Breakpoint"),goog.require("Blockly.Colours"),goog.require("Blockly.Connection"),goog.require("Blockly.connectionTypes"),goog.require("Blockly.constants"),goog.require("Blockly.Events"),goog.require("Blockly.Events.BlockChange"),goog.require("Blockly.Events.BlockCreate"),goog.require("Blockly.Events.BlockDelete"),goog.require("Blockly.Events.BlockMove"),goog.require("Blockly.Extensions"),goog.require("Blockly.FieldLabelHover"),goog.require("Blockly.FieldVariableGetter"),goog.require("Blockly.fieldRegistry"),goog.require("Blockly.IASTNodeLocation"),goog.require("Blockly.IDeletable"),goog.require("Blockly.Input"),goog.require("Blockly.inputTypes"),goog.require("Blockly.Tooltip"),goog.require("Blockly.utils"),goog.require("Blockly.utils.Coordinate"),goog.require("Blockly.utils.object"),goog.require("Blockly.utils.Size"),goog.require("Blockly.Workspace"),goog.requireType("Blockly.Comment"),goog.requireType("Blockly.Events.Abstract"),goog.requireType("Blockly.Field"),goog.requireType("Blockly.Mutator"),goog.requireType("Blockly.utils.Size"),goog.requireType("Blockly.VariableModel"),Blockly.Block=function(t,o,e){if(Blockly.Generator&&void 0!==Blockly.Generator.prototype[o])throw Error('Block prototypeName "'+o+'" conflicts with Blockly.Generator members.');var n=t&&t.getFlyout&&t.getFlyout()?t.getFlyout().getWorkspace():null;if(this.id=!e||t.getBlockById(e)||n&&n.getBlockById(e)?Blockly.utils.genUid():e,t.setBlockById(this.id,this),this.outputConnection=null,this.nextConnection=null,this.previousConnection=null,this.inputList=[],this.inputsInline=void 0,this.startHat=!1,this.disabled=!1,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.deletable_=!0,this.movable_=!0,this.editable_=!0,this.isShadow_=!1,this.collapsed_=!1,this.outputShape_=null,this.comment=null,this.commentModel={text:null,pinned:!1,size:new Blockly.utils.Size(160,80),xy:new Blockly.utils.Coordinate(10,10)},this.xy_=new Blockly.utils.Coordinate(0,0),this.workspace=t,this.isInFlyout=t.isFlyout,this.isInMutator=t.isMutator,this.RTL=t.RTL,this.isInsertionMarker_=!1,this.hat=void 0,this.rendered=null,this.statementInputCount=0,o){this.type=o;var i=Blockly.Blocks[o];if(!i||"object"!=typeof i)throw TypeError("Unknown block type: "+o);Blockly.utils.object.mixin(this,i)}t.addTopBlock(this),t.addTypedBlock(this);var l=Blockly.Events.getGroup();l||Blockly.Events.setGroup(!0);var r=Blockly.Events.recordUndo;try{"function"==typeof this.init&&(Blockly.Events.recordUndo=!1,this.init(),Blockly.Events.recordUndo=r),Blockly.Events.isEnabled()&&Blockly.Events.fire(new(Blockly.Events.get(Blockly.Events.BLOCK_CREATE))(this))}finally{l||Blockly.Events.setGroup(!1),Blockly.Events.recordUndo=r}this.inputsInlineDefault=this.inputsInline,"function"==typeof this.onchange&&this.setOnChange(this.onchange)},Blockly.Block.CommentModel,Blockly.Block.COLLAPSED_INPUT_NAME=Blockly.constants.COLLAPSED_INPUT_NAME,Blockly.Block.COLLAPSED_FIELD_NAME=Blockly.constants.COLLAPSED_FIELD_NAME,Blockly.Block.prototype.data=null,Blockly.Block.prototype.disposed=!1,Blockly.Block.prototype.hue_=null,Blockly.Block.prototype.colour_="#000000",Blockly.Block.prototype.styleName_="",Blockly.Block.prototype.init,Blockly.Block.prototype.onchange,Blockly.Block.prototype.mutationToDom,Blockly.Block.prototype.domToMutation,Blockly.Block.prototype.suppressPrefixSuffix,Blockly.Block.prototype.getDeveloperVariables,Blockly.Block.prototype.dispose=function(t){if(this.workspace){this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.unplug(t),Blockly.Events.isEnabled()&&Blockly.Events.fire(new(Blockly.Events.get(Blockly.Events.BLOCK_DELETE))(this)),Blockly.Events.disable();try{this.workspace&&(this.workspace.removeTopBlock(this),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),this.workspace=null),Blockly.selected==this&&(Blockly.selected=null);for(var o=this.childBlocks_.length-1;o>=0;o--)this.childBlocks_[o].dispose(!1);var e;for(o=0;e=this.inputList[o];o++)e.dispose();this.inputList.length=0;var n,i=this.getConnections_(!0);for(o=0;n=i[o];o++)n.dispose()}finally{Blockly.Events.enable(),this.disposed=!0}}},Blockly.Block.prototype.initModel=function(){for(var t,o=0;t=this.inputList[o];o++)for(var e,n=0;e=t.fieldRow[n];n++)e.initModel&&e.initModel()},Blockly.Block.prototype.unplug=function(t){this.outputConnection?this.unplugFromRow_(t):this.previousConnection&&this.unplugFromStack_(t)},Blockly.Block.prototype.unplugFromRow_=function(t){var o=null;if(this.outputConnection.isConnected()&&(o=this.outputConnection.targetConnection,this.outputConnection.disconnect()),o&&t){var e=this.getOnlyValueConnection_();if(e&&e.isConnected()&&!e.targetBlock().isShadow()){var n=e.targetConnection;n.disconnect(),this.workspace.connectionChecker.canConnect(n,o,!1)?o.connect(n):n.onFailedConnect(o)}}},Blockly.Block.prototype.getOnlyValueConnection_=function(){for(var t=null,o=0;o<this.inputList.length;o++){var e=this.inputList[o].connection;if(e&&e.type==Blockly.connectionTypes.INPUT_VALUE&&e.targetConnection){if(t)return null;t=e}}return t},Blockly.Block.prototype.unplugFromStack_=function(t){var o=null;this.previousConnection.isConnected()&&(o=this.previousConnection.targetConnection,this.previousConnection.disconnect());var e=this.getNextBlock();if(t&&e&&!e.isShadow()){var n=this.nextConnection.targetConnection;n.disconnect(),o&&this.workspace.connectionChecker.canConnect(o,n,!1)&&o.connect(n)}},Blockly.Block.prototype.getConnections_=function(t){var o=[];this.outputConnection&&o.push(this.outputConnection),this.previousConnection&&o.push(this.previousConnection),this.nextConnection&&o.push(this.nextConnection);for(var e,n=0;e=this.inputList[n];n++)e.connection&&o.push(e.connection);return o},Blockly.Block.prototype.lastConnectionInStack=function(t){for(var o=this.nextConnection;o;){var e=o.targetBlock();if(!e||t&&e.isShadow())return o;o=e.nextConnection}return null},Blockly.Block.prototype.bumpNeighbours=function(){},Blockly.Block.prototype.getParent=function(){return this.parentBlock_},Blockly.Block.prototype.getInputWithBlock=function(t){for(var o,e=0;o=this.inputList[e];e++)if(o.connection&&o.connection.targetBlock()==t)return o;return null},Blockly.Block.prototype.getInputWithConnection=function(t){for(var o,e=0;o=this.inputList[e];e++)if(o.connection==t)return o;return null},Blockly.Block.prototype.getSurroundParent=function(){var t=this;do{var o=t;if(!(t=t.getParent()))return null}while(t.getNextBlock()==o);return t},Blockly.Block.prototype.getNextBlock=function(){return this.nextConnection&&this.nextConnection.targetBlock()},Blockly.Block.prototype.getPreviousBlock=function(){return this.previousConnection&&this.previousConnection.targetBlock()},Blockly.Block.prototype.getFirstStatementConnection=function(){for(var t,o=0;t=this.inputList[o];o++)if(t.connection&&t.connection.type==Blockly.connectionTypes.NEXT_STATEMENT)return t.connection;return null},Blockly.Block.prototype.getRootBlock=function(){var t,o=this;do{o=(t=o).parentBlock_}while(o);return t},Blockly.Block.prototype.getTopStackBlock=function(){var t=this;do{var o=t.getPreviousBlock()}while(o&&o.getNextBlock()==t&&(t=o));return t},Blockly.Block.prototype.getChildren=function(t){if(!t)return this.childBlocks_;for(var o,e=[],n=0;o=this.inputList[n];n++)if(o.connection){var i=o.connection.targetBlock();i&&e.push(i)}var l=this.getNextBlock();return l&&e.push(l),e},Blockly.Block.prototype.setParent=function(t){if(t!=this.parentBlock_){if(this.parentBlock_){if(Blockly.utils.arrayRemove(this.parentBlock_.childBlocks_,this),this.previousConnection&&this.previousConnection.isConnected())throw Error("Still connected to previous block.");if(this.outputConnection&&this.outputConnection.isConnected())throw Error("Still connected to parent block.");this.parentBlock_=null}else this.workspace.removeTopBlock(this);this.parentBlock_=t,t?t.childBlocks_.push(this):this.workspace.addTopBlock(this)}},Blockly.Block.prototype.getDescendants=function(t,o){for(var e,n=[this],i=this.getChildren(t),l=0;e=i[l];l++)o&&e.isShadow()||n.push.apply(n,e.getDescendants(t));return n},Blockly.Block.prototype.isDeletable=function(){return this.deletable_&&!this.isShadow_&&!(this.workspace&&this.workspace.options.readOnly)&&!this.inDebugWorkspace()},Blockly.Block.prototype.inDebugWorkspace=function(){return!(!this.workspace||!this.workspace.options.debugMode)},Blockly.Block.prototype.setDeletable=function(t){this.deletable_=t},Blockly.Block.prototype.isMovable=function(){return this.isMovablePersisted()&&!this.inDebugWorkspace()},Blockly.Block.prototype.isMovablePersisted=function(){return this.movable_&&!this.isShadow_&&!(this.workspace&&this.workspace.options.readOnly)},Blockly.Block.prototype.setMovable=function(t){this.movable_=t},Blockly.Block.prototype.isDuplicatable=function(){return!this.workspace.hasBlockLimits()||this.workspace.isCapacityAvailable(Blockly.utils.getBlockTypeCounts(this,!0))},Blockly.Block.prototype.isShadow=function(){return this.isShadow_},Blockly.Block.prototype.setShadow=function(t){this.isShadow_=t},Blockly.Block.prototype.isInsertionMarker=function(){return this.isInsertionMarker_},Blockly.Block.prototype.setInsertionMarker=function(t){this.isInsertionMarker_!=t&&(this.isInsertionMarker_=t,this.isInsertionMarker_&&(this.setColour(Blockly.Colours.insertionMarker),this.setOpacity(Blockly.Colours.insertionMarkerOpacity),Blockly.utils.dom.addClass(this.svgGroup_,"blocklyInsertionMarker")))},Blockly.Block.prototype.isEditable=function(){return this.isEditablePersisted()&&!this.inDebugWorkspace()},Blockly.Block.prototype.isEditablePersisted=function(){return this.editable_&&!(this.workspace&&this.workspace.options.readOnly)},Blockly.Block.prototype.setEditable=function(t){this.editable_=t;for(var o,e=0;o=this.inputList[e];e++)for(var n,i=0;n=o.fieldRow[i];i++)n.updateEditable()},Blockly.Block.prototype.isDisposed=function(){return this.disposed},Blockly.Block.prototype.getMatchingConnection=function(t,o){var e=this.getConnections_(!0),n=t.getConnections_(!0);if(e.length!=n.length)throw Error("Connection lists did not match in length.");for(var i=0;i<n.length;i++)if(n[i]==o)return e[i];return null},Blockly.Block.prototype.setHelpUrl=function(t){this.helpUrl=t},Blockly.Block.prototype.setTooltip=function(t){this.tooltip=t},Blockly.Block.prototype.getTooltip=function(){return Blockly.Tooltip.getTooltipOfObject(this)},Blockly.Block.prototype.getColour=function(){return this.colour_},Blockly.Block.prototype.getStyleName=function(){return this.styleName_},Blockly.Block.prototype.getHue=function(){return this.hue_},Blockly.Block.prototype.setColour=function(t){var o=Blockly.utils.parseBlockColour(t);this.hue_=o.hue,this.colour_=o.hex},Blockly.Block.prototype.setStyle=function(t){this.styleName_=t},Blockly.Block.prototype.setOnChange=function(t){if(t&&"function"!=typeof t)throw Error("onchange must be a function.");this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.onchange=t,this.onchange&&(this.onchangeWrapper_=t.bind(this),this.workspace.addChangeListener(this.onchangeWrapper_))},Blockly.Block.prototype.getField=function(t){if("string"!=typeof t)throw TypeError("Blockly.Block.prototype.getField expects a string with the field name but received "+(void 0===t?"nothing":t+" of type "+typeof t)+" instead");for(var o,e=0;o=this.inputList[e];e++)for(var n,i=0;n=o.fieldRow[i];i++)if(n.name===t)return n;return null},Blockly.Block.prototype.getVars=function(){for(var t,o=[],e=0;t=this.inputList[e];e++)for(var n,i=0;n=t.fieldRow[i];i++)n.referencesVariables()&&o.push(n.getValue());return o},Blockly.Block.prototype.getVarModels=function(){for(var t,o=[],e=0;t=this.inputList[e];e++)for(var n,i=0;n=t.fieldRow[i];i++)if(n.referencesVariables()){var l=this.workspace.getVariableById(n.getValue());l&&o.push(l)}return o},Blockly.Block.prototype.updateVarName=function(t){for(var o,e=0;o=this.inputList[e];e++)for(var n,i=0;n=o.fieldRow[i];i++)n.referencesVariables()&&t.getId()==n.getValue()&&n.forceRerender()},Blockly.Block.prototype.renameVarById=function(t,o){for(var e,n=0;e=this.inputList[n];n++)for(var i,l=0;i=e.fieldRow[l];l++)i.referencesVariables()&&t==i.getValue()&&i.setValue(o)},Blockly.Block.prototype.getFieldValue=function(t){var o=this.getField(t);return o?o.getValue():null},Blockly.Block.prototype.setFieldValue=function(t,o){var e=this.getField(o);if(!e)throw Error('Field "'+o+'" not found.');e.setValue(t)},Blockly.Block.prototype.setPreviousStatement=function(t,o){if(t){if(void 0===o&&(o=null),!this.previousConnection){if(this.outputConnection)throw Error("Remove output connection prior to adding previous connection.");this.previousConnection=this.makeConnection_(Blockly.connectionTypes.PREVIOUS_STATEMENT)}this.previousConnection.setCheck(o)}else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}},Blockly.Block.prototype.setNextStatement=function(t,o){if(t)void 0===o&&(o=null),this.nextConnection||(this.nextConnection=this.makeConnection_(Blockly.connectionTypes.NEXT_STATEMENT)),this.nextConnection.setCheck(o);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}},Blockly.Block.prototype.setOutput=function(t,o){if(t){if(void 0===o&&(o=null),!this.outputConnection){if(this.previousConnection)throw Error("Remove previous connection prior to adding output connection.");this.outputConnection=this.makeConnection_(Blockly.connectionTypes.OUTPUT_VALUE)}this.outputConnection.setCheck(o)}else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}},Blockly.Block.prototype.setInputsInline=function(t){this.inputsInline!=t&&(Blockly.Events.fire(new(Blockly.Events.get(Blockly.Events.BLOCK_CHANGE))(this,"inline",null,this.inputsInline,t)),this.inputsInline=t)},Blockly.Block.prototype.getInputsInline=function(){if(null!=this.inputsInline)return this.inputsInline;for(var t=1;t<this.inputList.length;t++)if(this.inputList[t-1].type==Blockly.inputTypes.DUMMY&&this.inputList[t].type==Blockly.inputTypes.DUMMY)return!1;for(t=1;t<this.inputList.length;t++)if(this.inputList[t-1].type==Blockly.inputTypes.VALUE&&this.inputList[t].type==Blockly.inputTypes.DUMMY)return!0;return!1},Blockly.Block.prototype.setStartHat=function(t){this.startHat!=t&&(this.startHat=t)},Blockly.Block.prototype.getStartHat=function(){return this.startHat},Blockly.Block.prototype.setOutputShape=function(t){this.outputShape_=t},Blockly.Block.prototype.getOutputShape=function(){return this.outputShape_},Blockly.Block.prototype.isEnabled=function(){return!this.disabled},Blockly.Block.prototype.setEnabled=function(t){this.isEnabled()!=t&&(Blockly.Events.fire(new(Blockly.Events.get(Blockly.Events.BLOCK_CHANGE))(this,"disabled",null,this.disabled,!t)),this.disabled=!t)},Blockly.Block.prototype.getInheritedDisabled=function(){for(var t=this.getSurroundParent();t;){if(t.disabled)return!0;t=t.getSurroundParent()}return!1},Blockly.Block.prototype.isCollapsed=function(){return this.collapsed_},Blockly.Block.prototype.setCollapsed=function(t){this.collapsed_!=t&&(Blockly.Events.fire(new(Blockly.Events.get(Blockly.Events.BLOCK_CHANGE))(this,"collapsed",null,this.collapsed_,t)),this.collapsed_=t)},Blockly.Block.prototype.toString=function(t,o,e){var n=[],i=o||"?",l=Blockly.ASTNode.NAVIGATE_ALL_FIELDS;Blockly.ASTNode.NAVIGATE_ALL_FIELDS=!0;var r=Blockly.ASTNode.createBlockNode(this),s=r;function c(t){var o=t.getCheck();return!o&&t.targetConnection&&(o=t.targetConnection.getCheck()),!!o&&(-1!=o.indexOf("Boolean")||-1!=o.indexOf("Number"))}function p(){r&&r.getType()==s.getType()&&r.getLocation()==s.getLocation()&&(r=null)}for(;r;){switch(r.getType()){case Blockly.ASTNode.types.INPUT:var u=r.getLocation();r.in()?c(u)&&n.push("("):n.push(i);break;case Blockly.ASTNode.types.FIELD:var a=r.getLocation();a.name!=Blockly.constants.COLLAPSED_FIELD_NAME&&n.push(a.getText())}var k=r;if(!(r=k.in()||k.next())){for(r=k.out(),p();r&&!r.next();)r=r.out(),p(),r&&r.getType()==Blockly.ASTNode.types.INPUT&&c(r.getLocation())&&n.push(")");r&&(r=r.next())}}Blockly.ASTNode.NAVIGATE_ALL_FIELDS=l;for(var y=2;y<n.length;y++)"("==n[y-2]&&")"==n[y]&&(n[y-2]=n[y-1],n.splice(y-1,2));return n=(n=n.reduce(function(t,o){return t+("("==t.substr(-1)||")"==o?"":" ")+o},"")).trim()||"???",t&&n.length>t&&(n=n.substring(0,t-3)+"..."),n},Blockly.Block.prototype.appendValueInput=function(t){return this.appendInput_(Blockly.inputTypes.VALUE,t)},Blockly.Block.prototype.appendStatementInput=function(t){return this.appendInput_(Blockly.inputTypes.STATEMENT,t)},Blockly.Block.prototype.appendDummyInput=function(t){return this.appendInput_(Blockly.inputTypes.DUMMY,t||"")},Blockly.Block.prototype.jsonInit=function(t){var o=t.type?'Block "'+t.type+'": ':"";if(t.output&&t.previousStatement)throw Error(o+"Must not have both an output and a previousStatement.");if(t.style&&t.style.hat&&(this.hat=t.style.hat,t.style=null),t.style&&t.colour)throw Error(o+"Must not have both a colour and a style.");t.style?this.jsonInitStyle_(t,o):this.jsonInitColour_(t,o);for(var e=0;void 0!==t["message"+e];)this.interpolate_(t["message"+e],t["args"+e]||[],t["lastDummyAlign"+e],o),e++;if(void 0!==t.inputsInline&&this.setInputsInline(t.inputsInline),void 0!==t.startHat&&this.setStartHat(t.startHat),void 0!==t.output&&this.setOutput(!0,t.output),void 0!==t.outputShape&&this.setOutputShape(t.outputShape),void 0!==t.previousStatement&&this.setPreviousStatement(!0,t.previousStatement),void 0!==t.nextStatement&&this.setNextStatement(!0,t.nextStatement),void 0!==t.tooltip){var n=t.tooltip,i=Blockly.utils.replaceMessageReferences(n);this.setTooltip(i)}if(void 0!==t.enableContextMenu){n=t.enableContextMenu;this.contextMenu=!!n}if(void 0!==t.helpUrl){n=t.helpUrl;var l=Blockly.utils.replaceMessageReferences(n);this.setHelpUrl(l)}"string"==typeof t.extensions&&(console.warn(o+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+t.type+"' block."),t.extensions=[t.extensions]),void 0!==t.mutator&&Blockly.Extensions.apply(t.mutator,this,!0);var r=t.extensions;if(Array.isArray(r))for(var s=0;s<r.length;++s)Blockly.Extensions.apply(r[s],this,!1);void 0!==t.outputShape&&this.setOutputShape(t.outputShape),void 0!==t.category&&this.setCategory(t.category)},Blockly.Block.prototype.setColourFromRawValues_=function(t,o,e){t=goog.isString(t)?Blockly.utils.replaceMessageReferences(t):t,o=goog.isString(o)?Blockly.utils.replaceMessageReferences(o):o,e=goog.isString(e)?Blockly.utils.replaceMessageReferences(e):e,this.setColour(t,o,e)},Blockly.Block.prototype.jsonInitColour_=function(t,o){if("colour"in t)if(void 0===t.colour)console.warn(o+"Undefined colour value.");else{var e=t.colour;try{this.setColourFromRawValues_(e,t.colourSecondary,t.colourTertiary)}catch(t){console.warn(o+"Illegal colour value: ",e)}}},Blockly.Block.prototype.jsonInitStyle_=function(t,o){var e=t.style;try{this.setStyle(e)}catch(t){console.warn(o+"Style does not exist: ",e)}},Blockly.Block.prototype.mixin=function(t,o){if(void 0!==o&&"boolean"!=typeof o)throw Error("opt_disableCheck must be a boolean if provided");if(!o){var e=[];for(var n in t)void 0!==this[n]&&e.push(n);if(e.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(e))}Blockly.utils.object.mixin(this,t)},Blockly.Block.prototype.interpolate_=function(t,o,e,n){var i=Blockly.utils.tokenizeInterpolation(t);this.validateTokens_(i,o.length);for(var l,r=this.interpolateArguments_(i,o,e),s=[],c=0;l=r[c];c++)if(this.isInputKeyword_(l.type)){var p=this.inputFromJson_(l,n);if(p){for(var u,a=0;u=s[a];a++)p.appendField(u[0],u[1]);s.length=0}}else{var k=this.fieldFromJson_(l);k&&s.push([k,l.name])}},Blockly.Block.prototype.validateTokens_=function(t,o){for(var e=[],n=0,i=0;i<t.length;i++){var l=t[i];if("number"==typeof l){if(l<1||l>o)throw Error('Block "'+this.type+'": Message index %'+l+" out of range.");if(e[l])throw Error('Block "'+this.type+'": Message index %'+l+" duplicated.");e[l]=!0,n++}}if(n!=o)throw Error('Block "'+this.type+'": Message does not reference all '+o+" arg(s).")},Blockly.Block.prototype.interpolateArguments_=function(t,o,e){for(var n=[],i=0;i<t.length;i++){var l=t[i];"number"==typeof l&&(l=o[l-1]),("string"!=typeof l||(l=this.stringToFieldJson_(l)))&&n.push(l)}var r=n.length;if(r&&!this.isInputKeyword_(n[r-1].type)){var s={type:"input_dummy"};e&&(s.align=e),n.push(s)}return n},Blockly.Block.prototype.fieldFromJson_=function(t){var o=Blockly.fieldRegistry.fromJson(t);if(!o&&t.alt){if("string"==typeof t.alt){var e=this.stringToFieldJson_(t.alt);return e?this.fieldFromJson_(e):null}return this.fieldFromJson_(t.alt)}return o},Blockly.Block.prototype.inputFromJson_=function(t,o){var e={LEFT:Blockly.constants.ALIGN.LEFT,RIGHT:Blockly.constants.ALIGN.RIGHT,CENTRE:Blockly.constants.ALIGN.CENTRE,CENTER:Blockly.constants.ALIGN.CENTRE},n=null;switch(t.type){case"input_value":n=this.appendValueInput(t.name);break;case"input_statement":n=this.appendStatementInput(t.name);break;case"input_dummy":n=this.appendDummyInput(t.name)}if(!n)return null;if(t.check&&n.setCheck(t.check),t.align){var i=e[t.align.toUpperCase()];void 0===i?console.warn(o+"Illegal align value: ",t.align):n.setAlign(i)}return n},Blockly.Block.prototype.isInputKeyword_=function(t){return"input_value"==t||"input_statement"==t||"input_dummy"==t},Blockly.Block.prototype.stringToFieldJson_=function(t){return(t=t.trim())?{type:"field_label",text:t}:null},Blockly.Block.prototype.appendInput_=function(t,o){var e=null;t!=Blockly.inputTypes.VALUE&&t!=Blockly.inputTypes.STATEMENT||(e=this.makeConnection_(t)),t==Blockly.inputTypes.STATEMENT&&this.statementInputCount++;var n=new Blockly.Input(t,o,this,e);return this.inputList.push(n),n},Blockly.Block.prototype.moveInputBefore=function(t,o){if(t!=o){for(var e,n=-1,i=o?-1:this.inputList.length,l=0;e=this.inputList[l];l++)if(e.name==t){if(n=l,-1!=i)break}else if(o&&e.name==o&&(i=l,-1!=n))break;if(-1==n)throw Error('Named input "'+t+'" not found.');if(-1==i)throw Error('Reference input "'+o+'" not found.');this.moveNumberedInputBefore(n,i)}},Blockly.Block.prototype.moveNumberedInputBefore=function(t,o){if(t==o)throw Error("Can't move input to itself.");if(t>=this.inputList.length)throw RangeError("Input index "+t+" out of bounds.");if(o>this.inputList.length)throw RangeError("Reference input "+o+" out of bounds.");var e=this.inputList[t];this.inputList.splice(t,1),t<o&&o--,this.inputList.splice(o,0,e)},Blockly.Block.prototype.removeInput=function(t,o){for(var e,n=0;e=this.inputList[n];n++)if(e.name==t)return e.type==Blockly.inputTypes.STATEMENT&&this.statementInputCount--,e.dispose(),this.inputList.splice(n,1),!0;if(o)return!1;throw Error("Input not found: "+t)},Blockly.Block.prototype.getInput=function(t){for(var o,e=0;o=this.inputList[e];e++)if(o.name==t)return o;return null},Blockly.Block.prototype.getInputTargetBlock=function(t){var o=this.getInput(t);return o&&o.connection&&o.connection.targetBlock()},Blockly.Block.prototype.getCommentText=function(){return this.commentModel.text},Blockly.Block.prototype.setCommentText=function(t){this.commentModel.text!=t&&(Blockly.Events.fire(new(Blockly.Events.get(Blockly.Events.BLOCK_CHANGE))(this,"comment",null,this.commentModel.text,t)),this.commentModel.text=t,this.comment=t)},Blockly.Block.prototype.enableBreakpoint=function(t){let o=!1;t?(this.breakpoint||(this.breakpoint=new Blockly.Breakpoint(this),o=!0),this.breakpoint.setVisible(this.isBreakpointSet())):this.breakpoint&&(this.breakpoint.dispose(),o=!0),o&&Blockly.Events.fire(new Blockly.Events.BlockChange(this,"breakpoint",null,!t,t))},Blockly.Block.prototype.isBreakpointSet=function(){return this.breakpointSet_||!1},Blockly.Block.prototype.setBreakpoint=function(t){this.breakpointSet_=t},Blockly.Block.prototype.setOutputShape=function(t){this.outputShape_=t},Blockly.Block.prototype.getOutputShape=function(){return this.outputShape_||Blockly.OUTPUT_SHAPE_ROUND},Blockly.Block.prototype.setCategory=function(t){this.category_=t},Blockly.Block.prototype.getCategory=function(){return this.category_},Blockly.Block.prototype.setWarningText=function(t,o){},Blockly.Block.prototype.setMutator=function(t){},Blockly.Block.prototype.getRelativeToSurfaceXY=function(){return this.xy_},Blockly.Block.prototype.moveBy=function(t,o){if(this.parentBlock_)throw Error("Block has parent.");var e=new(Blockly.Events.get(Blockly.Events.BLOCK_MOVE))(this);this.xy_.translate(t,o),e.recordNew(),Blockly.Events.fire(e)},Blockly.Block.prototype.makeConnection_=function(t){return new Blockly.Connection(this,t)},Blockly.Block.prototype.allInputsFilled=function(t){if(void 0===t&&(t=!0),!t&&this.isShadow())return!1;for(var o,e=0;o=this.inputList[e];e++)if(o.connection){var n=o.connection.targetBlock();if(!n||!n.allInputsFilled(t))return!1}var i=this.getNextBlock();return!i||i.allInputsFilled(t)},Blockly.Block.prototype.toDevString=function(){var t=this.type?'"'+this.type+'" block':"Block";return this.id&&(t+=' (id="'+this.id+'")'),t},Blockly.Block.prototype.onLoadedIntoWorkspace=function(){for(var t,o=0;t=this.inputList[o];o++)for(var e,n=0;e=t.fieldRow[n];n++)e.onLoadedIntoWorkspace&&e.onLoadedIntoWorkspace()};