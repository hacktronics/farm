/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.ShortcutRegistry"),goog.require("Blockly.utils.KeyCodes"),goog.require("Blockly.utils.object"),goog.requireType("Blockly.Workspace"),Blockly.ShortcutRegistry=function(){Blockly.ShortcutRegistry.registry=this,this.registry_=Object.create(null),this.keyMap_=Object.create(null)},Blockly.ShortcutRegistry.modifierKeys={Shift:Blockly.utils.KeyCodes.SHIFT,Control:Blockly.utils.KeyCodes.CTRL,Alt:Blockly.utils.KeyCodes.ALT,Meta:Blockly.utils.KeyCodes.META},Blockly.ShortcutRegistry.KeyboardShortcut,Blockly.ShortcutRegistry.prototype.register=function(t,e){if(this.registry_[t.name]&&!e)throw new Error('Shortcut with name "'+t.name+'" already exists.');this.registry_[t.name]=t},Blockly.ShortcutRegistry.prototype.unregister=function(t){return this.registry_[t]?(this.removeAllKeyMappings(t),delete this.registry_[t],!0):(console.warn('Keyboard shortcut with name "'+t+'" not found.'),!1)},Blockly.ShortcutRegistry.prototype.addKeyMapping=function(t,e,r){t=String(t);var o=this.keyMap_[t];if(o&&!r)throw new Error('Shortcut with name "'+e+'" collides with shortcuts '+o.toString());o&&r?o.unshift(e):this.keyMap_[t]=[e]},Blockly.ShortcutRegistry.prototype.removeKeyMapping=function(t,e,r){var o=this.keyMap_[t];if(!o&&!r)return console.warn('No keyboard shortcut with name "'+e+'" registered with key code "'+t+'"'),!1;var i=o.indexOf(e);return i>-1?(o.splice(i,1),0==o.length&&delete this.keyMap_[t],!0):(r||console.warn('No keyboard shortcut with name "'+e+'" registered with key code "'+t+'"'),!1)},Blockly.ShortcutRegistry.prototype.removeAllKeyMappings=function(t){for(var e in this.keyMap_)this.removeKeyMapping(e,t,!0)},Blockly.ShortcutRegistry.prototype.setKeyMap=function(t){this.keyMap_=t},Blockly.ShortcutRegistry.prototype.getKeyMap=function(){return Blockly.utils.object.deepMerge(Object.create(null),this.keyMap_)},Blockly.ShortcutRegistry.prototype.getRegistry=function(){return Blockly.utils.object.deepMerge(Object.create(null),this.registry_)},Blockly.ShortcutRegistry.prototype.onKeyDown=function(t,e){var r=this.serializeKeyEvent_(e),o=this.getShortcutNamesByKeyCode(r);if(!o)return!1;for(var i,y=0;i=o[y];y++){var c=this.registry_[i];if((!c.preconditionFn||c.preconditionFn(t))&&c.callback&&c.callback(t,e,c))return!0}return!1},Blockly.ShortcutRegistry.prototype.getShortcutNamesByKeyCode=function(t){return this.keyMap_[t]||[]},Blockly.ShortcutRegistry.prototype.getKeyCodesByShortcutName=function(t){var e=[];for(var r in this.keyMap_){this.keyMap_[r].indexOf(t)>-1&&e.push(r)}return e},Blockly.ShortcutRegistry.prototype.serializeKeyEvent_=function(t){var e="";for(var r in Blockly.ShortcutRegistry.modifierKeys)t.getModifierState(r)&&(""!=e&&(e+="+"),e+=r);return""!=e&&t.keyCode?e=e+"+"+t.keyCode:t.keyCode&&(e=t.keyCode.toString()),e},Blockly.ShortcutRegistry.prototype.checkModifiers_=function(t){for(var e,r=Blockly.utils.object.values(Blockly.ShortcutRegistry.modifierKeys),o=0;e=t[o];o++)if(r.indexOf(e)<0)throw new Error(e+" is not a valid modifier key.")},Blockly.ShortcutRegistry.prototype.createSerializedKey=function(t,e){var r="";if(e)for(var o in this.checkModifiers_(e),Blockly.ShortcutRegistry.modifierKeys){var i=Blockly.ShortcutRegistry.modifierKeys[o];e.indexOf(i)>-1&&(""!=r&&(r+="+"),r+=o)}return""!=r&&t?r=r+"+"+t:t&&(r=t.toString()),r},new Blockly.ShortcutRegistry;