/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Events.CommentBase"),goog.provide("Blockly.Events.CommentChange"),goog.provide("Blockly.Events.CommentCreate"),goog.provide("Blockly.Events.CommentDelete"),goog.provide("Blockly.Events.CommentMove"),goog.require("Blockly.Events"),goog.require("Blockly.Events.Abstract"),goog.require("Blockly.registry"),goog.require("Blockly.utils.Coordinate"),goog.require("Blockly.utils.object"),goog.require("Blockly.utils.xml"),goog.require("Blockly.Xml"),Blockly.Events.CommentBase=function(e){this.isBlank=void 0===e,this.commentId=this.isBlank?"":e.id,this.workspaceId=this.isBlank?"":e.workspace.id,this.group=Blockly.Events.getGroup(),this.recordUndo=Blockly.Events.recordUndo},Blockly.utils.object.inherits(Blockly.Events.CommentBase,Blockly.Events.Abstract),Blockly.Events.CommentBase.prototype.toJson=function(){var e=Blockly.Events.CommentBase.superClass_.toJson.call(this);return this.commentId&&(e.commentId=this.commentId),e},Blockly.Events.CommentBase.prototype.fromJson=function(e){Blockly.Events.CommentBase.superClass_.fromJson.call(this,e),this.commentId=e.commentId},Blockly.Events.CommentChange=function(e,t,o){Blockly.Events.CommentChange.superClass_.constructor.call(this,e),e&&(this.oldContents_=void 0===t?"":t,this.newContents_=void 0===o?"":o)},Blockly.utils.object.inherits(Blockly.Events.CommentChange,Blockly.Events.CommentBase),Blockly.Events.CommentChange.prototype.type=Blockly.Events.COMMENT_CHANGE,Blockly.Events.CommentChange.prototype.toJson=function(){var e=Blockly.Events.CommentChange.superClass_.toJson.call(this);return e.oldContents=this.oldContents_,e.newContents=this.newContents_,e},Blockly.Events.CommentChange.prototype.fromJson=function(e){Blockly.Events.CommentChange.superClass_.fromJson.call(this,e),this.oldContents_=e.oldContents,this.newContents_=e.newContents},Blockly.Events.CommentChange.prototype.isNull=function(){return this.oldContents_==this.newContents_},Blockly.Events.CommentChange.prototype.run=function(e){var t=this.getEventWorkspace_().getCommentById(this.commentId);if(t){var o=e?this.newContents_:this.oldContents_;t.setContent(o),o.hasOwnProperty("minimized")&&t.setMinimized(o.minimized),o.hasOwnProperty("width")&&o.hasOwnProperty("height")&&t.setSize(o.width,o.height)}else console.warn("Can't change non-existent comment: "+this.commentId)},Blockly.Events.CommentCreate=function(e){Blockly.Events.CommentCreate.superClass_.constructor.call(this,e),e&&(this.xml=e.toXmlWithXY())},Blockly.utils.object.inherits(Blockly.Events.CommentCreate,Blockly.Events.CommentBase),Blockly.Events.CommentCreate.prototype.type=Blockly.Events.COMMENT_CREATE,Blockly.Events.CommentCreate.prototype.toJson=function(){var e=Blockly.Events.CommentCreate.superClass_.toJson.call(this);return e.xml=Blockly.Xml.domToText(this.xml),e},Blockly.Events.CommentCreate.prototype.fromJson=function(e){Blockly.Events.CommentCreate.superClass_.fromJson.call(this,e),this.xml=Blockly.Xml.textToDom(e.xml)},Blockly.Events.CommentCreate.prototype.run=function(e){Blockly.Events.CommentCreateDeleteHelper(this,e)},Blockly.Events.CommentCreateDeleteHelper=function(e,t){var o=e.getEventWorkspace_();if(t){var n=Blockly.utils.xml.createElement("xml");n.appendChild(e.xml),Blockly.Xml.domToWorkspace(n,o)}else{var l=o.getCommentById(e.commentId);l?l.dispose(!1,!1):console.warn("Can't uncreate non-existent comment: "+e.commentId)}},Blockly.Events.CommentDelete=function(e){Blockly.Events.CommentDelete.superClass_.constructor.call(this,e),e&&(this.xml=e.toXmlWithXY())},Blockly.utils.object.inherits(Blockly.Events.CommentDelete,Blockly.Events.CommentBase),Blockly.Events.CommentDelete.prototype.type=Blockly.Events.COMMENT_DELETE,Blockly.Events.CommentDelete.prototype.toJson=function(){return Blockly.Events.CommentDelete.superClass_.toJson.call(this)},Blockly.Events.CommentDelete.prototype.fromJson=function(e){Blockly.Events.CommentDelete.superClass_.fromJson.call(this,e)},Blockly.Events.CommentDelete.prototype.run=function(e){Blockly.Events.CommentCreateDeleteHelper(this,!e)},Blockly.Events.CommentMove=function(e){Blockly.Events.CommentMove.superClass_.constructor.call(this,e),e&&(this.comment_=e,this.oldCoordinate_=e.getXY(),this.newCoordinate_=null)},Blockly.utils.object.inherits(Blockly.Events.CommentMove,Blockly.Events.CommentBase),Blockly.Events.CommentMove.prototype.recordNew=function(){if(!this.comment_)throw Error("Tried to record the new position of a comment on the same event twice.");this.newCoordinate_=this.comment_.getXY(),this.comment_=null},Blockly.Events.CommentMove.prototype.type=Blockly.Events.COMMENT_MOVE,Blockly.Events.CommentMove.prototype.setOldCoordinate=function(e){this.oldCoordinate_=e},Blockly.Events.CommentMove.prototype.toJson=function(){var e=Blockly.Events.CommentMove.superClass_.toJson.call(this);return this.oldCoordinate_&&(e.oldCoordinate=Math.round(this.oldCoordinate_.x)+","+Math.round(this.oldCoordinate_.y)),this.newCoordinate_&&(e.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y)),e},Blockly.Events.CommentMove.prototype.fromJson=function(e){if(Blockly.Events.CommentMove.superClass_.fromJson.call(this,e),e.oldCoordinate){var t=e.oldCoordinate.split(",");this.oldCoordinate_=new Blockly.utils.Coordinate(Number(t[0]),Number(t[1]))}if(e.newCoordinate){t=e.newCoordinate.split(",");this.newCoordinate_=new Blockly.utils.Coordinate(Number(t[0]),Number(t[1]))}},Blockly.Events.CommentMove.prototype.isNull=function(){return Blockly.utils.Coordinate.equals(this.oldCoordinate_,this.newCoordinate_)},Blockly.Events.CommentMove.prototype.run=function(e){var t=this.getEventWorkspace_().getCommentById(this.commentId);if(t){var o=e?this.newCoordinate_:this.oldCoordinate_,n=t.getXY();t.moveBy(o.x-n.x,o.y-n.y)}else console.warn("Can't move non-existent comment: "+this.commentId)},Blockly.registry.register(Blockly.registry.Type.EVENT,Blockly.Events.COMMENT_CREATE,Blockly.Events.CommentCreate),Blockly.registry.register(Blockly.registry.Type.EVENT,Blockly.Events.COMMENT_CHANGE,Blockly.Events.CommentChange),Blockly.registry.register(Blockly.registry.Type.EVENT,Blockly.Events.COMMENT_MOVE,Blockly.Events.CommentMove),Blockly.registry.register(Blockly.registry.Type.EVENT,Blockly.Events.COMMENT_DELETE,Blockly.Events.CommentDelete);