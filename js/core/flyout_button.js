/**
 * @license
 * Copyright 2016 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.FlyoutButton"),goog.require("Blockly.browserEvents"),goog.require("Blockly.Css"),goog.require("Blockly.utils"),goog.require("Blockly.utils.Coordinate"),goog.require("Blockly.utils.dom"),goog.require("Blockly.utils.style"),goog.require("Blockly.utils.Svg"),goog.requireType("Blockly.utils.toolbox"),goog.requireType("Blockly.WorkspaceSvg"),Blockly.FlyoutButton=function(t,o,l,e){this.workspace_=t,this.targetWorkspace_=o,this.text_=l.text,this.position_=new Blockly.utils.Coordinate(0,0),this.isLabel_=e,this.helpButtonIcon_=l["web-help-button"]||null,this.callbackKey_=l.callbackKey||l.callbackkey,this.cssClass_=l["web-class"]||null,this.icon_=l["web-icon"]||null,this.iconClass_=l["web-icon-class"]||null,this.iconColor_=l["web-icon-color"]||null,this.line_=l["web-line"]||null,this.lineWidth_=l["web-line-width"]||null,this.onMouseUpWrapper_=null,this.info=l},Blockly.FlyoutButton.MARGIN_X=17.5,Blockly.FlyoutButton.MARGIN_Y=2,Blockly.FlyoutButton.prototype.width=0,Blockly.FlyoutButton.prototype.height=40,Blockly.FlyoutButton.HELP_IMAGE_URI="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTMiIGN5PSIxMyIgcj0iMTMiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xNy45NTIgOS4xODQwMkMxNy45NTIgMTAuMjU2IDE3LjgxNiAxMS4wNzIgMTcuNTQ0IDExLjYzMkMxNy4yODggMTIuMTkyIDE2Ljc1MiAxMi43OTIgMTUuOTM2IDEzLjQzMkMxNS4xMiAxNC4wNzIgMTQuNTc2IDE0LjU4NCAxNC4zMDQgMTQuOTY4QzE0LjA0OCAxNS4zMzYgMTMuOTIgMTUuNzM2IDEzLjkyIDE2LjE2OFYxNi45NkgxMS44MDhDMTEuNDI0IDE2LjQ2NCAxMS4yMzIgMTUuODQgMTEuMjMyIDE1LjA4OEMxMS4yMzIgMTQuNjg4IDExLjM4NCAxNC4yODggMTEuNjg4IDEzLjg4OEMxMS45OTIgMTMuNDg4IDEyLjUzNiAxMi45NjggMTMuMzIgMTIuMzI4QzE0LjEwNCAxMS42NzIgMTQuNjI0IDExLjE2OCAxNC44OCAxMC44MTZDMTUuMTM2IDEwLjQ0OCAxNS4yNjQgOS45NjgwMiAxNS4yNjQgOS4zNzYwMkMxNS4yNjQgOC4yMDgwMiAxNC40MTYgNy42MjQwMiAxMi43MiA3LjYyNDAyQzExLjc2IDcuNjI0MDIgMTAuNzUyIDcuNzM2MDIgOS42OTYgNy45NjAwMkw5LjE0NCA4LjA4MDAyTDkgNi4wODgwMkMxMC40ODggNS41NjAwMiAxMS44NCA1LjI5NjAyIDEzLjA1NiA1LjI5NjAyQzE0LjczNiA1LjI5NjAyIDE1Ljk2OCA1LjYwODAyIDE2Ljc1MiA2LjIzMjAyQzE3LjU1MiA2Ljg0MDAyIDE3Ljk1MiA3LjgyNDAyIDE3Ljk1MiA5LjE4NDAyWk0xMS40IDIyVjE4LjY0SDE0LjE4NFYyMkgxMS40WiIgZmlsbD0iIzU5NUU3NCIvPgo8L3N2Zz4K",Blockly.FlyoutButton.prototype.createDom=function(){var t=this.isLabel_?"blocklyFlyoutLabel":"blocklyFlyoutButton";if(this.cssClass_&&(t+=" "+this.cssClass_),this.svgGroup_=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.G,{class:t},this.workspace_.getCanvas()),!this.isLabel_)var o=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{class:"blocklyFlyoutButtonShadow",rx:4,ry:4,x:1,y:1},this.svgGroup_);var l=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.RECT,{class:this.isLabel_?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:4,ry:4},this.svgGroup_),e=Blockly.utils.dom.createSvgElement(Blockly.utils.Svg.TEXT,{class:this.isLabel_?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup_),i=Blockly.utils.replaceMessageReferences(this.text_);this.workspace_.RTL&&(i+="‚Äè"),e.textContent=i,this.isLabel_&&(this.svgText_=e,this.workspace_.getThemeManager().subscribe(this.svgText_,"flyoutForegroundColour","fill"));var s=Blockly.utils.style.getComputedStyle(e,"fontSize"),u=Blockly.utils.style.getComputedStyle(e,"fontWeight"),y=Blockly.utils.style.getComputedStyle(e,"fontFamily");if(this.width=Blockly.utils.dom.getFastTextWidthWithSizeString(e,s,u,y),this.icon_||this.iconClass_){var c=Blockly.utils.dom.createSvgElement("text",{class:this.iconClass_?"blocklyFlyoutLabelIcon "+this.iconClass_:"blocklyFlyoutLabelIcon",x:0,y:0,"text-anchor":"start"},this.svgGroup_);this.icon_&&(c.textContent=this.icon_),this.iconColor_&&c.setAttribute("style","fill: "+this.iconColor_),c.setAttribute("dominant-baseline","central"),c.setAttribute("dy",Blockly.utils.userAgent.EDGE_OR_IE?Blockly.Field.IE_TEXT_OFFSET:"0"),c.setAttribute("x",this.targetWorkspace_.RTL?this.width+Blockly.FlyoutButton.MARGIN_X:0),c.setAttribute("y",this.height/2+Blockly.FlyoutButton.MARGIN_Y),this.width+=Blockly.utils.dom.getTextWidth(c)+2*Blockly.FlyoutButton.MARGIN_X}if(this.helpButtonIcon_){var n=this.workspace_.RTL?-this.width+Blockly.FlyoutButton.MARGIN_X+15:this.width+15;this.helpButtonImage_=Blockly.utils.dom.createSvgElement("image",{class:"blocklyFlyoutButton",height:"25px",width:"25px",x:n+"px",y:"10px"},this.svgGroup_),this.helpButtonImage_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",Blockly.FlyoutButton.HELP_IMAGE_URI)}if(this.line_){var r=Blockly.utils.dom.createSvgElement("line",{class:"blocklyFlyoutLine","stroke-dasharray":this.line_,"text-anchor":"middle"},this.svgGroup_);r.setAttribute("x1",0),r.setAttribute("x2",null!=this.lineWidth_?this.lineWidth_:this.width),r.setAttribute("y1",this.height),r.setAttribute("y2",this.height)}this.isLabel_||(this.width+=2*Blockly.FlyoutButton.MARGIN_X,this.height+=2*Blockly.FlyoutButton.MARGIN_Y,o.setAttribute("width",this.width),o.setAttribute("height",this.height)),l.setAttribute("width",this.width),l.setAttribute("height",this.height),e.setAttribute("text-anchor","middle"),e.setAttribute("dominant-baseline","central"),e.setAttribute("dy",Blockly.utils.userAgent.EDGE_OR_IE?Blockly.Field.IE_TEXT_OFFSET:"0"),e.setAttribute("x",this.width/2),e.setAttribute("y",this.height/2),this.updateTransform_();var h=this.helpButtonIcon_&&this.callback_?this.helpButtonImage_:this.svgGroup_;return this.onMouseUpWrapper_=Blockly.browserEvents.conditionalBind(h,"mouseup",this,this.onMouseUp_),this.svgGroup_},Blockly.FlyoutButton.prototype.show=function(){this.updateTransform_(),this.svgGroup_.setAttribute("display","block")},Blockly.FlyoutButton.prototype.updateTransform_=function(){this.svgGroup_.setAttribute("transform","translate("+this.position_.x+","+this.position_.y+")")},Blockly.FlyoutButton.prototype.moveTo=function(t,o){this.position_.x=t,this.position_.y=o,this.updateTransform_()},Blockly.FlyoutButton.prototype.isLabel=function(){return this.isLabel_},Blockly.FlyoutButton.prototype.getPosition=function(){return this.position_},Blockly.FlyoutButton.prototype.getButtonText=function(){return this.text_},Blockly.FlyoutButton.prototype.getTargetWorkspace=function(){return this.targetWorkspace_},Blockly.FlyoutButton.prototype.dispose=function(){this.onMouseUpWrapper_&&Blockly.browserEvents.unbind(this.onMouseUpWrapper_),this.svgGroup_&&Blockly.utils.dom.removeNode(this.svgGroup_),this.svgText_&&this.workspace_.getThemeManager().unsubscribe(this.svgText_)},Blockly.FlyoutButton.prototype.onMouseUp_=function(t){var o=this.targetWorkspace_.getGesture(t);o&&o.cancel(),this.isLabel_&&this.callbackKey_?console.warn("Labels should not have callbacks. Label text: "+this.text_):this.isLabel_||this.callbackKey_&&this.targetWorkspace_.getButtonCallback(this.callbackKey_)?this.isLabel_||this.targetWorkspace_.getButtonCallback(this.callbackKey_)(this):console.warn("Buttons should have callbacks. Button text: "+this.text_)},Blockly.Css.register([".blocklyFlyoutButton {","fill: #F4F4F4;","}",".blocklyFlyoutButtonBackground {","stroke: #fff;","}",".blocklyFlyoutButton .blocklyText {","fill: $colour_text;","}",".blocklyFlyoutButtonShadow {","fill: none;","}",".blocklyFlyoutButton:hover {","fill: #EAEAEA;","cursor: pointer;","}",".blocklyFlyoutLabel {","cursor: default;","}",".blocklyFlyoutLabelBackground {","opacity: 0;","}",".blocklyFlyoutLabelText {",'font-family: "Helvetica Neue", "Segoe UI", Helvetica, sans-serif;',"font-size: 14pt;","fill: $colour_text;","font-weight: bold;","}"]);