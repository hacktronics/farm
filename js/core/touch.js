/**
 * @license
 * Copyright 2016 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Touch"),goog.require("Blockly.constants"),goog.require("Blockly.utils"),goog.require("Blockly.utils.global"),goog.require("Blockly.utils.string"),goog.requireType("Blockly.Gesture"),Blockly.Touch.TOUCH_ENABLED="ontouchstart"in Blockly.utils.global||!!(Blockly.utils.global.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!Blockly.utils.global.navigator||!Blockly.utils.global.navigator.maxTouchPoints&&!Blockly.utils.global.navigator.msMaxTouchPoints),Blockly.Touch.touchIdentifier_=null,Blockly.Touch.TOUCH_MAP={},Blockly.utils.global.PointerEvent?Blockly.Touch.TOUCH_MAP={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]}:Blockly.Touch.TOUCH_ENABLED&&(Blockly.Touch.TOUCH_MAP={mousedown:["touchstart"],mousemove:["touchmove"],mouseup:["touchend","touchcancel"]}),Blockly.longPid_=0,Blockly.longStart=function(o,e){Blockly.longStop_(),o.changedTouches&&1!=o.changedTouches.length||(Blockly.longPid_=setTimeout(function(){o.changedTouches&&(o.button=2,o.clientX=o.changedTouches[0].clientX,o.clientY=o.changedTouches[0].clientY),e&&e.handleRightClick(o)},Blockly.LONGPRESS))},Blockly.longStop_=function(){Blockly.longPid_&&(clearTimeout(Blockly.longPid_),Blockly.longPid_=0)},Blockly.Touch.clearTouchIdentifier=function(){Blockly.Touch.touchIdentifier_=null},Blockly.Touch.shouldHandleEvent=function(o){return!Blockly.Touch.isMouseOrTouchEvent(o)||Blockly.Touch.checkTouchIdentifier(o)},Blockly.Touch.getTouchIdentifierFromEvent=function(o){return null!=o.pointerId?o.pointerId:o.changedTouches&&o.changedTouches[0]&&void 0!==o.changedTouches[0].identifier&&null!==o.changedTouches[0].identifier?o.changedTouches[0].identifier:"mouse"},Blockly.Touch.checkTouchIdentifier=function(o){var e=Blockly.Touch.getTouchIdentifierFromEvent(o);return void 0!==Blockly.Touch.touchIdentifier_&&null!==Blockly.Touch.touchIdentifier_?Blockly.Touch.touchIdentifier_==e:("mousedown"==o.type||"touchstart"==o.type||"pointerdown"==o.type)&&(Blockly.Touch.touchIdentifier_=e,!0)},Blockly.Touch.setClientFromTouch=function(o){if(Blockly.utils.string.startsWith(o.type,"touch")){var e=o.changedTouches[0];o.clientX=e.clientX,o.clientY=e.clientY}},Blockly.Touch.isMouseOrTouchEvent=function(o){return Blockly.utils.string.startsWith(o.type,"touch")||Blockly.utils.string.startsWith(o.type,"mouse")||Blockly.utils.string.startsWith(o.type,"pointer")},Blockly.Touch.isTouchEvent=function(o){return!(o instanceof PointerEvent&&"mouse"==o.pointerType)&&(Blockly.utils.string.startsWith(o.type,"touch")||Blockly.utils.string.startsWith(o.type,"pointer"))},Blockly.Touch.splitEventByTouches=function(o){var e=[];if(o.changedTouches)for(var t=0;t<o.changedTouches.length;t++){var c={type:o.type,changedTouches:[o.changedTouches[t]],target:o.target,stopPropagation:function(){o.stopPropagation()},preventDefault:function(){o.preventDefault()}};e[t]=c}else e.push(o);return e};