"use strict";var arrayProto=require("@sinonjs/commons").prototypes.array,proxyCallUtil=require("./proxy-call-util"),push=arrayProto.push,forEach=arrayProto.forEach,concat=arrayProto.concat,ErrorConstructor=Error.prototype.constructor,bind=Function.prototype.bind,callId=0;module.exports=function(r,t,o){var a,l,s=this.matchingFakes(o),i=callId++;proxyCallUtil.incrementCallCount(this),push(this.thisValues,t),push(this.args,o),push(this.callIds,i),forEach(s,function(r){proxyCallUtil.incrementCallCount(r),push(r.thisValues,t),push(r.args,o),push(r.callIds,i)}),proxyCallUtil.createCallProperties(this),forEach(s,proxyCallUtil.createCallProperties);try{this.invoking=!0,this.getCall(this.callCount-1).calledWithNew()?"object"!=typeof(l=new(bind.apply(this.func||r,concat([t],o))))&&(l=t):l=(this.func||r).apply(t,o)}catch(r){a=r}finally{delete this.invoking}push(this.exceptions,a),push(this.returnValues,l),forEach(s,function(r){push(r.exceptions,a),push(r.returnValues,l)});var e=new ErrorConstructor;try{throw e}catch(r){}if(push(this.errorsWithCallStack,e),forEach(s,function(r){push(r.errorsWithCallStack,e)}),proxyCallUtil.createCallProperties(this),forEach(s,proxyCallUtil.createCallProperties),void 0!==a)throw a;return l};