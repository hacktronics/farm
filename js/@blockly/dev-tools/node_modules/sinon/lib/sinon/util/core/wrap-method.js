"use strict";var getPropertyDescriptor=require("./get-property-descriptor"),extend=require("./extend"),hasOwnProperty=require("@sinonjs/commons").prototypes.object.hasOwnProperty,valueToString=require("@sinonjs/commons").valueToString;function isFunction(r){return"function"==typeof r||Boolean(r&&r.constructor&&r.call&&r.apply)}function mirrorProperties(r,e){for(var t in e)hasOwnProperty(r,t)||(r[t]=e[t])}var hasES5Support="keys"in Object;module.exports=function(r,e,t){if(!r)throw new TypeError("Should wrap property of object");if("function"!=typeof t&&"object"!=typeof t)throw new TypeError("Method wrapper should be a function or a property descriptor");function o(r){var t;if(isFunction(r)){if(r.restore&&r.restore.sinon)t=new TypeError("Attempted to wrap "+valueToString(e)+" which is already wrapped");else if(r.calledBefore){var o=r.returns?"stubbed":"spied on";t=new TypeError("Attempted to wrap "+valueToString(e)+" which is already "+o)}}else t=new TypeError("Attempted to wrap "+typeof r+" property "+valueToString(e)+" as function");if(t)throw r&&r.stackTraceError&&(t.stack+="\n--------------\n"+r.stackTraceError.stack),t}var n,p,a,i;function s(){o(p=r[e]),r[e]=t,t.displayName=e}var c=r.hasOwnProperty?r.hasOwnProperty(e):hasOwnProperty(r,e);if(hasES5Support){var u="function"==typeof t?{value:t}:t;if((i=getPropertyDescriptor(r,e))?i.restore&&i.restore.sinon&&(n=new TypeError("Attempted to wrap "+e+" which is already wrapped")):n=new TypeError("Attempted to wrap "+typeof p+" property "+e+" as function"),n)throw i&&i.stackTraceError&&(n.stack+="\n--------------\n"+i.stackTraceError.stack),n;var y=Object.keys(u);for(a=0;a<y.length;a++)o(p=i[y[a]]);for(mirrorProperties(u,i),a=0;a<y.length;a++)mirrorProperties(u[y[a]],i[y[a]]);Object.defineProperty(r,e,u),"function"==typeof t&&r[e]!==t&&(delete r[e],s())}else s();return extend.nonEnum(t,{displayName:e,wrappedMethod:p,stackTraceError:new Error("Stack Trace for original"),restore:function(){if(c)hasES5Support&&Object.defineProperty(r,e,i);else try{delete r[e]}catch(r){}if(hasES5Support){var o=getPropertyDescriptor(r,e);o&&o.value===t&&(r[e]=p)}else r[e]===t&&(r[e]=p)}}),t.restore.sinon=!0,hasES5Support||mirrorProperties(t,p),t};