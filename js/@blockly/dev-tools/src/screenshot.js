/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
import Blockly from"blockly/core";function svgToPng_(e,t,n,o){const r=document.createElement("canvas"),c=r.getContext("2d"),i=new Image;r.width=10*t,r.height=10*n,i.onload=function(){c.drawImage(i,0,0,t,n,0,0,r.width,r.height);try{const e=r.toDataURL("image/png");o(e)}catch(e){console.warn("Error converting the workspace svg to a png"),o("")}},i.src=e}function workspaceToSvg_(e,t,n){const o=document.getElementsByTagName("textarea");for(let e=0;e<o.length;e++)o[e].innerHTML=o[e].value;const r=e.getBlocksBoundingBox(),c=r.x||r.left,i=r.y||r.top,a=r.width||r.right-c,s=r.height||r.bottom-i,l=e.getCanvas().cloneNode(!0);l.removeAttribute("transform");const g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttribute("xmlns","http://www.w3.org/2000/svg"),g.appendChild(l),g.setAttribute("viewBox",c+" "+i+" "+a+" "+s),g.setAttribute("class","blocklySvg "+(e.options.renderer||"geras")+"-renderer "+(e.getTheme?e.getTheme().name+"-theme":"")),g.setAttribute("width",a),g.setAttribute("height",s),g.setAttribute("style","background-color: transparent");const d=[].slice.call(document.head.querySelectorAll("style")).filter(function(e){return/\.blocklySvg/.test(e.innerText)||0===e.id.indexOf("blockly-")}).map(function(e){return e.innerText}).join("\n"),m=document.createElement("style");m.innerHTML=d+"\n"+n,g.insertBefore(m,g.firstChild);let h=(new XMLSerializer).serializeToString(g);h=h.replace(/&nbsp/g,"&#160");svgToPng_("data:image/svg+xml,"+encodeURIComponent(h),a,s,t)}export function downloadWorkspaceScreenshot(e){workspaceToSvg_(e,function(e){const t=document.createElement("a");t.download="screenshot.png",t.target="_self",t.href=e,document.body.appendChild(t),t.click(),t.parentNode.removeChild(t)})}