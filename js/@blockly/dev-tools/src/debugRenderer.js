/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
import Blockly from"blockly/core";export class DebugRenderer{constructor(e){this.debugElements_=[],this.svgRoot_=null,this.constants_=e}static init(){Blockly.blockRendering.useDebugger=!0,Blockly.blockRendering.Debug=DebugRenderer}clearElems(){for(let e,t=0;e=this.debugElements_[t];t++)Blockly.utils.dom.removeNode(e);this.debugElements_=[]}drawSpacerRow(e,t,o){if(!Blockly.blockRendering.Debug.config.rowSpacers)return;const n=Math.abs(e.height),l=e.height<0;l&&(t-=n),this.debugElements_.push(Blockly.utils.dom.createSvgElement("rect",{class:"rowSpacerRect blockRenderDebug",x:o?-(e.xPos+e.width):e.xPos,y:t,width:e.width,height:n,stroke:l?"black":"blue",fill:"blue","fill-opacity":"0.5","stroke-width":"1px"},this.svgRoot_))}drawSpacerElem(e,t,o){if(!Blockly.blockRendering.Debug.config.elemSpacers)return;const n=Math.abs(e.width),l=e.width<0;let i=l?e.xPos-n:e.xPos;o&&(i=-(i+n));const s=e.centerline-e.height/2;this.debugElements_.push(Blockly.utils.dom.createSvgElement("rect",{class:"elemSpacerRect blockRenderDebug",x:i,y:s,width:n,height:e.height,stroke:"pink",fill:l?"black":"pink","fill-opacity":"0.5","stroke-width":"1px"},this.svgRoot_))}drawRenderedElem(e,t){if(Blockly.blockRendering.Debug.config.elems){let o=e.xPos;t&&(o=-(o+e.width));const n=e.centerline-e.height/2;if(this.debugElements_.push(Blockly.utils.dom.createSvgElement("rect",{class:"rowRenderingRect blockRenderDebug",x:o,y:n,width:e.width,height:e.height,stroke:"black",fill:"none","stroke-width":"1px"},this.svgRoot_)),Blockly.blockRendering.Types.isField(e)&&e.field instanceof Blockly.FieldLabel){const t=this.constants_.FIELD_TEXT_BASELINE;this.debugElements_.push(Blockly.utils.dom.createSvgElement("rect",{class:"rowRenderingRect blockRenderDebug",x:o,y:n+t,width:e.width,height:"0.1px",stroke:"red",fill:"none","stroke-width":"0.5px"},this.svgRoot_))}}Blockly.blockRendering.Types.isInput(e)&&Blockly.blockRendering.Debug.config.connections&&this.drawConnection(e.connectionModel)}drawConnection(e){if(!Blockly.blockRendering.Debug.config.connections)return;let t,o,n;e.type==Blockly.INPUT_VALUE?(o=4,t="magenta",n="none"):e.type==Blockly.OUTPUT_VALUE?(o=2,t="magenta",n=t):e.type==Blockly.NEXT_STATEMENT?(o=4,t="goldenrod",n="none"):e.type==Blockly.PREVIOUS_STATEMENT&&(o=2,t="goldenrod",n=t),this.debugElements_.push(Blockly.utils.dom.createSvgElement("circle",{class:"blockRenderDebug",cx:e.offsetInBlock_.x,cy:e.offsetInBlock_.y,r:o,fill:n,stroke:t},this.svgRoot_))}drawRenderedRow(e,t,o){Blockly.blockRendering.Debug.config.rows&&(this.debugElements_.push(Blockly.utils.dom.createSvgElement("rect",{class:"elemRenderingRect blockRenderDebug",x:o?-(e.xPos+e.width):e.xPos,y:e.yPos,width:e.width,height:e.height,stroke:"red",fill:"none","stroke-width":"1px"},this.svgRoot_)),Blockly.blockRendering.Types.isTopOrBottomRow(e)||Blockly.blockRendering.Debug.config.connectedBlockBounds&&this.debugElements_.push(Blockly.utils.dom.createSvgElement("rect",{class:"connectedBlockWidth blockRenderDebug",x:o?-(e.xPos+e.widthWithConnectedBlocks):e.xPos,y:e.yPos,width:e.widthWithConnectedBlocks,height:e.height,stroke:this.randomColour_,fill:"none","stroke-width":"1px","stroke-dasharray":"3,3"},this.svgRoot_)))}drawRowWithElements(e,t,o){for(let t=0,n=e.elements.length;t<n;t++){const n=e.elements[t];n?Blockly.blockRendering.Types.isSpacer(n)?this.drawSpacerElem(n,e.height,o):this.drawRenderedElem(n,o):console.warn("A row has an undefined or null element.",e,n)}this.drawRenderedRow(e,t,o)}drawBoundingBox(e){if(!Blockly.blockRendering.Debug.config.blockBounds)return;let t=e.RTL?-e.width:0;this.debugElements_.push(Blockly.utils.dom.createSvgElement("rect",{class:"blockBoundingBox blockRenderDebug",x:t,y:0,width:e.width,height:e.height,stroke:"black",fill:"none","stroke-width":"1px","stroke-dasharray":"5,5"},this.svgRoot_)),Blockly.blockRendering.Debug.config.connectedBlockBounds&&(t=e.RTL?-e.widthWithChildren:0,this.debugElements_.push(Blockly.utils.dom.createSvgElement("rect",{class:"blockRenderDebug",x:t,y:0,width:e.widthWithChildren,height:e.height,stroke:"#DF57BC",fill:"none","stroke-width":"1px","stroke-dasharray":"3,3"},this.svgRoot_)))}drawDebug(e,t){this.clearElems(),this.svgRoot_=e.getSvgRoot(),this.randomColour_="#"+Math.floor(16777215*Math.random()).toString(16);let o=0;for(let e,n=0;e=t.rows[n];n++)Blockly.blockRendering.Types.isBetweenRowSpacer(e)?this.drawSpacerRow(e,o,t.RTL):this.drawRowWithElements(e,o,t.RTL),o+=e.height;e.previousConnection&&this.drawConnection(e.previousConnection),e.nextConnection&&this.drawConnection(e.nextConnection),e.outputConnection&&this.drawConnection(e.outputConnection),t.rightSide&&this.drawRenderedElem(t.rightSide,t.RTL),this.drawBoundingBox(t),this.drawRender(e.pathObject.svgPath)}drawRender(e){Blockly.blockRendering.Debug.config.render&&(e.setAttribute("filter","url(#"+this.constants_.debugFilterId+")"),setTimeout(function(){e.setAttribute("filter","")},100))}}DebugRenderer.config={rowSpacers:!0,elemSpacers:!0,rows:!0,elems:!0,connections:!0,blockBounds:!0,connectedBlockBounds:!0,render:!0};