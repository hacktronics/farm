/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
import{assert}from"chai";import*as sinon from"sinon";import*as commonTestHelpers from"./common_test_helpers.mocha";import*as Blockly from"blockly/core";const{runTestCases:runTestCases,runTestSuites:runTestSuites,TestCase:TestCase,TestSuite:TestSuite}=commonTestHelpers;export function CodeGenerationTestCase(){}CodeGenerationTestCase.prototype=new TestCase,CodeGenerationTestCase.prototype.expectedCode="",CodeGenerationTestCase.prototype.expectedInnerOrder=void 0,CodeGenerationTestCase.prototype.useWorkspaceToCode=!1,CodeGenerationTestCase.prototype.createBlock=void 0;export function CodeGenerationTestSuite(){}CodeGenerationTestSuite.prototype=new TestSuite,CodeGenerationTestSuite.prototype.generator=void 0;export function SerializationTestCase(){}SerializationTestCase.prototype=new TestCase,SerializationTestCase.prototype.xml="",SerializationTestCase.prototype.expectedXml="",SerializationTestCase.prototype.assertBlockStructure=void 0;const createCodeGenerationTestFn_=e=>t=>function(){const o=t.createBlock(this.workspace);let s,r;t.useWorkspaceToCode?s=e.workspaceToCode(this.workspace):(e.init(this.workspace),s=e.blockToCode(o),Array.isArray(s)&&(r=s[1],s=s[0]));("string"==typeof t.expectedCode?assert.equal:assert.match)(s,t.expectedCode),t.useWorkspaceToCode||void 0===t.expectedInnerOrder||assert.equal(r,t.expectedInnerOrder)};export const runCodeGenerationTestSuites=e=>{runTestSuites(e,e=>createCodeGenerationTestFn_(e.generator))};export const runSerializationTestSuite=e=>{const t=e=>function(){const t=Blockly.Xml.domToBlock(Blockly.Xml.textToDom(e.xml),this.workspace);e.assertBlockStructure(t)},o=e=>function(){const t=Blockly.Xml.domToBlock(Blockly.Xml.textToDom(e.xml),this.workspace),o=Blockly.Xml.domToPrettyText(Blockly.Xml.blockToDom(t)),s=e.expectedXml||e.xml;assert.equal(o,s)};suite("Serialization",function(){suite("xmlToBlock",function(){runTestCases(e,t)}),suite("xml round-trip",function(){setup(function(){sinon.stub(Blockly.utils,"genUid").returns("1")}),teardown(function(){sinon.restore()}),runTestCases(e,o)})})};