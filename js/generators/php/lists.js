/**
 * @license
 * Copyright 2015 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.PHP.lists"),goog.require("Blockly.PHP"),Blockly.PHP.lists_create_empty=function(l){return["array()",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_create_with=function(l){for(var e=new Array(l.itemCount_),o=0;o<l.itemCount_;o++)e[o]=Blockly.PHP.valueToCode(l,"ADD"+o,Blockly.PHP.ORDER_NONE)||"null";return[e="array("+e.join(", ")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_repeat=function(l){return[Blockly.PHP.provideFunction_("lists_repeat",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value, $count) {","  $array = array();","  for ($index = 0; $index < $count; $index++) {","    $array[] = $value;","  }","  return $array;","}"])+"("+(Blockly.PHP.valueToCode(l,"ITEM",Blockly.PHP.ORDER_NONE)||"null")+", "+(Blockly.PHP.valueToCode(l,"NUM",Blockly.PHP.ORDER_NONE)||"0")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_length=function(l){return[Blockly.PHP.provideFunction_("length",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value) {","  if (is_string($value)) {","    return strlen($value);","  } else {","    return count($value);","  }","}"])+"("+(Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"''")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_isEmpty=function(l){return["empty("+(Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_FUNCTION_CALL)||"array()")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_indexOf=function(l){var e=Blockly.PHP.valueToCode(l,"FIND",Blockly.PHP.ORDER_NONE)||"''",o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_MEMBER)||"[]";if(l.workspace.options.oneBasedIndex)var t=" 0",r=" + 1";else t=" -1",r="";if("FIRST"==l.getFieldValue("END"))var P=Blockly.PHP.provideFunction_("indexOf",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($haystack, $needle) {","  for ($index = 0; $index < count($haystack); $index++) {","    if ($haystack[$index] == $needle) return $index"+r+";","  }","  return "+t+";","}"]);else P=Blockly.PHP.provideFunction_("lastIndexOf",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($haystack, $needle) {","  $last = "+t+";","  for ($index = 0; $index < count($haystack); $index++) {","    if ($haystack[$index] == $needle) $last = $index"+r+";","  }","  return $last;","}"]);return[P+"("+o+", "+e+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_getIndex=function(l){var e=l.getFieldValue("MODE")||"GET";switch(l.getFieldValue("WHERE")||"FROM_START"){case"FIRST":if("GET"==e)return[t=(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_MEMBER)||"array()")+"[0]",Blockly.PHP.ORDER_MEMBER];if("GET_REMOVE"==e)return[t="array_shift("+(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+")",Blockly.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return"array_shift("+(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+");\n";break;case"LAST":if("GET"==e)return[t="end("+(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+")",Blockly.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==e)return[t="array_pop("+(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+")",Blockly.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return"array_pop("+(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+");\n";break;case"FROM_START":var o=Blockly.PHP.getAdjusted(l,"AT");if("GET"==e)return[t=(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_MEMBER)||"array()")+"["+o+"]",Blockly.PHP.ORDER_MEMBER];if("GET_REMOVE"==e)return[t="array_splice("+(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+", "+o+", 1)[0]",Blockly.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return"array_splice("+(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+", "+o+", 1);\n";break;case"FROM_END":var t;if("GET"==e)return[t="array_slice("+(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+", "+(o=Blockly.PHP.getAdjusted(l,"AT",1,!0))+", 1)[0]",Blockly.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==e||"REMOVE"==e){if(t="array_splice("+(r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+", count("+r+") - "+(o=Blockly.PHP.getAdjusted(l,"AT",1,!1,Blockly.PHP.ORDER_SUBTRACTION))+", 1)[0]","GET_REMOVE"==e)return[t,Blockly.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return t+";\n"}break;case"RANDOM":var r=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()";if("GET"==e)return[t=Blockly.PHP.provideFunction_("lists_get_random_item",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list) {","  return $list[rand(0,count($list)-1)];","}"])+"("+r+")",Blockly.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==e)return[t=Blockly.PHP.provideFunction_("lists_get_remove_random_item",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list) {","  $x = rand(0,count($list)-1);","  unset($list[$x]);","  return array_values($list);","}"])+"("+r+")",Blockly.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return Blockly.PHP.provideFunction_("lists_remove_random_item",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list) {","  unset($list[rand(0,count($list)-1)]);","}"])+"("+r+");\n"}throw Error("Unhandled combination (lists_getIndex).")},Blockly.PHP.lists_setIndex=function(l){var e=l.getFieldValue("MODE")||"GET",o=l.getFieldValue("WHERE")||"FROM_START",t=Blockly.PHP.valueToCode(l,"TO",Blockly.PHP.ORDER_ASSIGNMENT)||"null";switch(o){case"FIRST":if("SET"==e)return(r=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_MEMBER)||"array()")+"[0] = "+t+";\n";if("INSERT"==e)return"array_unshift("+(r=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"array()")+", "+t+");\n";break;case"LAST":var r=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"array()";if("SET"==e)return Blockly.PHP.provideFunction_("lists_set_last_item",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $value) {","  $list[count($list) - 1] = $value;","}"])+"("+r+", "+t+");\n";if("INSERT"==e)return"array_push("+r+", "+t+");\n";break;case"FROM_START":var P=Blockly.PHP.getAdjusted(l,"AT");if("SET"==e)return(r=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_MEMBER)||"array()")+"["+P+"] = "+t+";\n";if("INSERT"==e)return"array_splice("+(r=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"array()")+", "+P+", 0, "+t+");\n";break;case"FROM_END":r=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"array()",P=Blockly.PHP.getAdjusted(l,"AT",1);if("SET"==e)return Blockly.PHP.provideFunction_("lists_set_from_end",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $at, $value) {","  $list[count($list) - $at] = $value;","}"])+"("+r+", "+P+", "+t+");\n";if("INSERT"==e)return Blockly.PHP.provideFunction_("lists_insert_from_end",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $at, $value) {","  return array_splice($list, count($list) - $at, 0, $value);","}"])+"("+r+", "+P+", "+t+");\n";break;case"RANDOM":r=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_REFERENCE)||"array()";var a=function(){if(r.match(/^\$\w+$/))return"";var l=Blockly.PHP.nameDB_.getDistinctName("tmp_list",Blockly.VARIABLE_CATEGORY_NAME),e=l+" = &"+r+";\n";return r=l,e}(),c=Blockly.PHP.nameDB_.getDistinctName("tmp_x",Blockly.VARIABLE_CATEGORY_NAME);if(a+=c+" = rand(0, count("+r+")-1);\n","SET"==e)return a+=r+"["+c+"] = "+t+";\n";if("INSERT"==e)return a+="array_splice("+r+", "+c+", 0, "+t+");\n"}throw Error("Unhandled combination (lists_setIndex).")},Blockly.PHP.lists_getSublist=function(l){var e=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"array()",o=l.getFieldValue("WHERE1"),t=l.getFieldValue("WHERE2");if("FIRST"==o&&"LAST"==t)var r=e;else if(e.match(/^\$\w+$/)||"FROM_END"!=o&&"FROM_START"==t){switch(o){case"FROM_START":var P=Blockly.PHP.getAdjusted(l,"AT1");break;case"FROM_END":P="count("+e+") - "+(P=Blockly.PHP.getAdjusted(l,"AT1",1,!1,Blockly.PHP.ORDER_SUBTRACTION));break;case"FIRST":P="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(t){case"FROM_START":var a=(c=Blockly.PHP.getAdjusted(l,"AT2",0,!1,Blockly.PHP.ORDER_SUBTRACTION))+" - ";Blockly.isNumber(String(P))||String(P).match(/^\(.+\)$/)?a+=P:a+="("+P+")",a+=" + 1";break;case"FROM_END":a="count("+e+") - "+(c=Blockly.PHP.getAdjusted(l,"AT2",0,!1,Blockly.PHP.ORDER_SUBTRACTION))+" - ";Blockly.isNumber(String(P))||String(P).match(/^\(.+\)$/)?a+=P:a+="("+P+")";break;case"LAST":a="count("+e+") - ";Blockly.isNumber(String(P))||String(P).match(/^\(.+\)$/)?a+=P:a+="("+P+")";break;default:throw Error("Unhandled option (lists_getSublist).")}r="array_slice("+e+", "+P+", "+a+")"}else{P=Blockly.PHP.getAdjusted(l,"AT1");var c=Blockly.PHP.getAdjusted(l,"AT2");r=Blockly.PHP.provideFunction_("lists_get_sublist",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list, $where1, $at1, $where2, $at2) {","  if ($where1 == 'FROM_END') {","    $at1 = count($list) - 1 - $at1;","  } else if ($where1 == 'FIRST') {","    $at1 = 0;","  } else if ($where1 != 'FROM_START') {","    throw new Exception('Unhandled option (lists_get_sublist).');","  }","  $length = 0;","  if ($where2 == 'FROM_START') {","    $length = $at2 - $at1 + 1;","  } else if ($where2 == 'FROM_END') {","    $length = count($list) - $at1 - $at2;","  } else if ($where2 == 'LAST') {","    $length = count($list) - $at1;","  } else {","    throw new Exception('Unhandled option (lists_get_sublist).');","  }","  return array_slice($list, $at1, $length);","}"])+"("+e+", '"+o+"', "+P+", '"+t+"', "+c+")"}return[r,Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_sort=function(l){var e=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"array()",o="1"===l.getFieldValue("DIRECTION")?1:-1,t=l.getFieldValue("TYPE");return[Blockly.PHP.provideFunction_("lists_sort",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list, $type, $direction) {","  $sortCmpFuncs = array(",'    "NUMERIC" => "strnatcasecmp",','    "TEXT" => "strcmp",','    "IGNORE_CASE" => "strcasecmp"',"  );","  $sortCmp = $sortCmpFuncs[$type];","  $list2 = $list;","  usort($list2, $sortCmp);","  if ($direction == -1) {","    $list2 = array_reverse($list2);","  }","  return $list2;","}"])+"("+e+', "'+t+'", '+o+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_split=function(l){var e=Blockly.PHP.valueToCode(l,"INPUT",Blockly.PHP.ORDER_NONE),o=Blockly.PHP.valueToCode(l,"DELIM",Blockly.PHP.ORDER_NONE)||"''",t=l.getFieldValue("MODE");if("SPLIT"==t){e||(e="''");var r="explode"}else{if("JOIN"!=t)throw Error("Unknown mode: "+t);e||(e="array()");r="implode"}return[r+"("+o+", "+e+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_reverse=function(l){return["array_reverse("+(Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"[]")+")",Blockly.PHP.ORDER_FUNCTION_CALL]};