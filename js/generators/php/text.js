/**
 * @license
 * Copyright 2015 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.PHP.texts"),goog.require("Blockly.PHP"),Blockly.PHP.text=function(l){return[Blockly.PHP.quote_(l.getFieldValue("TEXT")),Blockly.PHP.ORDER_ATOMIC]},Blockly.PHP.text_multiline=function(l){var e=Blockly.PHP.multiline_quote_(l.getFieldValue("TEXT")),t=-1!=e.indexOf(".")?Blockly.PHP.ORDER_STRING_CONCAT:Blockly.PHP.ORDER_ATOMIC;return[e,t]},Blockly.PHP.text_join=function(l){if(0==l.itemCount_)return["''",Blockly.PHP.ORDER_ATOMIC];if(1==l.itemCount_)return[Blockly.PHP.valueToCode(l,"ADD0",Blockly.PHP.ORDER_NONE)||"''",Blockly.PHP.ORDER_NONE];if(2==l.itemCount_)return[(Blockly.PHP.valueToCode(l,"ADD0",Blockly.PHP.ORDER_STRING_CONCAT)||"''")+" . "+(Blockly.PHP.valueToCode(l,"ADD1",Blockly.PHP.ORDER_STRING_CONCAT)||"''"),Blockly.PHP.ORDER_STRING_CONCAT];for(var e=new Array(l.itemCount_),t=0;t<l.itemCount_;t++)e[t]=Blockly.PHP.valueToCode(l,"ADD"+t,Blockly.PHP.ORDER_NONE)||"''";return["implode('', array("+e.join(",")+"))",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_append=function(l){return Blockly.PHP.nameDB_.getName(l.getFieldValue("VAR"),Blockly.VARIABLE_CATEGORY_NAME)+" .= "+(Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_ASSIGNMENT)||"''")+";\n"},Blockly.PHP.text_length=function(l){return[Blockly.PHP.provideFunction_("length",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value) {","  if (is_string($value)) {","    return strlen($value);","  } else {","    return count($value);","  }","}"])+"("+(Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"''")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_isEmpty=function(l){return["empty("+(Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"''")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_indexOf=function(l){var e="FIRST"==l.getFieldValue("END")?"strpos":"strrpos",t=Blockly.PHP.valueToCode(l,"FIND",Blockly.PHP.ORDER_NONE)||"''",o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"''";if(l.workspace.options.oneBasedIndex)var P=" 0",r=" + 1";else P=" -1",r="";return[Blockly.PHP.provideFunction_("FIRST"==l.getFieldValue("END")?"text_indexOf":"text_lastIndexOf",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text, $search) {","  $pos = "+e+"($text, $search);","  return $pos === false ? "+P+" : $pos"+r+";","}"])+"("+o+", "+t+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_charAt=function(l){var e=l.getFieldValue("WHERE")||"FROM_START",t=Blockly.PHP.ORDER_NONE,o=Blockly.PHP.valueToCode(l,"VALUE",t)||"''";switch(e){case"FIRST":return["substr("+o+", 0, 1)",Blockly.PHP.ORDER_FUNCTION_CALL];case"LAST":return["substr("+o+", -1)",Blockly.PHP.ORDER_FUNCTION_CALL];case"FROM_START":return["substr("+o+", "+Blockly.PHP.getAdjusted(l,"AT")+", 1)",Blockly.PHP.ORDER_FUNCTION_CALL];case"FROM_END":return["substr("+o+", "+Blockly.PHP.getAdjusted(l,"AT",1,!0)+", 1)",Blockly.PHP.ORDER_FUNCTION_CALL];case"RANDOM":return[Blockly.PHP.provideFunction_("text_random_letter",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text) {","  return $text[rand(0, strlen($text) - 1)];","}"])+"("+o+")",Blockly.PHP.ORDER_FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},Blockly.PHP.text_getSubstring=function(l){var e=l.getFieldValue("WHERE1"),t=l.getFieldValue("WHERE2"),o=Blockly.PHP.valueToCode(l,"STRING",Blockly.PHP.ORDER_NONE)||"''";if("FIRST"==e&&"LAST"==t)return[o,Blockly.PHP.ORDER_NONE];var P=Blockly.PHP.getAdjusted(l,"AT1"),r=Blockly.PHP.getAdjusted(l,"AT2");return[Blockly.PHP.provideFunction_("text_get_substring",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text, $where1, $at1, $where2, $at2) {","  if ($where1 == 'FROM_END') {","    $at1 = strlen($text) - 1 - $at1;","  } else if ($where1 == 'FIRST') {","    $at1 = 0;","  } else if ($where1 != 'FROM_START'){","    throw new Exception('Unhandled option (text_get_substring).');","  }","  $length = 0;","  if ($where2 == 'FROM_START') {","    $length = $at2 - $at1 + 1;","  } else if ($where2 == 'FROM_END') {","    $length = strlen($text) - $at1 - $at2;","  } else if ($where2 == 'LAST') {","    $length = strlen($text) - $at1;","  } else {","    throw new Exception('Unhandled option (text_get_substring).');","  }","  return substr($text, $at1, $length);","}"])+"("+o+", '"+e+"', "+P+", '"+t+"', "+r+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_changeCase=function(l){var e=Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''";if("UPPERCASE"==l.getFieldValue("CASE"))var t="strtoupper("+e+")";else if("LOWERCASE"==l.getFieldValue("CASE"))t="strtolower("+e+")";else if("TITLECASE"==l.getFieldValue("CASE"))t="ucwords(strtolower("+e+"))";return[t,Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_trim=function(l){return[{LEFT:"ltrim",RIGHT:"rtrim",BOTH:"trim"}[l.getFieldValue("MODE")]+"("+(Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_print=function(l){return"print("+(Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''")+");\n"},Blockly.PHP.text_prompt_ext=function(l){if(l.getField("TEXT"))var e=Blockly.PHP.quote_(l.getFieldValue("TEXT"));else e=Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''";var t="readline("+e+")";return"NUMBER"==l.getFieldValue("TYPE")&&(t="floatval("+t+")"),[t,Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_prompt=Blockly.PHP.text_prompt_ext,Blockly.PHP.text_count=function(l){var e=Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''",t=Blockly.PHP.valueToCode(l,"SUB",Blockly.PHP.ORDER_NONE)||"''";return["strlen("+t+") === 0 ? strlen("+e+") + 1 : substr_count("+e+", "+t+")",Blockly.PHP.ORDER_CONDITIONAL]},Blockly.PHP.text_replace=function(l){var e=Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''";return["str_replace("+(Blockly.PHP.valueToCode(l,"FROM",Blockly.PHP.ORDER_NONE)||"''")+", "+(Blockly.PHP.valueToCode(l,"TO",Blockly.PHP.ORDER_NONE)||"''")+", "+e+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_reverse=function(l){return["strrev("+(Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''")+")",Blockly.PHP.ORDER_FUNCTION_CALL]};