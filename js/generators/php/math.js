/**
 * @license
 * Copyright 2015 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.PHP.math"),goog.require("Blockly.PHP"),Blockly.PHP.math_number=function(l){var o=parseFloat(l.getFieldValue("NUM")),e=o>=0?Blockly.PHP.ORDER_ATOMIC:Blockly.PHP.ORDER_UNARY_NEGATION;return o==1/0?o="INF":o==-1/0&&(o="-INF"),[o,e]},Blockly.PHP.math_arithmetic=function(l){var o={ADD:[" + ",Blockly.PHP.ORDER_ADDITION],MINUS:[" - ",Blockly.PHP.ORDER_SUBTRACTION],MULTIPLY:[" * ",Blockly.PHP.ORDER_MULTIPLICATION],DIVIDE:[" / ",Blockly.PHP.ORDER_DIVISION],POWER:[" ** ",Blockly.PHP.ORDER_POWER]}[l.getFieldValue("OP")],e=o[0],P=o[1];return[(Blockly.PHP.valueToCode(l,"A",P)||"0")+e+(Blockly.PHP.valueToCode(l,"B",P)||"0"),P]},Blockly.PHP.math_single=function(l){var o,e,P=l.getFieldValue("OP");if("NEG"==P)return"-"==(e=Blockly.PHP.valueToCode(l,"NUM",Blockly.PHP.ORDER_UNARY_NEGATION)||"0")[0]&&(e=" "+e),[o="-"+e,Blockly.PHP.ORDER_UNARY_NEGATION];switch(e="SIN"==P||"COS"==P||"TAN"==P?Blockly.PHP.valueToCode(l,"NUM",Blockly.PHP.ORDER_DIVISION)||"0":Blockly.PHP.valueToCode(l,"NUM",Blockly.PHP.ORDER_NONE)||"0",P){case"ABS":o="abs("+e+")";break;case"ROOT":o="sqrt("+e+")";break;case"LN":o="log("+e+")";break;case"EXP":o="exp("+e+")";break;case"POW10":o="pow(10,"+e+")";break;case"ROUND":o="round("+e+")";break;case"ROUNDUP":o="ceil("+e+")";break;case"ROUNDDOWN":o="floor("+e+")";break;case"SIN":o="sin("+e+" / 180 * pi())";break;case"COS":o="cos("+e+" / 180 * pi())";break;case"TAN":o="tan("+e+" / 180 * pi())"}if(o)return[o,Blockly.PHP.ORDER_FUNCTION_CALL];switch(P){case"LOG10":o="log("+e+") / log(10)";break;case"ASIN":o="asin("+e+") / pi() * 180";break;case"ACOS":o="acos("+e+") / pi() * 180";break;case"ATAN":o="atan("+e+") / pi() * 180";break;default:throw Error("Unknown math operator: "+P)}return[o,Blockly.PHP.ORDER_DIVISION]},Blockly.PHP.math_constant=function(l){return{PI:["M_PI",Blockly.PHP.ORDER_ATOMIC],E:["M_E",Blockly.PHP.ORDER_ATOMIC],GOLDEN_RATIO:["(1 + sqrt(5)) / 2",Blockly.PHP.ORDER_DIVISION],SQRT2:["M_SQRT2",Blockly.PHP.ORDER_ATOMIC],SQRT1_2:["M_SQRT1_2",Blockly.PHP.ORDER_ATOMIC],INFINITY:["INF",Blockly.PHP.ORDER_ATOMIC]}[l.getFieldValue("CONSTANT")]},Blockly.PHP.math_number_property=function(l){var o,e=Blockly.PHP.valueToCode(l,"NUMBER_TO_CHECK",Blockly.PHP.ORDER_MODULUS)||"0",P=l.getFieldValue("PROPERTY");if("PRIME"==P)return[o=Blockly.PHP.provideFunction_("math_isPrime",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($n) {","  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if ($n == 2 || $n == 3) {","    return true;","  }","  // False if n is NaN, negative, is 1, or not whole.","  // And false if n is divisible by 2 or 3.","  if (!is_numeric($n) || $n <= 1 || $n % 1 != 0 || $n % 2 == 0 || $n % 3 == 0) {","    return false;","  }","  // Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for ($x = 6; $x <= sqrt($n) + 1; $x += 6) {","    if ($n % ($x - 1) == 0 || $n % ($x + 1) == 0) {","      return false;","    }","  }","  return true;","}"])+"("+e+")",Blockly.PHP.ORDER_FUNCTION_CALL];switch(P){case"EVEN":o=e+" % 2 == 0";break;case"ODD":o=e+" % 2 == 1";break;case"WHOLE":o="is_int("+e+")";break;case"POSITIVE":o=e+" > 0";break;case"NEGATIVE":o=e+" < 0";break;case"DIVISIBLE_BY":o=e+" % "+(Blockly.PHP.valueToCode(l,"DIVISOR",Blockly.PHP.ORDER_MODULUS)||"0")+" == 0"}return[o,Blockly.PHP.ORDER_EQUALITY]},Blockly.PHP.math_change=function(l){var o=Blockly.PHP.valueToCode(l,"DELTA",Blockly.PHP.ORDER_ADDITION)||"0";return Blockly.PHP.nameDB_.getName(l.getFieldValue("VAR"),Blockly.VARIABLE_CATEGORY_NAME)+" += "+o+";\n"},Blockly.PHP.math_round=Blockly.PHP.math_single,Blockly.PHP.math_trig=Blockly.PHP.math_single,Blockly.PHP.math_on_list=function(l){var o,e=l.getFieldValue("OP");switch(e){case"SUM":o="array_sum("+(Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"MIN":o="min("+(Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"MAX":o="max("+(Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"AVERAGE":o=Blockly.PHP.provideFunction_("math_mean",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($myList) {","  return array_sum($myList) / count($myList);","}"])+"("+(Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"array()")+")";break;case"MEDIAN":o=Blockly.PHP.provideFunction_("math_median",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($arr) {","  sort($arr,SORT_NUMERIC);","  return (count($arr) % 2) ? $arr[floor(count($arr)/2)] : ","      ($arr[floor(count($arr)/2)] + $arr[floor(count($arr)/2) - 1]) / 2;","}"])+"("+(Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"[]")+")";break;case"MODE":o=Blockly.PHP.provideFunction_("math_modes",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($values) {","  if (empty($values)) return array();","  $counts = array_count_values($values);","  arsort($counts); // Sort counts in descending order","  $modes = array_keys($counts, current($counts), true);","  return $modes;","}"])+"("+(Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"[]")+")";break;case"STD_DEV":o=Blockly.PHP.provideFunction_("math_standard_deviation",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($numbers) {","  $n = count($numbers);","  if (!$n) return null;","  $mean = array_sum($numbers) / count($numbers);","  foreach($numbers as $key => $num) $devs[$key] = pow($num - $mean, 2);","  return sqrt(array_sum($devs) / (count($devs) - 1));","}"])+"("+(Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"[]")+")";break;case"RANDOM":o=Blockly.PHP.provideFunction_("math_random_list",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list) {","  $x = rand(0, count($list)-1);","  return $list[$x];","}"])+"("+(Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"[]")+")";break;default:throw Error("Unknown operator: "+e)}return[o,Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.math_modulo=function(l){return[(Blockly.PHP.valueToCode(l,"DIVIDEND",Blockly.PHP.ORDER_MODULUS)||"0")+" % "+(Blockly.PHP.valueToCode(l,"DIVISOR",Blockly.PHP.ORDER_MODULUS)||"0"),Blockly.PHP.ORDER_MODULUS]},Blockly.PHP.math_constrain=function(l){return["min(max("+(Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"0")+", "+(Blockly.PHP.valueToCode(l,"LOW",Blockly.PHP.ORDER_NONE)||"0")+"), "+(Blockly.PHP.valueToCode(l,"HIGH",Blockly.PHP.ORDER_NONE)||"Infinity")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.math_random_int=function(l){var o=Blockly.PHP.valueToCode(l,"FROM",Blockly.PHP.ORDER_NONE)||"0",e=Blockly.PHP.valueToCode(l,"TO",Blockly.PHP.ORDER_NONE)||"0";return[Blockly.PHP.provideFunction_("math_random_int",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($a, $b) {","  if ($a > $b) {","    return rand($b, $a);","  }","  return rand($a, $b);","}"])+"("+o+", "+e+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.math_random_float=function(l){return["(float)rand()/(float)getrandmax()",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.math_atan2=function(l){var o=Blockly.PHP.valueToCode(l,"X",Blockly.PHP.ORDER_NONE)||"0";return["atan2("+(Blockly.PHP.valueToCode(l,"Y",Blockly.PHP.ORDER_NONE)||"0")+", "+o+") / pi() * 180",Blockly.PHP.ORDER_DIVISION]};