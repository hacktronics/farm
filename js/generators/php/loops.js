/**
 * @license
 * Copyright 2015 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.PHP.loops"),goog.require("Blockly.PHP"),Blockly.PHP.controls_repeat_ext=function(l){if(l.getField("TIMES"))var o=String(Number(l.getFieldValue("TIMES")));else o=Blockly.PHP.valueToCode(l,"TIMES",Blockly.PHP.ORDER_ASSIGNMENT)||"0";var e=Blockly.PHP.statementToCode(l,"DO");e=Blockly.PHP.addLoopTrap(e,l);var P="",c=Blockly.PHP.nameDB_.getDistinctName("count",Blockly.VARIABLE_CATEGORY_NAME),t=o;return o.match(/^\w+$/)||Blockly.isNumber(o)||(P+=(t=Blockly.PHP.nameDB_.getDistinctName("repeat_end",Blockly.VARIABLE_CATEGORY_NAME))+" = "+o+";\n"),P+="for ("+c+" = 0; "+c+" < "+t+"; "+c+"++) {\n"+e+"}\n"},Blockly.PHP.controls_repeat=Blockly.PHP.controls_repeat_ext,Blockly.PHP.controls_whileUntil=function(l){var o="UNTIL"==l.getFieldValue("MODE"),e=Blockly.PHP.valueToCode(l,"BOOL",o?Blockly.PHP.ORDER_LOGICAL_NOT:Blockly.PHP.ORDER_NONE)||"false",P=Blockly.PHP.statementToCode(l,"DO");return o&&(e="!"+e),"while ("+e+") {\n"+(P=Blockly.PHP.addLoopTrap(P,l))+"}\n"},Blockly.PHP.controls_for=function(l){var o,e=Blockly.PHP.nameDB_.getName(l.getFieldValue("VAR"),Blockly.VARIABLE_CATEGORY_NAME),P=Blockly.PHP.valueToCode(l,"FROM",Blockly.PHP.ORDER_ASSIGNMENT)||"0",c=Blockly.PHP.valueToCode(l,"TO",Blockly.PHP.ORDER_ASSIGNMENT)||"0",t=Blockly.PHP.valueToCode(l,"BY",Blockly.PHP.ORDER_ASSIGNMENT)||"1",a=Blockly.PHP.statementToCode(l,"DO");if(a=Blockly.PHP.addLoopTrap(a,l),Blockly.isNumber(P)&&Blockly.isNumber(c)&&Blockly.isNumber(t)){var B=parseFloat(P)<=parseFloat(c);o="for ("+e+" = "+P+"; "+e+(B?" <= ":" >= ")+c+"; "+e;var n=Math.abs(parseFloat(t));o+=1==n?B?"++":"--":(B?" += ":" -= ")+n,o+=") {\n"+a+"}\n"}else{o="";var r=P;P.match(/^\w+$/)||Blockly.isNumber(P)||(o+=(r=Blockly.PHP.nameDB_.getDistinctName(e+"_start",Blockly.VARIABLE_CATEGORY_NAME))+" = "+P+";\n");var k=c;c.match(/^\w+$/)||Blockly.isNumber(c)||(o+=(k=Blockly.PHP.nameDB_.getDistinctName(e+"_end",Blockly.VARIABLE_CATEGORY_NAME))+" = "+c+";\n");var y=Blockly.PHP.nameDB_.getDistinctName(e+"_inc",Blockly.VARIABLE_CATEGORY_NAME);o+=y+" = ",Blockly.isNumber(t)?o+=Math.abs(t)+";\n":o+="abs("+t+");\n",o+="if ("+r+" > "+k+") {\n",o+=Blockly.PHP.INDENT+y+" = -"+y+";\n",o+="}\n",o+="for ("+e+" = "+r+"; "+y+" >= 0 ? "+e+" <= "+k+" : "+e+" >= "+k+"; "+e+" += "+y+") {\n"+a+"}\n"}return o},Blockly.PHP.controls_forEach=function(l){var o=Blockly.PHP.nameDB_.getName(l.getFieldValue("VAR"),Blockly.VARIABLE_CATEGORY_NAME),e=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_ASSIGNMENT)||"[]",P=Blockly.PHP.statementToCode(l,"DO"),c="";return c+="foreach ("+e+" as "+o+") {\n"+(P=Blockly.PHP.addLoopTrap(P,l))+"}\n"},Blockly.PHP.controls_flow_statements=function(l){var o="";if(Blockly.PHP.STATEMENT_PREFIX&&(o+=Blockly.PHP.injectId(Blockly.PHP.STATEMENT_PREFIX,l)),Blockly.PHP.STATEMENT_SUFFIX&&(o+=Blockly.PHP.injectId(Blockly.PHP.STATEMENT_SUFFIX,l)),Blockly.PHP.STATEMENT_PREFIX){var e=Blockly.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(l);e&&!e.suppressPrefixSuffix&&(o+=Blockly.PHP.injectId(Blockly.PHP.STATEMENT_PREFIX,e))}switch(l.getFieldValue("FLOW")){case"BREAK":return o+"break;\n";case"CONTINUE":return o+"continue;\n"}throw Error("Unknown flow statement.")};