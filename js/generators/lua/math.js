/**
 * @license
 * Copyright 2016 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Lua.math"),goog.require("Blockly.Lua"),Blockly.Lua.math_number=function(a){var e=parseFloat(a.getFieldValue("NUM"));return[e,e<0?Blockly.Lua.ORDER_UNARY:Blockly.Lua.ORDER_ATOMIC]},Blockly.Lua.math_arithmetic=function(a){var e={ADD:[" + ",Blockly.Lua.ORDER_ADDITIVE],MINUS:[" - ",Blockly.Lua.ORDER_ADDITIVE],MULTIPLY:[" * ",Blockly.Lua.ORDER_MULTIPLICATIVE],DIVIDE:[" / ",Blockly.Lua.ORDER_MULTIPLICATIVE],POWER:[" ^ ",Blockly.Lua.ORDER_EXPONENTIATION]}[a.getFieldValue("OP")],l=e[0],t=e[1];return[(Blockly.Lua.valueToCode(a,"A",t)||"0")+l+(Blockly.Lua.valueToCode(a,"B",t)||"0"),t]},Blockly.Lua.math_single=function(a){var e,l,t=a.getFieldValue("OP");if("NEG"==t)return["-"+(l=Blockly.Lua.valueToCode(a,"NUM",Blockly.Lua.ORDER_UNARY)||"0"),Blockly.Lua.ORDER_UNARY];if("POW10"==t)return["10 ^ "+(l=Blockly.Lua.valueToCode(a,"NUM",Blockly.Lua.ORDER_EXPONENTIATION)||"0"),Blockly.Lua.ORDER_EXPONENTIATION];switch(l="ROUND"==t?Blockly.Lua.valueToCode(a,"NUM",Blockly.Lua.ORDER_ADDITIVE)||"0":Blockly.Lua.valueToCode(a,"NUM",Blockly.Lua.ORDER_NONE)||"0",t){case"ABS":e="math.abs("+l+")";break;case"ROOT":e="math.sqrt("+l+")";break;case"LN":e="math.log("+l+")";break;case"LOG10":e="math.log("+l+", 10)";break;case"EXP":e="math.exp("+l+")";break;case"ROUND":e="math.floor("+l+" + .5)";break;case"ROUNDUP":e="math.ceil("+l+")";break;case"ROUNDDOWN":e="math.floor("+l+")";break;case"SIN":e="math.sin(math.rad("+l+"))";break;case"COS":e="math.cos(math.rad("+l+"))";break;case"TAN":e="math.tan(math.rad("+l+"))";break;case"ASIN":e="math.deg(math.asin("+l+"))";break;case"ACOS":e="math.deg(math.acos("+l+"))";break;case"ATAN":e="math.deg(math.atan("+l+"))";break;default:throw Error("Unknown math operator: "+t)}return[e,Blockly.Lua.ORDER_HIGH]},Blockly.Lua.math_constant=function(a){return{PI:["math.pi",Blockly.Lua.ORDER_HIGH],E:["math.exp(1)",Blockly.Lua.ORDER_HIGH],GOLDEN_RATIO:["(1 + math.sqrt(5)) / 2",Blockly.Lua.ORDER_MULTIPLICATIVE],SQRT2:["math.sqrt(2)",Blockly.Lua.ORDER_HIGH],SQRT1_2:["math.sqrt(1 / 2)",Blockly.Lua.ORDER_HIGH],INFINITY:["math.huge",Blockly.Lua.ORDER_HIGH]}[a.getFieldValue("CONSTANT")]},Blockly.Lua.math_number_property=function(a){var e,l=Blockly.Lua.valueToCode(a,"NUMBER_TO_CHECK",Blockly.Lua.ORDER_MULTIPLICATIVE)||"0",t=a.getFieldValue("PROPERTY");if("PRIME"==t)return[e=Blockly.Lua.provideFunction_("math_isPrime",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(n)","  -- https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if n == 2 or n == 3 then","    return true","  end","  -- False if n is NaN, negative, is 1, or not whole.","  -- And false if n is divisible by 2 or 3.","  if not(n > 1) or n % 1 ~= 0 or n % 2 == 0 or n % 3 == 0 then","    return false","  end","  -- Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for x = 6, math.sqrt(n) + 1.5, 6 do","    if n % (x - 1) == 0 or n % (x + 1) == 0 then","      return false","    end","  end","  return true","end"])+"("+l+")",Blockly.Lua.ORDER_HIGH];switch(t){case"EVEN":e=l+" % 2 == 0";break;case"ODD":e=l+" % 2 == 1";break;case"WHOLE":e=l+" % 1 == 0";break;case"POSITIVE":e=l+" > 0";break;case"NEGATIVE":e=l+" < 0";break;case"DIVISIBLE_BY":var o=Blockly.Lua.valueToCode(a,"DIVISOR",Blockly.Lua.ORDER_MULTIPLICATIVE);if(!o||"0"==o)return["nil",Blockly.Lua.ORDER_ATOMIC];e=l+" % "+o+" == 0"}return[e,Blockly.Lua.ORDER_RELATIONAL]},Blockly.Lua.math_change=function(a){var e=Blockly.Lua.valueToCode(a,"DELTA",Blockly.Lua.ORDER_ADDITIVE)||"0",l=Blockly.Lua.nameDB_.getName(a.getFieldValue("VAR"),Blockly.VARIABLE_CATEGORY_NAME);return l+" = "+l+" + "+e+"\n"},Blockly.Lua.math_round=Blockly.Lua.math_single,Blockly.Lua.math_trig=Blockly.Lua.math_single,Blockly.Lua.math_on_list=function(a){var e,l=a.getFieldValue("OP"),t=Blockly.Lua.valueToCode(a,"LIST",Blockly.Lua.ORDER_NONE)||"{}";function o(){return Blockly.Lua.provideFunction_("math_sum",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  local result = 0","  for _, v in ipairs(t) do","    result = result + v","  end","  return result","end"])}switch(l){case"SUM":e=o();break;case"MIN":e=Blockly.Lua.provideFunction_("math_min",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return 0","  end","  local result = math.huge","  for _, v in ipairs(t) do","    if v < result then","      result = v","    end","  end","  return result","end"]);break;case"AVERAGE":e=Blockly.Lua.provideFunction_("math_average",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return 0","  end","  return "+o()+"(t) / #t","end"]);break;case"MAX":e=Blockly.Lua.provideFunction_("math_max",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return 0","  end","  local result = -math.huge","  for _, v in ipairs(t) do","    if v > result then","      result = v","    end","  end","  return result","end"]);break;case"MEDIAN":e=Blockly.Lua.provideFunction_("math_median",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  -- Source: http://lua-users.org/wiki/SimpleStats","  if #t == 0 then","    return 0","  end","  local temp={}","  for _, v in ipairs(t) do",'    if type(v) == "number" then',"      table.insert(temp, v)","    end","  end","  table.sort(temp)","  if #temp % 2 == 0 then","    return (temp[#temp/2] + temp[(#temp/2)+1]) / 2","  else","    return temp[math.ceil(#temp/2)]","  end","end"]);break;case"MODE":e=Blockly.Lua.provideFunction_("math_modes",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  -- Source: http://lua-users.org/wiki/SimpleStats","  local counts={}","  for _, v in ipairs(t) do","    if counts[v] == nil then","      counts[v] = 1","    else","      counts[v] = counts[v] + 1","    end","  end","  local biggestCount = 0","  for _, v  in pairs(counts) do","    if v > biggestCount then","      biggestCount = v","    end","  end","  local temp={}","  for k, v in pairs(counts) do","    if v == biggestCount then","      table.insert(temp, k)","    end","  end","  return temp","end"]);break;case"STD_DEV":e=Blockly.Lua.provideFunction_("math_standard_deviation",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  local m","  local vm","  local total = 0","  local count = 0","  local result","  m = #t == 0 and 0 or "+o()+"(t) / #t","  for _, v in ipairs(t) do","    if type(v) == 'number' then","      vm = v - m","      total = total + (vm * vm)","      count = count + 1","    end","  end","  result = math.sqrt(total / (count-1))","  return result","end"]);break;case"RANDOM":e=Blockly.Lua.provideFunction_("math_random_list",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return nil","  end","  return t[math.random(#t)]","end"]);break;default:throw Error("Unknown operator: "+l)}return[e+"("+t+")",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.math_modulo=function(a){return[(Blockly.Lua.valueToCode(a,"DIVIDEND",Blockly.Lua.ORDER_MULTIPLICATIVE)||"0")+" % "+(Blockly.Lua.valueToCode(a,"DIVISOR",Blockly.Lua.ORDER_MULTIPLICATIVE)||"0"),Blockly.Lua.ORDER_MULTIPLICATIVE]},Blockly.Lua.math_constrain=function(a){return["math.min(math.max("+(Blockly.Lua.valueToCode(a,"VALUE",Blockly.Lua.ORDER_NONE)||"0")+", "+(Blockly.Lua.valueToCode(a,"LOW",Blockly.Lua.ORDER_NONE)||"-math.huge")+"), "+(Blockly.Lua.valueToCode(a,"HIGH",Blockly.Lua.ORDER_NONE)||"math.huge")+")",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.math_random_int=function(a){return["math.random("+(Blockly.Lua.valueToCode(a,"FROM",Blockly.Lua.ORDER_NONE)||"0")+", "+(Blockly.Lua.valueToCode(a,"TO",Blockly.Lua.ORDER_NONE)||"0")+")",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.math_random_float=function(a){return["math.random()",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.math_atan2=function(a){var e=Blockly.Lua.valueToCode(a,"X",Blockly.Lua.ORDER_NONE)||"0";return["math.deg(math.atan2("+(Blockly.Lua.valueToCode(a,"Y",Blockly.Lua.ORDER_NONE)||"0")+", "+e+"))",Blockly.Lua.ORDER_HIGH]};