/**
 * @license
 * Copyright 2016 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Lua.loops"),goog.require("Blockly.Lua"),Blockly.Lua.CONTINUE_STATEMENT="goto continue\n",Blockly.Lua.addContinueLabel_=function(l){return-1!=l.indexOf(Blockly.Lua.CONTINUE_STATEMENT)?l+Blockly.Lua.INDENT+"::continue::\n":l},Blockly.Lua.controls_repeat_ext=function(l){if(l.getField("TIMES"))var o=String(Number(l.getFieldValue("TIMES")));else o=Blockly.Lua.valueToCode(l,"TIMES",Blockly.Lua.ORDER_NONE)||"0";o=Blockly.isNumber(o)?parseInt(o,10):"math.floor("+o+")";var a=Blockly.Lua.statementToCode(l,"DO");return a=Blockly.Lua.addLoopTrap(a,l),a=Blockly.Lua.addContinueLabel_(a),"for "+Blockly.Lua.nameDB_.getDistinctName("count",Blockly.VARIABLE_CATEGORY_NAME)+" = 1, "+o+" do\n"+a+"end\n"},Blockly.Lua.controls_repeat=Blockly.Lua.controls_repeat_ext,Blockly.Lua.controls_whileUntil=function(l){var o="UNTIL"==l.getFieldValue("MODE"),a=Blockly.Lua.valueToCode(l,"BOOL",o?Blockly.Lua.ORDER_UNARY:Blockly.Lua.ORDER_NONE)||"false",e=Blockly.Lua.statementToCode(l,"DO");return e=Blockly.Lua.addLoopTrap(e,l),o&&(a="not "+a),"while "+a+" do\n"+(e=Blockly.Lua.addContinueLabel_(e))+"end\n"},Blockly.Lua.controls_for=function(l){var o=Blockly.Lua.nameDB_.getName(l.getFieldValue("VAR"),Blockly.VARIABLE_CATEGORY_NAME),a=Blockly.Lua.valueToCode(l,"FROM",Blockly.Lua.ORDER_NONE)||"0",e=Blockly.Lua.valueToCode(l,"TO",Blockly.Lua.ORDER_NONE)||"0",u=Blockly.Lua.valueToCode(l,"BY",Blockly.Lua.ORDER_NONE)||"1",n=Blockly.Lua.statementToCode(l,"DO");n=Blockly.Lua.addLoopTrap(n,l),n=Blockly.Lua.addContinueLabel_(n);var c,t="";Blockly.isNumber(a)&&Blockly.isNumber(e)&&Blockly.isNumber(u)?c=(parseFloat(a)<=parseFloat(e)?"":"-")+Math.abs(parseFloat(u)):(t="",t+=(c=Blockly.Lua.nameDB_.getDistinctName(o+"_inc",Blockly.VARIABLE_CATEGORY_NAME))+" = ",Blockly.isNumber(u)?t+=Math.abs(u)+"\n":t+="math.abs("+u+")\n",t+="if ("+a+") > ("+e+") then\n",t+=Blockly.Lua.INDENT+c+" = -"+c+"\n",t+="end\n");return t+="for "+o+" = "+a+", "+e+", "+c,t+=" do\n"+n+"end\n"},Blockly.Lua.controls_forEach=function(l){var o=Blockly.Lua.nameDB_.getName(l.getFieldValue("VAR"),Blockly.VARIABLE_CATEGORY_NAME),a=Blockly.Lua.valueToCode(l,"LIST",Blockly.Lua.ORDER_NONE)||"{}",e=Blockly.Lua.statementToCode(l,"DO");return e=Blockly.Lua.addLoopTrap(e,l),"for _, "+o+" in ipairs("+a+") do \n"+(e=Blockly.Lua.addContinueLabel_(e))+"end\n"},Blockly.Lua.controls_flow_statements=function(l){var o="";if(Blockly.Lua.STATEMENT_PREFIX&&(o+=Blockly.Lua.injectId(Blockly.Lua.STATEMENT_PREFIX,l)),Blockly.Lua.STATEMENT_SUFFIX&&(o+=Blockly.Lua.injectId(Blockly.Lua.STATEMENT_SUFFIX,l)),Blockly.Lua.STATEMENT_PREFIX){var a=Blockly.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(l);a&&!a.suppressPrefixSuffix&&(o+=Blockly.Lua.injectId(Blockly.Lua.STATEMENT_PREFIX,a))}switch(l.getFieldValue("FLOW")){case"BREAK":return o+"break\n";case"CONTINUE":return o+Blockly.Lua.CONTINUE_STATEMENT}throw Error("Unknown flow statement.")};