/**
 * @license
 * Copyright 2016 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Lua.lists"),goog.require("Blockly.Lua"),Blockly.Lua.lists_create_empty=function(l){return["{}",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.lists_create_with=function(l){for(var e=new Array(l.itemCount_),o=0;o<l.itemCount_;o++)e[o]=Blockly.Lua.valueToCode(l,"ADD"+o,Blockly.Lua.ORDER_NONE)||"None";return["{"+e.join(", ")+"}",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.lists_repeat=function(l){return[Blockly.Lua.provideFunction_("create_list_repeated",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(item, count)","  local t = {}","  for i = 1, count do","    table.insert(t, item)","  end","  return t","end"])+"("+(Blockly.Lua.valueToCode(l,"ITEM",Blockly.Lua.ORDER_NONE)||"None")+", "+(Blockly.Lua.valueToCode(l,"NUM",Blockly.Lua.ORDER_NONE)||"0")+")",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.lists_length=function(l){return["#"+(Blockly.Lua.valueToCode(l,"VALUE",Blockly.Lua.ORDER_UNARY)||"{}"),Blockly.Lua.ORDER_UNARY]},Blockly.Lua.lists_isEmpty=function(l){return["#"+(Blockly.Lua.valueToCode(l,"VALUE",Blockly.Lua.ORDER_UNARY)||"{}")+" == 0",Blockly.Lua.ORDER_RELATIONAL]},Blockly.Lua.lists_indexOf=function(l){var e=Blockly.Lua.valueToCode(l,"FIND",Blockly.Lua.ORDER_NONE)||"''",o=Blockly.Lua.valueToCode(l,"VALUE",Blockly.Lua.ORDER_NONE)||"{}";if("FIRST"==l.getFieldValue("END"))var t=Blockly.Lua.provideFunction_("first_index",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t, elem)","  for k, v in ipairs(t) do","    if v == elem then","      return k","    end","  end","  return 0","end"]);else t=Blockly.Lua.provideFunction_("last_index",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t, elem)","  for i = #t, 1, -1 do","    if t[i] == elem then","      return i","    end","  end","  return 0","end"]);return[t+"("+o+", "+e+")",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.lists.getIndex_=function(l,e,o){return"FIRST"==e?"1":"FROM_END"==e?"#"+l+" + 1 - "+o:"LAST"==e?"#"+l:"RANDOM"==e?"math.random(#"+l+")":o},Blockly.Lua.lists_getIndex=function(l){var e=l.getFieldValue("MODE")||"GET",o=l.getFieldValue("WHERE")||"FROM_START",t=Blockly.Lua.valueToCode(l,"VALUE",Blockly.Lua.ORDER_HIGH)||"({})",u=Blockly.Lua.lists.getIndex_;if("LAST"!=o&&"FROM_END"!=o&&"RANDOM"!=o||t.match(/^\w+$/)){a="GET"==e&&"FROM_END"==o?Blockly.Lua.ORDER_ADDITIVE:Blockly.Lua.ORDER_NONE;if(n=u(t,o,n=Blockly.Lua.valueToCode(l,"AT",a)||"1"),"GET"==e)return[i=t+"["+n+"]",Blockly.Lua.ORDER_HIGH];i="table.remove("+t+", "+n+")";return"GET_REMOVE"==e?[i,Blockly.Lua.ORDER_HIGH]:i+"\n"}if("REMOVE"==e){var a="FROM_END"==o?Blockly.Lua.ORDER_ADDITIVE:Blockly.Lua.ORDER_NONE,n=Blockly.Lua.valueToCode(l,"AT",a)||"1",r=Blockly.Lua.nameDB_.getDistinctName("tmp_list",Blockly.VARIABLE_CATEGORY_NAME);return i=r+" = "+t+"\ntable.remove("+r+", "+(n=u(r,o,n))+")\n"}var i,n=Blockly.Lua.valueToCode(l,"AT",Blockly.Lua.ORDER_NONE)||"1";if("GET"==e)var c=Blockly.Lua.provideFunction_("list_get_"+o.toLowerCase(),["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t"+("FROM_END"==o||"FROM_START"==o?", at)":")"),"  return t["+u("t",o,"at")+"]","end"]);else c=Blockly.Lua.provideFunction_("list_remove_"+o.toLowerCase(),["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t"+("FROM_END"==o||"FROM_START"==o?", at)":")"),"  return table.remove(t, "+u("t",o,"at")+")","end"]);return[i=c+"("+t+("FROM_END"==o||"FROM_START"==o?", "+n:"")+")",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.lists_setIndex=function(l){var e=Blockly.Lua.valueToCode(l,"LIST",Blockly.Lua.ORDER_HIGH)||"{}",o=l.getFieldValue("MODE")||"SET",t=l.getFieldValue("WHERE")||"FROM_START",u=Blockly.Lua.valueToCode(l,"AT",Blockly.Lua.ORDER_ADDITIVE)||"1",a=Blockly.Lua.valueToCode(l,"TO",Blockly.Lua.ORDER_NONE)||"None",n=Blockly.Lua.lists.getIndex_,r="";if(("LAST"==t||"FROM_END"==t||"RANDOM"==t)&&!e.match(/^\w+$/)){var i=Blockly.Lua.nameDB_.getDistinctName("tmp_list",Blockly.VARIABLE_CATEGORY_NAME);r=i+" = "+e+"\n",e=i}return(r+="SET"==o?e+"["+n(e,t,u)+"] = "+a:"table.insert("+e+", "+n(e,t,u)+("LAST"==t?" + 1":"")+", "+a+")")+"\n"},Blockly.Lua.lists_getSublist=function(l){var e=Blockly.Lua.valueToCode(l,"LIST",Blockly.Lua.ORDER_NONE)||"{}",o=l.getFieldValue("WHERE1"),t=l.getFieldValue("WHERE2"),u=Blockly.Lua.valueToCode(l,"AT1",Blockly.Lua.ORDER_NONE)||"1",a=Blockly.Lua.valueToCode(l,"AT2",Blockly.Lua.ORDER_NONE)||"1",n=Blockly.Lua.lists.getIndex_;return[Blockly.Lua.provideFunction_("list_sublist_"+o.toLowerCase()+"_"+t.toLowerCase(),["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(source"+("FROM_END"==o||"FROM_START"==o?", at1":"")+("FROM_END"==t||"FROM_START"==t?", at2":"")+")","  local t = {}","  local start = "+n("source",o,"at1"),"  local finish = "+n("source",t,"at2"),"  for i = start, finish do","    table.insert(t, source[i])","  end","  return t","end"])+"("+e+("FROM_END"==o||"FROM_START"==o?", "+u:"")+("FROM_END"==t||"FROM_START"==t?", "+a:"")+")",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.lists_sort=function(l){var e=Blockly.Lua.valueToCode(l,"LIST",Blockly.Lua.ORDER_NONE)||"{}",o="1"===l.getFieldValue("DIRECTION")?1:-1,t=l.getFieldValue("TYPE");return[Blockly.Lua.provideFunction_("list_sort",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(list, typev, direction)","  local t = {}","  for n,v in pairs(list) do table.insert(t, v) end","  local compareFuncs = {","    NUMERIC = function(a, b)","      return (tonumber(tostring(a)) or 0)","          < (tonumber(tostring(b)) or 0) end,","    TEXT = function(a, b)","      return tostring(a) < tostring(b) end,","    IGNORE_CASE = function(a, b)","      return string.lower(tostring(a)) < string.lower(tostring(b)) end","  }","  local compareTemp = compareFuncs[typev]","  local compare = compareTemp","  if direction == -1","  then compare = function(a, b) return compareTemp(b, a) end","  end","  table.sort(t, compare)","  return t","end"])+"("+e+',"'+t+'", '+o+")",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.lists_split=function(l){var e,o=Blockly.Lua.valueToCode(l,"INPUT",Blockly.Lua.ORDER_NONE),t=Blockly.Lua.valueToCode(l,"DELIM",Blockly.Lua.ORDER_NONE)||"''",u=l.getFieldValue("MODE");if("SPLIT"==u)o||(o="''"),e=Blockly.Lua.provideFunction_("list_string_split",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(input, delim)","  local t = {}","  local pos = 1","  while true do","    next_delim = string.find(input, delim, pos)","    if next_delim == nil then","      table.insert(t, string.sub(input, pos))","      break","    else","      table.insert(t, string.sub(input, pos, next_delim-1))","      pos = next_delim + #delim","    end","  end","  return t","end"]);else{if("JOIN"!=u)throw Error("Unknown mode: "+u);o||(o="{}"),e="table.concat"}return[e+"("+o+", "+t+")",Blockly.Lua.ORDER_HIGH]},Blockly.Lua.lists_reverse=function(l){var e=Blockly.Lua.valueToCode(l,"LIST",Blockly.Lua.ORDER_NONE)||"{}";return[Blockly.Lua.provideFunction_("list_reverse",["function "+Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_+"(input)","  local reversed = {}","  for i = #input, 1, -1 do","    table.insert(reversed, input[i])","  end","  return reversed","end"])+"("+e+")",Blockly.Lua.ORDER_HIGH]};