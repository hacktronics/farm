/**
 * @license
 * Copyright 2012 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.JavaScript.math"),goog.require("Blockly.JavaScript"),Blockly.JavaScript.math_number=function(a){var t=parseFloat(a.getFieldValue("NUM"));return[t,t>=0?Blockly.JavaScript.ORDER_ATOMIC:Blockly.JavaScript.ORDER_UNARY_NEGATION]},Blockly.JavaScript.math_arithmetic=function(a){var t={ADD:[" + ",Blockly.JavaScript.ORDER_ADDITION],MINUS:[" - ",Blockly.JavaScript.ORDER_SUBTRACTION],MULTIPLY:[" * ",Blockly.JavaScript.ORDER_MULTIPLICATION],DIVIDE:[" / ",Blockly.JavaScript.ORDER_DIVISION],POWER:[null,Blockly.JavaScript.ORDER_NONE]}[a.getFieldValue("OP")],l=t[0],c=t[1],r=Blockly.JavaScript.valueToCode(a,"A",c)||"0",o=Blockly.JavaScript.valueToCode(a,"B",c)||"0";return l?[r+l+o,c]:["Math.pow("+r+", "+o+")",Blockly.JavaScript.ORDER_FUNCTION_CALL]},Blockly.JavaScript.math_single=function(a){var t,l,c=a.getFieldValue("OP");if("NEG"==c)return"-"==(l=Blockly.JavaScript.valueToCode(a,"NUM",Blockly.JavaScript.ORDER_UNARY_NEGATION)||"0")[0]&&(l=" "+l),[t="-"+l,Blockly.JavaScript.ORDER_UNARY_NEGATION];switch(l="SIN"==c||"COS"==c||"TAN"==c?Blockly.JavaScript.valueToCode(a,"NUM",Blockly.JavaScript.ORDER_DIVISION)||"0":Blockly.JavaScript.valueToCode(a,"NUM",Blockly.JavaScript.ORDER_NONE)||"0",c){case"ABS":t="Math.abs("+l+")";break;case"ROOT":t="Math.sqrt("+l+")";break;case"LN":t="Math.log("+l+")";break;case"EXP":t="Math.exp("+l+")";break;case"POW10":t="Math.pow(10,"+l+")";break;case"ROUND":t="Math.round("+l+")";break;case"ROUNDUP":t="Math.ceil("+l+")";break;case"ROUNDDOWN":t="Math.floor("+l+")";break;case"SIN":t="Math.sin("+l+" / 180 * Math.PI)";break;case"COS":t="Math.cos("+l+" / 180 * Math.PI)";break;case"TAN":t="Math.tan("+l+" / 180 * Math.PI)"}if(t)return[t,Blockly.JavaScript.ORDER_FUNCTION_CALL];switch(c){case"LOG10":t="Math.log("+l+") / Math.log(10)";break;case"ASIN":t="Math.asin("+l+") / Math.PI * 180";break;case"ACOS":t="Math.acos("+l+") / Math.PI * 180";break;case"ATAN":t="Math.atan("+l+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+c)}return[t,Blockly.JavaScript.ORDER_DIVISION]},Blockly.JavaScript.math_constant=function(a){return{PI:["Math.PI",Blockly.JavaScript.ORDER_MEMBER],E:["Math.E",Blockly.JavaScript.ORDER_MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",Blockly.JavaScript.ORDER_DIVISION],SQRT2:["Math.SQRT2",Blockly.JavaScript.ORDER_MEMBER],SQRT1_2:["Math.SQRT1_2",Blockly.JavaScript.ORDER_MEMBER],INFINITY:["Infinity",Blockly.JavaScript.ORDER_ATOMIC]}[a.getFieldValue("CONSTANT")]},Blockly.JavaScript.math_number_property=function(a){var t,l=Blockly.JavaScript.valueToCode(a,"NUMBER_TO_CHECK",Blockly.JavaScript.ORDER_MODULUS)||"0",c=a.getFieldValue("PROPERTY");if("PRIME"==c)return[t=Blockly.JavaScript.provideFunction_("mathIsPrime",["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(n) {","  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if (n == 2 || n == 3) {","    return true;","  }","  // False if n is NaN, negative, is 1, or not whole.","  // And false if n is divisible by 2 or 3.","  if (isNaN(n) || n <= 1 || n % 1 != 0 || n % 2 == 0 || n % 3 == 0) {","    return false;","  }","  // Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {","    if (n % (x - 1) == 0 || n % (x + 1) == 0) {","      return false;","    }","  }","  return true;","}"])+"("+l+")",Blockly.JavaScript.ORDER_FUNCTION_CALL];switch(c){case"EVEN":t=l+" % 2 == 0";break;case"ODD":t=l+" % 2 == 1";break;case"WHOLE":t=l+" % 1 == 0";break;case"POSITIVE":t=l+" > 0";break;case"NEGATIVE":t=l+" < 0";break;case"DIVISIBLE_BY":t=l+" % "+(Blockly.JavaScript.valueToCode(a,"DIVISOR",Blockly.JavaScript.ORDER_MODULUS)||"0")+" == 0"}return[t,Blockly.JavaScript.ORDER_EQUALITY]},Blockly.JavaScript.math_change=function(a){var t=Blockly.JavaScript.valueToCode(a,"DELTA",Blockly.JavaScript.ORDER_ADDITION)||"0",l=Blockly.JavaScript.nameDB_.getName(a.getFieldValue("VAR"),Blockly.VARIABLE_CATEGORY_NAME);return l+" = (typeof "+l+" == 'number' ? "+l+" : 0) + "+t+";\n"},Blockly.JavaScript.math_round=Blockly.JavaScript.math_single,Blockly.JavaScript.math_trig=Blockly.JavaScript.math_single,Blockly.JavaScript.math_on_list=function(a){var t,l=a.getFieldValue("OP");switch(l){case"SUM":t=(Blockly.JavaScript.valueToCode(a,"LIST",Blockly.JavaScript.ORDER_MEMBER)||"[]")+".reduce(function(x, y) {return x + y;})";break;case"MIN":t="Math.min.apply(null, "+(Blockly.JavaScript.valueToCode(a,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]")+")";break;case"MAX":t="Math.max.apply(null, "+(Blockly.JavaScript.valueToCode(a,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]")+")";break;case"AVERAGE":t=Blockly.JavaScript.provideFunction_("mathMean",["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(myList) {","  return myList.reduce(function(x, y) {return x + y;}) / myList.length;","}"])+"("+(Blockly.JavaScript.valueToCode(a,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]")+")";break;case"MEDIAN":t=Blockly.JavaScript.provideFunction_("mathMedian",["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(myList) {","  var localList = myList.filter(function (x) {return typeof x == 'number';});","  if (!localList.length) return null;","  localList.sort(function(a, b) {return b - a;});","  if (localList.length % 2 == 0) {","    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;","  } else {","    return localList[(localList.length - 1) / 2];","  }","}"])+"("+(Blockly.JavaScript.valueToCode(a,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]")+")";break;case"MODE":t=Blockly.JavaScript.provideFunction_("mathModes",["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(values) {","  var modes = [];","  var counts = [];","  var maxCount = 0;","  for (var i = 0; i < values.length; i++) {","    var value = values[i];","    var found = false;","    var thisCount;","    for (var j = 0; j < counts.length; j++) {","      if (counts[j][0] === value) {","        thisCount = ++counts[j][1];","        found = true;","        break;","      }","    }","    if (!found) {","      counts.push([value, 1]);","      thisCount = 1;","    }","    maxCount = Math.max(thisCount, maxCount);","  }","  for (var j = 0; j < counts.length; j++) {","    if (counts[j][1] == maxCount) {","        modes.push(counts[j][0]);","    }","  }","  return modes;","}"])+"("+(Blockly.JavaScript.valueToCode(a,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]")+")";break;case"STD_DEV":t=Blockly.JavaScript.provideFunction_("mathStandardDeviation",["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(numbers) {","  var n = numbers.length;","  if (!n) return null;","  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;","  var variance = 0;","  for (var j = 0; j < n; j++) {","    variance += Math.pow(numbers[j] - mean, 2);","  }","  variance = variance / n;","  return Math.sqrt(variance);","}"])+"("+(Blockly.JavaScript.valueToCode(a,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]")+")";break;case"RANDOM":t=Blockly.JavaScript.provideFunction_("mathRandomList",["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(list) {","  var x = Math.floor(Math.random() * list.length);","  return list[x];","}"])+"("+(Blockly.JavaScript.valueToCode(a,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]")+")";break;default:throw Error("Unknown operator: "+l)}return[t,Blockly.JavaScript.ORDER_FUNCTION_CALL]},Blockly.JavaScript.math_modulo=function(a){return[(Blockly.JavaScript.valueToCode(a,"DIVIDEND",Blockly.JavaScript.ORDER_MODULUS)||"0")+" % "+(Blockly.JavaScript.valueToCode(a,"DIVISOR",Blockly.JavaScript.ORDER_MODULUS)||"0"),Blockly.JavaScript.ORDER_MODULUS]},Blockly.JavaScript.math_constrain=function(a){return["Math.min(Math.max("+(Blockly.JavaScript.valueToCode(a,"VALUE",Blockly.JavaScript.ORDER_NONE)||"0")+", "+(Blockly.JavaScript.valueToCode(a,"LOW",Blockly.JavaScript.ORDER_NONE)||"0")+"), "+(Blockly.JavaScript.valueToCode(a,"HIGH",Blockly.JavaScript.ORDER_NONE)||"Infinity")+")",Blockly.JavaScript.ORDER_FUNCTION_CALL]},Blockly.JavaScript.math_random_int=function(a){var t=Blockly.JavaScript.valueToCode(a,"FROM",Blockly.JavaScript.ORDER_NONE)||"0",l=Blockly.JavaScript.valueToCode(a,"TO",Blockly.JavaScript.ORDER_NONE)||"0";return[Blockly.JavaScript.provideFunction_("mathRandomInt",["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(a, b) {","  if (a > b) {","    // Swap a and b to ensure a is smaller.","    var c = a;","    a = b;","    b = c;","  }","  return Math.floor(Math.random() * (b - a + 1) + a);","}"])+"("+t+", "+l+")",Blockly.JavaScript.ORDER_FUNCTION_CALL]},Blockly.JavaScript.math_random_float=function(a){return["Math.random()",Blockly.JavaScript.ORDER_FUNCTION_CALL]},Blockly.JavaScript.math_atan2=function(a){var t=Blockly.JavaScript.valueToCode(a,"X",Blockly.JavaScript.ORDER_NONE)||"0";return["Math.atan2("+(Blockly.JavaScript.valueToCode(a,"Y",Blockly.JavaScript.ORDER_NONE)||"0")+", "+t+") / Math.PI * 180",Blockly.JavaScript.ORDER_DIVISION]};