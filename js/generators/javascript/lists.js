/**
 * @license
 * Copyright 2012 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.JavaScript.lists"),goog.require("Blockly.JavaScript"),Blockly.JavaScript.lists_create_empty=function(t){return["[]",Blockly.JavaScript.ORDER_ATOMIC]},Blockly.JavaScript.lists_create_with=function(t){for(var a=new Array(t.itemCount_),l=0;l<t.itemCount_;l++)a[l]=Blockly.JavaScript.valueToCode(t,"ADD"+l,Blockly.JavaScript.ORDER_NONE)||"null";return["["+a.join(", ")+"]",Blockly.JavaScript.ORDER_ATOMIC]},Blockly.JavaScript.lists_repeat=function(t){return[Blockly.JavaScript.provideFunction_("listsRepeat",["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(value, n) {","  var array = [];","  for (var i = 0; i < n; i++) {","    array[i] = value;","  }","  return array;","}"])+"("+(Blockly.JavaScript.valueToCode(t,"ITEM",Blockly.JavaScript.ORDER_NONE)||"null")+", "+(Blockly.JavaScript.valueToCode(t,"NUM",Blockly.JavaScript.ORDER_NONE)||"0")+")",Blockly.JavaScript.ORDER_FUNCTION_CALL]},Blockly.JavaScript.lists_length=function(t){return[(Blockly.JavaScript.valueToCode(t,"VALUE",Blockly.JavaScript.ORDER_MEMBER)||"[]")+".length",Blockly.JavaScript.ORDER_MEMBER]},Blockly.JavaScript.lists_isEmpty=function(t){return["!"+(Blockly.JavaScript.valueToCode(t,"VALUE",Blockly.JavaScript.ORDER_MEMBER)||"[]")+".length",Blockly.JavaScript.ORDER_LOGICAL_NOT]},Blockly.JavaScript.lists_indexOf=function(t){var a="FIRST"==t.getFieldValue("END")?"indexOf":"lastIndexOf",l=Blockly.JavaScript.valueToCode(t,"FIND",Blockly.JavaScript.ORDER_NONE)||"''",r=(Blockly.JavaScript.valueToCode(t,"VALUE",Blockly.JavaScript.ORDER_MEMBER)||"[]")+"."+a+"("+l+")";return t.workspace.options.oneBasedIndex?[r+" + 1",Blockly.JavaScript.ORDER_ADDITION]:[r,Blockly.JavaScript.ORDER_FUNCTION_CALL]},Blockly.JavaScript.lists_getIndex=function(t){var a=t.getFieldValue("MODE")||"GET",l=t.getFieldValue("WHERE")||"FROM_START",r="RANDOM"==l?Blockly.JavaScript.ORDER_NONE:Blockly.JavaScript.ORDER_MEMBER,e=Blockly.JavaScript.valueToCode(t,"VALUE",r)||"[]";switch(l){case"FIRST":if("GET"==a)return[i=e+"[0]",Blockly.JavaScript.ORDER_MEMBER];if("GET_REMOVE"==a)return[i=e+".shift()",Blockly.JavaScript.ORDER_MEMBER];if("REMOVE"==a)return e+".shift();\n";break;case"LAST":if("GET"==a)return[i=e+".slice(-1)[0]",Blockly.JavaScript.ORDER_MEMBER];if("GET_REMOVE"==a)return[i=e+".pop()",Blockly.JavaScript.ORDER_MEMBER];if("REMOVE"==a)return e+".pop();\n";break;case"FROM_START":var c=Blockly.JavaScript.getAdjusted(t,"AT");if("GET"==a)return[i=e+"["+c+"]",Blockly.JavaScript.ORDER_MEMBER];if("GET_REMOVE"==a)return[i=e+".splice("+c+", 1)[0]",Blockly.JavaScript.ORDER_FUNCTION_CALL];if("REMOVE"==a)return e+".splice("+c+", 1);\n";break;case"FROM_END":var i;c=Blockly.JavaScript.getAdjusted(t,"AT",1,!0);if("GET"==a)return[i=e+".slice("+c+")[0]",Blockly.JavaScript.ORDER_FUNCTION_CALL];if("GET_REMOVE"==a)return[i=e+".splice("+c+", 1)[0]",Blockly.JavaScript.ORDER_FUNCTION_CALL];if("REMOVE"==a)return e+".splice("+c+", 1);";break;case"RANDOM":if(i=Blockly.JavaScript.provideFunction_("listsGetRandomItem",["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(list, remove) {","  var x = Math.floor(Math.random() * list.length);","  if (remove) {","    return list.splice(x, 1)[0];","  } else {","    return list[x];","  }","}"])+"("+e+", "+("GET"!=a)+")","GET"==a||"GET_REMOVE"==a)return[i,Blockly.JavaScript.ORDER_FUNCTION_CALL];if("REMOVE"==a)return i+";\n"}throw Error("Unhandled combination (lists_getIndex).")},Blockly.JavaScript.lists_setIndex=function(t){var a=Blockly.JavaScript.valueToCode(t,"LIST",Blockly.JavaScript.ORDER_MEMBER)||"[]",l=t.getFieldValue("MODE")||"GET",r=t.getFieldValue("WHERE")||"FROM_START",e=Blockly.JavaScript.valueToCode(t,"TO",Blockly.JavaScript.ORDER_ASSIGNMENT)||"null";function c(){if(a.match(/^\w+$/))return"";var t=Blockly.JavaScript.nameDB_.getDistinctName("tmpList",Blockly.VARIABLE_CATEGORY_NAME),l="var "+t+" = "+a+";\n";return a=t,l}switch(r){case"FIRST":if("SET"==l)return a+"[0] = "+e+";\n";if("INSERT"==l)return a+".unshift("+e+");\n";break;case"LAST":if("SET"==l){var i=c();return i+=a+"["+a+".length - 1] = "+e+";\n"}if("INSERT"==l)return a+".push("+e+");\n";break;case"FROM_START":var o=Blockly.JavaScript.getAdjusted(t,"AT");if("SET"==l)return a+"["+o+"] = "+e+";\n";if("INSERT"==l)return a+".splice("+o+", 0, "+e+");\n";break;case"FROM_END":o=Blockly.JavaScript.getAdjusted(t,"AT",1,!1,Blockly.JavaScript.ORDER_SUBTRACTION),i=c();if("SET"==l)return i+=a+"["+a+".length - "+o+"] = "+e+";\n";if("INSERT"==l)return i+=a+".splice("+a+".length - "+o+", 0, "+e+");\n";break;case"RANDOM":i=c();var n=Blockly.JavaScript.nameDB_.getDistinctName("tmpX",Blockly.VARIABLE_CATEGORY_NAME);if(i+="var "+n+" = Math.floor(Math.random() * "+a+".length);\n","SET"==l)return i+=a+"["+n+"] = "+e+";\n";if("INSERT"==l)return i+=a+".splice("+n+", 0, "+e+");\n"}throw Error("Unhandled combination (lists_setIndex).")},Blockly.JavaScript.lists.getIndex_=function(t,a,l){return"FIRST"==a?"0":"FROM_END"==a?t+".length - 1 - "+l:"LAST"==a?t+".length - 1":l},Blockly.JavaScript.lists_getSublist=function(t){var a=Blockly.JavaScript.valueToCode(t,"LIST",Blockly.JavaScript.ORDER_MEMBER)||"[]",l=t.getFieldValue("WHERE1"),r=t.getFieldValue("WHERE2");if("FIRST"==l&&"LAST"==r)var e=a+".slice(0)";else if(a.match(/^\w+$/)||"FROM_END"!=l&&"FROM_START"==r){switch(l){case"FROM_START":var c=Blockly.JavaScript.getAdjusted(t,"AT1");break;case"FROM_END":c=a+".length - "+(c=Blockly.JavaScript.getAdjusted(t,"AT1",1,!1,Blockly.JavaScript.ORDER_SUBTRACTION));break;case"FIRST":c="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(r){case"FROM_START":var i=Blockly.JavaScript.getAdjusted(t,"AT2",1);break;case"FROM_END":i=a+".length - "+(i=Blockly.JavaScript.getAdjusted(t,"AT2",0,!1,Blockly.JavaScript.ORDER_SUBTRACTION));break;case"LAST":i=a+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}e=a+".slice("+c+", "+i+")"}else{c=Blockly.JavaScript.getAdjusted(t,"AT1"),i=Blockly.JavaScript.getAdjusted(t,"AT2");var o=Blockly.JavaScript.lists.getIndex_,n={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};e=Blockly.JavaScript.provideFunction_("subsequence"+n[l]+n[r],["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(sequence"+("FROM_END"==l||"FROM_START"==l?", at1":"")+("FROM_END"==r||"FROM_START"==r?", at2":"")+") {","  var start = "+o("sequence",l,"at1")+";","  var end = "+o("sequence",r,"at2")+" + 1;","  return sequence.slice(start, end);","}"])+"("+a+("FROM_END"==l||"FROM_START"==l?", "+c:"")+("FROM_END"==r||"FROM_START"==r?", "+i:"")+")"}return[e,Blockly.JavaScript.ORDER_FUNCTION_CALL]},Blockly.JavaScript.lists_sort=function(t){var a=Blockly.JavaScript.valueToCode(t,"LIST",Blockly.JavaScript.ORDER_FUNCTION_CALL)||"[]",l="1"===t.getFieldValue("DIRECTION")?1:-1,r=t.getFieldValue("TYPE");return[a+".slice().sort("+Blockly.JavaScript.provideFunction_("listsGetSortCompare",["function "+Blockly.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(type, direction) {","  var compareFuncs = {",'    "NUMERIC": function(a, b) {',"        return Number(a) - Number(b); },",'    "TEXT": function(a, b) {',"        return a.toString() > b.toString() ? 1 : -1; },",'    "IGNORE_CASE": function(a, b) {',"        return a.toString().toLowerCase() > b.toString().toLowerCase() ? 1 : -1; },","  };","  var compare = compareFuncs[type];","  return function(a, b) { return compare(a, b) * direction; }","}"])+'("'+r+'", '+l+"))",Blockly.JavaScript.ORDER_FUNCTION_CALL]},Blockly.JavaScript.lists_split=function(t){var a=Blockly.JavaScript.valueToCode(t,"INPUT",Blockly.JavaScript.ORDER_MEMBER),l=Blockly.JavaScript.valueToCode(t,"DELIM",Blockly.JavaScript.ORDER_NONE)||"''",r=t.getFieldValue("MODE");if("SPLIT"==r){a||(a="''");var e="split"}else{if("JOIN"!=r)throw Error("Unknown mode: "+r);a||(a="[]");e="join"}return[a+"."+e+"("+l+")",Blockly.JavaScript.ORDER_FUNCTION_CALL]},Blockly.JavaScript.lists_reverse=function(t){return[(Blockly.JavaScript.valueToCode(t,"LIST",Blockly.JavaScript.ORDER_FUNCTION_CALL)||"[]")+".slice().reverse()",Blockly.JavaScript.ORDER_FUNCTION_CALL]};