/**
 * @license
 * Copyright 2012 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Python.math"),goog.require("Blockly.Python"),Blockly.Python.addReservedWords("math,random,Number"),Blockly.Python.math_number=function(o){var t,n=parseFloat(o.getFieldValue("NUM"));return n==1/0?(n='float("inf")',t=Blockly.Python.ORDER_FUNCTION_CALL):n==-1/0?(n='-float("inf")',t=Blockly.Python.ORDER_UNARY_SIGN):t=n<0?Blockly.Python.ORDER_UNARY_SIGN:Blockly.Python.ORDER_ATOMIC,[n,t]},Blockly.Python.math_arithmetic=function(o){var t={ADD:[" + ",Blockly.Python.ORDER_ADDITIVE],MINUS:[" - ",Blockly.Python.ORDER_ADDITIVE],MULTIPLY:[" * ",Blockly.Python.ORDER_MULTIPLICATIVE],DIVIDE:[" / ",Blockly.Python.ORDER_MULTIPLICATIVE],POWER:[" ** ",Blockly.Python.ORDER_EXPONENTIATION]}[o.getFieldValue("OP")],n=t[0],l=t[1];return[(Blockly.Python.valueToCode(o,"A",l)||"0")+n+(Blockly.Python.valueToCode(o,"B",l)||"0"),l]},Blockly.Python.math_single=function(o){var t,n,l=o.getFieldValue("OP");if("NEG"==l)return["-"+(n=Blockly.Python.valueToCode(o,"NUM",Blockly.Python.ORDER_UNARY_SIGN)||"0"),Blockly.Python.ORDER_UNARY_SIGN];switch(Blockly.Python.definitions_.import_math="import math",t="SIN"==l||"COS"==l||"TAN"==l?Blockly.Python.valueToCode(o,"NUM",Blockly.Python.ORDER_MULTIPLICATIVE)||"0":Blockly.Python.valueToCode(o,"NUM",Blockly.Python.ORDER_NONE)||"0",l){case"ABS":n="math.fabs("+t+")";break;case"ROOT":n="math.sqrt("+t+")";break;case"LN":n="math.log("+t+")";break;case"LOG10":n="math.log10("+t+")";break;case"EXP":n="math.exp("+t+")";break;case"POW10":n="math.pow(10,"+t+")";break;case"ROUND":n="round("+t+")";break;case"ROUNDUP":n="math.ceil("+t+")";break;case"ROUNDDOWN":n="math.floor("+t+")";break;case"SIN":n="math.sin("+t+" / 180.0 * math.pi)";break;case"COS":n="math.cos("+t+" / 180.0 * math.pi)";break;case"TAN":n="math.tan("+t+" / 180.0 * math.pi)"}if(n)return[n,Blockly.Python.ORDER_FUNCTION_CALL];switch(l){case"ASIN":n="math.asin("+t+") / math.pi * 180";break;case"ACOS":n="math.acos("+t+") / math.pi * 180";break;case"ATAN":n="math.atan("+t+") / math.pi * 180";break;default:throw Error("Unknown math operator: "+l)}return[n,Blockly.Python.ORDER_MULTIPLICATIVE]},Blockly.Python.math_constant=function(o){var t={PI:["math.pi",Blockly.Python.ORDER_MEMBER],E:["math.e",Blockly.Python.ORDER_MEMBER],GOLDEN_RATIO:["(1 + math.sqrt(5)) / 2",Blockly.Python.ORDER_MULTIPLICATIVE],SQRT2:["math.sqrt(2)",Blockly.Python.ORDER_MEMBER],SQRT1_2:["math.sqrt(1.0 / 2)",Blockly.Python.ORDER_MEMBER],INFINITY:["float('inf')",Blockly.Python.ORDER_ATOMIC]},n=o.getFieldValue("CONSTANT");return"INFINITY"!=n&&(Blockly.Python.definitions_.import_math="import math"),t[n]},Blockly.Python.math_number_property=function(o){var t,n=Blockly.Python.valueToCode(o,"NUMBER_TO_CHECK",Blockly.Python.ORDER_MULTIPLICATIVE)||"0",l=o.getFieldValue("PROPERTY");if("PRIME"==l)return Blockly.Python.definitions_.import_math="import math",Blockly.Python.definitions_.from_numbers_import_Number="from numbers import Number",[t=Blockly.Python.provideFunction_("math_isPrime",["def "+Blockly.Python.FUNCTION_NAME_PLACEHOLDER_+"(n):","  # https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  # If n is not a number but a string, try parsing it.","  if not isinstance(n, Number):","    try:","      n = float(n)","    except:","      return False","  if n == 2 or n == 3:","    return True","  # False if n is negative, is 1, or not whole, or if n is divisible by 2 or 3.","  if n <= 1 or n % 1 != 0 or n % 2 == 0 or n % 3 == 0:","    return False","  # Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for x in range(6, int(math.sqrt(n)) + 2, 6):","    if n % (x - 1) == 0 or n % (x + 1) == 0:","      return False","  return True"])+"("+n+")",Blockly.Python.ORDER_FUNCTION_CALL];switch(l){case"EVEN":t=n+" % 2 == 0";break;case"ODD":t=n+" % 2 == 1";break;case"WHOLE":t=n+" % 1 == 0";break;case"POSITIVE":t=n+" > 0";break;case"NEGATIVE":t=n+" < 0";break;case"DIVISIBLE_BY":var e=Blockly.Python.valueToCode(o,"DIVISOR",Blockly.Python.ORDER_MULTIPLICATIVE);if(!e||"0"==e)return["False",Blockly.Python.ORDER_ATOMIC];t=n+" % "+e+" == 0"}return[t,Blockly.Python.ORDER_RELATIONAL]},Blockly.Python.math_change=function(o){Blockly.Python.definitions_.from_numbers_import_Number="from numbers import Number";var t=Blockly.Python.valueToCode(o,"DELTA",Blockly.Python.ORDER_ADDITIVE)||"0",n=Blockly.Python.nameDB_.getName(o.getFieldValue("VAR"),Blockly.VARIABLE_CATEGORY_NAME);return n+" = ("+n+" if isinstance("+n+", Number) else 0) + "+t+"\n"},Blockly.Python.math_round=Blockly.Python.math_single,Blockly.Python.math_trig=Blockly.Python.math_single,Blockly.Python.math_on_list=function(o){var t,n=o.getFieldValue("OP"),l=Blockly.Python.valueToCode(o,"LIST",Blockly.Python.ORDER_NONE)||"[]";switch(n){case"SUM":t="sum("+l+")";break;case"MIN":t="min("+l+")";break;case"MAX":t="max("+l+")";break;case"AVERAGE":Blockly.Python.definitions_.from_numbers_import_Number="from numbers import Number",t=Blockly.Python.provideFunction_("math_mean",["def "+Blockly.Python.FUNCTION_NAME_PLACEHOLDER_+"(myList):","  localList = [e for e in myList if isinstance(e, Number)]","  if not localList: return","  return float(sum(localList)) / len(localList)"])+"("+l+")";break;case"MEDIAN":Blockly.Python.definitions_.from_numbers_import_Number="from numbers import Number",t=Blockly.Python.provideFunction_("math_median",["def "+Blockly.Python.FUNCTION_NAME_PLACEHOLDER_+"(myList):","  localList = sorted([e for e in myList if isinstance(e, Number)])","  if not localList: return","  if len(localList) % 2 == 0:","    return (localList[len(localList) // 2 - 1] + localList[len(localList) // 2]) / 2.0","  else:","    return localList[(len(localList) - 1) // 2]"])+"("+l+")";break;case"MODE":t=Blockly.Python.provideFunction_("math_modes",["def "+Blockly.Python.FUNCTION_NAME_PLACEHOLDER_+"(some_list):","  modes = []","  # Using a lists of [item, count] to keep count rather than dict",'  # to avoid "unhashable" errors when the counted item is itself a list or dict.',"  counts = []","  maxCount = 1","  for item in some_list:","    found = False","    for count in counts:","      if count[0] == item:","        count[1] += 1","        maxCount = max(maxCount, count[1])","        found = True","    if not found:","      counts.append([item, 1])","  for counted_item, item_count in counts:","    if item_count == maxCount:","      modes.append(counted_item)","  return modes"])+"("+l+")";break;case"STD_DEV":Blockly.Python.definitions_.import_math="import math",t=Blockly.Python.provideFunction_("math_standard_deviation",["def "+Blockly.Python.FUNCTION_NAME_PLACEHOLDER_+"(numbers):","  n = len(numbers)","  if n == 0: return","  mean = float(sum(numbers)) / n","  variance = sum((x - mean) ** 2 for x in numbers) / n","  return math.sqrt(variance)"])+"("+l+")";break;case"RANDOM":Blockly.Python.definitions_.import_random="import random",t="random.choice("+l+")";break;default:throw Error("Unknown operator: "+n)}return[t,Blockly.Python.ORDER_FUNCTION_CALL]},Blockly.Python.math_modulo=function(o){return[(Blockly.Python.valueToCode(o,"DIVIDEND",Blockly.Python.ORDER_MULTIPLICATIVE)||"0")+" % "+(Blockly.Python.valueToCode(o,"DIVISOR",Blockly.Python.ORDER_MULTIPLICATIVE)||"0"),Blockly.Python.ORDER_MULTIPLICATIVE]},Blockly.Python.math_constrain=function(o){return["min(max("+(Blockly.Python.valueToCode(o,"VALUE",Blockly.Python.ORDER_NONE)||"0")+", "+(Blockly.Python.valueToCode(o,"LOW",Blockly.Python.ORDER_NONE)||"0")+"), "+(Blockly.Python.valueToCode(o,"HIGH",Blockly.Python.ORDER_NONE)||"float('inf')")+")",Blockly.Python.ORDER_FUNCTION_CALL]},Blockly.Python.math_random_int=function(o){return Blockly.Python.definitions_.import_random="import random",["random.randint("+(Blockly.Python.valueToCode(o,"FROM",Blockly.Python.ORDER_NONE)||"0")+", "+(Blockly.Python.valueToCode(o,"TO",Blockly.Python.ORDER_NONE)||"0")+")",Blockly.Python.ORDER_FUNCTION_CALL]},Blockly.Python.math_random_float=function(o){return Blockly.Python.definitions_.import_random="import random",["random.random()",Blockly.Python.ORDER_FUNCTION_CALL]},Blockly.Python.math_atan2=function(o){Blockly.Python.definitions_.import_math="import math";var t=Blockly.Python.valueToCode(o,"X",Blockly.Python.ORDER_NONE)||"0";return["math.atan2("+(Blockly.Python.valueToCode(o,"Y",Blockly.Python.ORDER_NONE)||"0")+", "+t+") / math.pi * 180",Blockly.Python.ORDER_MULTIPLICATIVE]};