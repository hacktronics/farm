/**
 * @license
 * Copyright 2014 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";goog.provide("Blockly.Dart.texts"),goog.require("Blockly.Dart"),Blockly.Dart.addReservedWords("Html,Math"),Blockly.Dart.text=function(t){return[Blockly.Dart.quote_(t.getFieldValue("TEXT")),Blockly.Dart.ORDER_ATOMIC]},Blockly.Dart.text_multiline=function(t){var e=Blockly.Dart.multiline_quote_(t.getFieldValue("TEXT")),l=-1!=e.indexOf("+")?Blockly.Dart.ORDER_ADDITIVE:Blockly.Dart.ORDER_ATOMIC;return[e,l]},Blockly.Dart.text_join=function(t){switch(t.itemCount_){case 0:return["''",Blockly.Dart.ORDER_ATOMIC];case 1:return[(Blockly.Dart.valueToCode(t,"ADD0",Blockly.Dart.ORDER_UNARY_POSTFIX)||"''")+".toString()",Blockly.Dart.ORDER_UNARY_POSTFIX];default:for(var e=new Array(t.itemCount_),l=0;l<t.itemCount_;l++)e[l]=Blockly.Dart.valueToCode(t,"ADD"+l,Blockly.Dart.ORDER_NONE)||"''";return["["+e.join(",")+"].join()",Blockly.Dart.ORDER_UNARY_POSTFIX]}},Blockly.Dart.text_append=function(t){var e=Blockly.Dart.nameDB_.getName(t.getFieldValue("VAR"),Blockly.VARIABLE_CATEGORY_NAME);return e+" = ["+e+", "+(Blockly.Dart.valueToCode(t,"TEXT",Blockly.Dart.ORDER_NONE)||"''")+"].join();\n"},Blockly.Dart.text_length=function(t){return[(Blockly.Dart.valueToCode(t,"VALUE",Blockly.Dart.ORDER_UNARY_POSTFIX)||"''")+".length",Blockly.Dart.ORDER_UNARY_POSTFIX]},Blockly.Dart.text_isEmpty=function(t){return[(Blockly.Dart.valueToCode(t,"VALUE",Blockly.Dart.ORDER_UNARY_POSTFIX)||"''")+".isEmpty",Blockly.Dart.ORDER_UNARY_POSTFIX]},Blockly.Dart.text_indexOf=function(t){var e="FIRST"==t.getFieldValue("END")?"indexOf":"lastIndexOf",l=Blockly.Dart.valueToCode(t,"FIND",Blockly.Dart.ORDER_NONE)||"''",r=(Blockly.Dart.valueToCode(t,"VALUE",Blockly.Dart.ORDER_UNARY_POSTFIX)||"''")+"."+e+"("+l+")";return t.workspace.options.oneBasedIndex?[r+" + 1",Blockly.Dart.ORDER_ADDITIVE]:[r,Blockly.Dart.ORDER_UNARY_POSTFIX]},Blockly.Dart.text_charAt=function(t){var e=t.getFieldValue("WHERE")||"FROM_START",l="FIRST"==e||"FROM_START"==e?Blockly.Dart.ORDER_UNARY_POSTFIX:Blockly.Dart.ORDER_NONE,r=Blockly.Dart.valueToCode(t,"VALUE",l)||"''";switch(e){case"FIRST":return[r+"[0]",Blockly.Dart.ORDER_UNARY_POSTFIX];case"FROM_START":return[r+"["+(a=Blockly.Dart.getAdjusted(t,"AT"))+"]",Blockly.Dart.ORDER_UNARY_POSTFIX];case"LAST":a=1;case"FROM_END":var a=Blockly.Dart.getAdjusted(t,"AT",1);return[Blockly.Dart.provideFunction_("text_get_from_end",["String "+Blockly.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String text, num x) {","  return text[text.length - x];","}"])+"("+r+", "+a+")",Blockly.Dart.ORDER_UNARY_POSTFIX];case"RANDOM":return Blockly.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",[Blockly.Dart.provideFunction_("text_random_letter",["String "+Blockly.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String text) {","  int x = new Math.Random().nextInt(text.length);","  return text[x];","}"])+"("+r+")",Blockly.Dart.ORDER_UNARY_POSTFIX]}throw Error("Unhandled option (text_charAt).")},Blockly.Dart.text_getSubstring=function(t){var e=t.getFieldValue("WHERE1"),l=t.getFieldValue("WHERE2"),r="FROM_END"!=e&&"FROM_START"==l,a=r?Blockly.Dart.ORDER_UNARY_POSTFIX:Blockly.Dart.ORDER_NONE,o=Blockly.Dart.valueToCode(t,"STRING",a)||"''";if("FIRST"==e&&"LAST"==l)return[c=o,Blockly.Dart.ORDER_NONE];if(o.match(/^'?\w+'?$/)||r){switch(e){case"FROM_START":var n=Blockly.Dart.getAdjusted(t,"AT1");break;case"FROM_END":n=o+".length - "+(n=Blockly.Dart.getAdjusted(t,"AT1",1,!1,Blockly.Dart.ORDER_ADDITIVE));break;case"FIRST":n="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(l){case"FROM_START":var D=Blockly.Dart.getAdjusted(t,"AT2",1);break;case"FROM_END":D=o+".length - "+(D=Blockly.Dart.getAdjusted(t,"AT2",0,!1,Blockly.Dart.ORDER_ADDITIVE));break;case"LAST":break;default:throw Error("Unhandled option (text_getSubstring).")}if("LAST"==l)var c=o+".substring("+n+")";else c=o+".substring("+n+", "+D+")"}else n=Blockly.Dart.getAdjusted(t,"AT1"),D=Blockly.Dart.getAdjusted(t,"AT2"),c=Blockly.Dart.provideFunction_("text_get_substring",["String "+Blockly.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String text, String where1, num at1, String where2, num at2) {","  int getAt(String where, num at) {","    if (where == 'FROM_END') {","      at = text.length - 1 - at;","    } else if (where == 'FIRST') {","      at = 0;","    } else if (where == 'LAST') {","      at = text.length - 1;","    } else if (where != 'FROM_START') {","      throw 'Unhandled option (text_getSubstring).';","    }","    return at;","  }","  at1 = getAt(where1, at1);","  at2 = getAt(where2, at2) + 1;","  return text.substring(at1, at2);","}"])+"("+o+", '"+e+"', "+n+", '"+l+"', "+D+")";return[c,Blockly.Dart.ORDER_UNARY_POSTFIX]},Blockly.Dart.text_changeCase=function(t){var e={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[t.getFieldValue("CASE")],l=e?Blockly.Dart.ORDER_UNARY_POSTFIX:Blockly.Dart.ORDER_NONE,r=Blockly.Dart.valueToCode(t,"TEXT",l)||"''";if(e)var a=r+e;else a=Blockly.Dart.provideFunction_("text_toTitleCase",["String "+Blockly.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String str) {","  RegExp exp = new RegExp(r'\\b');","  List<String> list = str.split(exp);","  final title = new StringBuffer();","  for (String part in list) {","    if (part.length > 0) {","      title.write(part[0].toUpperCase());","      if (part.length > 0) {","        title.write(part.substring(1).toLowerCase());","      }","    }","  }","  return title.toString();","}"])+"("+r+")";return[a,Blockly.Dart.ORDER_UNARY_POSTFIX]},Blockly.Dart.text_trim=function(t){var e={LEFT:".replaceFirst(new RegExp(r'^\\s+'), '')",RIGHT:".replaceFirst(new RegExp(r'\\s+$'), '')",BOTH:".trim()"}[t.getFieldValue("MODE")];return[(Blockly.Dart.valueToCode(t,"TEXT",Blockly.Dart.ORDER_UNARY_POSTFIX)||"''")+e,Blockly.Dart.ORDER_UNARY_POSTFIX]},Blockly.Dart.text_print=function(t){return"print("+(Blockly.Dart.valueToCode(t,"TEXT",Blockly.Dart.ORDER_NONE)||"''")+");\n"},Blockly.Dart.text_prompt_ext=function(t){if(Blockly.Dart.definitions_.import_dart_html="import 'dart:html' as Html;",t.getField("TEXT"))var e=Blockly.Dart.quote_(t.getFieldValue("TEXT"));else e=Blockly.Dart.valueToCode(t,"TEXT",Blockly.Dart.ORDER_NONE)||"''";var l="Html.window.prompt("+e+", '')";return"NUMBER"==t.getFieldValue("TYPE")&&(Blockly.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",l="Math.parseDouble("+l+")"),[l,Blockly.Dart.ORDER_UNARY_POSTFIX]},Blockly.Dart.text_prompt=Blockly.Dart.text_prompt_ext,Blockly.Dart.text_count=function(t){var e=Blockly.Dart.valueToCode(t,"TEXT",Blockly.Dart.ORDER_NONE)||"''",l=Blockly.Dart.valueToCode(t,"SUB",Blockly.Dart.ORDER_NONE)||"''";return[Blockly.Dart.provideFunction_("text_count",["int "+Blockly.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String haystack, String needle) {","  if (needle.length == 0) {","    return haystack.length + 1;","  }","  int index = 0;","  int count = 0;","  while (index != -1) {","    index = haystack.indexOf(needle, index);","    if (index != -1) {","      count++;","     index += needle.length;","    }","  }","  return count;","}"])+"("+e+", "+l+")",Blockly.Dart.ORDER_UNARY_POSTFIX]},Blockly.Dart.text_replace=function(t){return[(Blockly.Dart.valueToCode(t,"TEXT",Blockly.Dart.ORDER_UNARY_POSTFIX)||"''")+".replaceAll("+(Blockly.Dart.valueToCode(t,"FROM",Blockly.Dart.ORDER_NONE)||"''")+", "+(Blockly.Dart.valueToCode(t,"TO",Blockly.Dart.ORDER_NONE)||"''")+")",Blockly.Dart.ORDER_UNARY_POSTFIX]},Blockly.Dart.text_reverse=function(t){return["new String.fromCharCodes("+(Blockly.Dart.valueToCode(t,"TEXT",Blockly.Dart.ORDER_UNARY_POSTFIX)||"''")+".runes.toList().reversed)",Blockly.Dart.ORDER_UNARY_PREFIX]};