/**
 * @license
 * PXT Blockly fork
 *
 * The MIT License (MIT)
 *
 * Copyright (c) Microsoft Corporation
 *
 * All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
"use strict";goog.provide("Blockly.PXTBlockly.FunctionUtils"),Blockly.PXTBlockly.FunctionUtils={},Blockly.PXTBlockly.FunctionUtils.argumentIcons={},Blockly.PXTBlockly.FunctionUtils.argumentDefaultNames={},Blockly.PXTBlockly.FunctionUtils.getArgumentIcon=function(t){return Blockly.PXTBlockly.FunctionUtils.argumentIcons&&Blockly.PXTBlockly.FunctionUtils.argumentIcons[t]||void 0},Blockly.PXTBlockly.FunctionUtils.getArgumentDefaultName=function(t){return Blockly.PXTBlockly.FunctionUtils.argumentDefaultNames&&Blockly.PXTBlockly.FunctionUtils.argumentDefaultNames[t]||Blockly.Msg.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME},Blockly.PXTBlockly.FunctionUtils.mutationToDom=function(){this.ensureIds_();var t=Blockly.utils.xml.createElement("mutation");return t.setAttribute("name",this.name_),t.setAttribute("functionid",this.functionId_),this.arguments_.forEach(function(l){var e=Blockly.utils.xml.createElement("arg");e.setAttribute("name",l.name),e.setAttribute("id",l.id),e.setAttribute("type",l.type),t.appendChild(e)}),t},Blockly.PXTBlockly.FunctionUtils.domToMutation=function(t){for(var l=[],e=0;e<t.childNodes.length;++e){var o=t.childNodes[e];"arg"==o.nodeName.toLowerCase()&&l.push({id:o.getAttribute("id"),name:o.getAttribute("name"),type:o.getAttribute("type")})}this.arguments_=l,this.name_=t.getAttribute("name");var n=t.getAttribute("functionid");Blockly.Functions.idsInUse(this.workspace).indexOf(n)<0&&(this.functionId_=n),this.ensureIds_();var i=this.getHeightWidth?this.getHeightWidth():null;this.type!==Blockly.FUNCTION_DEFINITION_BLOCK_TYPE||i&&!i.height&&!i.width?this.updateDisplay_():!this.getFieldValue("function_name")&&this.name_&&this.setFieldValue(this.name_,"function_name")},Blockly.PXTBlockly.FunctionUtils.ensureIds_=function(){switch(this.type){case Blockly.FUNCTION_DEFINITION_BLOCK_TYPE:this.functionId_&&"null"!=this.functionId_||(this.functionId_=Blockly.utils.genUid());for(var t=0;t<this.arguments_.length;++t)this.arguments_[t].id||(this.arguments_[t].id=Blockly.utils.genUid());break;case Blockly.FUNCTION_CALL_OUTPUT_BLOCK_TYPE:case Blockly.FUNCTION_CALL_BLOCK_TYPE:var l=Blockly.Functions.getDefinition(this.name_,this.workspace);if(l){this.functionId_=l.getFunctionId();var e=l.getArguments();for(t=0;t<this.arguments_.length;++t)for(var o=0;o<e.length;++o)if(e[o].name==this.arguments_[t].name){this.arguments_[t].id=e[o].id;break}}}},Blockly.PXTBlockly.FunctionUtils.getName=function(){return this.name_},Blockly.PXTBlockly.FunctionUtils.getFunctionId=function(){return this.functionId_},Blockly.PXTBlockly.FunctionUtils.getArguments=function(){return this.arguments_},Blockly.PXTBlockly.FunctionUtils.setStatements_=function(t){this.hasStatements_!==t&&(t?this.appendStatementInput("STACK"):this.removeInput("STACK",!0),this.hasStatements_=t)},Blockly.PXTBlockly.FunctionUtils.updateDisplay_=function(){var t=this.rendered;this.rendered=!1;var l=this.disconnectOldBlocks_();this.removeValueInputs_(),this.createAllInputs_(l),this.deleteShadows_(l),this.rendered=t,t&&!this.isInsertionMarker()&&this.initSvg&&(this.initSvg(),this.render())},Blockly.PXTBlockly.FunctionUtils.disconnectOldBlocks_=function(){for(var t,l={},e=0;t=this.inputList[e];e++)if("STACK"!==t.name&&t.connection){var o=t.connection.targetBlock(),n={shadow:t.connection.getShadowDom(),block:o};l[t.name]=n,t.connection.setShadowDom(null,!0),t.connection.targetConnection&&t.connection.disconnect()}return l},Blockly.PXTBlockly.FunctionUtils.removeValueInputs_=function(){for(var t,l=[],e=0;t=this.inputList[e];e++)t.type==Blockly.INPUT_VALUE?t.dispose():l.push(t);this.inputList=l},Blockly.PXTBlockly.FunctionUtils.createAllInputs_=function(t){var l=!1,e=!1,o=!1;if(this.inputList.forEach(function(t){"function_title"==t.name?l=!0:"function_name"==t.name?e=!0:"function_collapse"==t.name&&(o=!0)}),!l){var n="";switch(this.type){case Blockly.FUNCTION_CALL_OUTPUT_BLOCK_TYPE:case Blockly.FUNCTION_CALL_BLOCK_TYPE:n=Blockly.Msg.FUNCTIONS_CALL_TITLE;break;case Blockly.FUNCTION_DEFINITION_BLOCK_TYPE:case Blockly.FUNCTION_DECLARATION_BLOCK_TYPE:n=Blockly.Msg.PROCEDURES_DEFNORETURN_TITLE}this.appendDummyInput("function_title").appendField(n,"function_title")}e?this.updateFunctionLabel_(this.getName()):this.addFunctionLabel_(this.getName());var i=this;this.arguments_.forEach(function(l){var e=i.appendValueInput(l.id);Blockly.Functions.isCustomType(l.type)?e.setCheck(l.type):e.setCheck(l.type.charAt(0).toUpperCase()+l.type.slice(1)),i.isInsertionMarker()||i.populateArgument_(l,t,e)}),o&&this.moveInputBefore("function_collapse",null),this.hasStatements_&&this.moveInputBefore("STACK",null)},Blockly.PXTBlockly.FunctionUtils.deleteShadows_=function(t){if(t)for(var l in t){var e=t[l];if(e){var o=e.block;o&&o.isShadow()&&(o.dispose(),delete t[l])}}},Blockly.PXTBlockly.FunctionUtils.updateLabelEditor_=function(t){Blockly.Events.disable(),this.getField("function_name").setValue(t),Blockly.Events.enable()},Blockly.PXTBlockly.FunctionUtils.updateLabelField_=function(t){this.getField("function_name").setValue(t)},Blockly.PXTBlockly.FunctionUtils.addLabelEditor_=function(t){if(this.type===Blockly.FUNCTION_DEFINITION_BLOCK_TYPE)var l=new Blockly.FieldTextInput(t||"",Blockly.Functions.rename);else l=new Blockly.FieldTextInput(t||"");l.setSpellcheck(!1),l.setAutoCapitalize(!1),this.appendDummyInput("function_name").appendField(l,"function_name")},Blockly.PXTBlockly.FunctionUtils.addLabelField_=function(t){this.appendDummyInput("function_name").appendField(new Blockly.FieldLabel(t,"functionNameText"),"function_name")},Blockly.PXTBlockly.FunctionUtils.getShadowBlockInfoFromType_=function(t,l){var e="",o="",n="";switch(t){case"boolean":e="logic_boolean",o="BOOL",n="TRUE";break;case"number":e="math_number",o="NUM",n="1";break;case"string":e="text",o="TEXT",n="abc";break;case"Array":e="variables_get",o="VAR",n=Blockly.Variables.getOrCreateVariablePackage(l,null,"list","").getId();break;default:e="variables_get",o="VAR",n=Blockly.Variables.getOrCreateVariablePackage(l,null,Blockly.PXTBlockly.FunctionUtils.getArgumentDefaultName(t),"").getId()}return[e,o,n]},Blockly.PXTBlockly.FunctionUtils.buildShadowDom_=function(t){var l=Blockly.utils.xml.createElement("shadow"),e=Blockly.PXTBlockly.FunctionUtils.getShadowBlockInfoFromType_(t,this.workspace),o=e[0],n=e[1],i=e[2],c="variables_get"===o;l.setAttribute("type",o);var s=goog.dom.createDom("field",null,i);if(c){s.setAttribute("id",i);var a=this.workspace.getVariableById(i);s.textContent=a?a.name:""}return s.setAttribute("name",n),l.appendChild(s),l},Blockly.PXTBlockly.FunctionUtils.attachShadow_=function(t,l){var e=Blockly.PXTBlockly.FunctionUtils.getShadowBlockInfoFromType_(l,this.workspace),o=e[0],n=e[1],i=e[2];Blockly.Events.disable();var c=null;try{(c=this.workspace.newBlock(o)).setFieldValue(i,n),c.setShadow(!0),!this.isInsertionMarker()&&c.initSvg&&(c.initSvg(),c.render(!1))}finally{Blockly.Events.enable()}c&&c.outputConnection.connect(t.connection)},Blockly.PXTBlockly.FunctionUtils.createArgumentReporter_=function(t){var l="";switch(t.type){case"boolean":l="argument_reporter_boolean";break;case"number":l="argument_reporter_number";break;case"string":l="argument_reporter_string";break;case"Array":l="argument_reporter_array";break;default:l="argument_reporter_custom"}Blockly.Events.disable();try{var e;(e="argument_reporter_custom"==l?Blockly.PXTBlockly.FunctionUtils.createCustomArgumentReporter(t.type,this.workspace):this.workspace.newBlock(l)).setShadow(!0),e.setFieldValue(t.name,"VALUE"),!this.isInsertionMarker()&&e.initSvg&&(e.initSvg(),e.render(!1))}finally{Blockly.Events.enable()}return e},Blockly.PXTBlockly.FunctionUtils.createCollapseIcon_=function(){var t=this;if(t.workspace&&t.workspace.getRenderer){var l=t.workspace.getRenderer().getConstants().COLLAPSE_IMAGE_DATAURI;l&&t.appendDummyInput("function_collapse").appendField(new Blockly.FieldImage(l,24,24,"",function(){t.setCollapsed(!0)},!1))}},Blockly.PXTBlockly.FunctionUtils.populateArgumentOnCaller_=function(t,l,e){var o=null,n=null;if(l&&t.id in l){var i=l[t.id];o=i.block,n=i.shadow}if(l&&o&&o.outputConnection.canConnectWithReason(e.connection)===Blockly.Connection.CAN_CONNECT)if(l[e.name]=null,o.outputConnection.connect(e.connection),o.isShadow())e.connection.setShadowDom(Blockly.Xml.blockToDom(o));else{var c=n||this.buildShadowDom_(t.type);e.connection.setShadowDom(c)}else this.attachShadow_(e,t.type),o&&o.isShadow_&&o.setShadow(!1)},Blockly.PXTBlockly.FunctionUtils.populateArgumentOnDefinition_=function(t,l,e){var o=null;l&&t.id in l&&(o=l[t.id].block);if(l&&o)(n=o).setFieldValue(t.name,"VALUE"),l[e.name]=null;else var n=this.createArgumentReporter_(t);e.connection.connect(n.outputConnection)},Blockly.PXTBlockly.FunctionUtils.populateArgumentOnDeclaration_=function(t,l,e){var o=this.createArgumentEditor_(t.type,t.name);e.connection.connect(o.outputConnection)},Blockly.PXTBlockly.FunctionUtils.createArgumentEditor_=function(t,l){var e;Blockly.Events.disable();try{var o="";switch(t){case"boolean":o="argument_editor_boolean";break;case"number":o="argument_editor_number";break;case"string":o="argument_editor_string";break;case"Array":o="argument_editor_array";break;default:o="argument_editor_custom"}(e="argument_editor_custom"==o?Blockly.PXTBlockly.FunctionUtils.createCustomArgumentEditor(t,this.workspace):this.workspace.newBlock(o)).setFieldValue(l,"TEXT"),e.setShadow(!0),!this.isInsertionMarker()&&e.initSvg&&(e.initSvg(),e.render(!1))}finally{Blockly.Events.enable()}return e},Blockly.PXTBlockly.FunctionUtils.updateDeclarationMutation_=function(){this.arguments_=[];for(var t=1;t<this.inputList.length;t++){var l=this.inputList[t];switch(l.type){case Blockly.NEXT_STATEMENT:break;case Blockly.DUMMY_INPUT:this.name_=l.fieldRow[0].getValue()||l.fieldRow[0].getText();break;case Blockly.INPUT_VALUE:var e=l.connection.targetBlock();this.arguments_.push({id:l.name,name:e.getFieldValue("TEXT"),type:e.getTypeName()});break;default:console.warn("Unexpected input type on a function mutator root: "+l.type)}}},Blockly.PXTBlockly.FunctionUtils.focusLastEditor_=function(){if(this.inputList.length>0){var t=this.inputList[this.inputList.length-2];if(t.type==Blockly.DUMMY_INPUT)this.workspace.centerOnBlock(this.id),t.fieldRow[0].showEditor_();else if(t.type==Blockly.INPUT_VALUE){var l=t.connection.targetBlock();l.workspace.centerOnBlock(l.id),l.getField("TEXT").showEditor_()}}},Blockly.PXTBlockly.FunctionUtils.addParam_=function(t,l){Blockly.WidgetDiv.hide(!0);var e=Blockly.Functions.findUniqueParamName(l,this.arguments_.map(function(t){return t.name}));this.arguments_.push({id:Blockly.utils.genUid(),name:e,type:t}),this.updateDisplay_(),this.focusLastEditor_()},Blockly.PXTBlockly.FunctionUtils.addBooleanExternal=function(){this.addParam_("boolean",Blockly.Msg.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME)},Blockly.PXTBlockly.FunctionUtils.addStringExternal=function(){this.addParam_("string",Blockly.Msg.FUNCTIONS_DEFAULT_STRING_ARG_NAME)},Blockly.PXTBlockly.FunctionUtils.addNumberExternal=function(){this.addParam_("number",Blockly.Msg.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME)},Blockly.PXTBlockly.FunctionUtils.addArrayExternal=function(){this.addParam_("Array",Blockly.Msg.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME)},Blockly.PXTBlockly.FunctionUtils.addCustomExternal=function(t){this.addParam_(t,Blockly.PXTBlockly.FunctionUtils.getArgumentDefaultName(t))},Blockly.PXTBlockly.FunctionUtils.removeFieldCallback=function(t){for(var l=null,e=0;e<this.inputList.length&&!l;e++){var o=this.inputList[e];if(o.connection){var n=o.connection.targetBlock();if(!n)continue;n.getField(t.name)===t&&(l=o.name)}else for(var i=0;i<o.fieldRow.length;i++)o.fieldRow[i]==t&&(l=o.name)}l&&(Blockly.WidgetDiv.hide(!0),this.removeInput(l),this.updateFunctionSignature(),this.updateDisplay_())},Blockly.PXTBlockly.FunctionUtils.removeArgumentCallback_=function(t){this.parentBlock_&&this.parentBlock_.removeFieldCallback&&this.parentBlock_.removeFieldCallback(t)},Blockly.PXTBlockly.FunctionUtils.onCallerChange=function(t){if(this.workspace&&!this.workspace.isFlyout)if(t.type==Blockly.Events.BLOCK_CREATE&&-1!=t.ids.indexOf(this.id)){var l=this.getName();if(r=Blockly.Functions.getDefinition(l,this.workspace)){var e=r.getArguments().slice(),o=this.arguments_.slice();JSON.stringify(o)!==JSON.stringify(e)&&Blockly.Functions.mutateCallersAndDefinition(r.getName(),this.workspace,r.mutationToDom()),this.functionId_=r.functionId_}else{Blockly.Events.setGroup(t.group);var n=Blockly.utils.xml.createElement("xml"),i=Blockly.utils.xml.createElement("block");i.setAttribute("type",Blockly.FUNCTION_DEFINITION_BLOCK_TYPE);var c=this.getRelativeToSurfaceXY(),s=c.x+Blockly.SNAP_RADIUS*(this.RTL?-1:1),a=c.y+2*Blockly.SNAP_RADIUS;i.setAttribute("x",s),i.setAttribute("y",a);var u=this.mutationToDom();i.appendChild(u),n.appendChild(i),Blockly.Xml.domToWorkspace(n,this.workspace),Blockly.Events.setGroup(!1)}}else if(t.type==Blockly.Events.BLOCK_DELETE){var r;l=this.getName();(r=Blockly.Functions.getDefinition(l,this.workspace))||(Blockly.Events.setGroup(t.group),this.dispose(!0,!1),Blockly.Events.setGroup(!1))}},Blockly.Blocks.function_declaration={init:function(){this.jsonInit({style:{hat:"cap"}}),this.name_="",this.arguments_=[],this.functionId_="",this.createAllInputs_(),this.setColour(Blockly.Msg.PROCEDURES_HUE),this.setStatements_(!0),this.setDeletable(!1),this.setMovable(!1),this.contextMenu=!1,this.setInputsInline(!0),this.statementConnection_=null},mutationToDom:Blockly.PXTBlockly.FunctionUtils.mutationToDom,domToMutation:Blockly.PXTBlockly.FunctionUtils.domToMutation,getName:Blockly.PXTBlockly.FunctionUtils.getName,getFunctionId:Blockly.PXTBlockly.FunctionUtils.getFunctionId,getArguments:Blockly.PXTBlockly.FunctionUtils.getArguments,removeValueInputs_:Blockly.PXTBlockly.FunctionUtils.removeValueInputs_,disconnectOldBlocks_:Blockly.PXTBlockly.FunctionUtils.disconnectOldBlocks_,deleteShadows_:Blockly.PXTBlockly.FunctionUtils.deleteShadows_,createAllInputs_:Blockly.PXTBlockly.FunctionUtils.createAllInputs_,updateDisplay_:Blockly.PXTBlockly.FunctionUtils.updateDisplay_,setStatements_:Blockly.PXTBlockly.FunctionUtils.setStatements_,ensureIds_:Blockly.PXTBlockly.FunctionUtils.ensureIds_,populateArgument_:Blockly.PXTBlockly.FunctionUtils.populateArgumentOnDeclaration_,addFunctionLabel_:Blockly.PXTBlockly.FunctionUtils.addLabelEditor_,updateFunctionLabel_:Blockly.PXTBlockly.FunctionUtils.updateLabelEditor_,createArgumentEditor_:Blockly.PXTBlockly.FunctionUtils.createArgumentEditor_,focusLastEditor_:Blockly.PXTBlockly.FunctionUtils.focusLastEditor_,removeFieldCallback:Blockly.PXTBlockly.FunctionUtils.removeFieldCallback,addParam_:Blockly.PXTBlockly.FunctionUtils.addParam_,addBooleanExternal:Blockly.PXTBlockly.FunctionUtils.addBooleanExternal,addStringExternal:Blockly.PXTBlockly.FunctionUtils.addStringExternal,addNumberExternal:Blockly.PXTBlockly.FunctionUtils.addNumberExternal,addArrayExternal:Blockly.PXTBlockly.FunctionUtils.addArrayExternal,addCustomExternal:Blockly.PXTBlockly.FunctionUtils.addCustomExternal,updateFunctionSignature:Blockly.PXTBlockly.FunctionUtils.updateDeclarationMutation_},Blockly.Blocks.function_definition={init:function(){this.jsonInit({style:{hat:"cap"}}),this.name_="",this.arguments_=[],this.functionId_="",this.createAllInputs_(),this.setColour(Blockly.Msg.PROCEDURES_HUE),this.setTooltip(Blockly.Msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(Blockly.Msg.PROCEDURES_DEFNORETURN_HELPURL),this.setStatements_(!0),this.createCollapseIcon_(),this.setInputsInline(!0),this.statementConnection_=null},customContextMenu:function(t){this.inDebugWorkspace()||(t.push(Blockly.Functions.makeEditOption(this)),t.push(Blockly.Functions.makeCreateCallOption(this)))},mutationToDom:Blockly.PXTBlockly.FunctionUtils.mutationToDom,domToMutation:Blockly.PXTBlockly.FunctionUtils.domToMutation,getName:Blockly.PXTBlockly.FunctionUtils.getName,getFunctionId:Blockly.PXTBlockly.FunctionUtils.getFunctionId,getArguments:Blockly.PXTBlockly.FunctionUtils.getArguments,removeValueInputs_:Blockly.PXTBlockly.FunctionUtils.removeValueInputs_,disconnectOldBlocks_:Blockly.PXTBlockly.FunctionUtils.disconnectOldBlocks_,deleteShadows_:Blockly.PXTBlockly.FunctionUtils.deleteShadows_,createAllInputs_:Blockly.PXTBlockly.FunctionUtils.createAllInputs_,updateDisplay_:Blockly.PXTBlockly.FunctionUtils.updateDisplay_,setStatements_:Blockly.PXTBlockly.FunctionUtils.setStatements_,ensureIds_:Blockly.PXTBlockly.FunctionUtils.ensureIds_,populateArgument_:Blockly.PXTBlockly.FunctionUtils.populateArgumentOnDefinition_,addFunctionLabel_:Blockly.PXTBlockly.FunctionUtils.addLabelEditor_,updateFunctionLabel_:Blockly.PXTBlockly.FunctionUtils.updateLabelEditor_,createArgumentReporter_:Blockly.PXTBlockly.FunctionUtils.createArgumentReporter_,createCollapseIcon_:Blockly.PXTBlockly.FunctionUtils.createCollapseIcon_},Blockly.Blocks.function_call={init:function(){this.jsonInit({extensions:["function_contextmenu_edit"]}),this.name_="",this.arguments_=[],this.functionId_="",this.setPreviousStatement(!0),this.setNextStatement(!0),this.setColour(Blockly.Msg.PROCEDURES_HUE),this.setHelpUrl(Blockly.Msg.PROCEDURES_CALLNORETURN_HELPURL),this.setTooltip(Blockly.Msg.FUNCTION_CALL_TOOLTIP),this.setInputsInline(!0)},mutationToDom:Blockly.PXTBlockly.FunctionUtils.mutationToDom,domToMutation:Blockly.PXTBlockly.FunctionUtils.domToMutation,getName:Blockly.PXTBlockly.FunctionUtils.getName,getFunctionId:Blockly.PXTBlockly.FunctionUtils.getFunctionId,getArguments:Blockly.PXTBlockly.FunctionUtils.getArguments,removeValueInputs_:Blockly.PXTBlockly.FunctionUtils.removeValueInputs_,disconnectOldBlocks_:Blockly.PXTBlockly.FunctionUtils.disconnectOldBlocks_,deleteShadows_:Blockly.PXTBlockly.FunctionUtils.deleteShadows_,createAllInputs_:Blockly.PXTBlockly.FunctionUtils.createAllInputs_,updateDisplay_:Blockly.PXTBlockly.FunctionUtils.updateDisplay_,setStatements_:Blockly.PXTBlockly.FunctionUtils.setStatements_,ensureIds_:Blockly.PXTBlockly.FunctionUtils.ensureIds_,populateArgument_:Blockly.PXTBlockly.FunctionUtils.populateArgumentOnCaller_,addFunctionLabel_:Blockly.PXTBlockly.FunctionUtils.addLabelField_,updateFunctionLabel_:Blockly.PXTBlockly.FunctionUtils.updateLabelField_,attachShadow_:Blockly.PXTBlockly.FunctionUtils.attachShadow_,buildShadowDom_:Blockly.PXTBlockly.FunctionUtils.buildShadowDom_,onchange:Blockly.PXTBlockly.FunctionUtils.onCallerChange},Blockly.Blocks.function_call_output={init:function(){this.jsonInit({extensions:["function_contextmenu_edit"]}),this.name_="",this.arguments_=[],this.functionId_="",this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0,null),this.setOutputShape(Blockly.OUTPUT_SHAPE_ROUND),this.setColour(Blockly.Msg.PROCEDURES_HUE),this.setHelpUrl(Blockly.Msg.PROCEDURES_CALLNORETURN_HELPURL),this.setTooltip(Blockly.Msg.FUNCTION_CALL_TOOLTIP),this.setInputsInline(!0)},mutationToDom:Blockly.PXTBlockly.FunctionUtils.mutationToDom,domToMutation:Blockly.PXTBlockly.FunctionUtils.domToMutation,getName:Blockly.PXTBlockly.FunctionUtils.getName,getFunctionId:Blockly.PXTBlockly.FunctionUtils.getFunctionId,getArguments:Blockly.PXTBlockly.FunctionUtils.getArguments,removeValueInputs_:Blockly.PXTBlockly.FunctionUtils.removeValueInputs_,disconnectOldBlocks_:Blockly.PXTBlockly.FunctionUtils.disconnectOldBlocks_,deleteShadows_:Blockly.PXTBlockly.FunctionUtils.deleteShadows_,createAllInputs_:Blockly.PXTBlockly.FunctionUtils.createAllInputs_,updateDisplay_:Blockly.PXTBlockly.FunctionUtils.updateDisplay_,setStatements_:Blockly.PXTBlockly.FunctionUtils.setStatements_,ensureIds_:Blockly.PXTBlockly.FunctionUtils.ensureIds_,populateArgument_:Blockly.PXTBlockly.FunctionUtils.populateArgumentOnCaller_,addFunctionLabel_:Blockly.PXTBlockly.FunctionUtils.addLabelField_,updateFunctionLabel_:Blockly.PXTBlockly.FunctionUtils.updateLabelField_,attachShadow_:Blockly.PXTBlockly.FunctionUtils.attachShadow_,buildShadowDom_:Blockly.PXTBlockly.FunctionUtils.buildShadowDom_,onchange:Blockly.PXTBlockly.FunctionUtils.onCallerChange},Blockly.PXTBlockly.FunctionUtils.getTypeName=function(){return this.typeName_},Blockly.PXTBlockly.FunctionUtils.argumentMutationToDom=function(){var t=Blockly.utils.xml.createElement("mutation");return t.setAttribute("typename",this.typeName_),t},Blockly.PXTBlockly.FunctionUtils.argumentDomToMutation=function(t){this.typeName_=t.getAttribute("typename"),this.setOutput(!0,this.typeName_)},Blockly.PXTBlockly.FunctionUtils.createCustomArgumentBlock=function(t,l,e){var o='<xml><block type="'+t+'"><mutation typename="'+l+'"></mutation></block></xml>',n=Blockly.Xml.textToDom(o);return Blockly.Xml.domToBlock(n.firstChild,e)},Blockly.PXTBlockly.FunctionUtils.createCustomArgumentEditor=function(t,l){return Blockly.PXTBlockly.FunctionUtils.createCustomArgumentBlock("argument_editor_custom",t,l)},Blockly.PXTBlockly.FunctionUtils.createCustomArgumentReporter=function(t,l){return Blockly.PXTBlockly.FunctionUtils.createCustomArgumentBlock("argument_reporter_custom",t,l)},Blockly.Blocks.argument_editor_boolean={init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"bool"}],colour:Blockly.Colours.textField,colourSecondary:Blockly.Colours.textField,colourTertiary:Blockly.Colours.textField,extensions:["output_boolean"]}),this.typeName_="boolean"},getTypeName:Blockly.PXTBlockly.FunctionUtils.getTypeName,removeFieldCallback:Blockly.PXTBlockly.FunctionUtils.removeArgumentCallback_},Blockly.Blocks.argument_editor_string={init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"text"}],colour:Blockly.Colours.textField,colourSecondary:Blockly.Colours.textField,colourTertiary:Blockly.Colours.textField,extensions:["output_string"]}),this.typeName_="string"},getTypeName:Blockly.PXTBlockly.FunctionUtils.getTypeName,removeFieldCallback:Blockly.PXTBlockly.FunctionUtils.removeArgumentCallback_},Blockly.Blocks.argument_editor_number={init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"num"}],colour:Blockly.Colours.textField,colourSecondary:Blockly.Colours.textField,colourTertiary:Blockly.Colours.textField,extensions:["output_number"]}),this.typeName_="number"},getTypeName:Blockly.PXTBlockly.FunctionUtils.getTypeName,removeFieldCallback:Blockly.PXTBlockly.FunctionUtils.removeArgumentCallback_},Blockly.Blocks.argument_editor_array={init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"list"}],colour:Blockly.Colours.textField,colourSecondary:Blockly.Colours.textField,colourTertiary:Blockly.Colours.textField,extensions:["output_array"]}),this.typeName_="Array"},getTypeName:Blockly.PXTBlockly.FunctionUtils.getTypeName,removeFieldCallback:Blockly.PXTBlockly.FunctionUtils.removeArgumentCallback_},Blockly.Blocks.argument_editor_custom={init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"arg"}],colour:Blockly.Colours.textField,colourSecondary:Blockly.Colours.textField,colourTertiary:Blockly.Colours.textField,outputShape:Blockly.OUTPUT_SHAPE_ROUND}),this.typeName_="any"},getTypeName:Blockly.PXTBlockly.FunctionUtils.getTypeName,removeFieldCallback:Blockly.PXTBlockly.FunctionUtils.removeArgumentCallback_,mutationToDom:Blockly.PXTBlockly.FunctionUtils.argumentMutationToDom,domToMutation:Blockly.PXTBlockly.FunctionUtils.argumentDomToMutation},Blockly.Blocks.argument_reporter_boolean={init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_hover",name:"VALUE",text:""}],colour:Blockly.Msg.REPORTERS_HUE,extensions:["output_boolean"]}),this.typeName_="boolean"},getTypeName:Blockly.PXTBlockly.FunctionUtils.getTypeName},Blockly.Blocks.argument_reporter_number={init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_hover",name:"VALUE",text:""}],colour:Blockly.Msg.REPORTERS_HUE,extensions:["output_number"]}),this.typeName_="number"},getTypeName:Blockly.PXTBlockly.FunctionUtils.getTypeName},Blockly.Blocks.argument_reporter_string={init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_hover",name:"VALUE",text:""}],colour:Blockly.Msg.REPORTERS_HUE,extensions:["output_string"]}),this.typeName_="string"},getTypeName:Blockly.PXTBlockly.FunctionUtils.getTypeName},Blockly.Blocks.argument_reporter_array={init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_hover",name:"VALUE",text:""}],colour:Blockly.Msg.REPORTERS_HUE,extensions:["output_array"]}),this.typeName_="Array"},getTypeName:Blockly.PXTBlockly.FunctionUtils.getTypeName},Blockly.Blocks.argument_reporter_custom={init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_hover",name:"VALUE",text:""}],colour:Blockly.Msg.REPORTERS_HUE,inputsInline:!0,outputShape:Blockly.OUTPUT_SHAPE_ROUND,output:null}),this.typeName_=""},getTypeName:Blockly.PXTBlockly.FunctionUtils.getTypeName,mutationToDom:Blockly.PXTBlockly.FunctionUtils.argumentMutationToDom,domToMutation:Blockly.PXTBlockly.FunctionUtils.argumentDomToMutation};