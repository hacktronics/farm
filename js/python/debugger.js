var Sk=Sk||{};function hasOwnProperty(t,e){var n=t.constructor.prototype;return e in t&&(!(e in n)||n[e]!==t[e])}Sk.Breakpoint=function(t,e,n){this.filename=t,this.lineno=e,this.colno=n,this.enabled=!0,this.ignore_count=0},Sk.Debugger=function(t,e){this.dbg_breakpoints={},this.tmp_breakpoints={},this.suspension_stack=[],this.current_suspension=-1,this.eval_callback=null,this.suspension=null,this.output_callback=e,this.step_mode=!1,this.filename=t},Sk.Debugger.prototype.print=function(t){null!=this.output_callback&&this.output_callback.print(t)},Sk.Debugger.prototype.get_source_line=function(t){return null!=this.output_callback?this.output_callback.get_source_line(t):""},Sk.Debugger.prototype.move_up_the_stack=function(){this.current_suspension=Math.min(this.current_suspension+1,this.suspension_stack.length-1)},Sk.Debugger.prototype.move_down_the_stack=function(){this.current_suspension=Math.max(this.current_suspension-1,0)},Sk.Debugger.prototype.enable_step_mode=function(){this.step_mode=!0},Sk.Debugger.prototype.disable_step_mode=function(){this.step_mode=!1},Sk.Debugger.prototype.get_suspension_stack=function(){return this.suspension_stack},Sk.Debugger.prototype.get_active_suspension=function(){return 0===this.suspension_stack.length?null:this.suspension_stack[this.current_suspension]},Sk.Debugger.prototype.generate_breakpoint_key=function(t,e,n){return t+"-"+e},Sk.Debugger.prototype.check_breakpoints=function(t,e,n,s,i){if(!0===this.step_mode)return!0;var o=this.generate_breakpoint_key(t,e,n);if(hasOwnProperty(this.dbg_breakpoints,o)&&!0===this.dbg_breakpoints[o].enabled){return hasOwnProperty(this.tmp_breakpoints,o)?(delete this.dbg_breakpoints[o],delete this.tmp_breakpoints[o],!0):(this.dbg_breakpoints[o].ignore_count-=1,this.dbg_breakpoints[o].ignore_count=Math.max(0,this.dbg_breakpoints[o].ignore_count),0===this.dbg_breakpoints[o].ignore_count)}return!1},Sk.Debugger.prototype.get_breakpoints_list=function(){return this.dbg_breakpoints},Sk.Debugger.prototype.disable_breakpoint=function(t,e,n){var s=this.generate_breakpoint_key(t,e,n);hasOwnProperty(this.dbg_breakpoints,s)&&(this.dbg_breakpoints[s].enabled=!1)},Sk.Debugger.prototype.enable_breakpoint=function(t,e,n){var s=this.generate_breakpoint_key(t,e,n);hasOwnProperty(this.dbg_breakpoints,s)&&(this.dbg_breakpoints[s].enabled=!0)},Sk.Debugger.prototype.clear_breakpoint=function(t,e,n){var s=this.generate_breakpoint_key(t,e,n);return hasOwnProperty(this.dbg_breakpoints,s)?(delete this.dbg_breakpoints[s],null):"Invalid breakpoint specified: "+t+" line: "+e},Sk.Debugger.prototype.clear_all_breakpoints=function(){this.dbg_breakpoints={},this.tmp_breakpoints={}},Sk.Debugger.prototype.set_ignore_count=function(t,e,n,s){var i=this.generate_breakpoint_key(t,e,n);hasOwnProperty(this.dbg_breakpoints,i)&&(this.dbg_breakpoints[i].ignore_count=s)},Sk.Debugger.prototype.set_condition=function(t,e,n,s,i,o){var r,p=this.generate_breakpoint_key(t,e,n);(r=hasOwnProperty(this.dbg_breakpoints,p)?this.dbg_breakpoints[p]:new Sk.Breakpoint(t,e,n)).condition=new Sk.Condition(s,i,o),this.dbg_breakpoints[p]=r},Sk.Debugger.prototype.print_suspension_info=function(t){var e=t.filename,n=t.lineno,s=t.colno;this.print("Hit Breakpoint at <"+e+"> at line: "+n+" column: "+s+"\n"),this.print("----------------------------------------------------------------------------------\n"),this.print(" ==> "+this.get_source_line(n-1)+"\n"),this.print("----------------------------------------------------------------------------------\n")},Sk.Debugger.prototype.set_suspension=function(t){var e=null;for(!hasOwnProperty(t,"filename")&&t.child instanceof Sk.misceval.Suspension&&(t=t.child),this.suspension_stack.length>0&&(this.suspension_stack.pop(),this.current_suspension-=1);t instanceof Sk.misceval.Suspension;)e=t,this.suspension_stack.push(e),this.current_suspension+=1,t=t.child;t=e,this.print_suspension_info(t)},Sk.Debugger.prototype.add_breakpoint=function(t,e,n,s){var i=this.generate_breakpoint_key(t,e,n);this.dbg_breakpoints[i]=new Sk.Breakpoint(t,e,n),s&&(this.tmp_breakpoints[i]=!0)},Sk.Debugger.prototype.suspension_handler=function(t){return new Promise(function(e,n){try{e(t.resume())}catch(t){n(t)}})},Sk.Debugger.prototype.resume=function(){(this.current_suspension=this.suspension_stack.length-1,0===this.suspension_stack.length)?this.print("No running program"):this.suspension_handler(this.get_active_suspension()).then(this.success.bind(this),this.error.bind(this))},Sk.Debugger.prototype.pop_suspension_stack=function(){this.suspension_stack.pop(),this.current_suspension-=1},Sk.Debugger.prototype.success=function(t){if(t instanceof Sk.misceval.Suspension)this.set_suspension(t);else if(this.suspension_stack.length>0){if(this.pop_suspension_stack(),0===this.suspension_stack.length)return void this.print("Program execution complete");this.get_active_suspension().child.resume=function(){return t},this.resume()}else this.print("Program execution complete")},Sk.Debugger.prototype.error=function(t){this.print("Traceback (most recent call last):");for(var e=0;e<t.traceback.length;++e){this.print('  File "'+t.traceback[e].filename+'", line '+t.traceback[e].lineno+", in <module>");var n=this.get_source_line(t.traceback[e].lineno-1);n="    "+(n=n.trim()),this.print(n)}var s=t.constructor.tp$name;for(e=0;e<t.args.v.length;++e)this.print(s+": "+t.args.v[e].v)},Sk.Debugger.prototype.asyncToPromise=function(t,e,n){return new Promise(function(e,s){try{!function(t){try{for(;t instanceof Sk.misceval.Suspension;)return void n.set_suspension(t);e(t)}catch(t){s(t)}}(t())}catch(t){s(t)}})},Sk.Debugger.prototype.execute=function(t,e){var n=t();n instanceof Sk.misceval.Suspension&&(this.suspensions.concat(n),this.eval_callback(n))},goog.exportSymbol("Sk.Debugger",Sk.Debugger);