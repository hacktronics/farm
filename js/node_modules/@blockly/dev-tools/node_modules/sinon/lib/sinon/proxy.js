"use strict";var arrayProto=require("@sinonjs/commons").prototypes.array,extend=require("./util/core/extend"),functionToString=require("./util/core/function-to-string"),proxyCall=require("./proxy-call"),proxyCallUtil=require("./proxy-call-util"),proxyInvoke=require("./proxy-invoke"),sinonFormat=require("./util/core/format"),push=arrayProto.push,forEach=arrayProto.forEach,slice=arrayProto.slice,emptyFakes=Object.freeze([]),proxyApi={toString:functionToString,named:function(e){this.displayName=e;var l=Object.getOwnPropertyDescriptor(this,"name");return l&&l.configurable&&(l.value=e,Object.defineProperty(this,"name",l)),this},invoke:proxyInvoke,matchingFakes:function(){return emptyFakes},getCall:function(e){var l=e;return l<0&&(l+=this.callCount),l<0||l>=this.callCount?null:proxyCall(this,this.thisValues[l],this.args[l],this.returnValues[l],this.exceptions[l],this.callIds[l],this.errorsWithCallStack[l])},getCalls:function(){var e,l=[];for(e=0;e<this.callCount;e++)push(l,this.getCall(e));return l},calledBefore:function(e){return!!this.called&&(!e.called||this.callIds[0]<e.callIds[e.callIds.length-1])},calledAfter:function(e){return!(!this.called||!e.called)&&this.callIds[this.callCount-1]>e.callIds[0]},calledImmediatelyBefore:function(e){return!(!this.called||!e.called)&&this.callIds[this.callCount-1]===e.callIds[e.callCount-1]-1},calledImmediatelyAfter:function(e){return!(!this.called||!e.called)&&this.callIds[this.callCount-1]===e.callIds[e.callCount-1]+1},formatters:require("./spy-formatters"),printf:function(e){var l,t=this,a=slice(arguments,1);return(e||"").replace(/%(.)/g,function(e,i){return"function"==typeof(l=proxyApi.formatters[i])?String(l(t,a)):isNaN(parseInt(i,10))?"%"+i:sinonFormat(a[i-1])})},resetHistory:function(){if(this.invoking){var e=new Error("Cannot reset Sinon function while invoking it. Move the call to .resetHistory outside of the callback.");throw e.name="InvalidResetException",e}return this.called=!1,this.notCalled=!0,this.calledOnce=!1,this.calledTwice=!1,this.calledThrice=!1,this.callCount=0,this.firstCall=null,this.secondCall=null,this.thirdCall=null,this.lastCall=null,this.args=[],this.firstArg=null,this.lastArg=null,this.returnValues=[],this.thisValues=[],this.exceptions=[],this.callIds=[],this.errorsWithCallStack=[],this.fakes&&forEach(this.fakes,function(e){e.resetHistory()}),this}},delegateToCalls=proxyCallUtil.delegateToCalls;function createProxy(e,l){var t=wrapFunction(e,l);return extend(t,e),t.prototype=e.prototype,extend.nonEnum(t,proxyApi),t}function wrapFunction(e,l){var t;switch(l.length){case 0:default:t=function(){return t.invoke(e,this,slice(arguments))};break;case 1:t=function(l){return t.invoke(e,this,slice(arguments))};break;case 2:t=function(l,a){return t.invoke(e,this,slice(arguments))};break;case 3:t=function(l,a,i){return t.invoke(e,this,slice(arguments))};break;case 4:t=function(l,a,i,r){return t.invoke(e,this,slice(arguments))};break;case 5:t=function(l,a,i,r,n){return t.invoke(e,this,slice(arguments))};break;case 6:t=function(l,a,i,r,n,o){return t.invoke(e,this,slice(arguments))};break;case 7:t=function(l,a,i,r,n,o,s){return t.invoke(e,this,slice(arguments))};break;case 8:t=function(l,a,i,r,n,o,s,c){return t.invoke(e,this,slice(arguments))};break;case 9:t=function(l,a,i,r,n,o,s,c,u){return t.invoke(e,this,slice(arguments))};break;case 10:t=function(l,a,i,r,n,o,s,c,u,h){return t.invoke(e,this,slice(arguments))};break;case 11:t=function(l,a,i,r,n,o,s,c,u,h,d){return t.invoke(e,this,slice(arguments))};break;case 12:t=function(l,a,i,r,n,o,s,c,u,h,d,p){return t.invoke(e,this,slice(arguments))}}var a=Object.getOwnPropertyDescriptor(l,"name");return a&&a.configurable&&Object.defineProperty(t,"name",a),extend.nonEnum(t,{isSinonProxy:!0,called:!1,notCalled:!0,calledOnce:!1,calledTwice:!1,calledThrice:!1,callCount:0,firstCall:null,firstArg:null,secondCall:null,thirdCall:null,lastCall:null,lastArg:null,args:[],returnValues:[],thisValues:[],exceptions:[],callIds:[],errorsWithCallStack:[]}),t}delegateToCalls(proxyApi,"calledOn",!0),delegateToCalls(proxyApi,"alwaysCalledOn",!1,"calledOn"),delegateToCalls(proxyApi,"calledWith",!0),delegateToCalls(proxyApi,"calledOnceWith",!0,"calledWith",!1,void 0,1),delegateToCalls(proxyApi,"calledWithMatch",!0),delegateToCalls(proxyApi,"alwaysCalledWith",!1,"calledWith"),delegateToCalls(proxyApi,"alwaysCalledWithMatch",!1,"calledWithMatch"),delegateToCalls(proxyApi,"calledWithExactly",!0),delegateToCalls(proxyApi,"calledOnceWithExactly",!0,"calledWithExactly",!1,void 0,1),delegateToCalls(proxyApi,"calledOnceWithMatch",!0,"calledWithMatch",!1,void 0,1),delegateToCalls(proxyApi,"alwaysCalledWithExactly",!1,"calledWithExactly"),delegateToCalls(proxyApi,"neverCalledWith",!1,"notCalledWith",!1,function(){return!0}),delegateToCalls(proxyApi,"neverCalledWithMatch",!1,"notCalledWithMatch",!1,function(){return!0}),delegateToCalls(proxyApi,"threw",!0),delegateToCalls(proxyApi,"alwaysThrew",!1,"threw"),delegateToCalls(proxyApi,"returned",!0),delegateToCalls(proxyApi,"alwaysReturned",!1,"returned"),delegateToCalls(proxyApi,"calledWithNew",!0),delegateToCalls(proxyApi,"alwaysCalledWithNew",!1,"calledWithNew"),module.exports=createProxy;