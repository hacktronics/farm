goog.provide("goog.fx.DragEvent"),goog.provide("goog.fx.Dragger"),goog.provide("goog.fx.Dragger.EventType"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.events"),goog.require("goog.events.Event"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventTarget"),goog.require("goog.events.EventType"),goog.require("goog.math.Coordinate"),goog.require("goog.math.Rect"),goog.require("goog.style"),goog.require("goog.style.bidi"),goog.require("goog.userAgent"),goog.fx.Dragger=function(t,e,g){goog.fx.Dragger.base(this,"constructor"),this.target=t,this.handle=e||t,this.limits=g||new goog.math.Rect(NaN,NaN,NaN,NaN),this.document_=goog.dom.getOwnerDocument(t),this.eventHandler_=new goog.events.EventHandler(this),this.registerDisposable(this.eventHandler_),this.rightToLeft_,this.clientX=0,this.clientY=0,this.screenX=0,this.screenY=0,this.startX=0,this.startY=0,this.deltaX=0,this.deltaY=0,this.pageScroll,this.enabled_=!0,this.dragging_=!1,this.preventMouseDown_=!0,this.hysteresisDistanceSquared_=0,this.scrollTarget_,this.ieDragStartCancellingOn_=!1,this.useRightPositioningForRtl_=!1,goog.events.listen(this.handle,[goog.events.EventType.TOUCHSTART,goog.events.EventType.MOUSEDOWN],this.startDrag,!1,this),this.useSetCapture_=goog.fx.Dragger.HAS_SET_CAPTURE_},goog.inherits(goog.fx.Dragger,goog.events.EventTarget),goog.tagUnsealableClass(goog.fx.Dragger),goog.fx.Dragger.HAS_SET_CAPTURE_=goog.global.document&&goog.global.document.documentElement&&!!goog.global.document.documentElement.setCapture&&!!goog.global.document.releaseCapture,goog.fx.Dragger.cloneNode=function(t){for(var e=t.cloneNode(!0),g=goog.dom.getElementsByTagName(goog.dom.TagName.TEXTAREA,t),o=goog.dom.getElementsByTagName(goog.dom.TagName.TEXTAREA,e),i=0;i<g.length;i++)o[i].value=g[i].value;switch(t.tagName){case String(goog.dom.TagName.TR):return goog.dom.createDom(goog.dom.TagName.TABLE,null,goog.dom.createDom(goog.dom.TagName.TBODY,null,e));case String(goog.dom.TagName.TD):case String(goog.dom.TagName.TH):return goog.dom.createDom(goog.dom.TagName.TABLE,null,goog.dom.createDom(goog.dom.TagName.TBODY,null,goog.dom.createDom(goog.dom.TagName.TR,null,e)));case String(goog.dom.TagName.TEXTAREA):e.value=t.value;default:return e}},goog.fx.Dragger.EventType={EARLY_CANCEL:"earlycancel",START:"start",BEFOREDRAG:"beforedrag",DRAG:"drag",END:"end"},goog.fx.Dragger.prototype.setAllowSetCapture=function(t){this.useSetCapture_=t&&goog.fx.Dragger.HAS_SET_CAPTURE_},goog.fx.Dragger.prototype.enableRightPositioningForRtl=function(t){this.useRightPositioningForRtl_=t},goog.fx.Dragger.prototype.getHandler=function(){return this.eventHandler_},goog.fx.Dragger.prototype.setLimits=function(t){this.limits=t||new goog.math.Rect(NaN,NaN,NaN,NaN)},goog.fx.Dragger.prototype.setHysteresis=function(t){this.hysteresisDistanceSquared_=Math.pow(t,2)},goog.fx.Dragger.prototype.getHysteresis=function(){return Math.sqrt(this.hysteresisDistanceSquared_)},goog.fx.Dragger.prototype.setScrollTarget=function(t){this.scrollTarget_=t},goog.fx.Dragger.prototype.setCancelIeDragStart=function(t){this.ieDragStartCancellingOn_=t},goog.fx.Dragger.prototype.getEnabled=function(){return this.enabled_},goog.fx.Dragger.prototype.setEnabled=function(t){this.enabled_=t},goog.fx.Dragger.prototype.setPreventMouseDown=function(t){this.preventMouseDown_=t},goog.fx.Dragger.prototype.disposeInternal=function(){goog.fx.Dragger.superClass_.disposeInternal.call(this),goog.events.unlisten(this.handle,[goog.events.EventType.TOUCHSTART,goog.events.EventType.MOUSEDOWN],this.startDrag,!1,this),this.cleanUpAfterDragging_(),this.target=null,this.handle=null},goog.fx.Dragger.prototype.isRightToLeft_=function(){return void 0===this.rightToLeft_&&(this.rightToLeft_=goog.style.isRightToLeft(this.target)),this.rightToLeft_},goog.fx.Dragger.prototype.startDrag=function(t){var e=t.type==goog.events.EventType.MOUSEDOWN;if(!this.enabled_||this.dragging_||e&&!t.isMouseActionButton())this.dispatchEvent(goog.fx.Dragger.EventType.EARLY_CANCEL);else{if(0==this.hysteresisDistanceSquared_){if(!this.fireDragStart_(t))return;this.dragging_=!0,this.preventMouseDown_&&e&&t.preventDefault()}else this.preventMouseDown_&&e&&t.preventDefault();this.setupDragHandlers(),this.clientX=this.startX=t.clientX,this.clientY=this.startY=t.clientY,this.screenX=t.screenX,this.screenY=t.screenY,this.computeInitialPosition(),this.pageScroll=goog.dom.getDomHelper(this.document_).getDocumentScroll()}},goog.fx.Dragger.prototype.setupDragHandlers=function(){var t=this.document_,e=t.documentElement,g=!this.useSetCapture_;this.eventHandler_.listen(t,[goog.events.EventType.TOUCHMOVE,goog.events.EventType.MOUSEMOVE],this.handleMove_,{capture:g,passive:!1}),this.eventHandler_.listen(t,[goog.events.EventType.TOUCHEND,goog.events.EventType.MOUSEUP],this.endDrag,g),this.useSetCapture_?(e.setCapture(!1),this.eventHandler_.listen(e,goog.events.EventType.LOSECAPTURE,this.endDrag)):this.eventHandler_.listen(goog.dom.getWindow(t),goog.events.EventType.BLUR,this.endDrag),goog.userAgent.IE&&this.ieDragStartCancellingOn_&&this.eventHandler_.listen(t,goog.events.EventType.DRAGSTART,goog.events.Event.preventDefault),this.scrollTarget_&&this.eventHandler_.listen(this.scrollTarget_,goog.events.EventType.SCROLL,this.onScroll_,g)},goog.fx.Dragger.prototype.fireDragStart_=function(t){return this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.START,this,t.clientX,t.clientY,t))},goog.fx.Dragger.prototype.cleanUpAfterDragging_=function(){this.eventHandler_.removeAll(),this.useSetCapture_&&this.document_.releaseCapture()},goog.fx.Dragger.prototype.endDrag=function(t,e){if(this.cleanUpAfterDragging_(),this.dragging_){this.dragging_=!1;var g=this.limitX(this.deltaX),o=this.limitY(this.deltaY),i=e||t.type==goog.events.EventType.TOUCHCANCEL;this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.END,this,t.clientX,t.clientY,t,g,o,i))}else this.dispatchEvent(goog.fx.Dragger.EventType.EARLY_CANCEL)},goog.fx.Dragger.prototype.endDragCancel=function(t){this.endDrag(t,!0)},goog.fx.Dragger.prototype.handleMove_=function(t){if(this.enabled_){var e=(this.useRightPositioningForRtl_&&this.isRightToLeft_()?-1:1)*(t.clientX-this.clientX),g=t.clientY-this.clientY;if(this.clientX=t.clientX,this.clientY=t.clientY,this.screenX=t.screenX,this.screenY=t.screenY,!this.dragging_){var o=this.startX-this.clientX,i=this.startY-this.clientY;if(o*o+i*i>this.hysteresisDistanceSquared_){if(!this.fireDragStart_(t))return void(this.isDisposed()||this.endDrag(t));this.dragging_=!0}}var r=this.calculatePosition_(e,g),n=r.x,s=r.y;if(this.dragging_)this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.BEFOREDRAG,this,t.clientX,t.clientY,t,n,s))&&(this.doDrag(t,n,s,!1),t.preventDefault())}},goog.fx.Dragger.prototype.calculatePosition_=function(t,e){var g=goog.dom.getDomHelper(this.document_).getDocumentScroll();t+=g.x-this.pageScroll.x,e+=g.y-this.pageScroll.y,this.pageScroll=g,this.deltaX+=t,this.deltaY+=e;var o=this.limitX(this.deltaX),i=this.limitY(this.deltaY);return new goog.math.Coordinate(o,i)},goog.fx.Dragger.prototype.onScroll_=function(t){var e=this.calculatePosition_(0,0);t.clientX=this.clientX,t.clientY=this.clientY,this.doDrag(t,e.x,e.y,!0)},goog.fx.Dragger.prototype.doDrag=function(t,e,g,o){this.defaultAction(e,g),this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.DRAG,this,t.clientX,t.clientY,t,e,g))},goog.fx.Dragger.prototype.limitX=function(t){var e=this.limits,g=isNaN(e.left)?null:e.left,o=isNaN(e.width)?0:e.width,i=null!=g?g+o:1/0,r=null!=g?g:-1/0;return Math.min(i,Math.max(r,t))},goog.fx.Dragger.prototype.limitY=function(t){var e=this.limits,g=isNaN(e.top)?null:e.top,o=isNaN(e.height)?0:e.height,i=null!=g?g+o:1/0,r=null!=g?g:-1/0;return Math.min(i,Math.max(r,t))},goog.fx.Dragger.prototype.computeInitialPosition=function(){this.deltaX=this.useRightPositioningForRtl_?goog.style.bidi.getOffsetStart(this.target):this.target.offsetLeft,this.deltaY=this.target.offsetTop},goog.fx.Dragger.prototype.defaultAction=function(t,e){this.useRightPositioningForRtl_&&this.isRightToLeft_()?this.target.style.right=t+"px":this.target.style.left=t+"px",this.target.style.top=e+"px"},goog.fx.Dragger.prototype.isDragging=function(){return this.dragging_},goog.fx.DragEvent=function(t,e,g,o,i,r,n,s){goog.events.Event.call(this,t),this.clientX=g,this.clientY=o,this.browserEvent=i,this.left=void 0!==r?r:e.deltaX,this.top=void 0!==n?n:e.deltaY,this.dragger=e,this.dragCanceled=!!s},goog.inherits(goog.fx.DragEvent,goog.events.Event);