goog.provide("goog.fx.DragScrollSupport"),goog.require("goog.Disposable"),goog.require("goog.Timer"),goog.require("goog.dom"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventType"),goog.require("goog.math.Coordinate"),goog.require("goog.style"),goog.fx.DragScrollSupport=function(o,t,r){if(goog.fx.DragScrollSupport.base(this,"constructor"),this.constrainScroll_=!1,this.horizontalScrolling_=!0,this.containerNode_=o,this.scrollTimer_=new goog.Timer(goog.fx.DragScrollSupport.TIMER_STEP_),this.eventHandler_=new goog.events.EventHandler(this),this.scrollDelta_=new goog.math.Coordinate,this.containerBounds_=goog.style.getBounds(o),"BODY"===o.tagName||"HTML"===o.tagName){var e=goog.dom.getViewportSize();this.containerBounds_.height=e.height,this.containerBounds_.width=e.width}this.margin_=t||0,this.scrollBounds_=t?this.constrainBounds_(this.containerBounds_.clone()):this.containerBounds_,this.setupListeners_(!!r)},goog.inherits(goog.fx.DragScrollSupport,goog.Disposable),goog.fx.DragScrollSupport.TIMER_STEP_=50,goog.fx.DragScrollSupport.SCROLL_STEP_=8,goog.fx.DragScrollSupport.MARGIN=32,goog.fx.DragScrollSupport.prototype.setConstrainScroll=function(o){this.constrainScroll_=!!this.margin_&&o},goog.fx.DragScrollSupport.prototype.setHorizontalScrolling=function(o){this.horizontalScrolling_=o},goog.fx.DragScrollSupport.prototype.constrainBounds_=function(o){var t=this.margin_;if(t){var r=.25*o.height,e=Math.min(t,r);o.top+=e,o.height-=2*e;var i=.25*o.width,l=Math.min(t,i);o.left+=l,o.width-=2*l}return o},goog.fx.DragScrollSupport.prototype.setupListeners_=function(o){o||this.eventHandler_.listen(goog.dom.getOwnerDocument(this.containerNode_),goog.events.EventType.MOUSEMOVE,this.onMouseMove),this.eventHandler_.listen(this.scrollTimer_,goog.Timer.TICK,this.onTick_)},goog.fx.DragScrollSupport.prototype.onTick_=function(o){this.containerNode_.scrollTop+=this.scrollDelta_.y,this.containerNode_.scrollLeft+=this.scrollDelta_.x},goog.fx.DragScrollSupport.prototype.onMouseMove=function(o){var t=this.horizontalScrolling_?this.calculateScrollDelta(o.clientX,this.scrollBounds_.left,this.scrollBounds_.width):0,r=this.calculateScrollDelta(o.clientY,this.scrollBounds_.top,this.scrollBounds_.height);this.scrollDelta_.x=t,this.scrollDelta_.y=r,!t&&!r||this.constrainScroll_&&!this.isInContainerBounds_(o.clientX,o.clientY)?this.scrollTimer_.stop():this.scrollTimer_.enabled||this.scrollTimer_.start()},goog.fx.DragScrollSupport.prototype.isInContainerBounds_=function(o,t){var r=this.containerBounds_;return r.left<=o&&r.left+r.width>=o&&r.top<=t&&r.top+r.height>=t},goog.fx.DragScrollSupport.prototype.calculateScrollDelta=function(o,t,r){var e=0;return o<t?e=-goog.fx.DragScrollSupport.SCROLL_STEP_:o>t+r&&(e=goog.fx.DragScrollSupport.SCROLL_STEP_),e},goog.fx.DragScrollSupport.prototype.disposeInternal=function(){goog.fx.DragScrollSupport.superClass_.disposeInternal.call(this),this.eventHandler_.dispose(),this.scrollTimer_.dispose()};