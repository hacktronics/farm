goog.provide("goog.fx.AbstractDragDrop"),goog.provide("goog.fx.AbstractDragDrop.EventType"),goog.provide("goog.fx.DragDropEvent"),goog.provide("goog.fx.DragDropItem"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.classlist"),goog.require("goog.events"),goog.require("goog.events.Event"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventTarget"),goog.require("goog.events.EventType"),goog.require("goog.fx.Dragger"),goog.require("goog.math.Box"),goog.require("goog.math.Coordinate"),goog.require("goog.style"),goog.fx.AbstractDragDrop=function(){goog.fx.AbstractDragDrop.base(this,"constructor"),this.items_=[],this.targets_=[],this.scrollableContainers_=[],this.isSource_=!1,this.isTarget_=!1,this.subtargetFunction_,this.activeSubtarget_,this.dragClass_,this.sourceClass_,this.targetClass_,this.scrollTarget_,this.dummyTarget_,this.initialized_=!1,this.dragEl_,this.targetList_,this.targetBox_,this.activeTarget_,this.dragItem_,this.dragger_},goog.inherits(goog.fx.AbstractDragDrop,goog.events.EventTarget),goog.fx.AbstractDragDrop.DUMMY_TARGET_MIN_SIZE_=10,goog.fx.AbstractDragDrop.EventType={DRAGOVER:"dragover",DRAGOUT:"dragout",DRAG:"drag",DROP:"drop",DRAGSTART:"dragstart",DRAGEND:"dragend"},goog.fx.AbstractDragDrop.initDragDistanceThreshold=5,goog.fx.AbstractDragDrop.prototype.setDragClass=function(t){this.dragClass_=t},goog.fx.AbstractDragDrop.prototype.setSourceClass=function(t){this.sourceClass_=t},goog.fx.AbstractDragDrop.prototype.setTargetClass=function(t){this.targetClass_=t},goog.fx.AbstractDragDrop.prototype.isInitialized=function(){return this.initialized_},goog.fx.AbstractDragDrop.prototype.addItem=goog.abstractMethod,goog.fx.AbstractDragDrop.prototype.addTarget=function(t){this.targets_.push(t),t.isTarget_=!0,this.isSource_=!0},goog.fx.AbstractDragDrop.prototype.removeTarget=function(t){goog.array.remove(this.targets_,t),this.activeTarget_&&this.activeTarget_.target_==t&&(this.activeTarget_=null),this.recalculateDragTargets()},goog.fx.AbstractDragDrop.prototype.setScrollTarget=function(t){this.scrollTarget_=t},goog.fx.AbstractDragDrop.prototype.init=function(){if(!this.initialized_){for(var t,e=0;t=this.items_[e];e++)this.initItem(t);this.initialized_=!0}},goog.fx.AbstractDragDrop.prototype.initItem=function(t){this.isSource_&&(goog.events.listen(t.element,goog.events.EventType.MOUSEDOWN,t.mouseDown_,!1,t),this.sourceClass_&&goog.dom.classlist.add(goog.asserts.assert(t.element),this.sourceClass_)),this.isTarget_&&this.targetClass_&&goog.dom.classlist.add(goog.asserts.assert(t.element),this.targetClass_)},goog.fx.AbstractDragDrop.prototype.disposeItem=function(t){this.isSource_&&(goog.events.unlisten(t.element,goog.events.EventType.MOUSEDOWN,t.mouseDown_,!1,t),this.sourceClass_&&goog.dom.classlist.remove(goog.asserts.assert(t.element),this.sourceClass_)),this.isTarget_&&this.targetClass_&&goog.dom.classlist.remove(goog.asserts.assert(t.element),this.targetClass_),t.dispose()},goog.fx.AbstractDragDrop.prototype.removeItems=function(){for(var t,e=0;t=this.items_[e];e++)this.disposeItem(t);this.items_.length=0},goog.fx.AbstractDragDrop.prototype.maybeStartDrag=function(t,e){e.maybeStartDrag_(t,e.element)},goog.fx.AbstractDragDrop.prototype.startDrag=function(t,e){if(!this.dragItem_){this.dragItem_=e;var o=new goog.fx.DragDropEvent(goog.fx.AbstractDragDrop.EventType.DRAGSTART,this,this.dragItem_,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t);if(0!=this.dispatchEvent(o)){var r=e.getCurrentDragElement();this.dragEl_=this.createDragElement(r);var g=goog.dom.getOwnerDocument(r);g.body.appendChild(this.dragEl_),this.dragger_=this.createDraggerFor(r,this.dragEl_,t),this.dragger_.setScrollTarget(this.scrollTarget_),goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.DRAG,this.moveDrag_,!1,this),goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.END,this.endDrag,!1,this),goog.events.listen(g.body,goog.events.EventType.SELECTSTART,this.suppressSelect_),this.recalculateDragTargets(),this.recalculateScrollableContainers(),this.activeTarget_=null,this.initScrollableContainerListeners_(),this.dragger_.startDrag(t),t.preventDefault()}else this.dragItem_=null}},goog.fx.AbstractDragDrop.prototype.recalculateDragTargets=function(){this.targetList_=[];for(var t,e=0;t=this.targets_[e];e++)for(var o,r=0;o=t.items_[r];r++)this.addDragTarget_(t,o);this.targetBox_||(this.targetBox_=new goog.math.Box(0,0,0,0))},goog.fx.AbstractDragDrop.prototype.recalculateScrollableContainers=function(){var t,e,o,r;for(e=0;t=this.scrollableContainers_[e];e++){t.containedTargets_=[],t.savedScrollLeft_=t.element_.scrollLeft,t.savedScrollTop_=t.element_.scrollTop;var g=goog.style.getPageOffset(t.element_),a=goog.style.getSize(t.element_);t.box_=new goog.math.Box(g.y,g.x+a.width,g.y+a.height,g.x)}for(e=0;r=this.targetList_[e];e++)for(o=0;t=this.scrollableContainers_[o];o++)goog.dom.contains(t.element_,r.element_)&&(t.containedTargets_.push(r),r.scrollableContainer_=t)},goog.fx.AbstractDragDrop.prototype.createDraggerFor=function(t,e,o){var r=this.getDragElementPosition(t,e,o);return e.style.position="absolute",e.style.left=r.x+"px",e.style.top=r.y+"px",new goog.fx.Dragger(e)},goog.fx.AbstractDragDrop.prototype.endDrag=function(t){var e=t.dragCanceled?null:this.activeTarget_;if(e&&e.target_){var o,r=t.clientX,g=t.clientY,a=this.getScrollPos(),s=r+a.x,i=g+a.y;this.subtargetFunction_&&(o=this.subtargetFunction_(e.item_,e.box_,s,i));var n=new goog.fx.DragDropEvent(goog.fx.AbstractDragDrop.EventType.DRAG,this,this.dragItem_,e.target_,e.item_,e.element_,r,g,s,i);this.dispatchEvent(n);var l=new goog.fx.DragDropEvent(goog.fx.AbstractDragDrop.EventType.DROP,this,this.dragItem_,e.target_,e.item_,e.element_,r,g,s,i,o,t.browserEvent);e.target_.dispatchEvent(l)}var h=new goog.fx.DragDropEvent(goog.fx.AbstractDragDrop.EventType.DRAGEND,this,this.dragItem_,e?e.target_:void 0,e?e.item_:void 0,e?e.element_:void 0);this.dispatchEvent(h),goog.events.unlisten(this.dragger_,goog.fx.Dragger.EventType.DRAG,this.moveDrag_,!1,this),goog.events.unlisten(this.dragger_,goog.fx.Dragger.EventType.END,this.endDrag,!1,this);var c=goog.dom.getOwnerDocument(this.dragItem_.getCurrentDragElement());goog.events.unlisten(c.body,goog.events.EventType.SELECTSTART,this.suppressSelect_),this.afterEndDrag(this.activeTarget_?this.activeTarget_.item_:null)},goog.fx.AbstractDragDrop.prototype.afterEndDrag=function(t){this.disposeDrag()},goog.fx.AbstractDragDrop.prototype.disposeDrag=function(){this.disposeScrollableContainerListeners_(),this.dragger_.dispose(),goog.dom.removeNode(this.dragEl_),delete this.dragItem_,delete this.dragEl_,delete this.dragger_,delete this.targetList_,delete this.activeTarget_},goog.fx.AbstractDragDrop.prototype.moveDrag_=function(t){var e,o=this.getEventPosition(t),r=o.x,g=o.y,a=this.activeTarget_;if(this.dispatchEvent(new goog.fx.DragDropEvent(goog.fx.AbstractDragDrop.EventType.DRAG,this,this.dragItem_,a?a.target_:void 0,a?a.item_:void 0,a?a.element_:void 0,t.clientX,t.clientY,r,g)),a){if(this.subtargetFunction_&&a.target_&&(e=this.subtargetFunction_(a.item_,a.box_,r,g)),a.box_.contains(o)&&e==this.activeSubtarget_)return;if(a.target_){var s=new goog.fx.DragDropEvent(goog.fx.AbstractDragDrop.EventType.DRAGOUT,this,this.dragItem_,a.target_,a.item_,a.element_);this.dispatchEvent(s);var i=new goog.fx.DragDropEvent(goog.fx.AbstractDragDrop.EventType.DRAGOUT,this,this.dragItem_,a.target_,a.item_,a.element_,void 0,void 0,void 0,void 0,this.activeSubtarget_);a.target_.dispatchEvent(i)}this.activeSubtarget_=e,this.activeTarget_=null}if(this.targetBox_.contains(o))if((a=this.activeTarget_=this.getTargetFromPosition_(o))&&a.target_){this.subtargetFunction_&&(e=this.subtargetFunction_(a.item_,a.box_,r,g));var n=new goog.fx.DragDropEvent(goog.fx.AbstractDragDrop.EventType.DRAGOVER,this,this.dragItem_,a.target_,a.item_,a.element_);n.subtarget=e,this.dispatchEvent(n);var l=new goog.fx.DragDropEvent(goog.fx.AbstractDragDrop.EventType.DRAGOVER,this,this.dragItem_,a.target_,a.item_,a.element_,t.clientX,t.clientY,void 0,void 0,e);a.target_.dispatchEvent(l)}else a||(this.activeTarget_=this.maybeCreateDummyTargetForPosition_(r,g))},goog.fx.AbstractDragDrop.prototype.suppressSelect_=function(t){return!1},goog.fx.AbstractDragDrop.prototype.initScrollableContainerListeners_=function(){var t,e;for(e=0;t=this.scrollableContainers_[e];e++)goog.events.listen(t.element_,goog.events.EventType.SCROLL,this.containerScrollHandler_,!1,this)},goog.fx.AbstractDragDrop.prototype.disposeScrollableContainerListeners_=function(){for(var t,e=0;t=this.scrollableContainers_[e];e++)goog.events.unlisten(t.element_,"scroll",this.containerScrollHandler_,!1,this),t.containedTargets_=[]},goog.fx.AbstractDragDrop.prototype.addScrollableContainer=function(t){this.scrollableContainers_.push(new goog.fx.ScrollableContainer_(t))},goog.fx.AbstractDragDrop.prototype.removeAllScrollableContainers=function(){this.disposeScrollableContainerListeners_(),this.scrollableContainers_=[]},goog.fx.AbstractDragDrop.prototype.containerScrollHandler_=function(t){for(var e,o=0;e=this.scrollableContainers_[o];o++)if(t.target==e.element_){var r=e.savedScrollTop_-e.element_.scrollTop,g=e.savedScrollLeft_-e.element_.scrollLeft;e.savedScrollTop_=e.element_.scrollTop,e.savedScrollLeft_=e.element_.scrollLeft,this.dummyTarget_&&this.activeTarget_==this.dummyTarget_&&(r>0?this.dummyTarget_.box_.top+=r:this.dummyTarget_.box_.bottom+=r,g>0?this.dummyTarget_.box_.left+=g:this.dummyTarget_.box_.right+=g);for(var a,s=0;a=e.containedTargets_[s];s++){var i=a.box_;i.top+=r,i.left+=g,i.bottom+=r,i.right+=g,this.calculateTargetBox_(i)}}this.dragger_.onScroll_(t)},goog.fx.AbstractDragDrop.prototype.setSubtargetFunction=function(t){this.subtargetFunction_=t},goog.fx.AbstractDragDrop.prototype.createDragElement=function(t){var e=this.createDragElementInternal(t);return goog.asserts.assert(e),this.dragClass_&&goog.dom.classlist.add(e,this.dragClass_),e},goog.fx.AbstractDragDrop.prototype.getDragElementPosition=function(t,e,o){var r=goog.style.getPageOffset(t),g=goog.style.getMarginBox(t);return r.x-=2*(g.left||0),r.y-=2*(g.top||0),r},goog.fx.AbstractDragDrop.prototype.getDragger=function(){return this.dragger_},goog.fx.AbstractDragDrop.prototype.cloneNode_=function(t){return goog.fx.Dragger.cloneNode(t)},goog.fx.AbstractDragDrop.prototype.createDragElementInternal=function(t){return this.cloneNode_(t)},goog.fx.AbstractDragDrop.prototype.addDragTarget_=function(t,e){for(var o=e.getDraggableElements(),r=0;r<o.length;r++){var g=o[r],a=this.getElementBox(e,g);this.targetList_.push(new goog.fx.ActiveDropTarget_(a,t,e,g)),this.calculateTargetBox_(a)}},goog.fx.AbstractDragDrop.prototype.getElementBox=function(t,e){var o=goog.style.getPageOffset(e),r=goog.style.getSize(e);return new goog.math.Box(o.y,o.x+r.width,o.y+r.height,o.x)},goog.fx.AbstractDragDrop.prototype.calculateTargetBox_=function(t){if(1==this.targetList_.length)this.targetBox_=new goog.math.Box(t.top,t.right,t.bottom,t.left);else{var e=this.targetBox_;e.left=Math.min(t.left,e.left),e.right=Math.max(t.right,e.right),e.top=Math.min(t.top,e.top),e.bottom=Math.max(t.bottom,e.bottom)}},goog.fx.AbstractDragDrop.prototype.maybeCreateDummyTargetForPosition_=function(t,e){this.dummyTarget_||(this.dummyTarget_=new goog.fx.ActiveDropTarget_(this.targetBox_.clone()));var o=this.dummyTarget_.box_;o.top=this.targetBox_.top,o.right=this.targetBox_.right,o.bottom=this.targetBox_.bottom,o.left=this.targetBox_.left;for(var r,g=0;r=this.targetList_[g];g++){var a=r.box_;if(r.scrollableContainer_){var s=r.scrollableContainer_.box_;a=new goog.math.Box(Math.max(a.top,s.top),Math.min(a.right,s.right),Math.min(a.bottom,s.bottom),Math.max(a.left,s.left))}var i=null;t>=a.right?i=a.right>o.left?a.right:o.left:t<a.left&&(i=a.left<o.right?a.left:o.right);var n=null;e>=a.bottom?n=a.bottom>o.top?a.bottom:o.top:e<a.top&&(n=a.top<o.bottom?a.top:o.bottom),null!==i&&null!==n&&(Math.abs(i-t)>Math.abs(n-e)?n=null:i=null),null!==i?i<=t?o.left=i:o.right=i:null!==n&&(n<=e?o.top=n:o.bottom=n)}return(o.right-o.left)*(o.bottom-o.top)>=goog.fx.AbstractDragDrop.DUMMY_TARGET_MIN_SIZE_?this.dummyTarget_:null},goog.fx.AbstractDragDrop.prototype.getTargetFromPosition_=function(t){for(var e,o=0;e=this.targetList_[o];o++)if(e.box_.contains(t)){if(!e.scrollableContainer_)return e;if(e.scrollableContainer_.box_.contains(t))return e}return null},goog.fx.AbstractDragDrop.prototype.isInside=function(t,e,o){return t>=o.left&&t<o.right&&e>=o.top&&e<o.bottom},goog.fx.AbstractDragDrop.prototype.getScrollPos=function(){return goog.dom.getDomHelper(this.dragEl_).getDocumentScroll()},goog.fx.AbstractDragDrop.prototype.getEventPosition=function(t){var e=this.getScrollPos();return new goog.math.Coordinate(t.clientX+e.x,t.clientY+e.y)},goog.fx.AbstractDragDrop.prototype.disposeInternal=function(){goog.fx.AbstractDragDrop.base(this,"disposeInternal"),this.removeItems()},goog.fx.DragDropEvent=function(t,e,o,r,g,a,s,i,n,l,h,c){goog.fx.DragDropEvent.base(this,"constructor",t),this.dragSource=e,this.dragSourceItem=o,this.dropTarget=r,this.dropTargetItem=g,this.dropTargetElement=a,this.clientX=s,this.clientY=i,this.viewportX=n,this.viewportY=l,this.subtarget=h,this.browserEvent=c},goog.inherits(goog.fx.DragDropEvent,goog.events.Event),goog.fx.DragDropItem=function(t,e){if(goog.fx.DragDropItem.base(this,"constructor"),this.element=goog.dom.getElement(t),this.data=e,this.parent_=null,this.eventHandler_=new goog.events.EventHandler(this),this.registerDisposable(this.eventHandler_),this.currentDragElement_=null,this.startPosition_,!this.element)throw new Error("Invalid argument")},goog.inherits(goog.fx.DragDropItem,goog.events.EventTarget),goog.fx.DragDropItem.prototype.getData=function(){return this.data},goog.fx.DragDropItem.prototype.getDraggableElement=function(t){return t},goog.fx.DragDropItem.prototype.getCurrentDragElement=function(){return this.currentDragElement_},goog.fx.DragDropItem.prototype.getDraggableElements=function(){return[this.element]},goog.fx.DragDropItem.prototype.mouseDown_=function(t){if(t.isMouseActionButton()){var e=this.getDraggableElement(t.target);e&&this.maybeStartDrag_(t,e)}},goog.fx.DragDropItem.prototype.setParent=function(t){this.parent_=t},goog.fx.DragDropItem.prototype.maybeStartDrag_=function(t,e){var o=goog.events.EventType;this.eventHandler_.listen(e,o.MOUSEMOVE,this.mouseMove_,!1).listen(e,o.MOUSEOUT,this.mouseMove_,!1);var r=goog.dom.getOwnerDocument(e);this.eventHandler_.listen(r,o.MOUSEUP,this.mouseUp_,!0),this.currentDragElement_=e,this.startPosition_=new goog.math.Coordinate(t.clientX,t.clientY)},goog.fx.DragDropItem.prototype.mouseMove_=function(t){var e=Math.abs(t.clientX-this.startPosition_.x)+Math.abs(t.clientY-this.startPosition_.y),o=this.currentDragElement_,r=e>goog.fx.AbstractDragDrop.initDragDistanceThreshold,g=t.type==goog.events.EventType.MOUSEOUT&&t.target==o;(r||g)&&(this.eventHandler_.removeAll(),this.parent_.startDrag(t,this)),t.preventDefault()},goog.fx.DragDropItem.prototype.mouseUp_=function(t){this.eventHandler_.removeAll(),delete this.startPosition_,this.currentDragElement_=null},goog.fx.ActiveDropTarget_=function(t,e,o,r){this.box_=t,this.target_=e,this.item_=o,this.element_=r||null,this.scrollableContainer_=null},goog.fx.ScrollableContainer_=function(t){this.containedTargets_=[],this.element_=t,this.savedScrollLeft_=0,this.savedScrollTop_=0,this.box_=null},goog.fx.AbstractDragDrop.TEST_ONLY={ActiveDropTarget:goog.fx.ActiveDropTarget_};