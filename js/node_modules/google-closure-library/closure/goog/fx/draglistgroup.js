goog.provide("goog.fx.DragListDirection"),goog.provide("goog.fx.DragListGroup"),goog.provide("goog.fx.DragListGroup.EventType"),goog.provide("goog.fx.DragListGroupEvent"),goog.provide("goog.fx.DragListPermission"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.classlist"),goog.require("goog.events"),goog.require("goog.events.Event"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventId"),goog.require("goog.events.EventTarget"),goog.require("goog.events.EventType"),goog.require("goog.fx.Dragger"),goog.require("goog.math.Coordinate"),goog.require("goog.string"),goog.require("goog.style"),goog.fx.DragListGroup=function(){goog.fx.DragListGroup.base(this,"constructor"),this.dragItemHoverClasses_,this.dragItemHandleHoverClasses_,this.currDragItemClasses_,this.draggerElClasses_,this.currDragItem_,this.currHoverList_,this.origList_,this.origNextItem_,this.currHoverItem_,this.draggerEl_,this.dragger_,this.hysteresisDistance_=0,this.dragLists_=[],this.dragItems_=[],this.dragItemForHandle_={},this.eventHandler_=new goog.events.EventHandler(this),this.isInitialized_=!1,this.isCurrDragItemAlwaysDisplayed_=!1,this.updateWhileDragging_=!0},goog.inherits(goog.fx.DragListGroup,goog.events.EventTarget),goog.fx.DragListDirection={DOWN:0,RIGHT:2,LEFT:3,RIGHT_2D:4,LEFT_2D:5},goog.fx.DragListPermission={DRAG_OUT_AND_DROP:0,ONLY_DRAG_OUT:1,ONLY_DROP:2},goog.fx.DragListGroup.EventType={DRAGGERCREATED:new goog.events.EventId(goog.events.getUniqueId("draggercreated")),BEFOREDRAGSTART:new goog.events.EventId("beforedragstart"),DRAGSTART:new goog.events.EventId("dragstart"),BEFOREDRAGMOVE:new goog.events.EventId("beforedragmove"),DRAGMOVE:new goog.events.EventId("dragmove"),BEFOREDRAGEND:new goog.events.EventId("beforedragend"),DRAGEND:new goog.events.EventId("dragend"),DRAGGERREMOVED:new goog.events.EventId(goog.events.getUniqueId("draggerremoved"))},goog.fx.DragListGroup.prototype.setIsCurrDragItemAlwaysDisplayed=function(){this.isCurrDragItemAlwaysDisplayed_=!0},goog.fx.DragListGroup.prototype.setNoUpdateWhileDragging=function(){this.updateWhileDragging_=!1},goog.fx.DragListGroup.prototype.setHysteresis=function(t){this.hysteresisDistance_=t},goog.fx.DragListGroup.prototype.getHysteresis=function(){return this.hysteresisDistance_},goog.fx.DragListGroup.prototype.isDragging=function(){return!!this.dragger_},goog.fx.DragListGroup.prototype.addDragList=function(t,r,e,g,s){goog.asserts.assert(!this.isInitialized_),t.dlgGrowthDirection_=r,t.dlgDragHoverClass_=g,t.dlgDragPermission=s||goog.fx.DragListPermission.DRAG_OUT_AND_DROP,this.dragLists_.push(t)},goog.fx.DragListGroup.prototype.setFunctionToGetHandleForDragItem=function(t){goog.asserts.assert(!this.isInitialized_),this.getHandleForDragItem_=t},goog.fx.DragListGroup.prototype.setDragItemHoverClass=function(t){goog.asserts.assert(!this.isInitialized_),this.dragItemHoverClasses_=goog.array.slice(arguments,0)},goog.fx.DragListGroup.prototype.setDragItemHandleHoverClass=function(t){goog.asserts.assert(!this.isInitialized_),this.dragItemHandleHoverClasses_=goog.array.slice(arguments,0)},goog.fx.DragListGroup.prototype.setCurrDragItemClass=function(t){goog.asserts.assert(!this.isInitialized_),this.currDragItemClasses_=goog.array.slice(arguments,0)},goog.fx.DragListGroup.prototype.setDraggerElClass=function(t){goog.asserts.assert(!this.isInitialized_),this.draggerElClasses_=goog.string.trim(t).split(" ")},goog.fx.DragListGroup.prototype.init=function(){if(!this.isInitialized_){for(var t=0,r=this.dragLists_.length;t<r;t++)for(var e=this.dragLists_[t],g=goog.dom.getChildren(e),s=0,o=g.length;s<o;++s)this.listenForDragEvents(g[s]);this.isInitialized_=!0}},goog.fx.DragListGroup.prototype.addItemToDragList=function(t,r,e){void 0!==e?goog.dom.insertChildAt(t,r,e):goog.dom.appendChild(t,r),this.listenForDragEvents(r)},goog.fx.DragListGroup.prototype.disposeInternal=function(){this.eventHandler_.dispose();for(var t=0,r=this.dragLists_.length;t<r;t++){var e=this.dragLists_[t];e.dlgGrowthDirection_=void 0,e.dlgDragHoverClass_=void 0}this.dragLists_.length=0,this.dragItems_.length=0,this.dragItemForHandle_=null,this.cleanupDragDom_(),goog.fx.DragListGroup.superClass_.disposeInternal.call(this)},goog.fx.DragListGroup.prototype.recacheListAndItemBounds=function(){this.recacheListAndItemBounds_(this.currDragItem_)},goog.fx.DragListGroup.prototype.recacheListAndItemBounds_=function(t){for(var r=0,e=this.dragLists_.length;r<e;r++){var g=this.dragLists_[r];g.dlgBounds_=goog.style.getBounds(g)}for(r=0,e=this.dragItems_.length;r<e;r++){var s=this.dragItems_[r];s!=t&&(s.dlgBounds_=goog.style.getBounds(s))}},goog.fx.DragListGroup.prototype.listenForDragEvents=function(t){var r=this.getHandleForDragItem_(t),e=goog.getUid(r);this.dragItemForHandle_[e]=t,this.dragItemHoverClasses_&&(this.eventHandler_.listen(t,goog.events.EventType.MOUSEOVER,this.handleDragItemMouseover_),this.eventHandler_.listen(t,goog.events.EventType.MOUSEOUT,this.handleDragItemMouseout_)),this.dragItemHandleHoverClasses_&&(this.eventHandler_.listen(r,goog.events.EventType.MOUSEOVER,this.handleDragItemHandleMouseover_),this.eventHandler_.listen(r,goog.events.EventType.MOUSEOUT,this.handleDragItemHandleMouseout_)),this.dragItems_.push(t),this.eventHandler_.listen(r,[goog.events.EventType.MOUSEDOWN,goog.events.EventType.TOUCHSTART],this.handlePotentialDragStart_)},goog.fx.DragListGroup.prototype.handlePotentialDragStart_=function(t){var r=goog.getUid(t.currentTarget),e=this.dragItemForHandle_[r];if(e.parentElement.dlgDragPermission!=goog.fx.DragListPermission.ONLY_DROP){this.currDragItem_=e,this.draggerEl_=this.createDragElementInternal(this.currDragItem_),this.draggerElClasses_&&goog.dom.classlist.addAll(goog.asserts.assert(this.draggerEl_),this.draggerElClasses_||[]),this.draggerEl_.style.margin="0",this.draggerEl_.style.position="absolute",this.draggerEl_.style.visibility="hidden",goog.dom.getOwnerDocument(this.currDragItem_).body.appendChild(this.draggerEl_);var g=goog.style.getPageOffset(this.currDragItem_);goog.style.setPageOffset(this.draggerEl_,g),this.dragger_=new goog.fx.Dragger(this.draggerEl_),this.dragger_.setHysteresis(this.hysteresisDistance_),goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.START,this.handleDragStart_,!1,this),goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.END,this.handleDragEnd_,!1,this),goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.EARLY_CANCEL,this.cleanup_,!1,this),this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.DRAGGERCREATED,this,t,this.currDragItem_,this.draggerEl_,this.dragger_)),this.dragger_.startDrag(t)}},goog.fx.DragListGroup.prototype.cloneNode_=function(t){return goog.fx.Dragger.cloneNode(t)},goog.fx.DragListGroup.prototype.createDragElementInternal=function(t){return this.cloneNode_(t)},goog.fx.DragListGroup.prototype.handleDragStart_=function(t){if(!this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.BEFOREDRAGSTART,this,t.browserEvent,this.currDragItem_,null,null)))return t.preventDefault(),void this.cleanup_();this.origList_=this.currDragItem_.parentNode,this.origNextItem_=goog.dom.getNextElementSibling(this.currDragItem_),this.currHoverItem_=this.origNextItem_,this.currHoverList_=this.origList_,this.currDragItemClasses_?goog.dom.classlist.addAll(goog.asserts.assert(this.currDragItem_),this.currDragItemClasses_||[]):this.currDragItem_.style.visibility="hidden";var r=goog.style.getSize(this.draggerEl_);this.draggerEl_.halfWidth=r.width/2,this.draggerEl_.halfHeight=r.height/2,this.draggerEl_.style.visibility="",this.updateWhileDragging_&&(this.currDragItem_.style.display="none"),this.recacheListAndItemBounds_(this.currDragItem_),this.currDragItem_.style.display="",goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.DRAG,this.handleDragMove_,!1,this),this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.DRAGSTART,this,t.browserEvent,this.currDragItem_,this.draggerEl_,this.dragger_))},goog.fx.DragListGroup.prototype.handleDragMove_=function(t){var r=goog.style.getPageOffset(this.draggerEl_),e=new goog.math.Coordinate(r.x+this.draggerEl_.halfWidth,r.y+this.draggerEl_.halfHeight),g=this.getHoverDragList_(e),s=g?this.getHoverNextItem_(g,e):null;if(!this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.BEFOREDRAGMOVE,this,t,this.currDragItem_,this.draggerEl_,this.dragger_,e,g,s)))return!1;if(g&&g.dlgDragPermission!=goog.fx.DragListPermission.ONLY_DRAG_OUT)this.updateWhileDragging_?this.insertCurrDragItem_(g,s):this.updateCurrHoverItem(s,e),this.currDragItem_.style.display="",g.dlgDragHoverClass_&&goog.dom.classlist.add(goog.asserts.assert(g),g.dlgDragHoverClass_);else{this.isCurrDragItemAlwaysDisplayed_||(this.currDragItem_.style.display="none");for(var o=0,i=this.dragLists_.length;o<i;o++){var a=this.dragLists_[o];a.dlgDragHoverClass_&&goog.dom.classlist.remove(goog.asserts.assert(a),a.dlgDragHoverClass_)}}return g!=this.currHoverList_&&(this.currHoverList_=g,this.recacheListAndItemBounds_(this.currDragItem_)),this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.DRAGMOVE,this,t,this.currDragItem_,this.draggerEl_,this.dragger_,e,g,s)),!1},goog.fx.DragListGroup.prototype.cleanup_=function(t){this.cleanupDragDom_(),this.currDragItem_=null,this.currHoverList_=null,this.origList_=null,this.origNextItem_=null,this.draggerEl_=null,this.dragger_=null;for(var r=0,e=this.dragLists_.length;r<e;r++)this.dragLists_[r].dlgBounds_=null;for(r=0,e=this.dragItems_.length;r<e;r++)this.dragItems_[r].dlgBounds_=null},goog.fx.DragListGroup.prototype.handleDragEnd_=function(t){return!!this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.BEFOREDRAGEND,this,t,this.currDragItem_,this.draggerEl_,this.dragger_))&&(this.updateWhileDragging_||this.insertCurrHoverItem(),this.cleanupDragDom_(),this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.DRAGEND,this,t,this.currDragItem_,this.draggerEl_,this.dragger_)),this.cleanup_(),!0)},goog.fx.DragListGroup.prototype.cleanupDragDom_=function(){goog.dispose(this.dragger_);var t=this.draggerEl_&&this.draggerEl_.parentElement;this.draggerEl_&&goog.dom.removeNode(this.draggerEl_),this.currDragItem_&&"none"==this.currDragItem_.style.display&&(this.origList_.insertBefore(this.currDragItem_,this.origNextItem_),this.currDragItem_.style.display=""),this.currDragItemClasses_&&this.currDragItem_?goog.dom.classlist.removeAll(goog.asserts.assert(this.currDragItem_),this.currDragItemClasses_||[]):this.currDragItem_&&(this.currDragItem_.style.visibility="");for(var r=0,e=this.dragLists_.length;r<e;r++){var g=this.dragLists_[r];g.dlgDragHoverClass_&&goog.dom.classlist.remove(goog.asserts.assert(g),g.dlgDragHoverClass_)}t&&this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.DRAGGERREMOVED,this,null,this.currDragItem_,this.draggerEl_,this.dragger_))},goog.fx.DragListGroup.prototype.getHandleForDragItem_=function(t){return t},goog.fx.DragListGroup.prototype.handleDragItemMouseover_=function(t){var r=goog.asserts.assertElement(t.currentTarget);goog.dom.classlist.addAll(r,this.dragItemHoverClasses_||[])},goog.fx.DragListGroup.prototype.handleDragItemMouseout_=function(t){var r=goog.asserts.assertElement(t.currentTarget);goog.dom.classlist.removeAll(r,this.dragItemHoverClasses_||[])},goog.fx.DragListGroup.prototype.handleDragItemHandleMouseover_=function(t){var r=goog.asserts.assertElement(t.currentTarget);goog.dom.classlist.addAll(r,this.dragItemHandleHoverClasses_||[])},goog.fx.DragListGroup.prototype.handleDragItemHandleMouseout_=function(t){var r=goog.asserts.assertElement(t.currentTarget);goog.dom.classlist.removeAll(r,this.dragItemHandleHoverClasses_||[])},goog.fx.DragListGroup.prototype.getHoverDragList_=function(t){var r=null;if("none"!=this.currDragItem_.style.display){r=this.currDragItem_.parentNode;var e=goog.style.getBounds(r);if(this.isInRect_(t,e))return r}for(var g=0,s=this.dragLists_.length;g<s;g++){var o=this.dragLists_[g];if(o!=r&&this.isInRect_(t,o.dlgBounds_))return o}return null},goog.fx.DragListGroup.prototype.isInRect_=function(t,r){return t.x>r.left&&t.x<r.left+r.width&&t.y>r.top&&t.y<r.top+r.height},goog.fx.DragListGroup.prototype.updateCurrHoverItem=function(t,r){t&&(this.currHoverItem_=t)},goog.fx.DragListGroup.prototype.insertCurrHoverItem=function(){this.origList_.insertBefore(this.currDragItem_,this.currHoverItem_)},goog.fx.DragListGroup.prototype.getHoverNextItem_=function(t,r){if(null==t)throw new Error("getHoverNextItem_ called with null hoverList.");var e,g,s=0,o=!1,i=void 0;switch(t.dlgGrowthDirection_){case goog.fx.DragListDirection.DOWN:s=r.y,e=goog.fx.DragListGroup.getBottomBound_,g=goog.fx.DragListGroup.isLessThan_;break;case goog.fx.DragListDirection.RIGHT_2D:o=!0;case goog.fx.DragListDirection.RIGHT:s=r.x,e=goog.fx.DragListGroup.getRightBound_,g=goog.fx.DragListGroup.isLessThan_;break;case goog.fx.DragListDirection.LEFT_2D:o=!0;case goog.fx.DragListDirection.LEFT:s=r.x,e=goog.fx.DragListGroup.getLeftBound_,g=goog.fx.DragListGroup.isGreaterThan_}for(var a,n=null,l=goog.dom.getChildren(t),h=0,d=l.length;h<d;h++){var u=l[h];if(u!=this.currDragItem_){var _=e(u.dlgBounds_);if(o){var D=goog.fx.DragListGroup.verticalDistanceFromItem_(u,r);void 0===i&&(i=D),g(s,_)&&(null==a||D<i||D==i&&(g(_,a)||_==a))&&(n=u,a=_),D<i&&(i=D)}else g(s,_)&&(null==a||g(_,a))&&(n=u,a=_)}}return null!==n&&goog.fx.DragListGroup.verticalDistanceFromItem_(n,r)>i?null:n},goog.fx.DragListGroup.verticalDistanceFromItem_=function(t,r){var e=t.dlgBounds_,g=e.top+(e.height-1)/2;return Math.abs(r.y-g)},goog.fx.DragListGroup.getBottomBound_=function(t){return t.top+t.height-1},goog.fx.DragListGroup.getRightBound_=function(t){return t.left+t.width-1},goog.fx.DragListGroup.getLeftBound_=function(t){return t.left||0},goog.fx.DragListGroup.isLessThan_=function(t,r){return t<r},goog.fx.DragListGroup.isGreaterThan_=function(t,r){return t>r},goog.fx.DragListGroup.prototype.insertCurrDragItem_=function(t,r){this.currDragItem_.parentNode==t&&goog.dom.getNextElementSibling(this.currDragItem_)==r||t.insertBefore(this.currDragItem_,r)},goog.fx.DragListGroupEvent=function(t,r,e,g,s,o,i,a,n){goog.events.Event.call(this,t),this.dragListGroup=r,this.event=e,this.currDragItem=g,this.draggerEl=s,this.dragger=o,this.draggerElCenter=i,this.hoverList=a,this.hoverNextItem=n},goog.inherits(goog.fx.DragListGroupEvent,goog.events.Event);