goog.provide("goog.debug.ErrorHandler"),goog.provide("goog.debug.ErrorHandler.ProtectedFunctionError"),goog.require("goog.Disposable"),goog.require("goog.asserts"),goog.require("goog.debug"),goog.require("goog.debug.EntryPointMonitor"),goog.require("goog.debug.Error"),goog.require("goog.debug.Trace"),goog.debug.ErrorHandler=function(r){goog.debug.ErrorHandler.base(this,"constructor"),this.errorHandlerFn_=r,this.wrapErrors_=!0,this.prefixErrorMessages_=!1},goog.inherits(goog.debug.ErrorHandler,goog.Disposable),goog.debug.ErrorHandler.prototype.addTracersToProtectedFunctions_=!1,goog.debug.ErrorHandler.prototype.setAddTracersToProtectedFunctions=function(r){this.addTracersToProtectedFunctions_=r},goog.debug.ErrorHandler.prototype.wrap=function(r){return this.protectEntryPoint(goog.asserts.assertFunction(r))},goog.debug.ErrorHandler.prototype.unwrap=function(r){return goog.asserts.assertFunction(r),r[this.getFunctionIndex_(!1)]||r},goog.debug.ErrorHandler.prototype.getStackTraceHolder_=function(r){var o=[];return o.push("##PE_STACK_START##"),o.push(r.replace(/(\r\n|\r|\n)/g,"##STACK_BR##")),o.push("##PE_STACK_END##"),o.join("")},goog.debug.ErrorHandler.prototype.getFunctionIndex_=function(r){return(r?"__wrapper_":"__protected_")+goog.getUid(this)+"__"},goog.debug.ErrorHandler.prototype.protectEntryPoint=function(r){var o=this.getFunctionIndex_(!0);r[o]||((r[o]=this.getProtectedFunction(r))[this.getFunctionIndex_(!1)]=r);return r[o]},goog.debug.ErrorHandler.prototype.getProtectedFunction=function(r){var o=this,e=this.addTracersToProtectedFunctions_;if(e)var t=goog.debug.getStacktraceSimple(15);var n=function(){if(o.isDisposed())return r.apply(this,arguments);if(e)var n=goog.debug.Trace.startTracer("protectedEntryPoint: "+o.getStackTraceHolder_(t));try{return r.apply(this,arguments)}catch(r){o.handleError_(r)}finally{e&&goog.debug.Trace.stopTracer(n)}};return n[this.getFunctionIndex_(!1)]=r,n},goog.debug.ErrorHandler.prototype.handleError_=function(r){var o=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX;if(!(r&&"object"==typeof r&&"string"==typeof r.message&&0==r.message.indexOf(o)||"string"==typeof r&&0==r.indexOf(o))){if(this.errorHandlerFn_(r),!this.wrapErrors_)throw this.prefixErrorMessages_&&("object"==typeof r&&r&&"string"==typeof r.message?r.message=o+r.message:r=o+r),goog.DEBUG&&r&&"string"==typeof r.stack&&Error.captureStackTrace&&goog.global.console&&goog.global.console.error(r.message,r.stack),r;throw new goog.debug.ErrorHandler.ProtectedFunctionError(r)}},goog.debug.ErrorHandler.prototype.protectWindowSetTimeout=function(){this.protectWindowFunctionsHelper_("setTimeout")},goog.debug.ErrorHandler.prototype.protectWindowSetInterval=function(){this.protectWindowFunctionsHelper_("setInterval")},goog.debug.ErrorHandler.prototype.catchUnhandledRejections=function(){"onunhandledrejection"in goog.global&&(goog.global.onunhandledrejection=r=>{const o=r&&r.reason?r.reason:new Error("uncaught error");this.handleError_(o)})},goog.debug.ErrorHandler.prototype.protectWindowRequestAnimationFrame=function(){for(var r=goog.getObjectByName("window"),o=["requestAnimationFrame","mozRequestAnimationFrame","webkitAnimationFrame","msRequestAnimationFrame"],e=0;e<o.length;e++){var t=o[e];o[e]in r&&this.protectWindowFunctionsHelper_(t)}},goog.debug.ErrorHandler.prototype.protectWindowFunctionsHelper_=function(r){var o=goog.getObjectByName("window"),e=o[r],t=this;o[r]=function(r,o){if("string"==typeof r&&(r=goog.partial(goog.globalEval,r)),arguments[0]=r=t.protectEntryPoint(r),e.apply)return e.apply(this,arguments);var n=r;if(arguments.length>2){var g=Array.prototype.slice.call(arguments,2);n=function(){r.apply(this,g)}}return e(n,o)},o[r][this.getFunctionIndex_(!1)]=e},goog.debug.ErrorHandler.prototype.setWrapErrors=function(r){this.wrapErrors_=r},goog.debug.ErrorHandler.prototype.setPrefixErrorMessages=function(r){this.prefixErrorMessages_=r},goog.debug.ErrorHandler.prototype.disposeInternal=function(){var r=goog.getObjectByName("window");r.setTimeout=this.unwrap(r.setTimeout),r.setInterval=this.unwrap(r.setInterval),goog.debug.ErrorHandler.base(this,"disposeInternal")},goog.debug.ErrorHandler.ProtectedFunctionError=function(r){var o=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+(r&&r.message?String(r.message):String(r));goog.debug.ErrorHandler.ProtectedFunctionError.base(this,"constructor",o),this.cause=r;var e=r&&r.stack;e&&"string"==typeof e&&(this.stack=e)},goog.inherits(goog.debug.ErrorHandler.ProtectedFunctionError,goog.debug.Error),goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX="Error in protected function: ";