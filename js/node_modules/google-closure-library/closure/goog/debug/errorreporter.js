goog.provide("goog.debug.ErrorReporter"),goog.provide("goog.debug.ErrorReporter.ExceptionEvent"),goog.require("goog.asserts"),goog.require("goog.debug"),goog.require("goog.debug.Error"),goog.require("goog.debug.ErrorHandler"),goog.require("goog.debug.entryPointRegistry"),goog.require("goog.debug.errorcontext"),goog.require("goog.events"),goog.require("goog.events.Event"),goog.require("goog.events.EventTarget"),goog.require("goog.log"),goog.require("goog.net.XhrIo"),goog.require("goog.object"),goog.require("goog.string"),goog.require("goog.uri.utils"),goog.require("goog.userAgent"),goog.debug.ErrorReporter=function(r,o,e){goog.debug.ErrorReporter.base(this,"constructor"),this.contextProvider_=o||null,this.contextPrefix_="context.",this.truncationLimit_=null,this.additionalArguments_={},this.xhrSender_=goog.debug.ErrorReporter.defaultXhrSender,this.handlerUrl_=r,goog.debug.ErrorReporter.ALLOW_AUTO_PROTECT?e||(this.errorHandler_=null,this.setup_()):e||goog.asserts.fail("opt_noAutoProtect cannot be false while goog.debug.ErrorReporter.ALLOW_AUTO_PROTECT is false.  Setting ALLOW_AUTO_PROTECT to false removes the necessary auto-protect code in compiled/optimized mode.")},goog.inherits(goog.debug.ErrorReporter,goog.events.EventTarget),goog.debug.ErrorReporter.ALLOW_AUTO_PROTECT=goog.define("goog.debug.ErrorReporter.ALLOW_AUTO_PROTECT",!0),goog.debug.ErrorReporter.ExceptionEvent=function(r,o){goog.events.Event.call(this,goog.debug.ErrorReporter.ExceptionEvent.TYPE),this.error=r,this.context=o},goog.inherits(goog.debug.ErrorReporter.ExceptionEvent,goog.events.Event),goog.debug.ErrorReporter.ExceptionEvent.TYPE=goog.events.getUniqueId("exception"),goog.debug.ErrorReporter.prototype.extraHeaders_,goog.debug.ErrorReporter.logger_=goog.log.getLogger("goog.debug.ErrorReporter"),goog.debug.ErrorReporter.install=function(r,o,e){return new goog.debug.ErrorReporter(r,o,e)},goog.debug.ErrorReporter.defaultXhrSender=function(r,o,e,t){goog.net.XhrIo.send(r,null,o,e,t)},goog.debug.ErrorReporter.prototype.protectAdditionalEntryPoint=goog.debug.ErrorReporter.ALLOW_AUTO_PROTECT?function(r){return this.errorHandler_?this.errorHandler_.protectEntryPoint(r):null}:function(r){return goog.asserts.fail("Cannot call protectAdditionalEntryPoint while ALLOW_AUTO_PROTECT is false.  If ALLOW_AUTO_PROTECT is false, the necessary auto-protect code in compiled/optimized mode is removed."),null},goog.debug.ErrorReporter.ALLOW_AUTO_PROTECT&&(goog.debug.ErrorReporter.prototype.setup_=function(){goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("10")?goog.debug.catchErrors(goog.bind(this.handleException,this),!1,null):(this.errorHandler_=new goog.debug.ErrorHandler(goog.bind(this.handleException,this)),this.errorHandler_.protectWindowSetTimeout(),this.errorHandler_.protectWindowSetInterval(),this.errorHandler_.protectWindowRequestAnimationFrame(),goog.debug.entryPointRegistry.monitorAll(this.errorHandler_))}),goog.debug.ErrorReporter.prototype.setLoggingHeaders=function(r){this.extraHeaders_=r},goog.debug.ErrorReporter.prototype.setXhrSender=function(r){this.xhrSender_=r},goog.debug.ErrorReporter.prototype.handleException=function(r,o){r=r.error||r;var e=o?goog.object.clone(o):{};r instanceof Error&&goog.object.extend(e,goog.debug.errorcontext.getErrorContext(r));var t=goog.debug.normalizeErrorObject(r);if(this.contextProvider_)try{this.contextProvider_(t,e)}catch(r){goog.log.error(goog.debug.ErrorReporter.logger_,"Context provider threw an exception: "+r.message)}var g=t.message.substring(0,1900);r instanceof goog.debug.Error&&!r.reportErrorToServer||this.sendErrorReport(g,t.fileName,t.lineNumber,t.stack,e);try{this.dispatchEvent(new goog.debug.ErrorReporter.ExceptionEvent(t,e))}catch(r){}},goog.debug.ErrorReporter.prototype.sendErrorReport=function(r,o,e,t,g){try{var n=goog.uri.utils.appendParams(this.handlerUrl_,"script",o,"error",r,"line",e);goog.object.isEmpty(this.additionalArguments_)||(n=goog.uri.utils.appendParamsFromMap(n,this.additionalArguments_));var i={};if(i.trace=t,g)for(var s in g)i[this.contextPrefix_+s]=g[s];var u=goog.uri.utils.buildQueryDataFromMap(i);"number"==typeof this.truncationLimit_&&(u=u.substring(0,this.truncationLimit_)),this.xhrSender_(n,"POST",u,this.extraHeaders_)}catch(g){var d=goog.string.buildString("Error occurred in sending an error report.\n\n","script:",o,"\n","line:",e,"\n","error:",r,"\n","trace:",t);goog.log.info(goog.debug.ErrorReporter.logger_,d)}},goog.debug.ErrorReporter.prototype.setContextPrefix=function(r){this.contextPrefix_=r},goog.debug.ErrorReporter.prototype.setTruncationLimit=function(r){goog.asserts.assert("number"!=typeof r||r>=0,"Body limit must be valid number >= 0 or null"),this.truncationLimit_=r},goog.debug.ErrorReporter.prototype.setAdditionalArguments=function(r){this.additionalArguments_=r},goog.debug.ErrorReporter.prototype.disposeInternal=function(){goog.debug.ErrorReporter.ALLOW_AUTO_PROTECT&&goog.dispose(this.errorHandler_),goog.debug.ErrorReporter.base(this,"disposeInternal")};