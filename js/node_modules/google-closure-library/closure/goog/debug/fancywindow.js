goog.provide("goog.debug.FancyWindow"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.debug.DebugWindow"),goog.require("goog.debug.LogManager"),goog.require("goog.debug.Logger"),goog.require("goog.dom.DomHelper"),goog.require("goog.dom.TagName"),goog.require("goog.dom.safe"),goog.require("goog.html.SafeHtml"),goog.require("goog.html.SafeStyleSheet"),goog.require("goog.object"),goog.require("goog.string"),goog.require("goog.string.Const"),goog.require("goog.userAgent"),goog.debug.FancyWindow=function(o,e){this.readOptionsFromLocalStorage_(),goog.debug.FancyWindow.base(this,"constructor",o,e),this.dh_=null},goog.inherits(goog.debug.FancyWindow,goog.debug.DebugWindow),goog.debug.FancyWindow.HAS_LOCAL_STORE=function(){try{return!!window.localStorage.getItem}catch(o){}return!1}(),goog.debug.FancyWindow.LOCAL_STORE_PREFIX="fancywindow.sel.",goog.debug.FancyWindow.prototype.writeBufferToLog=function(){if(this.lastCall=goog.now(),this.hasActiveWindow()){for(var o=this.dh_.getElement("log"),e=o.scrollHeight-(o.scrollTop+o.offsetHeight)<=100,t=0;t<this.outputBuffer.length;t++){var g=this.dh_.createDom(goog.dom.TagName.DIV,"logmsg");goog.dom.safe.setInnerHtml(g,this.outputBuffer[t]),o.appendChild(g)}this.outputBuffer.length=0,this.resizeStuff_(),e&&(o.scrollTop=o.scrollHeight)}},goog.debug.FancyWindow.prototype.writeInitialDocument=function(){if(this.hasActiveWindow()){var o=this.win.document;o.open(),goog.dom.safe.documentWrite(o,this.getHtml_()),o.close(),(goog.userAgent.IE?o.body:this.win).onresize=goog.bind(this.resizeStuff_,this),this.dh_=new goog.dom.DomHelper(o),this.dh_.getElement("openbutton").onclick=goog.bind(this.openOptions_,this),this.dh_.getElement("closebutton").onclick=goog.bind(this.closeOptions_,this),this.dh_.getElement("clearbutton").onclick=goog.bind(this.clear,this),this.dh_.getElement("exitbutton").onclick=goog.bind(this.exit_,this),this.writeSavedMessages()}},goog.debug.FancyWindow.prototype.openOptions_=function(){var o=goog.asserts.assert(this.dh_.getElement("optionsarea"));goog.dom.safe.setInnerHtml(o,goog.html.SafeHtml.EMPTY);for(var e=goog.debug.FancyWindow.getLoggers_(),t=this.dh_,g=0;g<e.length;g++){var n=e[g],i=n.getLevel()?n.getLevel().name:"INHERIT",r=t.createDom(goog.dom.TagName.DIV,{},this.getDropDown_("sel"+n.getName(),i),t.createDom(goog.dom.TagName.SPAN,{},n.getName()||"(root)"));o.appendChild(r)}return this.dh_.getElement("options").style.display="block",!1},goog.debug.FancyWindow.prototype.getDropDown_=function(o,e){for(var t=this.dh_,g=t.createDom(goog.dom.TagName.SELECT,{id:o}),n=goog.debug.Logger.Level.PREDEFINED_LEVELS,i=0;i<n.length;i++){var r=n[i],a=t.createDom(goog.dom.TagName.OPTION,{},r.name);e==r.name&&(a.selected=!0),g.appendChild(a)}return g.appendChild(t.createDom(goog.dom.TagName.OPTION,{selected:"INHERIT"==e},"INHERIT")),g},goog.debug.FancyWindow.prototype.closeOptions_=function(){this.dh_.getElement("options").style.display="none";for(var o=goog.debug.FancyWindow.getLoggers_(),e=this.dh_,t=0;t<o.length;t++){var g=o[t],n=e.getElement("sel"+g.getName()),i=n.options[n.selectedIndex].text;"INHERIT"==i?g.setLevel(null):g.setLevel(goog.debug.Logger.Level.getPredefinedLevel(i))}return this.writeOptionsToLocalStorage_(),!1},goog.debug.FancyWindow.prototype.resizeStuff_=function(){var o=this.dh_,e=o.getElement("log"),t=o.getElement("head");e.style.top=t.offsetHeight+"px",e.style.height=o.getDocument().body.offsetHeight-t.offsetHeight-(goog.userAgent.IE?4:0)+"px"},goog.debug.FancyWindow.prototype.exit_=function(o){this.setEnabled(!1),this.win&&this.win.close()},goog.debug.FancyWindow.prototype.getStyleRules=function(){var o=goog.debug.FancyWindow.base(this,"getStyleRules"),e=goog.html.SafeStyleSheet.fromConstant(goog.string.Const.from("html,body{height:100%;width:100%;margin:0px;padding:0px;background-color:#FFF;overflow:hidden}*{}.logmsg{border-bottom:1px solid #CCC;padding:2px;font:90% monospace}#head{position:absolute;width:100%;font:x-small arial;border-bottom:2px solid #999;background-color:#EEE;}#head p{margin:0px 5px;}#log{position:absolute;width:100%;background-color:#FFF;}#options{position:absolute;right:0px;width:50%;height:100%;border-left:1px solid #999;background-color:#DDD;display:none;padding-left: 5px;font:normal small arial;overflow:auto;}#openbutton,#closebutton{text-decoration:underline;color:#00F;cursor:pointer;position:absolute;top:0px;right:5px;font:x-small arial;}#clearbutton{text-decoration:underline;color:#00F;cursor:pointer;position:absolute;top:0px;right:80px;font:x-small arial;}#exitbutton{text-decoration:underline;color:#00F;cursor:pointer;position:absolute;top:0px;right:50px;font:x-small arial;}select{font:x-small arial;margin-right:10px;}hr{border:0;height:5px;background-color:#8c8;color:#8c8;}"));return goog.html.SafeStyleSheet.concat(o,e)},goog.debug.FancyWindow.prototype.getHtml_=function(){var o=goog.html.SafeHtml,e=o.create("head",{},o.concat(o.create("title",{},"Logging: "+this.identifier),o.createStyle(this.getStyleRules()))),t=o.create("body",{},o.concat(o.create("div",{id:"log",style:goog.string.Const.from("overflow:auto")}),o.create("div",{id:"head"},o.concat(o.create("p",{},o.create("b",{},"Logging: "+this.identifier)),o.create("p",{},this.welcomeMessage),o.create("span",{id:"clearbutton"},"clear"),o.create("span",{id:"exitbutton"},"exit"),o.create("span",{id:"openbutton"},"options"))),o.create("div",{id:"options"},o.concat(o.create("big",{},o.create("b",{},"Options:")),o.create("div",{id:"optionsarea"}),o.create("span",{id:"closebutton"},"save and close")))));return o.create("html",{},o.concat(e,t))},goog.debug.FancyWindow.prototype.writeOptionsToLocalStorage_=function(){if(goog.debug.FancyWindow.HAS_LOCAL_STORE)for(var o=goog.debug.FancyWindow.getLoggers_(),e=goog.debug.FancyWindow.getStoredKeys_(),t=0;t<o.length;t++){var g=goog.debug.FancyWindow.LOCAL_STORE_PREFIX+o[t].getName(),n=o[t].getLevel();g in e?n?window.localStorage.getItem(g)!=n.name&&window.localStorage.setItem(g,n.name):window.localStorage.removeItem(g):n&&window.localStorage.setItem(g,n.name)}},goog.debug.FancyWindow.prototype.readOptionsFromLocalStorage_=function(){if(goog.debug.FancyWindow.HAS_LOCAL_STORE){var o=goog.debug.FancyWindow.getStoredKeys_();for(var e in o){var t=e.replace(goog.debug.FancyWindow.LOCAL_STORE_PREFIX,""),g=goog.debug.LogManager.getLogger(t),n=g.getLevel(),i=window.localStorage.getItem(e).toString();n&&n.toString()==i||g.setLevel(goog.debug.Logger.Level.getPredefinedLevel(i))}}},goog.debug.FancyWindow.getStoredKeys_=function(){for(var o={},e=0,t=window.localStorage.length;e<t;e++){var g=window.localStorage.key(e);null!=g&&goog.string.startsWith(g,goog.debug.FancyWindow.LOCAL_STORE_PREFIX)&&(o[g]=!0)}return o},goog.debug.FancyWindow.getLoggers_=function(){var o=goog.object.getValues(goog.debug.LogManager.getLoggers());return goog.array.sort(o,function(o,e){return goog.array.defaultCompare(o.getName(),e.getName())}),o};