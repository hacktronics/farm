goog.module("goog.i18n.DateIntervalFormat");var DateLike=goog.require("goog.date.DateLike"),DateRange=goog.require("goog.date.DateRange"),DateTime=goog.require("goog.date.DateTime"),DateTimeFormat=goog.require("goog.i18n.DateTimeFormat"),DateTimeSymbols=goog.require("goog.i18n.DateTimeSymbols"),DateTimeSymbolsType=goog.require("goog.i18n.DateTimeSymbolsType"),Interval=goog.require("goog.date.Interval"),TimeZone=goog.require("goog.i18n.TimeZone"),array=goog.require("goog.array"),asserts=goog.require("goog.asserts"),dateIntervalSymbols=goog.require("goog.i18n.dateIntervalSymbols"),object=goog.require("goog.object"),DateIntervalFormat=function(t,e,a){asserts.assert(void 0!==t,"Pattern must be defined."),asserts.assert(void 0!==e||void 0!==dateIntervalSymbols.getDateIntervalSymbols(),"goog.i18n.DateIntervalSymbols or explicit symbols must be defined"),asserts.assert(void 0!==a||void 0!==DateTimeSymbols,"goog.i18n.DateTimeSymbols or explicit symbols must be defined"),this.dateIntervalSymbols_=e||dateIntervalSymbols.getDateIntervalSymbols(),this.dateTimeSymbols_=a||DateTimeSymbols,this.intervalPattern_=this.getIntervalPattern_(t),this.intervalPatternKeys_=object.getKeys(this.intervalPattern_),array.remove(this.intervalPatternKeys_,DEFAULT_PATTERN_KEY_),this.fallbackPattern_=this.dateIntervalSymbols_.FALLBACK||DEFAULT_FALLBACK_PATTERN_;var r=this.fallbackPattern_.indexOf(FIRST_DATE_PLACEHOLDER_),o=this.fallbackPattern_.indexOf(SECOND_DATE_PLACEHOLDER_);if(r<0||o<0)throw new Error("Malformed fallback interval pattern");this.useFirstDateOnFirstPattern_=r<=o,this.formatterMap_={}},DEFAULT_FALLBACK_PATTERN_="{0} â€“ {1}",FIRST_DATE_PLACEHOLDER_="{0}",SECOND_DATE_PLACEHOLDER_="{1}",DEFAULT_PATTERN_KEY_="_",Era_={BC:0,AD:1},AmPm_={AM:0,PM:1},RELEVANT_CALENDAR_FIELDS_="GyMdahms",ALL_PATTERN_LETTERS_=/[a-zA-Z]/;DateIntervalFormat.prototype.getIntervalPattern_=function(t){if("number"!=typeof t)return t;switch(t){case DateTimeFormat.Format.FULL_DATE:return this.dateIntervalSymbols_.FULL_DATE;case DateTimeFormat.Format.LONG_DATE:return this.dateIntervalSymbols_.LONG_DATE;case DateTimeFormat.Format.MEDIUM_DATE:return this.dateIntervalSymbols_.MEDIUM_DATE;case DateTimeFormat.Format.SHORT_DATE:return this.dateIntervalSymbols_.SHORT_DATE;case DateTimeFormat.Format.FULL_TIME:return this.dateIntervalSymbols_.FULL_TIME;case DateTimeFormat.Format.LONG_TIME:return this.dateIntervalSymbols_.LONG_TIME;case DateTimeFormat.Format.MEDIUM_TIME:return this.dateIntervalSymbols_.MEDIUM_TIME;case DateTimeFormat.Format.SHORT_TIME:return this.dateIntervalSymbols_.SHORT_TIME;case DateTimeFormat.Format.FULL_DATETIME:return this.dateIntervalSymbols_.FULL_DATETIME;case DateTimeFormat.Format.LONG_DATETIME:return this.dateIntervalSymbols_.LONG_DATETIME;case DateTimeFormat.Format.MEDIUM_DATETIME:return this.dateIntervalSymbols_.MEDIUM_DATETIME;case DateTimeFormat.Format.SHORT_DATETIME:return this.dateIntervalSymbols_.SHORT_DATETIME;default:return this.dateIntervalSymbols_.MEDIUM_DATETIME}},DateIntervalFormat.prototype.format=function(t,e,a){var r;asserts.assert(null!=t,"The startDate parameter should be defined and not-null."),asserts.assert(null!=e,"The endDate parameter should be defined and not-null."),goog.isDateLike(e)?r=e:(asserts.assertInstanceof(e,Interval,"endDate parameter should be a goog.date.DateLike or goog.date.Interval"),(r=new DateTime(t)).add(e));var o=DateIntervalFormat.getLargestDifferentCalendarField_(t,r,a);return this.getFormatterForCalendarField_(o).format(t,r,o,a)},DateIntervalFormat.prototype.formatRange=function(t,e){asserts.assert(null!=t,"The dateRange parameter should be defined and non-null.");var a=t.getStartDate(),r=t.getEndDate();if(null==a)throw new Error("The dateRange's startDate should be defined and non-null.");if(null==r)throw new Error("The dateRange's endDate should be defined and non-null.");return this.format(a,r,e)},DateIntervalFormat.prototype.getFormatterForCalendarField_=function(t){if(""!=t)for(var e=0;e<this.intervalPatternKeys_.length;e++)if(this.intervalPatternKeys_[e].indexOf(t)>=0)return this.getOrCreateFormatterForKey_(this.intervalPatternKeys_[e]);return this.getOrCreateFormatterForKey_(DEFAULT_PATTERN_KEY_)},DateIntervalFormat.prototype.getOrCreateFormatterForKey_=function(t){var e=this;return object.setWithReturnValueIfNotSet(this.formatterMap_,t,function(){var a=DateIntervalFormat.divideIntervalPattern_(e.intervalPattern_[t]);return null===a?new DateTimeFormatter_(e.intervalPattern_[t],e.fallbackPattern_,e.dateTimeSymbols_):new IntervalFormatter_(a.firstPart,a.secondPart,e.dateTimeSymbols_,e.useFirstDateOnFirstPattern_)})},DateIntervalFormat.divideIntervalPattern_=function(t){var e={},a=null;return DateIntervalFormat.executeForEveryCalendarField_(t,function(r,o){return object.containsKey(e,r)?(a={firstPart:t.substring(0,o),secondPart:t.substring(o)},!1):(object.set(e,r,!0),!0)}),a},DateIntervalFormat.executeForEveryCalendarField_=function(t,e){for(var a=!1,r="",o=0;o<t.length;o++){var n=t.charAt(o);if(a)"'"==n&&(o+1<t.length&&"'"==t.charAt(o+1)?o++:a=!1);else if("'"==n)a=!0;else if(n!=r&&ALL_PATTERN_LETTERS_.test(n)&&!e(n,o))break;r=n}},DateIntervalFormat.getLargestDifferentCalendarField_=function(t,e,a){var r=0,o=0;null!=a&&(r=6e4*(t.getTimezoneOffset()-a.getOffset(t)),o=6e4*(e.getTimezoneOffset()-a.getOffset(e)));var n=new Date(t.getTime()+r),i=new Date(e.getTime()+o);return DateIntervalFormat.getEra_(n)!=DateIntervalFormat.getEra_(i)?"G":n.getFullYear()!=i.getFullYear()?"y":n.getMonth()!=i.getMonth()?"M":n.getDate()!=i.getDate()?"d":DateIntervalFormat.getAmPm_(n)!=DateIntervalFormat.getAmPm_(i)?"a":n.getHours()!=i.getHours()?"h":n.getMinutes()!=i.getMinutes()?"m":n.getSeconds()!=i.getSeconds()?"s":""},DateIntervalFormat.getEra_=function(t){return t.getFullYear()>0?Era_.AD:Era_.BC},DateIntervalFormat.getAmPm_=function(t){var e=t.getHours();return 12<=e&&e<24?AmPm_.PM:AmPm_.AM},DateIntervalFormat.isCalendarFieldLargerOrEqualThan_=function(t,e){return RELEVANT_CALENDAR_FIELDS_.indexOf(t)<=RELEVANT_CALENDAR_FIELDS_.indexOf(e)};var Formatter_=function(){};Formatter_.prototype.format=function(t,e,a,r){};var IntervalFormatter_=function(t,e,a,r){this.firstPartFormatter_=new DateTimeFormat(t,a),this.secondPartFormatter_=new DateTimeFormat(e,a),this.useFirstDateOnFirstPattern_=r};IntervalFormatter_.prototype.format=function(t,e,a,r){return this.useFirstDateOnFirstPattern_?this.firstPartFormatter_.format(t,r)+this.secondPartFormatter_.format(e,r):this.firstPartFormatter_.format(e,r)+this.secondPartFormatter_.format(t,r)};var DateTimeFormatter_=function(t,e,a){this.dateTimePattern_=t,this.dateTimeFormatter_=new DateTimeFormat(t,a),this.fallbackPattern_=e};DateTimeFormatter_.prototype.format=function(t,e,a,r){var o=!1;return""!=a&&DateIntervalFormat.executeForEveryCalendarField_(this.dateTimePattern_,function(t,e){return!DateIntervalFormat.isCalendarFieldLargerOrEqualThan_(a,t)||(o=!0,!1)}),o?this.fallbackPattern_.replace(FIRST_DATE_PLACEHOLDER_,this.dateTimeFormatter_.format(t,r)).replace(SECOND_DATE_PLACEHOLDER_,this.dateTimeFormatter_.format(e,r)):this.dateTimeFormatter_.format(t,r)},exports=DateIntervalFormat;