goog.provide("goog.i18n.DateTimeParse"),goog.require("goog.asserts"),goog.require("goog.date"),goog.require("goog.i18n.DateTimeFormat"),goog.require("goog.i18n.DateTimeSymbols"),goog.i18n.DateTimeParse=function(t,e){goog.asserts.assert(void 0!==e||void 0!==goog.i18n.DateTimeSymbols,"goog.i18n.DateTimeSymbols or explicit symbols must be defined"),this.patternParts_=[],this.dateTimeSymbols_=e||goog.i18n.DateTimeSymbols,"number"==typeof t?this.applyStandardPattern_(t):this.applyPattern_(t)},goog.i18n.DateTimeParse.ambiguousYearCenturyStart=80,goog.i18n.DateTimeParse.prototype.applyPattern_=function(t){for(var e=!1,a="",r=0;r<t.length;r++){var s=t.charAt(r);if(" "==s)for(a.length>0&&(this.patternParts_.push({text:a,count:0,abutStart:!1}),a=""),this.patternParts_.push({text:" ",count:0,abutStart:!1});r<t.length-1&&" "==t.charAt(r+1);)r++;else if(e)"'"==s?r+1<t.length&&"'"==t.charAt(r+1)?(a+="'",r++):e=!1:a+=s;else if(goog.i18n.DateTimeParse.PATTERN_CHARS_.indexOf(s)>=0){a.length>0&&(this.patternParts_.push({text:a,count:0,abutStart:!1}),a="");var i=this.getNextCharCount_(t,r);this.patternParts_.push({text:s,count:i,abutStart:!1}),r+=i-1}else"'"==s?r+1<t.length&&"'"==t.charAt(r+1)?(a+="'",r++):e=!0:a+=s}a.length>0&&this.patternParts_.push({text:a,count:0,abutStart:!1}),this.markAbutStart_()},goog.i18n.DateTimeParse.prototype.applyStandardPattern_=function(t){var e;t>goog.i18n.DateTimeFormat.Format.SHORT_DATETIME&&(t=goog.i18n.DateTimeFormat.Format.MEDIUM_DATETIME),e=t<4?this.dateTimeSymbols_.DATEFORMATS[t]:t<8?this.dateTimeSymbols_.TIMEFORMATS[t-4]:(e=(e=this.dateTimeSymbols_.DATETIMEFORMATS[t-8]).replace("{1}",this.dateTimeSymbols_.DATEFORMATS[t-8])).replace("{0}",this.dateTimeSymbols_.TIMEFORMATS[t-8]),this.applyPattern_(e)},goog.i18n.DateTimeParse.prototype.parse=function(t,e,a){var r=a||0;return this.internalParse_(t,e,r,!1)},goog.i18n.DateTimeParse.prototype.strictParse=function(t,e,a){var r=a||0;return this.internalParse_(t,e,r,!0)},goog.i18n.DateTimeParse.prototype.internalParse_=function(t,e,a,r){for(var s=new goog.i18n.DateTimeParse.MyDate_,i=[a],o=-1,n=0,h=0,u=0;u<this.patternParts_.length;u++){if(!(this.patternParts_[u].count>0)){if(o=-1," "==this.patternParts_[u].text.charAt(0)){var g=i[0];if(this.skipSpace_(t,i),i[0]>g)continue}else if(t.indexOf(this.patternParts_[u].text,i[0])==i[0]){i[0]+=this.patternParts_[u].text.length;continue}return 0}if(o<0&&this.patternParts_[u].abutStart&&(o=u,n=a,h=0),o>=0){var m=this.patternParts_[u].count;if(u==o&&(m-=h,h++,0==m))return 0;if(!this.subParse_(t,i,this.patternParts_[u],m,s)){u=o-1,i[0]=n;continue}}else if(o=-1,!this.subParse_(t,i,this.patternParts_[u],0,s))return 0}return s.calcDate_(e,r)?i[0]-a:0},goog.i18n.DateTimeParse.prototype.getNextCharCount_=function(t,e){for(var a=t.charAt(e),r=e+1;r<t.length&&t.charAt(r)==a;)r++;return r-e},goog.i18n.DateTimeParse.PATTERN_CHARS_="GyMdkHmsSEDahKzZvQL",goog.i18n.DateTimeParse.NUMERIC_FORMAT_CHARS_="MydhHmsSDkK",goog.i18n.DateTimeParse.prototype.isNumericField_=function(t){if(t.count<=0)return!1;var e=goog.i18n.DateTimeParse.NUMERIC_FORMAT_CHARS_.indexOf(t.text.charAt(0));return e>0||0==e&&t.count<3},goog.i18n.DateTimeParse.prototype.markAbutStart_=function(){for(var t=!1,e=0;e<this.patternParts_.length;e++)this.isNumericField_(this.patternParts_[e])?!t&&e+1<this.patternParts_.length&&this.isNumericField_(this.patternParts_[e+1])&&(t=!0,this.patternParts_[e].abutStart=!0):t=!1},goog.i18n.DateTimeParse.prototype.skipSpace_=function(t,e){var a=t.substring(e[0]).match(/^\s+/);a&&(e[0]+=a[0].length)},goog.i18n.DateTimeParse.prototype.subParse_=function(t,e,a,r,s){this.skipSpace_(t,e);var i=e[0],o=a.text.charAt(0),n=-1;if(this.isNumericField_(a))if(r>0){if(i+r>t.length)return!1;n=this.parseInt_(t.substring(0,i+r),e)}else n=this.parseInt_(t,e);switch(o){case"G":return(n=this.matchString_(t,e,this.dateTimeSymbols_.ERAS))>=0&&(s.era=n),!0;case"M":case"L":return this.subParseMonth_(t,e,s,n);case"E":return this.subParseDayOfWeek_(t,e,s);case"a":return(n=this.matchString_(t,e,this.dateTimeSymbols_.AMPMS))>=0&&(s.ampm=n),!0;case"y":return this.subParseYear_(t,e,i,n,a,s);case"Q":return this.subParseQuarter_(t,e,s,n);case"d":return n>=0&&(s.day=n),!0;case"S":return this.subParseFractionalSeconds_(n,e,i,s);case"h":12==n&&(n=0);case"K":case"H":case"k":return n>=0&&(s.hours=n),!0;case"m":return n>=0&&(s.minutes=n),!0;case"s":return n>=0&&(s.seconds=n),!0;case"z":case"Z":case"v":return this.subparseTimeZoneInGMT_(t,e,s);default:return!1}},goog.i18n.DateTimeParse.prototype.subParseYear_=function(t,e,a,r,s,i){var o;if(r<0){if("+"!=(o=t.charAt(e[0]))&&"-"!=o)return!1;if(e[0]++,(r=this.parseInt_(t,e))<0)return!1;"-"==o&&(r=-r)}return o||e[0]-a!=2||2!=s.count?i.year=r:i.setTwoDigitYear_(r),!0},goog.i18n.DateTimeParse.prototype.subParseMonth_=function(t,e,a,r){if(r<0){var s=this.dateTimeSymbols_.MONTHS.concat(this.dateTimeSymbols_.STANDALONEMONTHS).concat(this.dateTimeSymbols_.SHORTMONTHS).concat(this.dateTimeSymbols_.STANDALONESHORTMONTHS);return!((r=this.matchString_(t,e,s))<0)&&(a.month=r%12,!0)}return a.month=r-1,!0},goog.i18n.DateTimeParse.prototype.subParseQuarter_=function(t,e,a,r){return r<0&&((r=this.matchString_(t,e,this.dateTimeSymbols_.QUARTERS))<0&&(r=this.matchString_(t,e,this.dateTimeSymbols_.SHORTQUARTERS)),!(r<0)&&(a.month=3*r,a.day=1,!0))},goog.i18n.DateTimeParse.prototype.subParseDayOfWeek_=function(t,e,a){var r=this.matchString_(t,e,this.dateTimeSymbols_.WEEKDAYS);return r<0&&(r=this.matchString_(t,e,this.dateTimeSymbols_.SHORTWEEKDAYS)),!(r<0)&&(a.dayOfWeek=r,!0)},goog.i18n.DateTimeParse.prototype.subParseFractionalSeconds_=function(t,e,a,r){var s=e[0]-a;return r.milliseconds=s<3?t*Math.pow(10,3-s):Math.round(t/Math.pow(10,s-3)),!0},goog.i18n.DateTimeParse.prototype.subparseTimeZoneInGMT_=function(t,e,a){return t.indexOf("GMT",e[0])==e[0]?(e[0]+=3,this.parseTimeZoneOffset_(t,e,a)):this.parseTimeZoneOffset_(t,e,a)},goog.i18n.DateTimeParse.prototype.parseTimeZoneOffset_=function(t,e,a){if(e[0]>=t.length)return a.tzOffset=0,!0;var r=1;switch(t.charAt(e[0])){case"-":r=-1;case"+":e[0]++}var s,i=e[0],o=this.parseInt_(t,e);if(o<0)return!1;if(e[0]<t.length&&":"==t.charAt(e[0])){if(s=60*o,e[0]++,(o=this.parseInt_(t,e))<0)return!1;s+=o}else(s=o)<24&&e[0]-i<=2?s*=60:s=s%100+s/100*60;return s*=r,a.tzOffset=-s,!0},goog.i18n.DateTimeParse.prototype.parseInt_=function(t,e){if(this.dateTimeSymbols_.ZERODIGIT){for(var a=[],r=e[0];r<t.length;r++){var s=t.charCodeAt(r)-this.dateTimeSymbols_.ZERODIGIT;a.push(0<=s&&s<=9?String.fromCharCode(s+48):t.charAt(r))}t=a.join("")}else t=t.substring(e[0]);var i=t.match(/^\d+/);return i?(e[0]+=i[0].length,parseInt(i[0],10)):-1},goog.i18n.DateTimeParse.prototype.matchString_=function(t,e,a){for(var r=0,s=-1,i=t.substring(e[0]).toLowerCase(),o=0;o<a.length;o++){var n=a[o].length;n>r&&0==i.indexOf(a[o].toLowerCase())&&(s=o,r=n)}return s>=0&&(e[0]+=r),s},goog.i18n.DateTimeParse.MyDate_=function(){},goog.i18n.DateTimeParse.MyDate_.prototype.era,goog.i18n.DateTimeParse.MyDate_.prototype.year,goog.i18n.DateTimeParse.MyDate_.prototype.month,goog.i18n.DateTimeParse.MyDate_.prototype.day,goog.i18n.DateTimeParse.MyDate_.prototype.hours,goog.i18n.DateTimeParse.MyDate_.prototype.ampm,goog.i18n.DateTimeParse.MyDate_.prototype.minutes,goog.i18n.DateTimeParse.MyDate_.prototype.seconds,goog.i18n.DateTimeParse.MyDate_.prototype.milliseconds,goog.i18n.DateTimeParse.MyDate_.prototype.tzOffset,goog.i18n.DateTimeParse.MyDate_.prototype.dayOfWeek,goog.i18n.DateTimeParse.MyDate_.prototype.setTwoDigitYear_=function(t){var e=(new Date).getFullYear()-goog.i18n.DateTimeParse.ambiguousYearCenturyStart,a=e%100;return this.ambiguousYear=t==a,t+=100*Math.floor(e/100)+(t<a?100:0),this.year=t},goog.i18n.DateTimeParse.MyDate_.prototype.calcDate_=function(t,e){if(null==t)throw new Error("Parameter 'date' should not be null.");null!=this.era&&null!=this.year&&0==this.era&&this.year>0&&(this.year=-(this.year-1)),null!=this.year&&t.setFullYear(this.year);var a=t.getDate();if(t.setDate(1),null!=this.month&&t.setMonth(this.month),null!=this.day)t.setDate(this.day);else{var r=goog.date.getNumberOfDaysInMonth(t.getFullYear(),t.getMonth());t.setDate(a>r?r:a)}if(goog.isFunction(t.setHours)&&(null==this.hours&&(this.hours=t.getHours()),null!=this.ampm&&this.ampm>0&&this.hours<12&&(this.hours+=12),t.setHours(this.hours)),goog.isFunction(t.setMinutes)&&null!=this.minutes&&t.setMinutes(this.minutes),goog.isFunction(t.setSeconds)&&null!=this.seconds&&t.setSeconds(this.seconds),goog.isFunction(t.setMilliseconds)&&null!=this.milliseconds&&t.setMilliseconds(this.milliseconds),e&&(null!=this.year&&this.year!=t.getFullYear()||null!=this.month&&this.month!=t.getMonth()||null!=this.day&&this.day!=t.getDate()||this.hours>=24||this.minutes>=60||this.seconds>=60||this.milliseconds>=1e3))return!1;if(null!=this.tzOffset){var s=t.getTimezoneOffset();t.setTime(t.getTime()+60*(this.tzOffset-s)*1e3)}if(this.ambiguousYear){var i=new Date;i.setFullYear(i.getFullYear()-goog.i18n.DateTimeParse.ambiguousYearCenturyStart),t.getTime()<i.getTime()&&t.setFullYear(i.getFullYear()+100)}if(null!=this.dayOfWeek)if(null==this.day){var o=(7+this.dayOfWeek-t.getDay())%7;o>3&&(o-=7);var n=t.getMonth();t.setDate(t.getDate()+o),t.getMonth()!=n&&t.setDate(t.getDate()+(o>0?-7:7))}else if(this.dayOfWeek!=t.getDay())return!1;return!0};