goog.provide("goog.i18n.uChar.RemoteNameFetcher"),goog.require("goog.Disposable"),goog.require("goog.Uri"),goog.require("goog.events"),goog.require("goog.i18n.uChar"),goog.require("goog.i18n.uChar.NameFetcher"),goog.require("goog.log"),goog.require("goog.net.EventType"),goog.require("goog.net.XhrIo"),goog.i18n.uChar.RemoteNameFetcher=function(e){goog.i18n.uChar.RemoteNameFetcher.base(this,"constructor"),this.prefetchXhrIo_=new goog.net.XhrIo,this.getNameXhrIo_=new goog.net.XhrIo,this.dataSourceUri_=e,this.charNames_=new Map},goog.inherits(goog.i18n.uChar.RemoteNameFetcher,goog.Disposable),goog.i18n.uChar.RemoteNameFetcher.prototype.prefetchLastListenerKey_,goog.i18n.uChar.RemoteNameFetcher.prototype.getNameLastListenerKey_,goog.i18n.uChar.RemoteNameFetcher.logger_=goog.log.getLogger("goog.i18n.uChar.RemoteNameFetcher"),goog.i18n.uChar.RemoteNameFetcher.prototype.disposeInternal=function(){goog.i18n.uChar.RemoteNameFetcher.base(this,"disposeInternal"),this.prefetchXhrIo_.dispose(),this.getNameXhrIo_.dispose()},goog.i18n.uChar.RemoteNameFetcher.prototype.prefetch=function(e){this.prefetchXhrIo_.isActive()&&(goog.log.info(goog.i18n.uChar.RemoteNameFetcher.logger_,"Aborted previous prefetch() call for new incoming request"),this.prefetchXhrIo_.abort()),this.prefetchLastListenerKey_&&goog.events.unlistenByKey(this.prefetchLastListenerKey_);var o=goog.bind(this.prefetchCallback_,this);this.prefetchLastListenerKey_=goog.events.listenOnce(this.prefetchXhrIo_,goog.net.EventType.COMPLETE,o),this.fetch_(goog.i18n.uChar.RemoteNameFetcher.RequestType_.BASE_88,e,this.prefetchXhrIo_)},goog.i18n.uChar.RemoteNameFetcher.prototype.prefetchCallback_=function(){this.processResponse_(this.prefetchXhrIo_)},goog.i18n.uChar.RemoteNameFetcher.prototype.getName=function(e,o){var t=goog.i18n.uChar.toCharCode(e).toString(16);if(this.charNames_.has(t)){o(this.charNames_.get(t))}else{this.getNameXhrIo_.isActive()&&(goog.log.info(goog.i18n.uChar.RemoteNameFetcher.logger_,"Aborted previous getName() call for new incoming request"),this.getNameXhrIo_.abort()),this.getNameLastListenerKey_&&goog.events.unlistenByKey(this.getNameLastListenerKey_);var r=goog.bind(this.getNameCallback_,this,t,o);this.getNameLastListenerKey_=goog.events.listenOnce(this.getNameXhrIo_,goog.net.EventType.COMPLETE,r),this.fetch_(goog.i18n.uChar.RemoteNameFetcher.RequestType_.CODEPOINT,t,this.getNameXhrIo_)}},goog.i18n.uChar.RemoteNameFetcher.prototype.getNameCallback_=function(e,o){this.processResponse_(this.getNameXhrIo_),o(this.charNames_.has(e)?this.charNames_.get(e):null)},goog.i18n.uChar.RemoteNameFetcher.prototype.processResponse_=function(e){if(e.isSuccess()){var o=e.getResponseJson();for(var t in o)o[t].hasOwnProperty("name")&&this.charNames_.set(t,o[t].name)}else goog.log.error(goog.i18n.uChar.RemoteNameFetcher.logger_,"Problem with data source: "+e.getLastError())},goog.i18n.uChar.RemoteNameFetcher.RequestType_={BASE_88:"b88",CODEPOINT:"c"},goog.i18n.uChar.RemoteNameFetcher.prototype.fetch_=function(e,o,t){var r=new goog.Uri(this.dataSourceUri_);r.setParameterValue(e,o),r.setParameterValue("p","name"),goog.log.info(goog.i18n.uChar.RemoteNameFetcher.logger_,"Request: "+r.toString()),t.send(r)},goog.i18n.uChar.RemoteNameFetcher.prototype.isNameAvailable=function(e){return!0};