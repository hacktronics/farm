goog.provide("goog.cssom.iframe.style"),goog.require("goog.asserts"),goog.require("goog.cssom"),goog.require("goog.dom"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.TagName"),goog.require("goog.dom.classlist"),goog.require("goog.string"),goog.require("goog.style"),goog.require("goog.userAgent"),goog.cssom.iframe.style.selectorPartAnchorRegex_=/a(:(link|visited|active|hover))?/,goog.cssom.iframe.style.SELECTOR_DELIMITER_=",",goog.cssom.iframe.style.SELECTOR_PART_DELIMITER_=" ",goog.cssom.iframe.style.DECLARATION_START_DELIMITER_="{",goog.cssom.iframe.style.DECLARATION_END_DELIMITER_="}\n",goog.cssom.iframe.style.CssRuleSet_=function(){this.declarationText="",this.selectors=[]},goog.cssom.iframe.style.CssRuleSet_.prototype.initializeFromCssRule=function(e){var o,t=e.style;if(!t)return!1;var s="";if(t&&(o=e.selectorText)&&(s=t.cssText))goog.userAgent.IE&&(s+="/* */");else if(e.cssText){var r=/([^\{]+)\{/;o=r.exec(e.cssText)[1],s=e.cssText.replace(r,"").replace(/\}[^\}]*$/g,"")}return!!o&&(this.setSelectorsFromString(o),this.declarationText=s,!0)},goog.cssom.iframe.style.CssRuleSet_.prototype.setSelectorsFromString=function(e){this.selectors=[];for(var o=e.split(/,\s*/gm),t=0;t<o.length;t++){var s=o[t];s.length>0&&this.selectors.push(new goog.cssom.iframe.style.CssSelector_(s))}},goog.cssom.iframe.style.CssRuleSet_.prototype.clone=function(){var e=new goog.cssom.iframe.style.CssRuleSet_;return e.selectors=this.selectors.concat(),e.declarationText=this.declarationText,e},goog.cssom.iframe.style.CssRuleSet_.prototype.setDeclarationTextFromObject=function(e,o){var t=[];for(var s in e){var r=e[s];r&&t.push(s,":",r,o?" !important":"",";")}this.declarationText=t.join("")},goog.cssom.iframe.style.CssRuleSet_.prototype.writeToArray=function(e){for(var o=this.selectors.length,t=!1,s=0;s<o;s++){for(var r=this.selectors[s].parts,a=r.length,g=0;g<a;g++)e.push(r[g].inputString_,goog.cssom.iframe.style.SELECTOR_PART_DELIMITER_);s<o-1&&e.push(goog.cssom.iframe.style.SELECTOR_DELIMITER_),goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("1.9a")&&(t=t||goog.cssom.iframe.style.selectorPartAnchorRegex_.test(r[a-1].inputString_))}var i=this.declarationText;t&&(i=goog.cssom.iframe.style.makeColorRuleImportant_(i)),e.push(goog.cssom.iframe.style.DECLARATION_START_DELIMITER_,i,goog.cssom.iframe.style.DECLARATION_END_DELIMITER_)},goog.cssom.iframe.style.colorImportantReplaceRegex_=/(^|;|{)\s*color:([^;]+);/g,goog.cssom.iframe.style.makeColorRuleImportant_=function(e){return e.replace(goog.cssom.iframe.style.colorImportantReplaceRegex_,"$1 color: $2 ! important; ")},goog.cssom.iframe.style.CssSelector_=function(e){this.parts,this.ancestryMatchCache_={},e&&this.setPartsFromString_(e)},goog.cssom.iframe.style.CssSelector_.prototype.setPartsFromString_=function(e){for(var o=[],t=e.split(/\s+/gm),s=0;s<t.length;s++)if(t[s]){var r=new goog.cssom.iframe.style.CssSelectorPart_(t[s]);o.push(r)}this.parts=o},goog.cssom.iframe.style.CssSelector_.prototype.matchElementAncestry=function(e){var o=e.uid;if(this.ancestryMatchCache_[o])return this.ancestryMatchCache_[o];for(var t=0,s=null,r=null,a=null,g=e.nodes,i=g.length,n=0;n<=this.parts.length;n++){for(r=this.parts[n];t<i;){var l=g[t];if(r&&r.testElement(l)){s={elementIndex:t,selectorPartIndex:n},t++;break}a&&a.testElement(l)&&(s={elementIndex:t,selectorPartIndex:n-1}),t++}a=r}return this.ancestryMatchCache_[o]=s,s},goog.cssom.iframe.style.CssSelectorPart_=function(e){var o,t=goog.cssom.iframe.style.CssSelectorPart_.instances_[e];if(t)return t;o=e.match(/[#\.]/)?e.split(/(?=[#\.])/):[e];for(var s={},r=0;r<o.length;r++){var a=o[r];"."==a.charAt(0)?s.className=a.substring(1,a.length):"#"==a.charAt(0)?s.id=a.substring(1,a.length):s.tagName=a.toUpperCase()}this.inputString_=e,this.matchProperties_=s,this.testedElements_={},goog.cssom.iframe.style.CssSelectorPart_.instances_[e]=this},goog.cssom.iframe.style.CssSelectorPart_.instances_={},goog.cssom.iframe.style.CssSelectorPart_.prototype.testElement=function(e){var o=e.uid,t=this.testedElements_[o];if(void 0!==t)return t;var s=this.matchProperties_,r=s.tagName,a=s.className,g=s.id,i=!0;return(r&&"*"!=r&&r!=e.nodeName||g&&g!=e.id||a&&!e.classNames[a])&&(i=!1),this.testedElements_[o]=i,i},goog.cssom.iframe.style.NodeAncestry_=function(e){var o=e,t=goog.getUid(o),s=goog.cssom.iframe.style.NodeAncestry_.instances_[t];if(s)return s;var r=[];do{var a={id:o.id,nodeName:o.nodeName};a.uid=goog.getUid(a);var g={};if(o.className)for(var i=goog.dom.classlist.get(goog.asserts.assertElement(o)),n=0;n<i.length;n++)g[i[n]]=1;a.classNames=g,r.unshift(a)}while(o=o.parentNode);this.nodes=r,this.uid=goog.getUid(this),goog.cssom.iframe.style.NodeAncestry_.instances_[t]=this},goog.cssom.iframe.style.NodeAncestry_.instances_={},goog.cssom.iframe.style.resetDomCache=function(){goog.cssom.iframe.style.NodeAncestry_.instances_={}},goog.cssom.iframe.style.getRuleSetsFromDocument_=function(e){for(var o,t=[],s=goog.cssom.getAllCssStyleSheets(e.styleSheets),r=0;o=s[r];r++){var a=goog.cssom.getCssRulesFromStyleSheet(o);if(a&&a.length)for(var g=0,i=a.length;g<i;g++){var n=new goog.cssom.iframe.style.CssRuleSet_;n.initializeFromCssRule(a[g])&&t.push(n)}}return t},goog.cssom.iframe.style.ruleSetCache_={},goog.cssom.iframe.style.ruleSetCache_.cache_={},goog.cssom.iframe.style.ruleSetCache_.loadRuleSetsForDocument=function(e){var o=goog.getUid(e);goog.cssom.iframe.style.ruleSetCache_.cache_[o]=goog.cssom.iframe.style.getRuleSetsFromDocument_(e)},goog.cssom.iframe.style.ruleSetCache_.getRuleSetsForDocument=function(e){var o=goog.getUid(e),t=goog.cssom.iframe.style.ruleSetCache_.cache_;t[o]||goog.cssom.iframe.style.ruleSetCache_.loadRuleSetsForDocument(e);for(var s=t[o],r=[],a=0;a<s.length;a++)r.push(s[a].clone());return r},goog.cssom.iframe.style.inheritedProperties_=["color","visibility","quotes","list-style-type","list-style-image","list-style-position","list-style","page-break-inside","orphans","widows","font-family","font-style","font-variant","font-weight","text-indent","text-align","text-transform","white-space","caption-side","border-collapse","border-spacing","empty-cells","cursor"],goog.cssom.iframe.style.textProperties_=["font-family","font-size","font-weight","font-variant","font-style","color","text-align","text-decoration","text-indent","text-transform","letter-spacing","white-space","word-spacing"],goog.cssom.iframe.style.getElementContext=function(e,o,t){var s=e.ownerDocument;o&&goog.cssom.iframe.style.ruleSetCache_.loadRuleSetsForDocument(s);for(var r=goog.cssom.iframe.style.ruleSetCache_.getRuleSetsForDocument(s),a=new goog.cssom.iframe.style.NodeAncestry_(e),g=new goog.cssom.iframe.style.CssSelectorPart_("body"),i=0;i<r.length;i++)for(var n=r[i].selectors,l=n.length,c=0;c<l;c++){var m=n[c],u=m.matchElementAncestry(a);if(u){var f,y=u.selectorPartIndex,d=m.parts,h=d.length-1;if(u.elementIndex==a.nodes.length-1||y<h){var _=d.concat();_.splice(0,y+1,g),(f=new goog.cssom.iframe.style.CssSelector_).parts=_,n.push(f)}else y>0&&y==h&&((f=new goog.cssom.iframe.style.CssSelector_).parts=[g,d[h]],n.push(f))}}var p=new goog.cssom.iframe.style.CssRuleSet_,C=goog.cssom.iframe.style.getComputedStyleObject_(e),v=new goog.cssom.iframe.style.CssSelector_;v.parts=[new goog.cssom.iframe.style.CssSelectorPart_("html")],p.selectors=[v];var S,R={};for(i=0;S=goog.cssom.iframe.style.inheritedProperties_[i];i++)R[S]=C[goog.string.toCamelCase(S)];p.setDeclarationTextFromObject(R),r.push(p);var b=new goog.cssom.iframe.style.CssRuleSet_,E=new goog.cssom.iframe.style.CssSelector_;E.parts=[new goog.cssom.iframe.style.CssSelectorPart_("body")];var T={position:"relative",top:"0",left:"0",right:"auto",display:"block",visibility:"visible"};for(i=0;S=goog.cssom.iframe.style.textProperties_[i];i++)T[S]=C[goog.string.toCamelCase(S)];if(t&&goog.cssom.iframe.style.isTransparentValue_(C.backgroundColor)){var x=goog.cssom.iframe.style.getBackgroundContext(e);T["background-color"]=x.backgroundColor;var k=C.backgroundImage;k&&"none"!=k||(T["background-image"]=x.backgroundImage,T["background-repeat"]=x.backgroundRepeat,T["background-position"]=x.backgroundPosition)}b.setDeclarationTextFromObject(T,!0),b.selectors=[E],r.push(b);var I=[];for(l=r.length,i=0;i<l;i++)r[i].writeToArray(I);return I.join("")},goog.cssom.iframe.style.isTransparentValue_=function(e){return"transparent"==e||"rgba(0, 0, 0, 0)"==e},goog.cssom.iframe.style.getComputedStyleObject_=function(e){return e.currentStyle||goog.dom.getOwnerDocument(e).defaultView.getComputedStyle(e,"")||{}},goog.cssom.iframe.style.valueWithUnitsRegEx_=/^(-?)([0-9]+)([a-z]*|%)/,goog.cssom.iframe.style.getBackgroundXYValues_=function(e){return e.backgroundPositionY?[e.backgroundPositionX,e.backgroundPositionY]:(e.backgroundPosition||"0 0").split(" ")},goog.cssom.iframe.style.getBackgroundContext=function(e){for(var o,t={backgroundImage:"none"},s=e;(s=s.parentNode)&&s.nodeType==goog.dom.NodeType.ELEMENT;){var r=goog.cssom.iframe.style.getComputedStyleObject_(s),a=r.backgroundColor;if(goog.cssom.iframe.style.isTransparentValue_(a)||(t.backgroundColor=a),r.backgroundImage&&"none"!=r.backgroundImage){var g;if(t.backgroundImage=r.backgroundImage,t.backgroundRepeat=r.backgroundRepeat,o){g=goog.style.getFramedPageOffset(e,o);var i=o.frameElement,n=goog.style.getRelativePosition(i,s),l=goog.style.getBorderBox(i);g.x+=n.x+l.left,g.y+=n.y+l.top}else g=goog.style.getRelativePosition(e,s);for(var c=goog.cssom.iframe.style.getBackgroundXYValues_(r),m=0;m<2;m++){var u=c[m],f=0==m?"X":"Y",y="backgroundPosition"+f,d=goog.cssom.iframe.style.valueWithUnitsRegEx_.exec(u);if(d){var h=parseInt(d[1]+d[2],10),_=d[3];0!=h&&"px"!=_||(h-="X"==f?g.x:g.y),u=h+_}t[y]=u}t.backgroundPosition=t.backgroundPositionX+" "+t.backgroundPositionY}if(t.backgroundColor)break;if(s.tagName==goog.dom.TagName.HTML)try{if(!(s=(o=goog.dom.getWindow(s.parentNode)).frameElement))break}catch(e){break}}return t};