goog.provide("goog.ds.AbstractFastDataNode"),goog.provide("goog.ds.FastDataNode"),goog.provide("goog.ds.FastListNode"),goog.provide("goog.ds.PrimitiveFastDataNode"),goog.require("goog.ds.DataManager"),goog.require("goog.ds.DataNodeList"),goog.require("goog.ds.EmptyNodeList"),goog.require("goog.string"),goog.ds.AbstractFastDataNode=function(t,o){if(!t)throw new Error("Cannot create a fast data node without a data name");this.__dataName=t,this.__parent=o},goog.ds.AbstractFastDataNode.prototype.getDataName=function(){return this.__dataName},goog.ds.AbstractFastDataNode.prototype.setDataName=function(t){this.__dataName=t},goog.ds.AbstractFastDataNode.prototype.getDataPath=function(){return(this.__parent?this.__parent.getDataPath()+goog.ds.STR_PATH_SEPARATOR:"")+this.getDataName()},goog.ds.FastDataNode=function(t,o,e){goog.ds.AbstractFastDataNode.call(this,o,e),this.extendWith(t)},goog.inherits(goog.ds.FastDataNode,goog.ds.AbstractFastDataNode),goog.ds.FastDataNode.prototype.extendWith=function(t){for(var o in t)this[o]=t[o]},goog.ds.FastDataNode.fromJs=function(t,o,e){return goog.isArray(t)?new goog.ds.FastListNode(t,o,e):goog.isObject(t)?new goog.ds.FastDataNode(t,o,e):new goog.ds.PrimitiveFastDataNode(t||!!t,o,e)},goog.ds.FastDataNode.emptyList_=new goog.ds.EmptyNodeList,goog.ds.FastDataNode.prototype.set=function(t){throw new Error("Not implemented yet")},goog.ds.FastDataNode.prototype.getChildNodes=function(t){if(t&&t!=goog.ds.STR_ALL_CHILDREN_SELECTOR){if(-1==t.indexOf(goog.ds.STR_WILDCARD)){var o=this.getChildNode(t);return o?new goog.ds.FastListNode([o],""):new goog.ds.EmptyNodeList}throw new Error("Unsupported selector: "+t)}return this},goog.ds.FastDataNode.prototype.wrapChild_=function(t){var o=this[t];null==o||o.getDataName||(this[t]=goog.ds.FastDataNode.fromJs(this[t],t,this))},goog.ds.FastDataNode.prototype.getChildNode=function(t,o){this.wrapChild_(t);var e=this[t]||null;return null==e&&o&&(e=new goog.ds.FastDataNode({},t,this),this[t]=e),e},goog.ds.FastDataNode.prototype.setChildNode=function(t,o){return null!=o?this[t]=o:delete this[t],goog.ds.DataManager.getInstance().fireDataChange(this.getDataPath()+goog.ds.STR_PATH_SEPARATOR+t),null},goog.ds.FastDataNode.prototype.getChildNodeValue=function(t){var o=this[t];return null!=o?o.getDataName?o.get():o:null},goog.ds.FastDataNode.prototype.isList=function(){return!1},goog.ds.FastDataNode.prototype.getJsObject=function(){var t={};for(var o in this)goog.string.startsWith(o,"__")||goog.isFunction(this[o])||(t[o]=this[o].__dataName?this[o].getJsObject():this[o]);return t},goog.ds.FastDataNode.prototype.clone=function(){return goog.ds.FastDataNode.fromJs(this.getJsObject(),this.getDataName())},goog.ds.FastDataNode.prototype.add=function(t){this.setChildNode(t.getDataName(),t)},goog.ds.FastDataNode.prototype.get=function(t){return void 0===t?this:this.getChildNode(t)},goog.ds.FastDataNode.prototype.getByIndex=function(t){var o=0;for(var e in this)if(!goog.string.startsWith(e,"__")&&!goog.isFunction(this[e])){if(o==t)return this.wrapChild_(e),this[e];++o}return null},goog.ds.FastDataNode.prototype.getCount=function(){var t=0;for(var o in this)goog.string.startsWith(o,"__")||goog.isFunction(this[o])||++t;return t},goog.ds.FastDataNode.prototype.setNode=function(t,o){this.setChildNode(t,o)},goog.ds.FastDataNode.prototype.removeNode=function(t){return delete this[t],!1},goog.ds.PrimitiveFastDataNode=function(t,o,e){this.value_=t,goog.ds.AbstractFastDataNode.call(this,o,e)},goog.inherits(goog.ds.PrimitiveFastDataNode,goog.ds.AbstractFastDataNode),goog.ds.PrimitiveFastDataNode.prototype.get=function(){return this.value_},goog.ds.PrimitiveFastDataNode.prototype.set=function(t){if(goog.isArray(t)||goog.isObject(t))throw new Error("can only set PrimitiveFastDataNode to primitive values");this.value_=t,goog.ds.DataManager.getInstance().fireDataChange(this.getDataPath())},goog.ds.PrimitiveFastDataNode.prototype.getChildNodes=function(){return goog.ds.FastDataNode.emptyList_},goog.ds.PrimitiveFastDataNode.prototype.getChildNode=function(t){return null},goog.ds.PrimitiveFastDataNode.prototype.getChildNodeValue=function(t){return null},goog.ds.PrimitiveFastDataNode.prototype.setChildNode=function(t,o){throw new Error("Cannot set a child node for a PrimitiveFastDataNode")},goog.ds.PrimitiveFastDataNode.prototype.isList=function(){return!1},goog.ds.PrimitiveFastDataNode.prototype.getJsObject=function(){return this.value_},goog.ds.FastListNode=function(t,o,e){this.values_=[];for(var a=0;a<t.length;++a){var s=t[a].id||"["+a+"]";this.values_.push(goog.ds.FastDataNode.fromJs(t[a],s,this)),t[a].id&&(this.map_||(this.map_={}),this.map_[t[a].id]=a)}goog.ds.AbstractFastDataNode.call(this,o,e)},goog.inherits(goog.ds.FastListNode,goog.ds.AbstractFastDataNode),goog.ds.FastListNode.prototype.set=function(t){throw new Error("Cannot set a FastListNode to a new value")},goog.ds.FastListNode.prototype.getChildNodes=function(){return this},goog.ds.FastListNode.prototype.getChildNode=function(t,o){var e=this.getKeyAsNumber_(t);return null==e&&this.map_&&(e=this.map_[t]),null!=e&&this.values_[e]?this.values_[e]:o?(this.setChildNode(t,{}),this.getChildNode(t)):null},goog.ds.FastListNode.prototype.getChildNodeValue=function(t){var o=this.getChildNode(t);return o?o.get():null},goog.ds.FastListNode.prototype.getKeyAsNumber_=function(t){return"["==t.charAt(0)&&"]"==t.charAt(t.length-1)?Number(t.substring(1,t.length-1)):null},goog.ds.FastListNode.prototype.setChildNode=function(t,o){var e=this.values_.length;if(null!=o){o.getDataName||(o=goog.ds.FastDataNode.fromJs(o,t,this));var a=this.getKeyAsNumber_(t);if(null!=a){if(a<0||a>=this.values_.length)throw new Error("List index out of bounds: "+a);this.values_[t]=o}else this.map_||(this.map_={}),this.values_.push(o),this.map_[t]=this.values_.length-1}else this.removeNode(t);return goog.ds.DataManager.getInstance().fireDataChange(this.getDataPath()+goog.ds.STR_PATH_SEPARATOR+t),this.values_.length!=e&&this.listSizeChanged_(),null},goog.ds.FastListNode.prototype.listSizeChanged_=function(){var t=goog.ds.DataManager.getInstance();t.fireDataChange(this.getDataPath()),t.fireDataChange(this.getDataPath()+goog.ds.STR_PATH_SEPARATOR+"count()")},goog.ds.FastListNode.prototype.isList=function(){return!0},goog.ds.FastListNode.prototype.getJsObject=function(){for(var t=[],o=0;o<this.values_.length;++o)t.push(this.values_[o].getJsObject());return t},goog.ds.FastListNode.prototype.add=function(t){t.getDataName||(t=goog.ds.FastDataNode.fromJs(t,String("["+this.values_.length+"]"),this)),this.values_.push(t),goog.ds.DataManager.getInstance().fireDataChange(this.getDataPath()+goog.ds.STR_PATH_SEPARATOR+"["+(this.values_.length-1)+"]"),this.listSizeChanged_()},goog.ds.FastListNode.prototype.get=function(t){return void 0===t?this.values_:this.getChildNode(t)},goog.ds.FastListNode.prototype.getByIndex=function(t){var o=this.values_[t];return null!=o?o:null},goog.ds.FastListNode.prototype.getCount=function(){return this.values_.length},goog.ds.FastListNode.prototype.setNode=function(t,o){throw new Error("Setting child nodes of a FastListNode is not implemented, yet")},goog.ds.FastListNode.prototype.removeNode=function(t){var o=this.getKeyAsNumber_(t);if(null==o&&this.map_&&(o=this.map_[t]),null!=o){if(this.values_.splice(o,1),this.map_){var e=null;for(var a in this.map_)this.map_[a]==o?e=a:this.map_[a]>o&&--this.map_[a];e&&delete this.map_[e]}goog.ds.DataManager.getInstance().fireDataChange(this.getDataPath()+goog.ds.STR_PATH_SEPARATOR+"["+o+"]"),this.listSizeChanged_()}return!1},goog.ds.FastListNode.prototype.indexOf=function(t){var o=this.getKeyAsNumber_(t);if(null==o&&this.map_&&(o=this.map_[t]),null==o)throw new Error("Cannot determine index for: "+t);return o};