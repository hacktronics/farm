goog.provide("goog.ds.JsDataSource"),goog.provide("goog.ds.JsPropertyDataSource"),goog.require("goog.ds.BaseDataNode"),goog.require("goog.ds.BasicNodeList"),goog.require("goog.ds.DataManager"),goog.require("goog.ds.DataNode"),goog.require("goog.ds.EmptyNodeList"),goog.require("goog.ds.LoadState"),goog.ds.JsDataSource=function(t,o,e){this.parent_=e,this.dataName_=o,this.setRoot(t)},goog.ds.JsDataSource.prototype.root_,goog.ds.JsDataSource.prototype.setRoot=function(t){this.root_=t,this.childNodeList_=null},goog.ds.JsDataSource.prototype.setIsList_=function(t){this.isList_=t},goog.ds.JsDataSource.prototype.get=function(){return goog.isObject(this.root_)?this.getChildNodes():this.root_},goog.ds.JsDataSource.prototype.set=function(t){if(t&&goog.isObject(this.root_))throw new Error("Can't set group nodes to new values yet");this.parent_&&(this.parent_.root_[this.dataName_]=t),this.root_=t,this.childNodeList_=null,goog.ds.DataManager.getInstance().fireDataChange(this.getDataPath())},goog.ds.JsDataSource.prototype.getChildNodes=function(t){if(!this.root_)return new goog.ds.EmptyNodeList;if(t&&t!=goog.ds.STR_ALL_CHILDREN_SELECTOR){if(-1==t.indexOf(goog.ds.STR_WILDCARD))return null!=this.root_[t]?new goog.ds.BasicNodeList([this.getChildNode(t)]):new goog.ds.EmptyNodeList;throw new Error("Selector not supported yet ("+t+")")}return this.createChildNodes_(!1),this.childNodeList_},goog.ds.JsDataSource.prototype.createChildNodes_=function(t){if(!this.childNodeList_||t)if(goog.isObject(this.root_)){var o,e=new goog.ds.BasicNodeList;if(goog.isArray(this.root_))for(var s=this.root_.length,a=0;a<s;a++){var i=this.root_[a],r=i.id,g=null!=r?String(r):"["+a+"]";o=new goog.ds.JsDataSource(i,g,this),e.add(o)}else for(var g in this.root_){var d=this.root_[g];d.getDataName?e.add(d):goog.isFunction(d)||(o=new goog.ds.JsDataSource(d,g,this),e.add(o))}this.childNodeList_=e}else this.childNodeList_=new goog.ds.EmptyNodeList},goog.ds.JsDataSource.prototype.getChildNode=function(t,o){if(!this.root_)return null;var e=this.getChildNodes().get(t);if(!e&&o){var s={};goog.isArray(this.root_)?(s.id=t,this.root_.push(s)):this.root_[t]=s,e=new goog.ds.JsDataSource(s,t,this),this.childNodeList_&&this.childNodeList_.add(e)}return e},goog.ds.JsDataSource.prototype.getChildNodeValue=function(t){if(this.childNodeList_){var o=this.getChildNodes().get(t);return o?o.get():null}return this.root_?this.root_[t]:null},goog.ds.JsDataSource.prototype.setChildNode=function(t,o){var e=null,s=null,a=!1;if(null!=o&&(o.getDataName?(s=o).parent_=this:s=goog.isArray(o)||goog.isObject(o)?new goog.ds.JsDataSource(o,t,this):new goog.ds.JsPropertyDataSource(this.root_,t,this)),goog.isArray(this.root_)){this.createChildNodes_();var i=this.childNodeList_.indexOf(t);if(null==o)(r=this.childNodeList_.get(t))&&(e=r.getDataPath()),this.root_.splice(i,1);else i?this.root_[i]=o:this.root_.push(o);null==i&&(a=!0),this.childNodeList_.setNode(t,s)}else if(goog.isObject(this.root_)){var r;if(null==o)this.createChildNodes_(),(r=this.childNodeList_.get(t))&&(e=r.getDataPath()),delete this.root_[t];else this.root_[t]||(a=!0),this.root_[t]=o;this.childNodeList_&&this.childNodeList_.setNode(t,s)}var g=goog.ds.DataManager.getInstance();return s?(g.fireDataChange(s.getDataPath()),a&&this.isList()&&(g.fireDataChange(this.getDataPath()),g.fireDataChange(this.getDataPath()+"/count()"))):e&&(g.fireDataChange(e),this.isList()&&(g.fireDataChange(this.getDataPath()),g.fireDataChange(this.getDataPath()+"/count()"))),s},goog.ds.JsDataSource.prototype.getDataName=function(){return this.dataName_},goog.ds.JsDataSource.prototype.setDataName=function(t){this.dataName_=t},goog.ds.JsDataSource.prototype.getDataPath=function(){var t="";return this.parent_&&(t=this.parent_.getDataPath()+goog.ds.STR_PATH_SEPARATOR),t+this.dataName_},goog.ds.JsDataSource.prototype.load=function(){},goog.ds.JsDataSource.prototype.getLoadState=function(){return null==this.root_?goog.ds.LoadState.NOT_LOADED:goog.ds.LoadState.LOADED},goog.ds.JsDataSource.prototype.isList=function(){return null!=this.isList_?this.isList_:goog.isArray(this.root_)},goog.ds.JsPropertyDataSource=function(t,o,e){goog.ds.BaseDataNode.call(this),this.dataName_=o,this.parent_=t,this.parentDataNode_=e||this.parent_},goog.inherits(goog.ds.JsPropertyDataSource,goog.ds.BaseDataNode),goog.ds.JsPropertyDataSource.prototype.get=function(){return this.parent_[this.dataName_]},goog.ds.JsPropertyDataSource.prototype.set=function(t){var o=this.parent_[this.dataName_];this.parent_[this.dataName_]=t,o!=t&&goog.ds.DataManager.getInstance().fireDataChange(this.getDataPath())},goog.ds.JsPropertyDataSource.prototype.getDataName=function(){return this.dataName_},goog.ds.JsPropertyDataSource.prototype.getParent=function(){return this.parentDataNode_};