goog.provide("goog.tweak.Registry"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.log"),goog.require("goog.string"),goog.require("goog.tweak.BasePrimitiveSetting"),goog.require("goog.tweak.BaseSetting"),goog.require("goog.tweak.BooleanSetting"),goog.require("goog.tweak.NumericSetting"),goog.require("goog.tweak.StringSetting"),goog.require("goog.uri.utils"),goog.tweak.Registry=function(e,t){this.entryMap_={},this.parsedQueryParams_=goog.tweak.Registry.parseQueryParams(e),this.onRegisterListeners_=[],this.compilerDefaultValueOverrides_=t,this.defaultValueOverrides_={}},goog.tweak.Registry.prototype.logger_=goog.log.getLogger("goog.tweak.Registry"),goog.tweak.Registry.parseQueryParams=function(e){for(var t=e.substr(1).split("&"),r={},o=0,g=t.length;o<g;++o){var a=t[o].split("=");a[0]&&(r[goog.string.urlDecode(a[0]).toLowerCase()]=goog.string.urlDecode(a[1]||""))}return r},goog.tweak.Registry.prototype.register=function(e){var t=e.getId(),r=this.entryMap_[t];if(r){if(r==e)return void goog.log.warning(this.logger_,"Tweak entry registered twice: "+t);goog.asserts.fail("Tweak entry registered twice and with different types: "+t)}var o=t in this.compilerDefaultValueOverrides_?this.compilerDefaultValueOverrides_[t]:this.defaultValueOverrides_[t];void 0!==o&&(goog.asserts.assertInstanceof(e,goog.tweak.BasePrimitiveSetting,"Cannot set the default value of non-primitive setting %s",e.label),e.setDefaultValue(o)),e instanceof goog.tweak.BaseSetting&&e.getParamName()&&e.setInitialQueryParamValue(this.parsedQueryParams_[e.getParamName()]),this.entryMap_[t]=e;for(var g,a=0;g=this.onRegisterListeners_[a];++a)g(e)},goog.tweak.Registry.prototype.addOnRegisterListener=function(e){this.onRegisterListeners_.push(e)},goog.tweak.Registry.prototype.hasEntry=function(e){return e in this.entryMap_},goog.tweak.Registry.prototype.getEntry=function(e){var t=this.entryMap_[e];return goog.asserts.assert(t,"Tweak not registered: %s",e),t},goog.tweak.Registry.prototype.getBooleanSetting=function(e){var t=this.getEntry(e);return goog.asserts.assertInstanceof(t,goog.tweak.BooleanSetting,"getBooleanSetting called on wrong type of BaseSetting"),t},goog.tweak.Registry.prototype.getStringSetting=function(e){var t=this.getEntry(e);return goog.asserts.assertInstanceof(t,goog.tweak.StringSetting,"getStringSetting called on wrong type of BaseSetting"),t},goog.tweak.Registry.prototype.getNumericSetting=function(e){var t=this.getEntry(e);return goog.asserts.assertInstanceof(t,goog.tweak.NumericSetting,"getNumericSetting called on wrong type of BaseSetting"),t},goog.tweak.Registry.prototype.extractEntries=function(e,t){var r=[];for(var o in this.entryMap_){var g=this.entryMap_[o];if(g instanceof goog.tweak.BaseSetting){if(e&&!g.getParamName())continue}else if(t)continue;r.push(g)}return r},goog.tweak.Registry.prototype.makeUrlQuery=function(e){var t=null==e?window.location.search:e,r=this.extractEntries(!0,!0);r.sort(function(e,t){return goog.array.defaultCompare(e.getParamName(),t.getParamName())});for(var o,g=[],a=0;o=r[a];++a){var i=o.getNewValueEncoded();null!=i&&g.push(o.getParamName(),i),t=goog.uri.utils.removeParam(t,encodeURIComponent(o.getParamName()))}var s=goog.uri.utils.buildQueryData(g);return(s=s.replace(/%2C/g,",").replace(/%20/g,"+"))?t?t+"&"+s:"?"+s:t},goog.tweak.Registry.prototype.overrideDefaultValue=function(e,t){goog.asserts.assert(!this.hasEntry(e),"goog.tweak.overrideDefaultValue must be called before the tweak is registered. Tweak: %s",e),this.defaultValueOverrides_[e]=t};