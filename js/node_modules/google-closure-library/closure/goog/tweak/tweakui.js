goog.provide("goog.tweak.EntriesPanel"),goog.provide("goog.tweak.TweakUi"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.dom.safe"),goog.require("goog.html.SafeHtml"),goog.require("goog.html.SafeStyleSheet"),goog.require("goog.object"),goog.require("goog.string.Const"),goog.require("goog.style"),goog.require("goog.tweak"),goog.require("goog.tweak.BaseEntry"),goog.require("goog.tweak.BooleanGroup"),goog.require("goog.tweak.BooleanInGroupSetting"),goog.require("goog.tweak.BooleanSetting"),goog.require("goog.tweak.ButtonAction"),goog.require("goog.tweak.NumericSetting"),goog.require("goog.tweak.StringSetting"),goog.require("goog.ui.Zippy"),goog.require("goog.userAgent"),goog.tweak.TweakUi=function(e,o){this.registry_=e,this.entriesPanel_,this.domHelper_=o||goog.dom.getDomHelper(),e.addOnRegisterListener(goog.bind(this.onNewRegisteredEntry_,this))},goog.tweak.TweakUi.ROOT_PANEL_CLASS_=goog.getCssName("goog-tweak-root"),goog.tweak.TweakUi.ENTRY_CSS_CLASS_=goog.getCssName("goog-tweak-entry"),goog.tweak.TweakUi.ENTRY_CSS_CLASSES_=goog.tweak.TweakUi.ENTRY_CSS_CLASS_+" "+goog.getCssName("goog-inline-block"),goog.tweak.TweakUi.ENTRY_GROUP_CSS_CLASSES_=goog.tweak.TweakUi.ENTRY_CSS_CLASS_,goog.tweak.TweakUi.STYLE_SHEET_INSTALLED_MARKER_="__closure_tweak_installed_",goog.tweak.TweakUi.CSS_STYLES_=function(){var e=goog.userAgent.MOBILE,o=goog.userAgent.IE,t="."+goog.tweak.TweakUi.ROOT_PANEL_CLASS_,a="."+goog.getCssName("goog-inline-block"),g=[goog.html.SafeStyleSheet.createRule(t,{background:"#ffc",padding:"0 4px"})];return o||g.push(goog.html.SafeStyleSheet.createRule(a,{display:"inline-block"})),e&&g.push(goog.html.SafeStyleSheet.createRule(t+","+t+" fieldset",{"line-height":"2em"})),goog.html.SafeStyleSheet.concat(g)}(),goog.tweak.TweakUi.create=function(e){var o=goog.tweak.getRegistry();if(o){var t=new goog.tweak.TweakUi(o,e);return t.render(),t.getRootElement()}},goog.tweak.TweakUi.createCollapsible=function(e){var o=goog.tweak.getRegistry();if(o){var t=e||goog.dom.getDomHelper(),a=t.createDom(goog.dom.TagName.A,{href:"javascript:;"},"Show Tweaks"),g=t.createDom(goog.dom.TagName.A,{href:"javascript:;"},"Hide Tweaks"),r=t.createDom(goog.dom.TagName.DIV,null,a);return new goog.ui.Zippy(a,function(){var e=new goog.tweak.TweakUi(o,t);e.render(),g.style.marginRight="10px";var a=e.getRootElement();return a.insertBefore(g,a.firstChild),r.appendChild(a),a},!1,g),r}},goog.tweak.TweakUi.entryCompare_=function(e,o){return goog.array.defaultCompare(e instanceof goog.tweak.NamespaceEntry_,o instanceof goog.tweak.NamespaceEntry_)||goog.array.defaultCompare(e instanceof goog.tweak.BooleanGroup,o instanceof goog.tweak.BooleanGroup)||goog.array.defaultCompare(e instanceof goog.tweak.ButtonAction,o instanceof goog.tweak.ButtonAction)||goog.array.defaultCompare(e.label,o.label)||goog.array.defaultCompare(e.getId(),o.getId())},goog.tweak.TweakUi.isGroupEntry_=function(e){return e instanceof goog.tweak.NamespaceEntry_||e instanceof goog.tweak.BooleanGroup},goog.tweak.TweakUi.extractBooleanGroupEntries_=function(e){var o=goog.object.getValues(e.getChildEntries());return o.sort(goog.tweak.TweakUi.entryCompare_),o},goog.tweak.TweakUi.extractNamespace_=function(e){var o=/.+(?=\.)/.exec(e.getId());return o?o[0]:""},goog.tweak.TweakUi.getNamespacedLabel_=function(e){var o=e.label;return o==e.getId()&&(o=o.substr(o.lastIndexOf(".")+1)),o},goog.tweak.TweakUi.prototype.getRootElement=function(){return goog.asserts.assert(this.entriesPanel_,"TweakUi.getRootElement called before render()."),this.entriesPanel_.getRootElement()},goog.tweak.TweakUi.prototype.restartWithAppliedTweaks_=function(){var e=this.registry_.makeUrlQuery(),o=this.domHelper_.getWindow();e!=o.location.search?o.location.search=e:o.location.reload()},goog.tweak.TweakUi.prototype.installStyles_=function(){var e=this.domHelper_.getDocument();goog.tweak.TweakUi.STYLE_SHEET_INSTALLED_MARKER_ in e||(goog.style.installSafeStyleSheet(goog.tweak.TweakUi.CSS_STYLES_,e),e[goog.tweak.TweakUi.STYLE_SHEET_INSTALLED_MARKER_]=!0)},goog.tweak.TweakUi.prototype.render=function(){this.installStyles_();var e=this.domHelper_,o=e.createDom(goog.dom.TagName.BUTTON,{style:"font-weight:bold"},"Apply Tweaks");o.onclick=goog.bind(this.restartWithAppliedTweaks_,this);var t=new goog.tweak.EntriesPanel([],e),a=t.render(o);a.className+=" "+goog.tweak.TweakUi.ROOT_PANEL_CLASS_,this.entriesPanel_=t;for(var g,r=this.registry_.extractEntries(!0,!1),n=0;g=r[n];n++)this.insertEntry_(g);return a},goog.tweak.TweakUi.prototype.onNewRegisteredEntry_=function(e){this.entriesPanel_&&this.insertEntry_(e)},goog.tweak.TweakUi.prototype.insertEntry_=function(e){var o=this.entriesPanel_,t=goog.tweak.TweakUi.extractNamespace_(e);if(t){var a=goog.tweak.NamespaceEntry_.ID_PREFIX+t,g=o.childPanels[a];g?o=g:e=new goog.tweak.NamespaceEntry_(t,[e])}if(e instanceof goog.tweak.BooleanInGroupSetting){var r=e.getGroup();o=o.childPanels[r.getId()]}goog.asserts.assert(o,"Missing panel for entry %s",e.getId()),o.insertEntry(e)},goog.tweak.EntriesPanel=function(e,o){this.entries_=e;var t=this;this.boundHelpOnClickHandler_=function(){t.onHelpClick_(this.parentNode)},this.rootElem_,this.mainPanel_,this.showAllDescriptionsState_,this.domHelper_=o||goog.dom.getDomHelper(),this.childPanels={}},goog.tweak.EntriesPanel.prototype.getRootElement=function(){return goog.asserts.assert(this.rootElem_,"EntriesPanel.getRootElement called before render()."),this.rootElem_},goog.tweak.EntriesPanel.prototype.render=function(e){var o=this.domHelper_,t=this.entries_,a=o.createDom(goog.dom.TagName.DIV),g=o.createDom(goog.dom.TagName.A,{href:"javascript:;",onclick:goog.bind(this.toggleAllDescriptions,this)},"Toggle all Descriptions");a.appendChild(g);var r=o.createElement(goog.dom.TagName.DIV);this.mainPanel_=r;for(var n,i=0;n=t[i];i++)r.appendChild(this.createEntryElem_(n));return e&&r.appendChild(e),a.appendChild(r),this.rootElem_=a,a},goog.tweak.EntriesPanel.prototype.insertEntry=function(e){var o=-goog.array.binarySearch(this.entries_,e,goog.tweak.TweakUi.entryCompare_)-1;goog.asserts.assert(o>=0,"insertEntry failed for %s",e.getId()),goog.array.insertAt(this.entries_,e,o),this.mainPanel_.insertBefore(this.createEntryElem_(e),this.mainPanel_.childNodes[o]||null)},goog.tweak.EntriesPanel.prototype.createEntryElem_=function(e){var o=this.domHelper_,t=goog.tweak.TweakUi.isGroupEntry_(e),a=t?goog.tweak.TweakUi.ENTRY_GROUP_CSS_CLASSES_:goog.tweak.TweakUi.ENTRY_CSS_CLASSES_,g=t?goog.dom.TagName.SPAN:goog.dom.TagName.LABEL;return o.createDom(goog.dom.TagName.DIV,a,o.createDom(g,{title:e.description,style:"color:"+(e.isRestartRequired()?"":"blue")},this.createTweakEntryDom_(e)),this.createHelpElem_(e))},goog.tweak.EntriesPanel.prototype.onHelpClick_=function(e){this.showDescription_(e,!e.style.display)},goog.tweak.EntriesPanel.prototype.showDescription_=function(e,o){var t=e.lastChild.lastChild;goog.style.setElementShown(t,o),e.style.display=o?"block":""},goog.tweak.EntriesPanel.prototype.createHelpElem_=function(e){var o=this.domHelper_.createElement(goog.dom.TagName.SPAN);goog.dom.safe.setInnerHtml(o,goog.html.SafeHtml.concat(goog.html.SafeHtml.create("b",{style:goog.string.Const.from("padding:0 1em 0 .5em")},"?"),goog.html.SafeHtml.create("span",{style:goog.string.Const.from("display:none;color:#666")}))),o.onclick=this.boundHelpOnClickHandler_;var t=o.lastChild;return e.isRestartRequired()?goog.dom.setTextContent(t,e.description):goog.dom.safe.setInnerHtml(t,goog.html.SafeHtml.concat(goog.html.SafeHtml.htmlEscape(e.description),goog.html.SafeHtml.create("span",{style:goog.string.Const.from("color: blue")},"(no restart required)"))),o},goog.tweak.EntriesPanel.prototype.toggleAllDescriptions=function(){var e=!this.showAllDescriptionsState_;this.showAllDescriptionsState_=e;for(var o,t=this.domHelper_.getElementsByTagNameAndClass(goog.dom.TagName.DIV,goog.tweak.TweakUi.ENTRY_CSS_CLASS_,this.rootElem_),a=0;o=t[a];a++)this.showDescription_(o,e)},goog.tweak.EntriesPanel.prototype.createComboBoxDom_=function(e,o,t){var a=this.domHelper_,g=a.getDocument().createDocumentFragment();g.appendChild(a.createTextNode(o+": "));for(var r=a.createElement(goog.dom.TagName.SELECT),n=e.getValidValues(),i=0,s=n.length;i<s;++i){var l=a.createElement(goog.dom.TagName.OPTION);l.text=String(n[i]),l.value=String(n[i]),r.appendChild(l)}return g.appendChild(r),r.value=String(e.getNewValue()),r.onchange=t,e.addCallback(function(){r.value=String(e.getNewValue())}),g},goog.tweak.EntriesPanel.prototype.createBooleanSettingDom_=function(e,o){var t=this.domHelper_,a=t.getDocument().createDocumentFragment(),g=t.createDom(goog.dom.TagName.INPUT,{type:"checkbox"});return a.appendChild(g),a.appendChild(t.createTextNode(o)),g.defaultChecked=e.getNewValue(),g.checked=e.getNewValue(),g.onchange=function(){e.setValue(g.checked)},e.addCallback(function(){g.checked=e.getNewValue()}),a},goog.tweak.EntriesPanel.prototype.createSubPanelDom_=function(e,o,t){var a=this.domHelper_,g=a.createDom(goog.dom.TagName.A,{href:"javascript:;"},o+" »"),r=a.createDom(goog.dom.TagName.A,{href:"javascript:;"},"« "+o);r.style.marginRight="10px";var n=new goog.tweak.EntriesPanel(t,a);this.childPanels[e.getId()]=n;var i=n.render(),s=i.firstChild,l=a.createDom(goog.dom.TagName.FIELDSET,goog.getCssName("goog-inline-block"),a.createDom(goog.dom.TagName.LEGEND,null,r,s),i);new goog.ui.Zippy(g,l,!1,r);var c=a.getDocument().createDocumentFragment();return c.appendChild(g),c.appendChild(l),c},goog.tweak.EntriesPanel.prototype.createTextBoxDom_=function(e,o,t){var a=this.domHelper_,g=a.getDocument().createDocumentFragment();g.appendChild(a.createTextNode(o+": "));var r=a.createDom(goog.dom.TagName.INPUT,{value:String(e.getNewValue()),size:5,onblur:t});return g.appendChild(r),e.addCallback(function(){r.value=String(e.getNewValue())}),g},goog.tweak.EntriesPanel.prototype.createButtonActionDom_=function(e,o){return this.domHelper_.createDom(goog.dom.TagName.BUTTON,{onclick:goog.bind(e.fireCallbacks,e)},o)},goog.tweak.EntriesPanel.prototype.createTweakEntryDom_=function(e){var o=goog.tweak.TweakUi.getNamespacedLabel_(e);if(e instanceof goog.tweak.BooleanSetting)return this.createBooleanSettingDom_(e,o);if(e instanceof goog.tweak.BooleanGroup){var t=goog.tweak.TweakUi.extractBooleanGroupEntries_(e);return this.createSubPanelDom_(e,o,t)}if(e instanceof goog.tweak.StringSetting){var a=function(){e.setValue(this.value)};return e.getValidValues()?this.createComboBoxDom_(e,o,a):this.createTextBoxDom_(e,o,a)}return e instanceof goog.tweak.NumericSetting?(a=function(){isNaN(this.value)?this.value=e.getNewValue():e.setValue(+this.value)},e.getValidValues()?this.createComboBoxDom_(e,o,a):this.createTextBoxDom_(e,o,a)):e instanceof goog.tweak.NamespaceEntry_?this.createSubPanelDom_(e,e.label,e.entries):(goog.asserts.assertInstanceof(e,goog.tweak.ButtonAction,"invalid entry: %s",e),this.createButtonActionDom_(e,o))},goog.tweak.NamespaceEntry_=function(e,o){goog.tweak.BaseEntry.call(this,goog.tweak.NamespaceEntry_.ID_PREFIX+e,"Tweaks within the "+e+" namespace."),this.entries=o,this.label=e},goog.inherits(goog.tweak.NamespaceEntry_,goog.tweak.BaseEntry),goog.tweak.NamespaceEntry_.ID_PREFIX="!";