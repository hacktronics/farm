goog.provide("goog.spell.SpellCheck"),goog.provide("goog.spell.SpellCheck.WordChangedEvent"),goog.require("goog.Timer"),goog.require("goog.events.Event"),goog.require("goog.events.EventTarget"),goog.require("goog.structs.Set"),goog.spell.SpellCheck=function(e,o){goog.events.EventTarget.call(this),this.lookupFunction_=e||null,this.unknownWords_=new goog.structs.Set,this.setLanguage(o)},goog.inherits(goog.spell.SpellCheck,goog.events.EventTarget),goog.spell.SpellCheck.LOOKUP_DELAY_=100,goog.spell.SpellCheck.EventType={READY:"ready",ERROR:"error",WORD_CHANGED:"wordchanged"},goog.spell.SpellCheck.cache_={},goog.spell.SpellCheck.prototype.language_="",goog.spell.SpellCheck.prototype.cache_,goog.spell.SpellCheck.prototype.queueTimer_=0,goog.spell.SpellCheck.prototype.lookupInProgress_=!1,goog.spell.SpellCheck.WordStatus={UNKNOWN:0,VALID:1,INVALID:2,IGNORED:3,CORRECTED:4},goog.spell.SpellCheck.CacheIndex={STATUS:0,SUGGESTIONS:1},goog.spell.SpellCheck.WORD_BOUNDARY_CHARS='\t\r\nÂ  !"#$%&()*+,-./\\\\:;<=>?@\\[\\]^_`{|}~',goog.spell.SpellCheck.WORD_BOUNDARY_REGEX=new RegExp("["+goog.spell.SpellCheck.WORD_BOUNDARY_CHARS+"]"),goog.spell.SpellCheck.SPLIT_REGEX=new RegExp("([^"+goog.spell.SpellCheck.WORD_BOUNDARY_CHARS+"]*)(["+goog.spell.SpellCheck.WORD_BOUNDARY_CHARS+"]*)"),goog.spell.SpellCheck.prototype.setLookupFunction=function(e){this.lookupFunction_=e},goog.spell.SpellCheck.prototype.setLanguage=function(e){this.language_=e||"",goog.spell.SpellCheck.cache_[this.language_]||(goog.spell.SpellCheck.cache_[this.language_]={}),this.cache_=goog.spell.SpellCheck.cache_[this.language_]},goog.spell.SpellCheck.prototype.getLanguage=function(){return this.language_},goog.spell.SpellCheck.prototype.checkBlock=function(e){for(var o,l=e.split(goog.spell.SpellCheck.WORD_BOUNDARY_REGEX),t=l.length,g=0;g<t;g++)o=l[g],this.checkWord_(o);this.queueTimer_||this.lookupInProgress_||!this.unknownWords_.getCount()?0==this.unknownWords_.getCount()&&this.dispatchEvent(goog.spell.SpellCheck.EventType.READY):this.processPending_()},goog.spell.SpellCheck.prototype.checkWord=function(e){var o=this.checkWord_(e);return o!=goog.spell.SpellCheck.WordStatus.UNKNOWN||this.queueTimer_||this.lookupInProgress_||(this.queueTimer_=goog.Timer.callOnce(this.processPending_,goog.spell.SpellCheck.LOOKUP_DELAY_,this)),o},goog.spell.SpellCheck.prototype.checkWord_=function(e){if(!e)return goog.spell.SpellCheck.WordStatus.INVALID;var o=this.cache_[e];return o?o[goog.spell.SpellCheck.CacheIndex.STATUS]:(this.unknownWords_.add(e),goog.spell.SpellCheck.WordStatus.UNKNOWN)},goog.spell.SpellCheck.prototype.processPending=function(){this.unknownWords_.getCount()?this.queueTimer_||this.lookupInProgress_||this.processPending_():this.dispatchEvent(goog.spell.SpellCheck.EventType.READY)},goog.spell.SpellCheck.prototype.processPending_=function(){if(!this.lookupFunction_)throw new Error("No lookup function provided for spell checker.");this.unknownWords_.getCount()?(this.lookupInProgress_=!0,(0,this.lookupFunction_)(this.unknownWords_.getValues(),this,this.lookupCallback_)):this.dispatchEvent(goog.spell.SpellCheck.EventType.READY);this.queueTimer_=0},goog.spell.SpellCheck.prototype.lookupCallback_=function(e){if(null==e)return this.queueTimer_&&(goog.Timer.clear(this.queueTimer_),this.queueTimer_=0),this.lookupInProgress_=!1,void this.dispatchEvent(goog.spell.SpellCheck.EventType.ERROR);for(var o,l=0;o=e[l];l++)this.setWordStatus_(o[0],o[1],o[2]);this.lookupInProgress_=!1,0==this.unknownWords_.getCount()?this.dispatchEvent(goog.spell.SpellCheck.EventType.READY):this.queueTimer_||(this.queueTimer_=goog.Timer.callOnce(this.processPending_,goog.spell.SpellCheck.LOOKUP_DELAY_,this))},goog.spell.SpellCheck.prototype.setWordStatus=function(e,o,l){this.setWordStatus_(e,o,l)},goog.spell.SpellCheck.prototype.setWordStatus_=function(e,o,l){var t=l||[];this.cache_[e]=[o,t],this.unknownWords_.remove(e),this.dispatchEvent(new goog.spell.SpellCheck.WordChangedEvent(this,e,o))},goog.spell.SpellCheck.prototype.getSuggestions=function(e){var o=this.cache_[e];return o?o[goog.spell.SpellCheck.CacheIndex.STATUS]==goog.spell.SpellCheck.WordStatus.INVALID?o[goog.spell.SpellCheck.CacheIndex.SUGGESTIONS]:[]:(this.checkWord(e),[])},goog.spell.SpellCheck.WordChangedEvent=function(e,o,l){goog.events.Event.call(this,goog.spell.SpellCheck.EventType.WORD_CHANGED,e),this.word=o,this.status=l},goog.inherits(goog.spell.SpellCheck.WordChangedEvent,goog.events.Event);