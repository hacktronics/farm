goog.provide("goog.Uri"),goog.provide("goog.Uri.QueryData"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.string"),goog.require("goog.structs"),goog.require("goog.structs.Map"),goog.require("goog.uri.utils"),goog.require("goog.uri.utils.ComponentIndex"),goog.require("goog.uri.utils.StandardQueryParam"),goog.Uri=function(t,e){var o;this.scheme_="",this.userInfo_="",this.domain_="",this.port_=null,this.path_="",this.fragment_="",this.isReadOnly_=!1,this.ignoreCase_=!1,this.queryData_,t instanceof goog.Uri?(this.ignoreCase_=void 0!==e?e:t.getIgnoreCase(),this.setScheme(t.getScheme()),this.setUserInfo(t.getUserInfo()),this.setDomain(t.getDomain()),this.setPort(t.getPort()),this.setPath(t.getPath()),this.setQueryData(t.getQueryData().clone()),this.setFragment(t.getFragment())):t&&(o=goog.uri.utils.split(String(t)))?(this.ignoreCase_=!!e,this.setScheme(o[goog.uri.utils.ComponentIndex.SCHEME]||"",!0),this.setUserInfo(o[goog.uri.utils.ComponentIndex.USER_INFO]||"",!0),this.setDomain(o[goog.uri.utils.ComponentIndex.DOMAIN]||"",!0),this.setPort(o[goog.uri.utils.ComponentIndex.PORT]),this.setPath(o[goog.uri.utils.ComponentIndex.PATH]||"",!0),this.setQueryData(o[goog.uri.utils.ComponentIndex.QUERY_DATA]||"",!0),this.setFragment(o[goog.uri.utils.ComponentIndex.FRAGMENT]||"",!0)):(this.ignoreCase_=!!e,this.queryData_=new goog.Uri.QueryData(null,null,this.ignoreCase_))},goog.Uri.RANDOM_PARAM=goog.uri.utils.StandardQueryParam.RANDOM,goog.Uri.prototype.toString=function(){var t=[],e=this.getScheme();e&&t.push(goog.Uri.encodeSpecialChars_(e,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),":");var o=this.getDomain();if(o||"file"==e){t.push("//");var r=this.getUserInfo();r&&t.push(goog.Uri.encodeSpecialChars_(r,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),"@"),t.push(goog.Uri.removeDoubleEncoding_(goog.string.urlEncode(o)));var i=this.getPort();null!=i&&t.push(":",String(i))}var n=this.getPath();n&&(this.hasDomain()&&"/"!=n.charAt(0)&&t.push("/"),t.push(goog.Uri.encodeSpecialChars_(n,"/"==n.charAt(0)?goog.Uri.reDisallowedInAbsolutePath_:goog.Uri.reDisallowedInRelativePath_,!0)));var g=this.getEncodedQuery();g&&t.push("?",g);var s=this.getFragment();return s&&t.push("#",goog.Uri.encodeSpecialChars_(s,goog.Uri.reDisallowedInFragment_)),t.join("")},goog.Uri.prototype.resolve=function(t){var e=this.clone(),o=t.hasScheme();o?e.setScheme(t.getScheme()):o=t.hasUserInfo(),o?e.setUserInfo(t.getUserInfo()):o=t.hasDomain(),o?e.setDomain(t.getDomain()):o=t.hasPort();var r=t.getPath();if(o)e.setPort(t.getPort());else if(o=t.hasPath()){if("/"!=r.charAt(0))if(this.hasDomain()&&!this.hasPath())r="/"+r;else{var i=e.getPath().lastIndexOf("/");-1!=i&&(r=e.getPath().substr(0,i+1)+r)}r=goog.Uri.removeDotSegments(r)}return o?e.setPath(r):o=t.hasQuery(),o?e.setQueryData(t.getQueryData().clone()):o=t.hasFragment(),o&&e.setFragment(t.getFragment()),e},goog.Uri.prototype.clone=function(){return new goog.Uri(this)},goog.Uri.prototype.getScheme=function(){return this.scheme_},goog.Uri.prototype.setScheme=function(t,e){return this.enforceReadOnly(),this.scheme_=e?goog.Uri.decodeOrEmpty_(t,!0):t,this.scheme_&&(this.scheme_=this.scheme_.replace(/:$/,"")),this},goog.Uri.prototype.hasScheme=function(){return!!this.scheme_},goog.Uri.prototype.getUserInfo=function(){return this.userInfo_},goog.Uri.prototype.setUserInfo=function(t,e){return this.enforceReadOnly(),this.userInfo_=e?goog.Uri.decodeOrEmpty_(t):t,this},goog.Uri.prototype.hasUserInfo=function(){return!!this.userInfo_},goog.Uri.prototype.getDomain=function(){return this.domain_},goog.Uri.prototype.setDomain=function(t,e){return this.enforceReadOnly(),this.domain_=e?goog.Uri.decodeOrEmpty_(t,!0):t,this},goog.Uri.prototype.hasDomain=function(){return!!this.domain_},goog.Uri.prototype.getPort=function(){return this.port_},goog.Uri.prototype.setPort=function(t){if(this.enforceReadOnly(),t){if(t=Number(t),isNaN(t)||t<0)throw new Error("Bad port number "+t);this.port_=t}else this.port_=null;return this},goog.Uri.prototype.hasPort=function(){return null!=this.port_},goog.Uri.prototype.getPath=function(){return this.path_},goog.Uri.prototype.setPath=function(t,e){return this.enforceReadOnly(),this.path_=e?goog.Uri.decodeOrEmpty_(t,!0):t,this},goog.Uri.prototype.hasPath=function(){return!!this.path_},goog.Uri.prototype.hasQuery=function(){return""!==this.queryData_.toString()},goog.Uri.prototype.setQueryData=function(t,e){return this.enforceReadOnly(),t instanceof goog.Uri.QueryData?(this.queryData_=t,this.queryData_.setIgnoreCase(this.ignoreCase_)):(e||(t=goog.Uri.encodeSpecialChars_(t,goog.Uri.reDisallowedInQuery_)),this.queryData_=new goog.Uri.QueryData(t,null,this.ignoreCase_)),this},goog.Uri.prototype.setQuery=function(t,e){return this.setQueryData(t,e)},goog.Uri.prototype.getEncodedQuery=function(){return this.queryData_.toString()},goog.Uri.prototype.getDecodedQuery=function(){return this.queryData_.toDecodedString()},goog.Uri.prototype.getQueryData=function(){return this.queryData_},goog.Uri.prototype.getQuery=function(){return this.getEncodedQuery()},goog.Uri.prototype.setParameterValue=function(t,e){return this.enforceReadOnly(),this.queryData_.set(t,e),this},goog.Uri.prototype.setParameterValues=function(t,e){return this.enforceReadOnly(),goog.isArray(e)||(e=[String(e)]),this.queryData_.setValues(t,e),this},goog.Uri.prototype.getParameterValues=function(t){return this.queryData_.getValues(t)},goog.Uri.prototype.getParameterValue=function(t){return this.queryData_.get(t)},goog.Uri.prototype.getFragment=function(){return this.fragment_},goog.Uri.prototype.setFragment=function(t,e){return this.enforceReadOnly(),this.fragment_=e?goog.Uri.decodeOrEmpty_(t):t,this},goog.Uri.prototype.hasFragment=function(){return!!this.fragment_},goog.Uri.prototype.hasSameDomainAs=function(t){return!((this.hasDomain()||t.hasDomain())&&this.getDomain()!=t.getDomain()||(this.hasPort()||t.hasPort())&&this.getPort()!=t.getPort())},goog.Uri.prototype.makeUnique=function(){return this.enforceReadOnly(),this.setParameterValue(goog.Uri.RANDOM_PARAM,goog.string.getRandomString()),this},goog.Uri.prototype.removeParameter=function(t){return this.enforceReadOnly(),this.queryData_.remove(t),this},goog.Uri.prototype.setReadOnly=function(t){return this.isReadOnly_=t,this},goog.Uri.prototype.isReadOnly=function(){return this.isReadOnly_},goog.Uri.prototype.enforceReadOnly=function(){if(this.isReadOnly_)throw new Error("Tried to modify a read-only Uri")},goog.Uri.prototype.setIgnoreCase=function(t){return this.ignoreCase_=t,this.queryData_&&this.queryData_.setIgnoreCase(t),this},goog.Uri.prototype.getIgnoreCase=function(){return this.ignoreCase_},goog.Uri.parse=function(t,e){return t instanceof goog.Uri?t.clone():new goog.Uri(t,e)},goog.Uri.create=function(t,e,o,r,i,n,g,s){var a=new goog.Uri(null,s);return t&&a.setScheme(t),e&&a.setUserInfo(e),o&&a.setDomain(o),r&&a.setPort(r),i&&a.setPath(i),n&&a.setQueryData(n),g&&a.setFragment(g),a},goog.Uri.resolve=function(t,e){return t instanceof goog.Uri||(t=goog.Uri.parse(t)),e instanceof goog.Uri||(e=goog.Uri.parse(e)),t.resolve(e)},goog.Uri.removeDotSegments=function(t){if(".."==t||"."==t)return"";if(goog.string.contains(t,"./")||goog.string.contains(t,"/.")){for(var e=goog.string.startsWith(t,"/"),o=t.split("/"),r=[],i=0;i<o.length;){var n=o[i++];"."==n?e&&i==o.length&&r.push(""):".."==n?((r.length>1||1==r.length&&""!=r[0])&&r.pop(),e&&i==o.length&&r.push("")):(r.push(n),e=!0)}return r.join("/")}return t},goog.Uri.decodeOrEmpty_=function(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""},goog.Uri.encodeSpecialChars_=function(t,e,o){if("string"==typeof t){var r=encodeURI(t).replace(e,goog.Uri.encodeChar_);return o&&(r=goog.Uri.removeDoubleEncoding_(r)),r}return null},goog.Uri.encodeChar_=function(t){var e=t.charCodeAt(0);return"%"+(e>>4&15).toString(16)+(15&e).toString(16)},goog.Uri.removeDoubleEncoding_=function(t){return t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")},goog.Uri.reDisallowedInSchemeOrUserInfo_=/[#\/\?@]/g,goog.Uri.reDisallowedInRelativePath_=/[\#\?:]/g,goog.Uri.reDisallowedInAbsolutePath_=/[\#\?]/g,goog.Uri.reDisallowedInQuery_=/[\#\?@]/g,goog.Uri.reDisallowedInFragment_=/#/g,goog.Uri.haveSameDomain=function(t,e){var o=goog.uri.utils.split(t),r=goog.uri.utils.split(e);return o[goog.uri.utils.ComponentIndex.DOMAIN]==r[goog.uri.utils.ComponentIndex.DOMAIN]&&o[goog.uri.utils.ComponentIndex.PORT]==r[goog.uri.utils.ComponentIndex.PORT]},goog.Uri.QueryData=function(t,e,o){this.keyMap_=null,this.count_=null,this.encodedQuery_=t||null,this.ignoreCase_=!!o},goog.Uri.QueryData.prototype.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_=new goog.structs.Map,this.count_=0,this.encodedQuery_)){var t=this;goog.uri.utils.parseQueryData(this.encodedQuery_,function(e,o){t.add(goog.string.urlDecode(e),o)})}},goog.Uri.QueryData.createFromMap=function(t,e,o){var r=goog.structs.getKeys(t);if(void 0===r)throw new Error("Keys are undefined");for(var i=new goog.Uri.QueryData(null,null,o),n=goog.structs.getValues(t),g=0;g<r.length;g++){var s=r[g],a=n[g];goog.isArray(a)?i.setValues(s,a):i.add(s,a)}return i},goog.Uri.QueryData.createFromKeysValues=function(t,e,o,r){if(t.length!=e.length)throw new Error("Mismatched lengths for keys/values");for(var i=new goog.Uri.QueryData(null,null,r),n=0;n<t.length;n++)i.add(t[n],e[n]);return i},goog.Uri.QueryData.prototype.getCount=function(){return this.ensureKeyMapInitialized_(),this.count_},goog.Uri.QueryData.prototype.add=function(t,e){this.ensureKeyMapInitialized_(),this.invalidateCache_(),t=this.getKeyName_(t);var o=this.keyMap_.get(t);return o||this.keyMap_.set(t,o=[]),o.push(e),this.count_=goog.asserts.assertNumber(this.count_)+1,this},goog.Uri.QueryData.prototype.remove=function(t){return this.ensureKeyMapInitialized_(),t=this.getKeyName_(t),!!this.keyMap_.containsKey(t)&&(this.invalidateCache_(),this.count_=goog.asserts.assertNumber(this.count_)-this.keyMap_.get(t).length,this.keyMap_.remove(t))},goog.Uri.QueryData.prototype.clear=function(){this.invalidateCache_(),this.keyMap_=null,this.count_=0},goog.Uri.QueryData.prototype.isEmpty=function(){return this.ensureKeyMapInitialized_(),0==this.count_},goog.Uri.QueryData.prototype.containsKey=function(t){return this.ensureKeyMapInitialized_(),t=this.getKeyName_(t),this.keyMap_.containsKey(t)},goog.Uri.QueryData.prototype.containsValue=function(t){var e=this.getValues();return goog.array.contains(e,t)},goog.Uri.QueryData.prototype.forEach=function(t,e){this.ensureKeyMapInitialized_(),this.keyMap_.forEach(function(o,r){goog.array.forEach(o,function(o){t.call(e,o,r,this)},this)},this)},goog.Uri.QueryData.prototype.getKeys=function(){this.ensureKeyMapInitialized_();for(var t=this.keyMap_.getValues(),e=this.keyMap_.getKeys(),o=[],r=0;r<e.length;r++)for(var i=t[r],n=0;n<i.length;n++)o.push(e[r]);return o},goog.Uri.QueryData.prototype.getValues=function(t){this.ensureKeyMapInitialized_();var e=[];if("string"==typeof t)this.containsKey(t)&&(e=goog.array.concat(e,this.keyMap_.get(this.getKeyName_(t))));else for(var o=this.keyMap_.getValues(),r=0;r<o.length;r++)e=goog.array.concat(e,o[r]);return e},goog.Uri.QueryData.prototype.set=function(t,e){return this.ensureKeyMapInitialized_(),this.invalidateCache_(),t=this.getKeyName_(t),this.containsKey(t)&&(this.count_=goog.asserts.assertNumber(this.count_)-this.keyMap_.get(t).length),this.keyMap_.set(t,[e]),this.count_=goog.asserts.assertNumber(this.count_)+1,this},goog.Uri.QueryData.prototype.get=function(t,e){if(!t)return e;var o=this.getValues(t);return o.length>0?String(o[0]):e},goog.Uri.QueryData.prototype.setValues=function(t,e){this.remove(t),e.length>0&&(this.invalidateCache_(),this.keyMap_.set(this.getKeyName_(t),goog.array.clone(e)),this.count_=goog.asserts.assertNumber(this.count_)+e.length)},goog.Uri.QueryData.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";for(var t=[],e=this.keyMap_.getKeys(),o=0;o<e.length;o++)for(var r=e[o],i=goog.string.urlEncode(r),n=this.getValues(r),g=0;g<n.length;g++){var s=i;""!==n[g]&&(s+="="+goog.string.urlEncode(n[g])),t.push(s)}return this.encodedQuery_=t.join("&")},goog.Uri.QueryData.prototype.toDecodedString=function(){return goog.Uri.decodeOrEmpty_(this.toString())},goog.Uri.QueryData.prototype.invalidateCache_=function(){this.encodedQuery_=null},goog.Uri.QueryData.prototype.filterKeys=function(t){return this.ensureKeyMapInitialized_(),this.keyMap_.forEach(function(e,o){goog.array.contains(t,o)||this.remove(o)},this),this},goog.Uri.QueryData.prototype.clone=function(){var t=new goog.Uri.QueryData;return t.encodedQuery_=this.encodedQuery_,this.keyMap_&&(t.keyMap_=this.keyMap_.clone(),t.count_=this.count_),t},goog.Uri.QueryData.prototype.getKeyName_=function(t){var e=String(t);return this.ignoreCase_&&(e=e.toLowerCase()),e},goog.Uri.QueryData.prototype.setIgnoreCase=function(t){t&&!this.ignoreCase_&&(this.ensureKeyMapInitialized_(),this.invalidateCache_(),this.keyMap_.forEach(function(t,e){var o=e.toLowerCase();e!=o&&(this.remove(e),this.setValues(o,t))},this)),this.ignoreCase_=t},goog.Uri.QueryData.prototype.extend=function(t){for(var e=0;e<arguments.length;e++){var o=arguments[e];goog.structs.forEach(o,function(t,e){this.add(e,t)},this)}};