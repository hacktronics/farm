goog.provide("goog.dom.browserrange.W3cRange"),goog.require("goog.array"),goog.require("goog.dom"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.RangeEndpoint"),goog.require("goog.dom.TagName"),goog.require("goog.dom.browserrange.AbstractRange"),goog.require("goog.string"),goog.require("goog.userAgent"),goog.dom.browserrange.W3cRange=function(o){this.range_=o},goog.inherits(goog.dom.browserrange.W3cRange,goog.dom.browserrange.AbstractRange),goog.dom.browserrange.W3cRange.getBrowserRangeForNode=function(o){var e=goog.dom.getOwnerDocument(o).createRange();if(o.nodeType==goog.dom.NodeType.TEXT)e.setStart(o,0),e.setEnd(o,o.length);else if(goog.dom.browserrange.canContainRangeEndpoint(o)){for(var g,n=o;(g=n.firstChild)&&goog.dom.browserrange.canContainRangeEndpoint(g);)n=g;for(e.setStart(n,0),n=o;(g=n.lastChild)&&goog.dom.browserrange.canContainRangeEndpoint(g);)n=g;e.setEnd(n,n.nodeType==goog.dom.NodeType.ELEMENT?n.childNodes.length:n.length)}else{var r=o.parentNode,t=goog.array.indexOf(r.childNodes,o);e.setStart(r,t),e.setEnd(r,t+1)}return e},goog.dom.browserrange.W3cRange.getBrowserRangeForNodes=function(o,e,g,n){var r=goog.dom.getOwnerDocument(o).createRange();return r.setStart(o,e),r.setEnd(g,n),r},goog.dom.browserrange.W3cRange.createFromNodeContents=function(o){return new goog.dom.browserrange.W3cRange(goog.dom.browserrange.W3cRange.getBrowserRangeForNode(o))},goog.dom.browserrange.W3cRange.createFromNodes=function(o,e,g,n){return new goog.dom.browserrange.W3cRange(goog.dom.browserrange.W3cRange.getBrowserRangeForNodes(o,e,g,n))},goog.dom.browserrange.W3cRange.prototype.clone=function(){return new this.constructor(this.range_.cloneRange())},goog.dom.browserrange.W3cRange.prototype.getBrowserRange=function(){return this.range_},goog.dom.browserrange.W3cRange.prototype.getContainer=function(){return this.range_.commonAncestorContainer},goog.dom.browserrange.W3cRange.prototype.getStartNode=function(){return this.range_.startContainer},goog.dom.browserrange.W3cRange.prototype.getStartOffset=function(){return this.range_.startOffset},goog.dom.browserrange.W3cRange.prototype.getEndNode=function(){return this.range_.endContainer},goog.dom.browserrange.W3cRange.prototype.getEndOffset=function(){return this.range_.endOffset},goog.dom.browserrange.W3cRange.prototype.compareBrowserRangeEndpoints=function(o,e,g){return this.range_.compareBoundaryPoints(g==goog.dom.RangeEndpoint.START?e==goog.dom.RangeEndpoint.START?goog.global.Range.START_TO_START:goog.global.Range.START_TO_END:e==goog.dom.RangeEndpoint.START?goog.global.Range.END_TO_START:goog.global.Range.END_TO_END,o)},goog.dom.browserrange.W3cRange.prototype.isCollapsed=function(){return this.range_.collapsed},goog.dom.browserrange.W3cRange.prototype.getText=function(){return this.range_.toString()},goog.dom.browserrange.W3cRange.prototype.getValidHtml=function(){var o=goog.dom.getDomHelper(this.range_.startContainer).createDom(goog.dom.TagName.DIV);o.appendChild(this.range_.cloneContents());var e=o.innerHTML;if(goog.string.startsWith(e,"<")||!this.isCollapsed()&&!goog.string.contains(e,"<"))return e;var g=this.getContainer();return g=g.nodeType==goog.dom.NodeType.ELEMENT?g:g.parentNode,goog.dom.getOuterHtml(g.cloneNode(!1)).replace(">",">"+e)},goog.dom.browserrange.W3cRange.prototype.select=function(o){var e=goog.dom.getWindow(goog.dom.getOwnerDocument(this.getStartNode()));this.selectInternal(e.getSelection(),o)},goog.dom.browserrange.W3cRange.prototype.selectInternal=function(o,e){o.removeAllRanges(),o.addRange(this.range_)},goog.dom.browserrange.W3cRange.prototype.removeContents=function(){var o=this.range_;if(o.extractContents(),o.startContainer.hasChildNodes()){var e=o.startContainer.childNodes[o.startOffset];if(e){var g=e.previousSibling;""==goog.dom.getRawTextContent(e)&&goog.dom.removeNode(e),g&&""==goog.dom.getRawTextContent(g)&&goog.dom.removeNode(g)}}if(goog.userAgent.EDGE_OR_IE){var n=this.getStartNode(),r=this.getStartOffset(),t=this.getEndNode(),a=this.getEndOffset(),d=n.nextSibling;n==t&&n.parentNode&&n.nodeType==goog.dom.NodeType.TEXT&&d&&d.nodeType==goog.dom.NodeType.TEXT&&(n.nodeValue+=d.nodeValue,goog.dom.removeNode(d),o.setStart(n,r),o.setEnd(t,a))}},goog.dom.browserrange.W3cRange.prototype.surroundContents=function(o){return this.range_.surroundContents(o),o},goog.dom.browserrange.W3cRange.prototype.insertNode=function(o,e){var g=this.range_.cloneRange();return g.collapse(e),g.insertNode(o),g.detach(),o},goog.dom.browserrange.W3cRange.prototype.surroundWithNodes=function(o,e){var g=goog.dom.getWindow(goog.dom.getOwnerDocument(this.getStartNode())),n=goog.dom.Range.createFromWindow(g);if(n)var r=n.getStartNode(),t=n.getEndNode(),a=n.getStartOffset(),d=n.getEndOffset();var s=this.range_.cloneRange(),i=this.range_.cloneRange();if(s.collapse(!1),i.collapse(!0),s.insertNode(e),i.insertNode(o),s.detach(),i.detach(),n){var c=function(g){return g==o||g==e};if(r.nodeType==goog.dom.NodeType.TEXT)for(;a>r.length;){a-=r.length;do{r=r.nextSibling}while(c(r))}if(t.nodeType==goog.dom.NodeType.TEXT)for(;d>t.length;){d-=t.length;do{t=t.nextSibling}while(c(t))}goog.dom.Range.createFromNodes(r,a,t,d).select()}},goog.dom.browserrange.W3cRange.prototype.collapse=function(o){this.range_.collapse(o)};