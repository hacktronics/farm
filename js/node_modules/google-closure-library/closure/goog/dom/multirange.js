goog.provide("goog.dom.MultiRange"),goog.provide("goog.dom.MultiRangeIterator"),goog.require("goog.array"),goog.require("goog.dom"),goog.require("goog.dom.AbstractMultiRange"),goog.require("goog.dom.AbstractRange"),goog.require("goog.dom.RangeIterator"),goog.require("goog.dom.RangeType"),goog.require("goog.dom.SavedRange"),goog.require("goog.dom.TextRange"),goog.require("goog.iter"),goog.require("goog.iter.StopIteration"),goog.require("goog.log"),goog.dom.MultiRange=function(){this.logger_=goog.log.getLogger("goog.dom.MultiRange"),this.browserRanges_=[],this.ranges_=[],this.sortedRanges_=null,this.container_=null},goog.inherits(goog.dom.MultiRange,goog.dom.AbstractMultiRange),goog.dom.MultiRange.createFromBrowserSelection=function(t){for(var o=new goog.dom.MultiRange,e=0,g=t.rangeCount;e<g;e++)o.browserRanges_.push(t.getRangeAt(e));return o},goog.dom.MultiRange.createFromBrowserRanges=function(t){var o=new goog.dom.MultiRange;return o.browserRanges_=goog.array.clone(t),o},goog.dom.MultiRange.createFromTextRanges=function(t){var o=new goog.dom.MultiRange;return o.ranges_=t,o.browserRanges_=goog.array.map(t,function(t){return t.getBrowserRangeObject()}),o},goog.dom.MultiRange.prototype.clearCachedValues_=function(){this.ranges_=[],this.sortedRanges_=null,this.container_=null},goog.dom.MultiRange.prototype.clone=function(){return goog.dom.MultiRange.createFromBrowserRanges(this.browserRanges_)},goog.dom.MultiRange.prototype.getType=function(){return goog.dom.RangeType.MULTI},goog.dom.MultiRange.prototype.getBrowserRangeObject=function(){return this.browserRanges_.length>1&&goog.log.warning(this.logger_,"getBrowserRangeObject called on MultiRange with more than 1 range"),this.browserRanges_[0]},goog.dom.MultiRange.prototype.setBrowserRangeObject=function(t){return!1},goog.dom.MultiRange.prototype.getTextRangeCount=function(){return this.browserRanges_.length},goog.dom.MultiRange.prototype.getTextRange=function(t){return this.ranges_[t]||(this.ranges_[t]=goog.dom.TextRange.createFromBrowserRange(this.browserRanges_[t])),this.ranges_[t]},goog.dom.MultiRange.prototype.getContainer=function(){if(!this.container_){for(var t=[],o=0,e=this.getTextRangeCount();o<e;o++)t.push(this.getTextRange(o).getContainer());this.container_=goog.dom.findCommonAncestor.apply(null,t)}return this.container_},goog.dom.MultiRange.prototype.getSortedRanges=function(){return this.sortedRanges_||(this.sortedRanges_=this.getTextRanges(),this.sortedRanges_.sort(function(t,o){var e=t.getStartNode(),g=t.getStartOffset(),r=o.getStartNode(),n=o.getStartOffset();return e==r&&g==n?0:goog.dom.Range.isReversed(e,g,r,n)?1:-1})),this.sortedRanges_},goog.dom.MultiRange.prototype.getStartNode=function(){return this.getSortedRanges()[0].getStartNode()},goog.dom.MultiRange.prototype.getStartOffset=function(){return this.getSortedRanges()[0].getStartOffset()},goog.dom.MultiRange.prototype.getEndNode=function(){return goog.array.peek(this.getSortedRanges()).getEndNode()},goog.dom.MultiRange.prototype.getEndOffset=function(){return goog.array.peek(this.getSortedRanges()).getEndOffset()},goog.dom.MultiRange.prototype.isRangeInDocument=function(){return goog.array.every(this.getTextRanges(),function(t){return t.isRangeInDocument()})},goog.dom.MultiRange.prototype.isCollapsed=function(){return 0==this.browserRanges_.length||1==this.browserRanges_.length&&this.getTextRange(0).isCollapsed()},goog.dom.MultiRange.prototype.getText=function(){return goog.array.map(this.getTextRanges(),function(t){return t.getText()}).join("")},goog.dom.MultiRange.prototype.getHtmlFragment=function(){return this.getValidHtml()},goog.dom.MultiRange.prototype.getValidHtml=function(){return goog.array.map(this.getTextRanges(),function(t){return t.getValidHtml()}).join("")},goog.dom.MultiRange.prototype.getPastableHtml=function(){return this.getValidHtml()},goog.dom.MultiRange.prototype.__iterator__=function(t){return new goog.dom.MultiRangeIterator(this)},goog.dom.MultiRange.prototype.select=function(){var t=goog.dom.AbstractRange.getBrowserSelectionForWindow(this.getWindow());t.removeAllRanges();for(var o=0,e=this.getTextRangeCount();o<e;o++)t.addRange(this.getTextRange(o).getBrowserRangeObject())},goog.dom.MultiRange.prototype.removeContents=function(){goog.array.forEach(this.getTextRanges(),function(t){t.removeContents()})},goog.dom.MultiRange.prototype.saveUsingDom=function(){return new goog.dom.DomSavedMultiRange_(this)},goog.dom.MultiRange.prototype.collapse=function(t){if(!this.isCollapsed()){var o=t?this.getTextRange(0):this.getTextRange(this.getTextRangeCount()-1);this.clearCachedValues_(),o.collapse(t),this.ranges_=[o],this.sortedRanges_=[o],this.browserRanges_=[o.getBrowserRangeObject()]}},goog.dom.DomSavedMultiRange_=function(t){this.savedRanges_=goog.array.map(t.getTextRanges(),function(t){return t.saveUsingDom()})},goog.inherits(goog.dom.DomSavedMultiRange_,goog.dom.SavedRange),goog.dom.DomSavedMultiRange_.prototype.restoreInternal=function(){var t=goog.array.map(this.savedRanges_,function(t){return t.restore()});return goog.dom.MultiRange.createFromTextRanges(t)},goog.dom.DomSavedMultiRange_.prototype.disposeInternal=function(){goog.dom.DomSavedMultiRange_.superClass_.disposeInternal.call(this),goog.array.forEach(this.savedRanges_,function(t){t.dispose()}),delete this.savedRanges_},goog.dom.MultiRangeIterator=function(t){this.iterators_=null,this.currentIdx_=0,t&&(this.iterators_=goog.array.map(t.getSortedRanges(),function(t){return goog.iter.toIterator(t)})),goog.dom.MultiRangeIterator.base(this,"constructor",t?this.getStartNode():null,!1)},goog.inherits(goog.dom.MultiRangeIterator,goog.dom.RangeIterator),goog.dom.MultiRangeIterator.prototype.getStartTextOffset=function(){return this.iterators_[this.currentIdx_].getStartTextOffset()},goog.dom.MultiRangeIterator.prototype.getEndTextOffset=function(){return this.iterators_[this.currentIdx_].getEndTextOffset()},goog.dom.MultiRangeIterator.prototype.getStartNode=function(){return this.iterators_[0].getStartNode()},goog.dom.MultiRangeIterator.prototype.getEndNode=function(){return goog.array.peek(this.iterators_).getEndNode()},goog.dom.MultiRangeIterator.prototype.isLast=function(){return this.iterators_[this.currentIdx_].isLast()},goog.dom.MultiRangeIterator.prototype.next=function(){try{var t=this.iterators_[this.currentIdx_],o=t.next();return this.setPosition(t.node,t.tagType,t.depth),o}catch(t){if(t!==goog.iter.StopIteration||this.iterators_.length-1==this.currentIdx_)throw t;return this.currentIdx_++,this.next()}},goog.dom.MultiRangeIterator.prototype.copyFrom=function(t){this.iterators_=goog.array.clone(t.iterators_),goog.dom.MultiRangeIterator.superClass_.copyFrom.call(this,t)},goog.dom.MultiRangeIterator.prototype.clone=function(){var t=new goog.dom.MultiRangeIterator(null);return t.copyFrom(this),t};