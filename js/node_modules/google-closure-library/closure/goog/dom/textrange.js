goog.provide("goog.dom.TextRange"),goog.require("goog.array"),goog.require("goog.dom"),goog.require("goog.dom.AbstractRange"),goog.require("goog.dom.RangeType"),goog.require("goog.dom.SavedRange"),goog.require("goog.dom.TagName"),goog.require("goog.dom.TextRangeIterator"),goog.require("goog.dom.browserrange"),goog.require("goog.string"),goog.require("goog.userAgent"),goog.dom.TextRange=function(){this.browserRangeWrapper_=null,this.startNode_=null,this.startOffset_=null,this.endNode_=null,this.endOffset_=null,this.isReversed_=!1},goog.inherits(goog.dom.TextRange,goog.dom.AbstractRange),goog.dom.TextRange.createFromBrowserRange=function(e,o){return goog.dom.TextRange.createFromBrowserRangeWrapper_(goog.dom.browserrange.createRange(e),o)},goog.dom.TextRange.createFromBrowserRangeWrapper_=function(e,o){var t=new goog.dom.TextRange;return t.browserRangeWrapper_=e,t.isReversed_=!!o,t},goog.dom.TextRange.createFromNodeContents=function(e,o){return goog.dom.TextRange.createFromBrowserRangeWrapper_(goog.dom.browserrange.createRangeFromNodeContents(e),o)},goog.dom.TextRange.createFromNodes=function(e,o,t,r){var g=new goog.dom.TextRange;if(g.isReversed_=goog.dom.Range.isReversed(e,o,t,r),goog.dom.isElement(e)&&!goog.dom.canHaveChildren(e)){var n=e.parentNode;o=goog.array.indexOf(n.childNodes,e),e=n}if(goog.dom.isElement(t)&&!goog.dom.canHaveChildren(t)){n=t.parentNode;r=goog.array.indexOf(n.childNodes,t),t=n}return g.isReversed_?(g.startNode_=t,g.startOffset_=r,g.endNode_=e,g.endOffset_=o):(g.startNode_=e,g.startOffset_=o,g.endNode_=t,g.endOffset_=r),g},goog.dom.TextRange.prototype.clone=function(){var e=new goog.dom.TextRange;return e.browserRangeWrapper_=this.browserRangeWrapper_&&this.browserRangeWrapper_.clone(),e.startNode_=this.startNode_,e.startOffset_=this.startOffset_,e.endNode_=this.endNode_,e.endOffset_=this.endOffset_,e.isReversed_=this.isReversed_,e},goog.dom.TextRange.prototype.getType=function(){return goog.dom.RangeType.TEXT},goog.dom.TextRange.prototype.getBrowserRangeObject=function(){return this.getBrowserRangeWrapper_().getBrowserRange()},goog.dom.TextRange.prototype.setBrowserRangeObject=function(e){return!goog.dom.AbstractRange.isNativeControlRange(e)&&(this.browserRangeWrapper_=goog.dom.browserrange.createRange(e),this.clearCachedValues_(),!0)},goog.dom.TextRange.prototype.clearCachedValues_=function(){this.startNode_=this.startOffset_=this.endNode_=this.endOffset_=null},goog.dom.TextRange.prototype.getTextRangeCount=function(){return 1},goog.dom.TextRange.prototype.getTextRange=function(e){return this},goog.dom.TextRange.prototype.getBrowserRangeWrapper_=function(){return this.browserRangeWrapper_||(this.browserRangeWrapper_=goog.dom.browserrange.createRangeFromNodes(this.getStartNode(),this.getStartOffset(),this.getEndNode(),this.getEndOffset()))},goog.dom.TextRange.prototype.getContainer=function(){return this.getBrowserRangeWrapper_().getContainer()},goog.dom.TextRange.prototype.getStartNode=function(){return this.startNode_||(this.startNode_=this.getBrowserRangeWrapper_().getStartNode())},goog.dom.TextRange.prototype.getStartOffset=function(){return null!=this.startOffset_?this.startOffset_:this.startOffset_=this.getBrowserRangeWrapper_().getStartOffset()},goog.dom.TextRange.prototype.getStartPosition=function(){return this.getBrowserRangeWrapper_().getStartPosition()},goog.dom.TextRange.prototype.getEndNode=function(){return this.endNode_||(this.endNode_=this.getBrowserRangeWrapper_().getEndNode())},goog.dom.TextRange.prototype.getEndOffset=function(){return null!=this.endOffset_?this.endOffset_:this.endOffset_=this.getBrowserRangeWrapper_().getEndOffset()},goog.dom.TextRange.prototype.getEndPosition=function(){return this.getBrowserRangeWrapper_().getEndPosition()},goog.dom.TextRange.prototype.moveToNodes=function(e,o,t,r,g){this.startNode_=e,this.startOffset_=o,this.endNode_=t,this.endOffset_=r,this.isReversed_=g,this.browserRangeWrapper_=null},goog.dom.TextRange.prototype.isReversed=function(){return this.isReversed_},goog.dom.TextRange.prototype.containsRange=function(e,o){var t=e.getType();if(t==goog.dom.RangeType.TEXT)return this.getBrowserRangeWrapper_().containsRange(e.getBrowserRangeWrapper_(),o);if(t==goog.dom.RangeType.CONTROL){var r=e.getElements();return(o?goog.array.some:goog.array.every)(r,function(e){return this.containsNode(e,o)},this)}return!1},goog.dom.TextRange.prototype.containsNode=function(e,o){return this.containsRange(goog.dom.TextRange.createFromNodeContents(e),o)},goog.dom.TextRange.isAttachedNode=function(e){if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){var o=!1;try{o=e.parentNode}catch(e){}return!!o}return goog.dom.contains(e.ownerDocument.body,e)},goog.dom.TextRange.prototype.isRangeInDocument=function(){return(!this.startNode_||goog.dom.TextRange.isAttachedNode(this.startNode_))&&(!this.endNode_||goog.dom.TextRange.isAttachedNode(this.endNode_))&&(!(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9))||this.getBrowserRangeWrapper_().isRangeInDocument())},goog.dom.TextRange.prototype.isCollapsed=function(){return this.getBrowserRangeWrapper_().isCollapsed()},goog.dom.TextRange.prototype.getText=function(){return this.getBrowserRangeWrapper_().getText()},goog.dom.TextRange.prototype.getHtmlFragment=function(){return this.getBrowserRangeWrapper_().getHtmlFragment()},goog.dom.TextRange.prototype.getValidHtml=function(){return this.getBrowserRangeWrapper_().getValidHtml()},goog.dom.TextRange.prototype.getPastableHtml=function(){var e=this.getValidHtml();if(e.match(/^\s*<td\b/i))e="<table><tbody><tr>"+e+"</tr></tbody></table>";else if(e.match(/^\s*<tr\b/i))e="<table><tbody>"+e+"</tbody></table>";else if(e.match(/^\s*<tbody\b/i))e="<table>"+e+"</table>";else if(e.match(/^\s*<li\b/i)){for(var o=this.getContainer(),t=goog.dom.TagName.UL;o;){if(o.tagName==goog.dom.TagName.OL){t=goog.dom.TagName.OL;break}if(o.tagName==goog.dom.TagName.UL)break;o=o.parentNode}e=goog.string.buildString("<",t,">",e,"</",t,">")}return e},goog.dom.TextRange.prototype.__iterator__=function(e){return new goog.dom.TextRangeIterator(this.getStartNode(),this.getStartOffset(),this.getEndNode(),this.getEndOffset())},goog.dom.TextRange.prototype.select=function(){this.getBrowserRangeWrapper_().select(this.isReversed_)},goog.dom.TextRange.prototype.removeContents=function(){this.getBrowserRangeWrapper_().removeContents(),this.clearCachedValues_()},goog.dom.TextRange.prototype.surroundContents=function(e){var o=this.getBrowserRangeWrapper_().surroundContents(e);return this.clearCachedValues_(),o},goog.dom.TextRange.prototype.insertNode=function(e,o){var t=this.getBrowserRangeWrapper_().insertNode(e,o);return this.clearCachedValues_(),t},goog.dom.TextRange.prototype.surroundWithNodes=function(e,o){this.getBrowserRangeWrapper_().surroundWithNodes(e,o),this.clearCachedValues_()},goog.dom.TextRange.prototype.saveUsingDom=function(){return new goog.dom.DomSavedTextRange_(this)},goog.dom.TextRange.prototype.collapse=function(e){var o=this.isReversed()?!e:e;this.browserRangeWrapper_&&this.browserRangeWrapper_.collapse(o),o?(this.endNode_=this.startNode_,this.endOffset_=this.startOffset_):(this.startNode_=this.endNode_,this.startOffset_=this.endOffset_),this.isReversed_=!1},goog.dom.DomSavedTextRange_=function(e){goog.dom.DomSavedTextRange_.base(this,"constructor"),this.anchorNode_=e.getAnchorNode(),this.anchorOffset_=e.getAnchorOffset(),this.focusNode_=e.getFocusNode(),this.focusOffset_=e.getFocusOffset()},goog.inherits(goog.dom.DomSavedTextRange_,goog.dom.SavedRange),goog.dom.DomSavedTextRange_.prototype.restoreInternal=function(){return goog.dom.Range.createFromNodes(this.anchorNode_,this.anchorOffset_,this.focusNode_,this.focusOffset_)},goog.dom.DomSavedTextRange_.prototype.disposeInternal=function(){goog.dom.DomSavedTextRange_.superClass_.disposeInternal.call(this),this.anchorNode_=null,this.focusNode_=null};