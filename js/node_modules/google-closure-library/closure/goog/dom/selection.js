goog.provide("goog.dom.selection"),goog.require("goog.dom.InputType"),goog.require("goog.string"),goog.require("goog.userAgent"),goog.dom.selection.setStart=function(e,o){if(goog.dom.selection.useSelectionProperties_(e))e.selectionStart=o;else if(goog.dom.selection.isLegacyIe_()){var t=goog.dom.selection.getRangeIe_(e),n=t[0],g=t[1];n.inRange(g)&&(o=goog.dom.selection.canonicalizePositionIe_(e,o),n.collapse(!0),n.move("character",o),n.select())}},goog.dom.selection.getStart=function(e){return goog.dom.selection.getEndPoints_(e,!0)[0]},goog.dom.selection.getEndPointsTextareaIe_=function(e,o,t){for(var n=o.duplicate(),g=e.text,i=g,r=n.text,c=r,s=!1;!s;)0==e.compareEndPoints("StartToEnd",e)?s=!0:(e.moveEnd("character",-1),e.text==g?i+="\r\n":s=!0);if(t)return[i.length,-1];for(var l=!1;!l;)0==n.compareEndPoints("StartToEnd",n)?l=!0:(n.moveEnd("character",-1),n.text==r?c+="\r\n":l=!0);return[i.length,i.length+c.length]},goog.dom.selection.getEndPoints=function(e){return goog.dom.selection.getEndPoints_(e,!1)},goog.dom.selection.getEndPoints_=function(e,o){var t=0,n=0;if(goog.dom.selection.useSelectionProperties_(e))t=e.selectionStart,n=o?-1:e.selectionEnd;else if(goog.dom.selection.isLegacyIe_()){var g=goog.dom.selection.getRangeIe_(e),i=g[0],r=g[1];if(i.inRange(r)){if(i.setEndPoint("EndToStart",r),e.type==goog.dom.InputType.TEXTAREA)return goog.dom.selection.getEndPointsTextareaIe_(i,r,o);t=i.text.length,n=o?-1:i.text.length+r.text.length}}return[t,n]},goog.dom.selection.setEnd=function(e,o){if(goog.dom.selection.useSelectionProperties_(e))e.selectionEnd=o;else if(goog.dom.selection.isLegacyIe_()){var t=goog.dom.selection.getRangeIe_(e),n=t[0],g=t[1];if(n.inRange(g)){o=goog.dom.selection.canonicalizePositionIe_(e,o);var i=goog.dom.selection.canonicalizePositionIe_(e,goog.dom.selection.getStart(e));g.collapse(!0),g.moveEnd("character",o-i),g.select()}}},goog.dom.selection.getEnd=function(e){return goog.dom.selection.getEndPoints_(e,!1)[1]},goog.dom.selection.setCursorPosition=function(e,o){if(goog.dom.selection.useSelectionProperties_(e))e.selectionStart=o,e.selectionEnd=o;else if(goog.dom.selection.isLegacyIe_()){o=goog.dom.selection.canonicalizePositionIe_(e,o);var t=e.createTextRange();t.collapse(!0),t.move("character",o),t.select()}},goog.dom.selection.setText=function(e,o){if(goog.dom.selection.useSelectionProperties_(e)){var t=e.value,n=e.selectionStart,g=t.substr(0,n),i=t.substr(e.selectionEnd);e.value=g+o+i,e.selectionStart=n,e.selectionEnd=n+o.length}else{if(!goog.dom.selection.isLegacyIe_())throw new Error("Cannot set the selection end");var r=goog.dom.selection.getRangeIe_(e),c=r[0],s=r[1];if(!c.inRange(s))return;var l=s.duplicate();s.text=o,s.setEndPoint("StartToStart",l),s.select()}},goog.dom.selection.getText=function(e){if(goog.dom.selection.useSelectionProperties_(e))return e.value.substring(e.selectionStart,e.selectionEnd);if(goog.dom.selection.isLegacyIe_()){var o=goog.dom.selection.getRangeIe_(e),t=o[0],n=o[1];return t.inRange(n)?e.type==goog.dom.InputType.TEXTAREA?goog.dom.selection.getSelectionRangeText_(n):n.text:""}throw new Error("Cannot get the selection text")},goog.dom.selection.getSelectionRangeText_=function(e){for(var o=e.duplicate(),t=o.text,n=t,g=!1;!g;)0==o.compareEndPoints("StartToEnd",o)?g=!0:(o.moveEnd("character",-1),o.text==t?n+="\r\n":g=!0);return n},goog.dom.selection.getRangeIe_=function(e){var o,t=e.ownerDocument||e.document,n=t.selection.createRange();return e.type==goog.dom.InputType.TEXTAREA?(o=t.body.createTextRange()).moveToElementText(e):o=e.createTextRange(),[o,n]},goog.dom.selection.canonicalizePositionIe_=function(e,o){if(e.type==goog.dom.InputType.TEXTAREA){var t=e.value.substring(0,o);o=goog.string.canonicalizeNewlines(t).length}return o},goog.dom.selection.useSelectionProperties_=function(e){try{return"number"==typeof e.selectionStart}catch(e){return!1}},goog.dom.selection.isLegacyIe_=function(){return goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9")};