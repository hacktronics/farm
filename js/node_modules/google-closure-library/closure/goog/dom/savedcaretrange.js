goog.provide("goog.dom.SavedCaretRange"),goog.forwardDeclare("goog.dom.AbstractRange"),goog.forwardDeclare("goog.dom.Range"),goog.require("goog.array"),goog.require("goog.dom"),goog.require("goog.dom.SavedRange"),goog.require("goog.dom.TagName"),goog.require("goog.string"),goog.dom.SavedCaretRange=function(e){goog.dom.SavedRange.call(this),this.startCaretId_=goog.string.createUniqueString(),this.endCaretId_=goog.string.createUniqueString(),this.reversed_=e.isReversed(),this.dom_=goog.dom.getDomHelper(e.getDocument()),e.surroundWithNodes(this.createCaret_(!0),this.createCaret_(!1))},goog.inherits(goog.dom.SavedCaretRange,goog.dom.SavedRange),goog.dom.SavedCaretRange.prototype.toAbstractRange=function(){var e=null,o=this.getCaret(!0),t=this.getCaret(!1);return o&&t&&(e=goog.dom.Range.createFromNodes(o,0,t,0)),e},goog.dom.SavedCaretRange.prototype.getCaret=function(e){return this.dom_.getElement(e?this.startCaretId_:this.endCaretId_)},goog.dom.SavedCaretRange.prototype.removeCarets=function(e){return goog.dom.removeNode(this.getCaret(!0)),goog.dom.removeNode(this.getCaret(!1)),e},goog.dom.SavedCaretRange.prototype.setRestorationDocument=function(e){this.dom_.setDocument(e)},goog.dom.SavedCaretRange.prototype.restoreInternal=function(){var e=null,o=this.getCaret(!this.reversed_),t=this.getCaret(this.reversed_);if(o&&t){var r=o.parentNode,g=goog.array.indexOf(r.childNodes,o),a=t.parentNode,d=goog.array.indexOf(a.childNodes,t);a==r&&(this.reversed_?g--:d--),e=goog.dom.Range.createFromNodes(r,g,a,d),(e=this.removeCarets(e)).select()}else this.removeCarets();return e},goog.dom.SavedCaretRange.prototype.disposeInternal=function(){this.removeCarets(),this.dom_=null},goog.dom.SavedCaretRange.prototype.createCaret_=function(e){return this.dom_.createDom(goog.dom.TagName.SPAN,{id:e?this.startCaretId_:this.endCaretId_})},goog.dom.SavedCaretRange.CARET_REGEX=/<span\s+id="?goog_\d+"?><\/span>/gi,goog.dom.SavedCaretRange.htmlEqual=function(e,o){return e==o||e.replace(goog.dom.SavedCaretRange.CARET_REGEX,"")==o.replace(goog.dom.SavedCaretRange.CARET_REGEX,"")};