goog.module("goog.delegate.DelegateRegistry");const{ENABLE_ASSERTS:ENABLE_ASSERTS,assert:assert}=goog.require("goog.asserts"),{binarySelect:binarySelect}=goog.require("goog.array"),{freeze:freeze}=goog.require("goog.debug");class Registration{constructor(){this.instance,this.ctor,this.priority}}class DelegateRegistryBase{constructor(){this.registered_=[],this.allowLateRegistration_=!1,this.cacheInstantiation_=!1,this.delegatesConstructed_=!1}allowLateRegistration(){return ENABLE_ASSERTS&&(this.allowLateRegistration_=!0),this}cacheInstantiation(){return this.cacheInstantiation_=!0,this}delegate(e=void 0){return ENABLE_ASSERTS&&(this.delegatesConstructed_=!0),this.registered_.length?this.instantiate_(this.registered_[0],e):void 0}delegates(e=void 0){return ENABLE_ASSERTS&&(this.delegatesConstructed_=!0),freeze(this.registered_.map(t=>this.instantiate_(t,e)))}instantiate_(e,t=e=>new e){if(!e.ctor)return e.instance;const s=t(e.ctor);return this.cacheInstantiation_&&(delete e.ctor,e.instance=s),s}checkRegistration_(){assert(this.allowLateRegistration_||!this.delegatesConstructed_,"Cannot register new delegates after instantiation.")}}class DelegateRegistry extends DelegateRegistryBase{constructor(){super(),this.expectAtMostOneDelegate_=!1}expectAtMostOneDelegate(){return ENABLE_ASSERTS&&(this.expectAtMostOneDelegate_=!0),this}registerClass(e){this.checkRegistration_(),this.registered_.push({ctor:e})}registerInstance(e){this.checkRegistration_(),this.registered_.push({instance:e})}checkRegistration_(){super.checkRegistration_(),ENABLE_ASSERTS&&this.expectAtMostOneDelegate_&&this.registered_.length&&assert(!1,"delegate already registered: %s",this.registered_[0].ctor||this.registered_[0].instance)}}DelegateRegistry.Prioritized=class extends DelegateRegistryBase{registerClass(e,t){this.add_({ctor:e,priority:t})}registerInstance(e,t){this.add_({instance:e,priority:t})}add_(e){this.checkRegistration_();const t=e.priority,s=~binarySelect(this.registered_,e=>e.priority<t?-1:1),i=s>0?this.registered_[s-1]:null;ENABLE_ASSERTS&&i&&i.priority<=t&&assert(!1,"two delegates registered with same priority (%s): %s and %s",t,i.ctor||i.instance,e.ctor||e.instance),this.registered_.splice(s,0,e)}},exports=DelegateRegistry;