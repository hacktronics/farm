goog.provide("goog.events.EventTarget"),goog.require("goog.Disposable"),goog.require("goog.asserts"),goog.require("goog.events"),goog.require("goog.events.Event"),goog.require("goog.events.Listenable"),goog.require("goog.events.ListenerMap"),goog.require("goog.object"),goog.events.EventTarget=function(){goog.Disposable.call(this),this.eventTargetListeners_=new goog.events.ListenerMap(this),this.actualEventTarget_=this,this.parentEventTarget_=null},goog.inherits(goog.events.EventTarget,goog.Disposable),goog.events.Listenable.addImplementation(goog.events.EventTarget),goog.events.EventTarget.MAX_ANCESTORS_=1e3,goog.events.EventTarget.prototype.getParentEventTarget=function(){return this.parentEventTarget_},goog.events.EventTarget.prototype.setParentEventTarget=function(e){this.parentEventTarget_=e},goog.events.EventTarget.prototype.addEventListener=function(e,t,n,r){goog.events.listen(this,e,t,n,r)},goog.events.EventTarget.prototype.removeEventListener=function(e,t,n,r){goog.events.unlisten(this,e,t,n,r)},goog.events.EventTarget.prototype.dispatchEvent=function(e){this.assertInitialized_();var t,n=this.getParentEventTarget();if(n){t=[];for(var r=1;n;n=n.getParentEventTarget())t.push(n),goog.asserts.assert(++r<goog.events.EventTarget.MAX_ANCESTORS_,"infinite loop")}return goog.events.EventTarget.dispatchEventInternal_(this.actualEventTarget_,e,t)},goog.events.EventTarget.prototype.disposeInternal=function(){goog.events.EventTarget.superClass_.disposeInternal.call(this),this.removeAllListeners(),this.parentEventTarget_=null},goog.events.EventTarget.prototype.listen=function(e,t,n,r){return this.assertInitialized_(),this.eventTargetListeners_.add(String(e),t,!1,n,r)},goog.events.EventTarget.prototype.listenOnce=function(e,t,n,r){return this.eventTargetListeners_.add(String(e),t,!0,n,r)},goog.events.EventTarget.prototype.unlisten=function(e,t,n,r){return this.eventTargetListeners_.remove(String(e),t,n,r)},goog.events.EventTarget.prototype.unlistenByKey=function(e){return this.eventTargetListeners_.removeByKey(e)},goog.events.EventTarget.prototype.removeAllListeners=function(e){return this.eventTargetListeners_?this.eventTargetListeners_.removeAll(e):0},goog.events.EventTarget.prototype.fireListeners=function(e,t,n){var r=this.eventTargetListeners_.listeners[String(e)];if(!r)return!0;r=r.concat();for(var o=!0,g=0;g<r.length;++g){var s=r[g];if(s&&!s.removed&&s.capture==t){var i=s.listener,a=s.handler||s.src;s.callOnce&&this.unlistenByKey(s),o=!1!==i.call(a,n)&&o}}return o&&0!=n.returnValue_},goog.events.EventTarget.prototype.getListeners=function(e,t){return this.eventTargetListeners_.getListeners(String(e),t)},goog.events.EventTarget.prototype.getListener=function(e,t,n,r){return this.eventTargetListeners_.getListener(String(e),t,n,r)},goog.events.EventTarget.prototype.hasListener=function(e,t){var n=void 0!==e?String(e):void 0;return this.eventTargetListeners_.hasListener(n,t)},goog.events.EventTarget.prototype.setTargetForTesting=function(e){this.actualEventTarget_=e},goog.events.EventTarget.prototype.assertInitialized_=function(){goog.asserts.assert(this.eventTargetListeners_,"Event target is not initialized. Did you call the superclass (goog.events.EventTarget) constructor?")},goog.events.EventTarget.dispatchEventInternal_=function(e,t,n){var r=t.type||t;if("string"==typeof t)t=new goog.events.Event(t,e);else if(t instanceof goog.events.Event)t.target=t.target||e;else{var o=t;t=new goog.events.Event(r,e),goog.object.extend(t,o)}var g,s=!0;if(n)for(var i=n.length-1;!t.propagationStopped_&&i>=0;i--)s=(g=t.currentTarget=n[i]).fireListeners(r,!0,t)&&s;if(t.propagationStopped_||(s=(g=t.currentTarget=e).fireListeners(r,!0,t)&&s,t.propagationStopped_||(s=g.fireListeners(r,!1,t)&&s)),n)for(i=0;!t.propagationStopped_&&i<n.length;i++)s=(g=t.currentTarget=n[i]).fireListeners(r,!1,t)&&s;return s};