goog.module("goog.events.eventTargetTester"),goog.setTestOnly();const GoogEventsEvent=goog.require("goog.events.Event"),GoogEventsEventTarget=goog.require("goog.events.EventTarget"),GoogEventsListenable=goog.require("goog.events.Listenable"),googArray=goog.require("goog.array"),recordFunction=goog.require("goog.testing.recordFunction");let dispatchEvent,eventTargets,getListener,getListeners,hasListener,keyType,listen,listenOnce,listenableFactory,listeners,objectTypeListenerSupported,removeAll,unlisten,unlistenByKey,unlistenReturnType;goog.require("goog.testing.asserts");const MAX_INSTANCE_COUNT=10;function times(e){return e}function createListener(e){return recordFunction(e)}function assertListenerIsCalled(e,t){assertEquals("Listeners is not called the correct number of times.",t,e.getCallCount()),e[exports.ALREADY_CHECKED_PROP]=!0,e[exports.NUM_CALLED_PROP]=t}function assertNoOtherListenerIsCalled(){googArray.forEach(listeners,function(e,t){e[exports.ALREADY_CHECKED_PROP]?assertEquals("Listeners "+t+" is unexpectedly called.",e[exports.NUM_CALLED_PROP],e.getCallCount()):assertEquals("Listeners "+t+" is unexpectedly called.",0,e.getCallCount())})}function resetListeners(){googArray.forEach(listeners,function(e){e.reset(),e[exports.ALREADY_CHECKED_PROP]=!1})}const KeyType={NUMBER:0,UNDEFINED:1},UnlistenReturnType={BOOLEAN:0,UNDEFINED:1};var EventType={A:goog.events.getUniqueId("a"),B:goog.events.getUniqueId("b"),C:goog.events.getUniqueId("c")};class TestEvent extends GoogEventsEvent{constructor(){super(EventType.A)}}exports={assertListenerIsCalled:assertListenerIsCalled,assertNoOtherListenerIsCalled:assertNoOtherListenerIsCalled,createListener:createListener,times:times,resetListeners:resetListeners,getListeners:()=>listeners,getTargets:()=>eventTargets,setUp(e,t,s,n,r,a,i,l,v,T,g,E,p){listenableFactory=e,listen=t,unlisten=s,unlistenByKey=n,listenOnce=r,dispatchEvent=a,removeAll=i,getListeners=l,getListener=v,hasListener=T,keyType=g,unlistenReturnType=E,objectTypeListenerSupported=p,listeners=[];for(var o=0;o<10;o++)listeners[o]=createListener();for(eventTargets=[],o=0;o<10;o++)eventTargets[o]=listenableFactory()},tearDown(){for(var e=0;e<10;e++)goog.dispose(eventTargets[e])},KeyType:KeyType,EventType:EventType,UnlistenReturnType:UnlistenReturnType,TestEvent:TestEvent,ALREADY_CHECKED_PROP:"__alreadyChecked",NUM_CALLED_PROP:"__numCalled",commonTests:{testNoListener(){dispatchEvent(eventTargets[0],EventType.A),assertNoOtherListenerIsCalled()},testOneListener(){listen(eventTargets[0],EventType.A,listeners[0]),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertNoOtherListenerIsCalled(),resetListeners(),dispatchEvent(eventTargets[0],EventType.B),dispatchEvent(eventTargets[0],EventType.C),assertNoOtherListenerIsCalled()},testTwoListenersOfSameType(){var e=listen(eventTargets[0],EventType.A,listeners[0]),t=listen(eventTargets[0],EventType.A,listeners[1]);keyType==KeyType.NUMBER?assertNotEquals(e,t):(assertUndefined(e),assertUndefined(t)),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertNoOtherListenerIsCalled()},testInstallingSameListeners(){var e=listen(eventTargets[0],EventType.A,listeners[0]),t=listen(eventTargets[0],EventType.A,listeners[0]),s=listen(eventTargets[0],EventType.B,listeners[0]);keyType==KeyType.NUMBER?(assertEquals(e,t),assertNotEquals(e,s)):(assertUndefined(e),assertUndefined(t),assertUndefined(s)),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),dispatchEvent(eventTargets[0],EventType.B),assertListenerIsCalled(listeners[0],times(2)),assertNoOtherListenerIsCalled()},testScope(){listeners[0]=createListener(function(e){assertEquals("Wrong scope with undefined scope",eventTargets[0],this)}),listeners[1]=createListener(function(e){assertEquals("Wrong scope with null scope",eventTargets[0],this)});var e={};listeners[2]=createListener(function(t){assertEquals("Wrong scope with specific scope object",e,this)}),listen(eventTargets[0],EventType.A,listeners[0]),listen(eventTargets[0],EventType.A,listeners[1],!1,null),listen(eventTargets[0],EventType.A,listeners[2],!1,e),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertListenerIsCalled(listeners[2],times(1))},testDispatchEventDoesNotThrowWithDisposedEventTarget(){goog.dispose(eventTargets[0]),assertTrue(dispatchEvent(eventTargets[0],EventType.A))},testDispatchEventWithObjectLiteral(){listen(eventTargets[0],EventType.A,listeners[0]),assertTrue(dispatchEvent(eventTargets[0],{type:EventType.A})),assertListenerIsCalled(listeners[0],times(1)),assertNoOtherListenerIsCalled()},testDispatchEventWithCustomEventObject(){listen(eventTargets[0],EventType.A,listeners[0]);var e=new TestEvent;assertTrue(dispatchEvent(eventTargets[0],e)),assertListenerIsCalled(listeners[0],times(1)),assertNoOtherListenerIsCalled();var t=listeners[0].getLastCall().getArgument(0);assertEquals(e,t),assertEquals(eventTargets[0],t.target)},testDisposingEventTargetRemovesListeners(){listenableFactory()instanceof GoogEventsEventTarget&&(listen(eventTargets[0],EventType.A,listeners[0]),goog.dispose(eventTargets[0]),dispatchEvent(eventTargets[0],EventType.A),assertNoOtherListenerIsCalled())},testUnlistenWorksAfterDisposal(){var e=listen(eventTargets[0],EventType.A,listeners[0]);goog.dispose(eventTargets[0]),unlisten(eventTargets[0],EventType.A,listeners[1]),unlistenByKey&&unlistenByKey(eventTargets[0],e)},testRemovingListener(){var e=unlisten(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[0]);var t=unlisten(eventTargets[0],EventType.A,listeners[1]),s=unlisten(eventTargets[0],EventType.B,listeners[0]),n=unlisten(eventTargets[1],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1));var r=unlisten(eventTargets[0],EventType.A,listeners[0]),a=unlisten(eventTargets[0],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertNoOtherListenerIsCalled(),unlistenReturnType==UnlistenReturnType.BOOLEAN?(assertFalse(e),assertFalse(t),assertFalse(s),assertFalse(n),assertTrue(r),assertFalse(a)):(assertUndefined(e),assertUndefined(t),assertUndefined(s),assertUndefined(n),assertUndefined(r),assertUndefined(a))},testCapture(){eventTargets[0].setParentEventTarget(eventTargets[1]),eventTargets[1].setParentEventTarget(eventTargets[2]),eventTargets[9].setParentEventTarget(eventTargets[0]);var e=0;listeners[0]=createListener(function(t){assertEquals(eventTargets[2],t.currentTarget),assertEquals(eventTargets[0],t.target),assertEquals("First capture listener is not called first",0,e),e++}),listeners[1]=createListener(function(t){assertEquals(eventTargets[1],t.currentTarget),assertEquals(eventTargets[0],t.target),assertEquals("2nd capture listener is not called 2nd",1,e),e++}),listeners[2]=createListener(function(t){assertEquals(eventTargets[0],t.currentTarget),assertEquals(eventTargets[0],t.target),assertEquals("3rd capture listener is not called 3rd",2,e),e++}),listen(eventTargets[2],EventType.A,listeners[0],!0),listen(eventTargets[1],EventType.A,listeners[1],!0),listen(eventTargets[0],EventType.A,listeners[2],!0),listen(eventTargets[3],EventType.A,listeners[3],!0),listen(eventTargets[0],EventType.B,listeners[4],!0),listen(eventTargets[0],EventType.C,listeners[5],!0),listen(eventTargets[1],EventType.B,listeners[6],!0),listen(eventTargets[1],EventType.C,listeners[7],!0),listen(eventTargets[2],EventType.B,listeners[8],!0),listen(eventTargets[2],EventType.C,listeners[9],!0),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertListenerIsCalled(listeners[2],times(1)),assertNoOtherListenerIsCalled()},testBubble(){eventTargets[0].setParentEventTarget(eventTargets[1]),eventTargets[1].setParentEventTarget(eventTargets[2]),eventTargets[9].setParentEventTarget(eventTargets[0]);var e=0;listeners[0]=createListener(function(t){assertEquals(eventTargets[0],t.currentTarget),assertEquals(eventTargets[0],t.target),assertEquals("First bubble listener is not called first",0,e),e++}),listeners[1]=createListener(function(t){assertEquals(eventTargets[1],t.currentTarget),assertEquals(eventTargets[0],t.target),assertEquals("2nd bubble listener is not called 2nd",1,e),e++}),listeners[2]=createListener(function(t){assertEquals(eventTargets[2],t.currentTarget),assertEquals(eventTargets[0],t.target),assertEquals("3rd bubble listener is not called 3rd",2,e),e++}),listen(eventTargets[0],EventType.A,listeners[0]),listen(eventTargets[1],EventType.A,listeners[1]),listen(eventTargets[2],EventType.A,listeners[2]),listen(eventTargets[3],EventType.A,listeners[3]),listen(eventTargets[0],EventType.B,listeners[4]),listen(eventTargets[0],EventType.C,listeners[5]),listen(eventTargets[1],EventType.B,listeners[6]),listen(eventTargets[1],EventType.C,listeners[7]),listen(eventTargets[2],EventType.B,listeners[8]),listen(eventTargets[2],EventType.C,listeners[9]),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertListenerIsCalled(listeners[2],times(1)),assertNoOtherListenerIsCalled()},testCaptureAndBubble(){eventTargets[0].setParentEventTarget(eventTargets[1]),eventTargets[1].setParentEventTarget(eventTargets[2]),listen(eventTargets[0],EventType.A,listeners[0],!0),listen(eventTargets[1],EventType.A,listeners[1],!0),listen(eventTargets[2],EventType.A,listeners[2],!0),listen(eventTargets[0],EventType.A,listeners[3]),listen(eventTargets[1],EventType.A,listeners[4]),listen(eventTargets[2],EventType.A,listeners[5]),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertListenerIsCalled(listeners[2],times(1)),assertListenerIsCalled(listeners[3],times(1)),assertListenerIsCalled(listeners[4],times(1)),assertListenerIsCalled(listeners[5],times(1)),assertNoOtherListenerIsCalled()},testPreventDefaultByReturningFalse(){listeners[0]=createListener(function(e){return!1}),listeners[1]=createListener(function(e){return!0}),listen(eventTargets[0],EventType.A,listeners[0]),listen(eventTargets[0],EventType.A,listeners[1]);var e=dispatchEvent(eventTargets[0],EventType.A);assertFalse(e)},testPreventDefault(){listeners[0]=createListener(function(e){e.preventDefault()}),listeners[1]=createListener(function(e){return!0}),listen(eventTargets[0],EventType.A,listeners[0]),listen(eventTargets[0],EventType.A,listeners[1]);var e=dispatchEvent(eventTargets[0],EventType.A);assertFalse(e)},testPreventDefaultAtCapture(){listeners[0]=createListener(function(e){e.preventDefault()}),listeners[1]=createListener(function(e){return!0}),listen(eventTargets[0],EventType.A,listeners[0],!0),listen(eventTargets[0],EventType.A,listeners[1],!0);var e=dispatchEvent(eventTargets[0],EventType.A);assertFalse(e)},testStopPropagation(){eventTargets[0].setParentEventTarget(eventTargets[1]),eventTargets[1].setParentEventTarget(eventTargets[2]),listeners[0]=createListener(function(e){e.stopPropagation()}),listen(eventTargets[0],EventType.A,listeners[0]),listen(eventTargets[0],EventType.A,listeners[1]),listen(eventTargets[1],EventType.A,listeners[2]),listen(eventTargets[2],EventType.A,listeners[3]),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertNoOtherListenerIsCalled()},testStopPropagation2(){eventTargets[0].setParentEventTarget(eventTargets[1]),eventTargets[1].setParentEventTarget(eventTargets[2]),listeners[1]=createListener(function(e){e.stopPropagation()}),listen(eventTargets[0],EventType.A,listeners[0]),listen(eventTargets[0],EventType.A,listeners[1]),listen(eventTargets[1],EventType.A,listeners[2]),listen(eventTargets[2],EventType.A,listeners[3]),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertNoOtherListenerIsCalled()},testStopPropagation3(){eventTargets[0].setParentEventTarget(eventTargets[1]),eventTargets[1].setParentEventTarget(eventTargets[2]),listeners[2]=createListener(function(e){e.stopPropagation()}),listen(eventTargets[0],EventType.A,listeners[0]),listen(eventTargets[0],EventType.A,listeners[1]),listen(eventTargets[1],EventType.A,listeners[2]),listen(eventTargets[2],EventType.A,listeners[3]),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertListenerIsCalled(listeners[2],times(1)),assertNoOtherListenerIsCalled()},testStopPropagationAtCapture(){eventTargets[0].setParentEventTarget(eventTargets[1]),eventTargets[1].setParentEventTarget(eventTargets[2]),listeners[0]=createListener(function(e){e.stopPropagation()}),listen(eventTargets[2],EventType.A,listeners[0],!0),listen(eventTargets[1],EventType.A,listeners[1],!0),listen(eventTargets[0],EventType.A,listeners[2],!0),listen(eventTargets[0],EventType.A,listeners[3]),listen(eventTargets[1],EventType.A,listeners[4]),listen(eventTargets[2],EventType.A,listeners[5]),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertNoOtherListenerIsCalled()},testHandleEvent(){if(objectTypeListenerSupported){var e={};e.handleEvent=recordFunction(),listen(eventTargets[0],EventType.A,e),dispatchEvent(eventTargets[0],EventType.A),assertEquals(1,e.handleEvent.getCallCount())}},testListenOnce(){listenOnce&&(listenOnce(eventTargets[0],EventType.A,listeners[0],!0),listenOnce(eventTargets[0],EventType.A,listeners[1]),listenOnce(eventTargets[0],EventType.B,listeners[2]),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertListenerIsCalled(listeners[2],times(0)),assertNoOtherListenerIsCalled(),resetListeners(),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(0)),assertListenerIsCalled(listeners[1],times(0)),assertListenerIsCalled(listeners[2],times(0)),dispatchEvent(eventTargets[0],EventType.B),assertListenerIsCalled(listeners[2],times(1)),assertNoOtherListenerIsCalled())},testUnlistenInListen(){listeners[1]=createListener(function(e){unlisten(eventTargets[0],EventType.A,listeners[1]),unlisten(eventTargets[0],EventType.A,listeners[2])}),listen(eventTargets[0],EventType.A,listeners[0]),listen(eventTargets[0],EventType.A,listeners[1]),listen(eventTargets[0],EventType.A,listeners[2]),listen(eventTargets[0],EventType.A,listeners[3]),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertListenerIsCalled(listeners[2],times(0)),assertListenerIsCalled(listeners[3],times(1)),assertNoOtherListenerIsCalled(),resetListeners(),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(0)),assertListenerIsCalled(listeners[2],times(0)),assertListenerIsCalled(listeners[3],times(1)),assertNoOtherListenerIsCalled()},testUnlistenByKeyInListen(){var e,t;unlistenByKey&&(listeners[1]=createListener(function(s){unlistenByKey(eventTargets[0],e),unlistenByKey(eventTargets[0],t)}),listen(eventTargets[0],EventType.A,listeners[0]),e=listen(eventTargets[0],EventType.A,listeners[1]),t=listen(eventTargets[0],EventType.A,listeners[2]),listen(eventTargets[0],EventType.A,listeners[3]),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertListenerIsCalled(listeners[2],times(0)),assertListenerIsCalled(listeners[3],times(1)),assertNoOtherListenerIsCalled(),resetListeners(),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(0)),assertListenerIsCalled(listeners[2],times(0)),assertListenerIsCalled(listeners[3],times(1)),assertNoOtherListenerIsCalled())},testSetParentEventTarget(){assertNull(eventTargets[0].getParentEventTarget()),eventTargets[0].setParentEventTarget(eventTargets[1]),assertEquals(eventTargets[1],eventTargets[0].getParentEventTarget()),assertNull(eventTargets[1].getParentEventTarget()),eventTargets[0].setParentEventTarget(null),assertNull(eventTargets[0].getParentEventTarget())},testListenOnceAfterListenDoesNotChangeExistingListener(){listenOnce&&(listen(eventTargets[0],EventType.A,listeners[0]),listenOnce(eventTargets[0],EventType.A,listeners[0]),dispatchEvent(eventTargets[0],EventType.A),dispatchEvent(eventTargets[0],EventType.A),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(3)),assertNoOtherListenerIsCalled())},testListenOnceAfterListenOnceDoesNotChangeExistingListener(){listenOnce&&(listenOnce(eventTargets[0],EventType.A,listeners[0]),listenOnce(eventTargets[0],EventType.A,listeners[0]),dispatchEvent(eventTargets[0],EventType.A),dispatchEvent(eventTargets[0],EventType.A),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(1)),assertNoOtherListenerIsCalled())},testListenAfterListenOnceRemoveOnceness(){listenOnce&&(listenOnce(eventTargets[0],EventType.A,listeners[0]),listen(eventTargets[0],EventType.A,listeners[0]),dispatchEvent(eventTargets[0],EventType.A),dispatchEvent(eventTargets[0],EventType.A),dispatchEvent(eventTargets[0],EventType.A),assertListenerIsCalled(listeners[0],times(3)),assertNoOtherListenerIsCalled())},testUnlistenAfterListenOnce(){listenOnce&&(listenOnce(eventTargets[0],EventType.A,listeners[0]),unlisten(eventTargets[0],EventType.A,listeners[0]),dispatchEvent(eventTargets[0],EventType.A),listen(eventTargets[0],EventType.A,listeners[0]),listenOnce(eventTargets[0],EventType.A,listeners[0]),unlisten(eventTargets[0],EventType.A,listeners[0]),dispatchEvent(eventTargets[0],EventType.A),listenOnce(eventTargets[0],EventType.A,listeners[0]),listen(eventTargets[0],EventType.A,listeners[0]),unlisten(eventTargets[0],EventType.A,listeners[0]),dispatchEvent(eventTargets[0],EventType.A),listenOnce(eventTargets[0],EventType.A,listeners[0]),listenOnce(eventTargets[0],EventType.A,listeners[0]),unlisten(eventTargets[0],EventType.A,listeners[0]),dispatchEvent(eventTargets[0],EventType.A),assertNoOtherListenerIsCalled())},testRemoveAllWithType(){removeAll&&(listen(eventTargets[0],EventType.A,listeners[0],!0),listen(eventTargets[0],EventType.A,listeners[1]),listen(eventTargets[0],EventType.C,listeners[2],!0),listen(eventTargets[0],EventType.C,listeners[3]),listen(eventTargets[0],EventType.B,listeners[4],!0),listen(eventTargets[0],EventType.B,listeners[5],!0),listen(eventTargets[0],EventType.B,listeners[6]),listen(eventTargets[0],EventType.B,listeners[7]),assertEquals(4,removeAll(eventTargets[0],EventType.B)),dispatchEvent(eventTargets[0],EventType.A),dispatchEvent(eventTargets[0],EventType.B),dispatchEvent(eventTargets[0],EventType.C),assertListenerIsCalled(listeners[0],times(1)),assertListenerIsCalled(listeners[1],times(1)),assertListenerIsCalled(listeners[2],times(1)),assertListenerIsCalled(listeners[3],times(1)),assertNoOtherListenerIsCalled())},testRemoveAll(){removeAll&&(listen(eventTargets[0],EventType.A,listeners[0],!0),listen(eventTargets[0],EventType.A,listeners[1]),listen(eventTargets[0],EventType.C,listeners[2],!0),listen(eventTargets[0],EventType.C,listeners[3]),listen(eventTargets[0],EventType.B,listeners[4],!0),listen(eventTargets[0],EventType.B,listeners[5],!0),listen(eventTargets[0],EventType.B,listeners[6]),listen(eventTargets[0],EventType.B,listeners[7]),assertEquals(8,removeAll(eventTargets[0])),dispatchEvent(eventTargets[0],EventType.A),dispatchEvent(eventTargets[0],EventType.B),dispatchEvent(eventTargets[0],EventType.C),assertNoOtherListenerIsCalled())},testRemoveAllCallsMarkAsRemoved(){if(removeAll){var e=listen(eventTargets[0],EventType.A,listeners[0]),t=listen(eventTargets[1],EventType.A,listeners[1]);assertNotNullNorUndefined(e.listener),assertFalse(e.removed),assertNotNullNorUndefined(t.listener),assertFalse(t.removed),assertEquals(1,removeAll(eventTargets[0])),assertNull(e.listener),assertTrue(e.removed),assertNotNullNorUndefined(t.listener),assertFalse(t.removed),assertEquals(1,removeAll(eventTargets[1])),assertNull(t.listener),assertTrue(t.removed)}},testGetListeners(){if(getListeners){listen(eventTargets[0],EventType.A,listeners[0],!0),listen(eventTargets[0],EventType.A,listeners[1],!0),listen(eventTargets[0],EventType.A,listeners[2]),listen(eventTargets[0],EventType.A,listeners[3]);var e=getListeners(eventTargets[0],EventType.A,!0);assertEquals(2,e.length),assertEquals(listeners[0],e[0].listener),assertEquals(listeners[1],e[1].listener),e=getListeners(eventTargets[0],EventType.A,!1),assertEquals(2,e.length),assertEquals(listeners[2],e[0].listener),assertEquals(listeners[3],e[1].listener),e=getListeners(eventTargets[0],EventType.B,!0),assertEquals(0,e.length)}},testGetListener(){getListener&&(listen(eventTargets[0],EventType.A,listeners[0],!0),assertNotNull(getListener(eventTargets[0],EventType.A,listeners[0],!0)),assertNull(getListener(eventTargets[0],EventType.A,listeners[0],!0,{})),assertNull(getListener(eventTargets[1],EventType.A,listeners[0],!0)),assertNull(getListener(eventTargets[0],EventType.B,listeners[0],!0)),assertNull(getListener(eventTargets[0],EventType.A,listeners[1],!0)))},testHasListener(){hasListener&&(assertFalse(hasListener(eventTargets[0])),listen(eventTargets[0],EventType.A,listeners[0],!0),assertTrue(hasListener(eventTargets[0])),assertTrue(hasListener(eventTargets[0],EventType.A)),assertTrue(hasListener(eventTargets[0],EventType.A,!0)),assertTrue(hasListener(eventTargets[0],void 0,!0)),assertFalse(hasListener(eventTargets[0],EventType.A,!1)),assertFalse(hasListener(eventTargets[0],void 0,!1)),assertFalse(hasListener(eventTargets[0],EventType.B)),assertFalse(hasListener(eventTargets[0],EventType.B,!0)),assertFalse(hasListener(eventTargets[1])))},testFiringEventBeforeDisposeInternalWorks(){var e=function(){e.base(this,"constructor")};goog.inherits(e,GoogEventsEventTarget),e.prototype.disposeInternal=function(){dispatchEvent(this,EventType.A),e.base(this,"disposeInternal")};var t=new e;try{listen(t,EventType.A,listeners[0]),t.dispose(),assertListenerIsCalled(listeners[0],times(1))}catch(e){goog.dispose(t)}},testLoopDetection(){var e=listenableFactory();e.setParentEventTarget(e);try{e.dispatchEvent("string"),fail("expected error")}catch(e){assertContains("infinite",e.message)}}}};