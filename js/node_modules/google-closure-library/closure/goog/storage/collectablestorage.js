goog.provide("goog.storage.CollectableStorage"),goog.forwardDeclare("goog.storage.mechanism.IterableMechanism"),goog.require("goog.array"),goog.require("goog.iter"),goog.require("goog.storage.ErrorCode"),goog.require("goog.storage.ExpiringStorage"),goog.require("goog.storage.RichStorage"),goog.storage.CollectableStorage=function(o){goog.storage.CollectableStorage.base(this,"constructor",o)},goog.inherits(goog.storage.CollectableStorage,goog.storage.ExpiringStorage),goog.storage.CollectableStorage.prototype.getExpiredKeys_=function(o,e){var r=[];return goog.iter.forEach(o,function(o){var g;try{g=goog.storage.CollectableStorage.prototype.getWrapper.call(this,o,!0)}catch(g){if(g==goog.storage.ErrorCode.INVALID_VALUE)return void(e&&r.push(o));throw g}if(void 0!==g){if(goog.storage.ExpiringStorage.isExpired(g))r.push(o);else if(e)try{goog.storage.RichStorage.Wrapper.unwrap(g)}catch(e){if(e==goog.storage.ErrorCode.INVALID_VALUE)return void r.push(o);throw e}}else r.push(o)},this),r},goog.storage.CollectableStorage.prototype.collectInternal=function(o,e){var r=this.getExpiredKeys_(o,e);return goog.array.forEach(r,function(o){goog.storage.CollectableStorage.prototype.remove.call(this,o)},this),r},goog.storage.CollectableStorage.prototype.collect=function(o){this.collectInternal(this.mechanism.__iterator__(!0),o)};