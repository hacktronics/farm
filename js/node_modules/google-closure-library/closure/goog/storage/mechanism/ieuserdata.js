goog.provide("goog.storage.mechanism.IEUserData"),goog.require("goog.asserts"),goog.require("goog.iter.Iterator"),goog.require("goog.iter.StopIteration"),goog.require("goog.storage.mechanism.ErrorCode"),goog.require("goog.storage.mechanism.IterableMechanism"),goog.require("goog.structs.Map"),goog.require("goog.userAgent"),goog.storage.mechanism.IEUserData=function(e,o){if(this.storageKey_=e,this.storageNode_=null,goog.storage.mechanism.IEUserData.base(this,"constructor"),goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){goog.storage.mechanism.IEUserData.storageMap_||(goog.storage.mechanism.IEUserData.storageMap_=new goog.structs.Map),this.storageNode_=goog.storage.mechanism.IEUserData.storageMap_.get(e),this.storageNode_||(o?this.storageNode_=document.getElementById(o):(this.storageNode_=document.createElement("userdata"),this.storageNode_.addBehavior("#default#userData"),document.body.appendChild(this.storageNode_)),goog.storage.mechanism.IEUserData.storageMap_.set(e,this.storageNode_));try{this.loadNode_()}catch(e){this.storageNode_=null}}},goog.inherits(goog.storage.mechanism.IEUserData,goog.storage.mechanism.IterableMechanism),goog.storage.mechanism.IEUserData.ENCODE_MAP={".":".2E","!":".21","~":".7E","*":".2A","'":".27","(":".28",")":".29","%":"."},goog.storage.mechanism.IEUserData.storageMap_=null,goog.storage.mechanism.IEUserData.encodeKey_=function(e){return"_"+encodeURIComponent(e).replace(/[.!~*'()%]/g,function(e){return goog.storage.mechanism.IEUserData.ENCODE_MAP[e]})},goog.storage.mechanism.IEUserData.decodeKey_=function(e){return decodeURIComponent(e.replace(/\./g,"%")).substr(1)},goog.storage.mechanism.IEUserData.prototype.isAvailable=function(){return!!this.storageNode_},goog.storage.mechanism.IEUserData.prototype.set=function(e,o){this.storageNode_.setAttribute(goog.storage.mechanism.IEUserData.encodeKey_(e),o),this.saveNode_()},goog.storage.mechanism.IEUserData.prototype.get=function(e){var o=this.storageNode_.getAttribute(goog.storage.mechanism.IEUserData.encodeKey_(e));if("string"!=typeof o&&null!==o)throw goog.storage.mechanism.ErrorCode.INVALID_VALUE;return o},goog.storage.mechanism.IEUserData.prototype.remove=function(e){this.storageNode_.removeAttribute(goog.storage.mechanism.IEUserData.encodeKey_(e)),this.saveNode_()},goog.storage.mechanism.IEUserData.prototype.getCount=function(){return this.getNode_().attributes.length},goog.storage.mechanism.IEUserData.prototype.__iterator__=function(e){var o=0,t=this.getNode_().attributes,r=new goog.iter.Iterator;return r.next=function(){if(o>=t.length)throw goog.iter.StopIteration;var r=goog.asserts.assert(t[o++]);if(e)return goog.storage.mechanism.IEUserData.decodeKey_(r.nodeName);var a=r.nodeValue;if("string"!=typeof a)throw goog.storage.mechanism.ErrorCode.INVALID_VALUE;return a},r},goog.storage.mechanism.IEUserData.prototype.clear=function(){for(var e=this.getNode_(),o=e.attributes.length;o>0;o--)e.removeAttribute(e.attributes[o-1].nodeName);this.saveNode_()},goog.storage.mechanism.IEUserData.prototype.loadNode_=function(){this.storageNode_.load(this.storageKey_)},goog.storage.mechanism.IEUserData.prototype.saveNode_=function(){try{this.storageNode_.save(this.storageKey_)}catch(e){throw goog.storage.mechanism.ErrorCode.QUOTA_EXCEEDED}},goog.storage.mechanism.IEUserData.prototype.getNode_=function(){return this.storageNode_.XMLDocument.documentElement};