goog.provide("goog.crypt.hashTester"),goog.require("goog.array"),goog.require("goog.crypt"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.reflect"),goog.require("goog.testing.PerformanceTable"),goog.require("goog.testing.PseudoRandom"),goog.require("goog.testing.asserts"),goog.setTestOnly("hashTester"),goog.crypt.hashTester.runBasicTests=function(e){e.update([97,158]);var t=e.digest();e.reset(),e.update("aB");var r=e.digest();assertTrue("Two different inputs resulted in a hash collision",!!goog.testing.asserts.findDifferences(t,r)),e.reset();var a=e.digest();assertTrue("Empty hash collided with a non-trivial one",!!goog.testing.asserts.findDifferences(t,a)&&!!goog.testing.asserts.findDifferences(r,a)),e.reset(),e.update([]),assertArrayEquals("Updating with an empty array did not give an empty hash",a,e.digest()),e.reset(),e.update(""),assertArrayEquals("Updating with an empty string did not give an empty hash",a,e.digest()),e.reset(),e.update([97,158]),assertArrayEquals("The reset did not produce the initial state",t,e.digest()),e.reset(),e.update([158,97]),assertTrue("Swapping bytes resulted in a hash collision",!!goog.testing.asserts.findDifferences(t,e.digest())),e.reset(),e.update([97,66]),assertArrayEquals("String and array inputs should give the same result",r,e.digest()),e.reset(),e.update("a"),e.update([158]),assertArrayEquals("Partial updates resulted in a different hash",t,e.digest()),e.reset(),e.update("aB",0),e.update([97,158,32],2),assertArrayEquals("Updating with an explicit buffer length did not work",t,e.digest())},goog.crypt.hashTester.runBlockTests=function(e,t){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="",s=0;s<t-1;s++)a+=r.charAt(s%62);e.update(a+"123");var o=e.digest();e.reset(),e.update(a+a+"123");var g=e.digest();e.reset(),e.update(a),e.update("123"),assertArrayEquals(o,e.digest()),e.reset(),e.update(a+"1"),e.update("23"),assertArrayEquals(o,e.digest()),e.reset(),e.update(a+"12"),e.update("3"),assertArrayEquals(o,e.digest()),e.reset(),e.update(goog.crypt.stringToByteArray(a+"123")),assertArrayEquals(o,e.digest()),e.reset(),e.update(a),e.update(a+"123"),assertArrayEquals(g,e.digest()),e.reset(),e.update(a+a+"12"),e.update("3"),assertArrayEquals(g,e.digest()),e.reset(),e.update(goog.crypt.stringToByteArray(a)),e.update(goog.crypt.stringToByteArray(a+"123")),assertArrayEquals(g,e.digest())},goog.crypt.hashTester.runPerfTests=function(e,t){var r=goog.dom.getDocument().body,a=goog.dom.createElement(goog.dom.TagName.DIV);goog.dom.appendChild(r,a);var s=new goog.testing.PerformanceTable(a);function o(r,a){var o=t+": "+a+" update(s) of "+r+" bytes";function g(t,g){s.run(function(){for(var s=e(),o=0;o<a;o++)s.update(t,r);goog.reflect.sinkValue(s.digest())},o+" ("+g+")")}var i=goog.crypt.hashTester.createRandomByteArray_(r),d=goog.crypt.hashTester.createByteString_(i);g(i,"byte array"),g(d,"byte string")}var g=1e7;o(g,1),o(10,1e6)},goog.crypt.hashTester.createRandomByteArray_=function(e){for(var t=new goog.testing.PseudoRandom(0),r=[],a=0;a<e;++a){var s=Math.floor(256*t.random());r.push(s)}return r},goog.crypt.hashTester.createByteString_=function(e){var t="";return goog.array.forEach(e,function(e){t+=String.fromCharCode(e)}),t};