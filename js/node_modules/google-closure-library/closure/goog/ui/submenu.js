goog.provide("goog.ui.SubMenu"),goog.require("goog.Timer"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.classlist"),goog.require("goog.events.KeyCodes"),goog.require("goog.positioning.AnchoredViewportPosition"),goog.require("goog.positioning.Corner"),goog.require("goog.style"),goog.require("goog.ui.Component"),goog.require("goog.ui.Menu"),goog.require("goog.ui.MenuItem"),goog.require("goog.ui.SubMenuRenderer"),goog.require("goog.ui.registry"),goog.ui.SubMenu=function(e,t,i,o){goog.ui.MenuItem.call(this,e,t,i,o||goog.ui.SubMenuRenderer.getInstance())},goog.inherits(goog.ui.SubMenu,goog.ui.MenuItem),goog.tagUnsealableClass(goog.ui.SubMenu),goog.ui.SubMenu.MENU_DELAY_MS=218,goog.ui.SubMenu.prototype.dismissTimer_=null,goog.ui.SubMenu.prototype.showTimer_=null,goog.ui.SubMenu.prototype.menuIsVisible_=!1,goog.ui.SubMenu.prototype.subMenu_=null,goog.ui.SubMenu.prototype.externalSubMenu_=!1,goog.ui.SubMenu.prototype.alignToEnd_=!0,goog.ui.SubMenu.prototype.isPositionAdjustable_=!1,goog.ui.SubMenu.prototype.enterDocument=function(){goog.ui.SubMenu.superClass_.enterDocument.call(this),this.getHandler().listen(this.getParent(),goog.ui.Component.EventType.HIDE,this.onParentHidden_),this.subMenu_&&this.setMenuListenersEnabled_(this.subMenu_,!0)},goog.ui.SubMenu.prototype.exitDocument=function(){this.getHandler().unlisten(this.getParent(),goog.ui.Component.EventType.HIDE,this.onParentHidden_),this.subMenu_&&(this.setMenuListenersEnabled_(this.subMenu_,!1),this.externalSubMenu_||(this.subMenu_.exitDocument(),goog.dom.removeNode(this.subMenu_.getElement()))),goog.ui.SubMenu.superClass_.exitDocument.call(this)},goog.ui.SubMenu.prototype.disposeInternal=function(){this.subMenu_&&!this.externalSubMenu_&&this.subMenu_.dispose(),this.subMenu_=null,goog.ui.SubMenu.superClass_.disposeInternal.call(this)},goog.ui.SubMenu.prototype.setHighlighted=function(e,t){goog.ui.SubMenu.superClass_.setHighlighted.call(this,e),t&&this.getMenu().setMouseButtonPressed(!0),e||(this.dismissTimer_&&goog.Timer.clear(this.dismissTimer_),this.dismissTimer_=goog.Timer.callOnce(this.dismissSubMenu,this.getMenuDelay(),this))},goog.ui.SubMenu.prototype.showSubMenu=function(){var e=this.getParent();e&&e.getHighlighted()==this&&(this.setSubMenuVisible_(!0),this.dismissSiblings_())},goog.ui.SubMenu.prototype.dismissSubMenu=function(){var e=this.subMenu_;e&&e.getParent()==this&&(this.setSubMenuVisible_(!1),e.forEachChild(function(e){"function"==typeof e.dismissSubMenu&&e.dismissSubMenu()}))},goog.ui.SubMenu.prototype.clearTimers=function(){this.dismissTimer_&&goog.Timer.clear(this.dismissTimer_),this.showTimer_&&goog.Timer.clear(this.showTimer_)},goog.ui.SubMenu.prototype.setVisible=function(e,t){var i=goog.ui.SubMenu.superClass_.setVisible.call(this,e,t);return i&&!this.isVisible()&&this.dismissSubMenu(),i},goog.ui.SubMenu.prototype.dismissSiblings_=function(){this.getParent().forEachChild(function(e){e!=this&&"function"==typeof e.dismissSubMenu&&(e.dismissSubMenu(),e.clearTimers())},this)},goog.ui.SubMenu.prototype.handleKeyEvent=function(e){var t=e.keyCode,i=this.isRightToLeft()?goog.events.KeyCodes.LEFT:goog.events.KeyCodes.RIGHT,o=this.isRightToLeft()?goog.events.KeyCodes.RIGHT:goog.events.KeyCodes.LEFT;if(this.menuIsVisible_)if(this.getMenu().handleKeyEvent(e));else{if(t!=o)return!1;this.dismissSubMenu()}else{if(!this.isEnabled()||t!=i&&t!=goog.events.KeyCodes.ENTER&&t!=this.getMnemonic())return!1;this.showSubMenu(),this.getMenu().highlightFirst(),this.clearTimers()}return e.preventDefault(),!0},goog.ui.SubMenu.prototype.onChildEnter_=function(e){this.subMenu_.getParent()==this&&(this.clearTimers(),this.getParentEventTarget().setHighlighted(this),this.dismissSiblings_())},goog.ui.SubMenu.prototype.onParentHidden_=function(e){e.target==this.getParentEventTarget()&&(this.dismissSubMenu(),this.clearTimers())},goog.ui.SubMenu.prototype.handleMouseOver=function(e){this.isEnabled()&&(this.clearTimers(),this.showTimer_=goog.Timer.callOnce(this.showSubMenu,this.getMenuDelay(),this)),goog.ui.SubMenu.superClass_.handleMouseOver.call(this,e)},goog.ui.SubMenu.prototype.getMenuDelay=function(){return goog.ui.SubMenu.MENU_DELAY_MS},goog.ui.SubMenu.prototype.performActionInternal=function(e){return this.clearTimers(),this.isSupportedState(goog.ui.Component.State.SELECTED)||this.isSupportedState(goog.ui.Component.State.CHECKED)?goog.ui.SubMenu.superClass_.performActionInternal.call(this,e):(this.showSubMenu(),!0)},goog.ui.SubMenu.prototype.setSubMenuVisible_=function(e){!e&&this.getMenu()&&this.getMenu().setHighlightedIndex(-1),this.dispatchEvent(goog.ui.Component.getStateTransitionEvent(goog.ui.Component.State.OPENED,e));var t=this.getMenu();e!=this.menuIsVisible_&&goog.dom.classlist.enable(goog.asserts.assert(this.getElement()),goog.getCssName("goog-submenu-open"),e),e!=t.isVisible()&&(e&&(t.isInDocument()||t.render(),t.setHighlightedIndex(-1)),t.setVisible(e),e&&this.positionSubMenu()),this.menuIsVisible_=e},goog.ui.SubMenu.prototype.setMenuListenersEnabled_=function(e,t){var i=this.getHandler();(t?i.listen:i.unlisten).call(i,e,goog.ui.Component.EventType.ENTER,this.onChildEnter_)},goog.ui.SubMenu.prototype.setAlignToEnd=function(e){if(e!=this.alignToEnd_&&(this.alignToEnd_=e,this.isInDocument())){var t=this.getElement();this.exitDocument(),t.nextSibling?this.renderBefore(t.nextSibling):this.render(t.parentNode)}},goog.ui.SubMenu.prototype.isAlignedToEnd=function(){return this.alignToEnd_},goog.ui.SubMenu.prototype.positionSubMenu=function(){var e=new goog.positioning.AnchoredViewportPosition(this.getElement(),this.isAlignedToEnd()?goog.positioning.Corner.TOP_END:goog.positioning.Corner.TOP_START,this.isPositionAdjustable_),t=this.getMenu(),i=t.getElement();t.isVisible()||(i.style.visibility="hidden",goog.style.setElementShown(i,!0)),e.reposition(i,this.isAlignedToEnd()?goog.positioning.Corner.TOP_START:goog.positioning.Corner.TOP_END),t.isVisible()||(goog.style.setElementShown(i,!1),i.style.visibility="visible")},goog.ui.SubMenu.prototype.addItem=function(e){this.getMenu().addChild(e,!0)},goog.ui.SubMenu.prototype.addItemAt=function(e,t){this.getMenu().addChildAt(e,t,!0)},goog.ui.SubMenu.prototype.removeItem=function(e){var t=this.getMenu().removeChild(e,!0);t&&t.dispose()},goog.ui.SubMenu.prototype.removeItemAt=function(e){var t=this.getMenu().removeChildAt(e,!0);t&&t.dispose()},goog.ui.SubMenu.prototype.getItemAt=function(e){return this.getMenu().getChildAt(e)},goog.ui.SubMenu.prototype.getItemCount=function(){return this.getMenu().getChildCount()},goog.ui.SubMenu.prototype.getItems=function(){return this.getMenu().getItems()},goog.ui.SubMenu.prototype.getMenu=function(){return this.subMenu_?this.externalSubMenu_&&this.subMenu_.getParent()!=this&&this.subMenu_.setParent(this):this.setMenu(new goog.ui.Menu(this.getDomHelper()),!0),this.subMenu_.getElement()||this.subMenu_.createDom(),this.subMenu_},goog.ui.SubMenu.prototype.setMenu=function(e,t){var i=this.subMenu_;e!=i&&(i&&(this.dismissSubMenu(),this.isInDocument()&&this.setMenuListenersEnabled_(i,!1)),this.subMenu_=e,this.externalSubMenu_=!t,e&&(e.setParent(this),e.setVisible(!1,!0),e.setAllowAutoFocus(!1),e.setFocusable(!1),this.isInDocument()&&this.setMenuListenersEnabled_(e,!0)))},goog.ui.SubMenu.prototype.containsElement=function(e){return this.getMenu().containsElement(e)},goog.ui.SubMenu.prototype.setPositionAdjustable=function(e){this.isPositionAdjustable_=!!e},goog.ui.SubMenu.prototype.isPositionAdjustable=function(){return this.isPositionAdjustable_},goog.ui.registry.setDecoratorByClassName(goog.getCssName("goog-submenu"),function(){return new goog.ui.SubMenu(null)});