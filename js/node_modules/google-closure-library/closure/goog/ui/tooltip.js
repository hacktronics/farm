goog.provide("goog.ui.Tooltip"),goog.provide("goog.ui.Tooltip.CursorTooltipPosition"),goog.provide("goog.ui.Tooltip.ElementTooltipPosition"),goog.provide("goog.ui.Tooltip.State"),goog.require("goog.Timer"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.dom.safe"),goog.require("goog.events"),goog.require("goog.events.EventType"),goog.require("goog.events.FocusHandler"),goog.require("goog.math.Box"),goog.require("goog.math.Coordinate"),goog.require("goog.positioning"),goog.require("goog.positioning.AnchoredPosition"),goog.require("goog.positioning.Corner"),goog.require("goog.positioning.Overflow"),goog.require("goog.positioning.OverflowStatus"),goog.require("goog.positioning.ViewportPosition"),goog.require("goog.structs.Set"),goog.require("goog.style"),goog.require("goog.ui.Popup"),goog.require("goog.ui.PopupBase"),goog.ui.Tooltip=function(o,t,i){this.dom_=i||(o?goog.dom.getDomHelper(goog.dom.getElement(o)):goog.dom.getDomHelper()),goog.ui.Popup.call(this,this.dom_.createDom(goog.dom.TagName.DIV,{style:"position:absolute;display:none;"})),this.cursorPosition=new goog.math.Coordinate(1,1),this.elements_=new goog.structs.Set,this.tooltipFocusHandler_=null,o&&this.attach(o),null!=t&&this.setText(t)},goog.inherits(goog.ui.Tooltip,goog.ui.Popup),goog.tagUnsealableClass(goog.ui.Tooltip),goog.ui.Tooltip.activeInstances_=[],goog.ui.Tooltip.prototype.activeEl_=null,goog.ui.Tooltip.prototype.className=goog.getCssName("goog-tooltip"),goog.ui.Tooltip.prototype.showDelayMs_=500,goog.ui.Tooltip.prototype.showTimer,goog.ui.Tooltip.prototype.hideDelayMs_=0,goog.ui.Tooltip.prototype.hideTimer,goog.ui.Tooltip.prototype.anchor,goog.ui.Tooltip.State={INACTIVE:0,WAITING_TO_SHOW:1,SHOWING:2,WAITING_TO_HIDE:3,UPDATING:4},goog.ui.Tooltip.Activation={CURSOR:0,FOCUS:1},goog.ui.Tooltip.prototype.seenInteraction_,goog.ui.Tooltip.prototype.requireInteraction_,goog.ui.Tooltip.prototype.childTooltip_,goog.ui.Tooltip.prototype.parentTooltip_,goog.ui.Tooltip.prototype.getDomHelper=function(){return this.dom_},goog.ui.Tooltip.prototype.getChildTooltip=function(){return this.childTooltip_},goog.ui.Tooltip.prototype.attach=function(o){o=goog.dom.getElement(o),this.elements_.add(o),goog.events.listen(o,goog.events.EventType.MOUSEOVER,this.handleMouseOver,!1,this),goog.events.listen(o,goog.events.EventType.MOUSEOUT,this.handleMouseOutAndBlur,!1,this),goog.events.listen(o,goog.events.EventType.MOUSEMOVE,this.handleMouseMove,!1,this),goog.events.listen(o,goog.events.EventType.FOCUS,this.handleFocus,!1,this),goog.events.listen(o,goog.events.EventType.BLUR,this.handleMouseOutAndBlur,!1,this)},goog.ui.Tooltip.prototype.detach=function(o){if(o){var t=goog.dom.getElement(o);this.detachElement_(t),this.elements_.remove(t)}else{for(var i=this.elements_.getValues(),e=0;t=i[e];e++)this.detachElement_(t);this.elements_.clear()}},goog.ui.Tooltip.prototype.detachElement_=function(o){goog.events.unlisten(o,goog.events.EventType.MOUSEOVER,this.handleMouseOver,!1,this),goog.events.unlisten(o,goog.events.EventType.MOUSEOUT,this.handleMouseOutAndBlur,!1,this),goog.events.unlisten(o,goog.events.EventType.MOUSEMOVE,this.handleMouseMove,!1,this),goog.events.unlisten(o,goog.events.EventType.FOCUS,this.handleFocus,!1,this),goog.events.unlisten(o,goog.events.EventType.BLUR,this.handleMouseOutAndBlur,!1,this)},goog.ui.Tooltip.prototype.setShowDelayMs=function(o){this.showDelayMs_=o},goog.ui.Tooltip.prototype.getShowDelayMs=function(){return this.showDelayMs_},goog.ui.Tooltip.prototype.setHideDelayMs=function(o){this.hideDelayMs_=o},goog.ui.Tooltip.prototype.getHideDelayMs=function(){return this.hideDelayMs_},goog.ui.Tooltip.prototype.setText=function(o){goog.dom.setTextContent(this.getElement(),o)},goog.ui.Tooltip.prototype.setSafeHtml=function(o){var t=this.getElement();t&&goog.dom.safe.setInnerHtml(t,o)},goog.ui.Tooltip.prototype.setElement=function(o){var t=this.getElement();if(t&&goog.dom.removeNode(t),goog.ui.Tooltip.superClass_.setElement.call(this,o),o){var i=this.dom_.getDocument().body;i.insertBefore(o,i.lastChild),this.registerContentFocusEvents_()}else goog.dispose(this.tooltipFocusHandler_),this.tooltipFocusHandler_=null},goog.ui.Tooltip.prototype.registerContentFocusEvents_=function(){goog.dispose(this.tooltipFocusHandler_),this.tooltipFocusHandler_=new goog.events.FocusHandler(goog.asserts.assert(this.getElement())),this.registerDisposable(this.tooltipFocusHandler_),goog.events.listen(this.tooltipFocusHandler_,goog.events.FocusHandler.EventType.FOCUSIN,this.clearHideTimer,void 0,this),goog.events.listen(this.tooltipFocusHandler_,goog.events.FocusHandler.EventType.FOCUSOUT,this.startHideTimer,void 0,this)},goog.ui.Tooltip.prototype.getText=function(){return goog.dom.getTextContent(this.getElement())},goog.ui.Tooltip.prototype.getHtml=function(){return this.getElement().innerHTML},goog.ui.Tooltip.prototype.getState=function(){return this.showTimer?this.isVisible()?goog.ui.Tooltip.State.UPDATING:goog.ui.Tooltip.State.WAITING_TO_SHOW:this.hideTimer?goog.ui.Tooltip.State.WAITING_TO_HIDE:this.isVisible()?goog.ui.Tooltip.State.SHOWING:goog.ui.Tooltip.State.INACTIVE},goog.ui.Tooltip.prototype.setRequireInteraction=function(o){this.requireInteraction_=o},goog.ui.Tooltip.prototype.isCoordinateInTooltip=function(o){if(!this.isVisible())return!1;var t=goog.style.getPageOffset(this.getElement()),i=goog.style.getSize(this.getElement());return t.x<=o.x&&o.x<=t.x+i.width&&t.y<=o.y&&o.y<=t.y+i.height},goog.ui.Tooltip.prototype.onBeforeShow=function(){if(!goog.ui.PopupBase.prototype.onBeforeShow.call(this))return!1;if(this.anchor)for(var o,t=0;o=goog.ui.Tooltip.activeInstances_[t];t++)goog.dom.contains(o.getElement(),this.anchor)||o.setVisible(!1);goog.array.insert(goog.ui.Tooltip.activeInstances_,this);var i=this.getElement();return i.className=this.className,this.clearHideTimer(),goog.events.listen(i,goog.events.EventType.MOUSEOVER,this.handleTooltipMouseOver,!1,this),goog.events.listen(i,goog.events.EventType.MOUSEOUT,this.handleTooltipMouseOut,!1,this),this.clearShowTimer(),!0},goog.ui.Tooltip.prototype.onHide=function(){goog.array.remove(goog.ui.Tooltip.activeInstances_,this);for(var o,t=this.getElement(),i=0;o=goog.ui.Tooltip.activeInstances_[i];i++)o.anchor&&goog.dom.contains(t,o.anchor)&&o.setVisible(!1);this.parentTooltip_&&this.parentTooltip_.startHideTimer(),goog.events.unlisten(t,goog.events.EventType.MOUSEOVER,this.handleTooltipMouseOver,!1,this),goog.events.unlisten(t,goog.events.EventType.MOUSEOUT,this.handleTooltipMouseOut,!1,this),this.anchor=void 0,this.getState()==goog.ui.Tooltip.State.INACTIVE&&(this.seenInteraction_=!1),goog.ui.PopupBase.prototype.onHide.call(this)},goog.ui.Tooltip.prototype.maybeShow=function(o,t){this.anchor==o&&this.elements_.contains(this.anchor)&&(this.seenInteraction_||!this.requireInteraction_?(this.setVisible(!1),this.isVisible()||this.positionAndShow_(o,t)):this.anchor=void 0),this.showTimer=void 0},goog.ui.Tooltip.prototype.getElements=function(){return this.elements_},goog.ui.Tooltip.prototype.getActiveElement=function(){return this.activeEl_},goog.ui.Tooltip.prototype.setActiveElement=function(o){this.activeEl_=o},goog.ui.Tooltip.prototype.showForElement=function(o,t){this.attach(o),this.activeEl_=o,this.positionAndShow_(o,t)},goog.ui.Tooltip.prototype.positionAndShow_=function(o,t){this.anchor=o,this.setPosition(t||this.getPositioningStrategy(goog.ui.Tooltip.Activation.CURSOR)),this.setVisible(!0)},goog.ui.Tooltip.prototype.maybeHide=function(o){if(this.hideTimer=void 0,o==this.anchor){var t=this.getDomHelper(),i=t.getActiveElement(),e=i&&this.getElement()&&t.contains(this.getElement(),i);null!=this.activeEl_&&(this.activeEl_==this.getElement()||this.elements_.contains(this.activeEl_))||e||this.hasActiveChild()||this.setVisible(!1)}},goog.ui.Tooltip.prototype.hasActiveChild=function(){return!(!this.childTooltip_||!this.childTooltip_.activeEl_)},goog.ui.Tooltip.prototype.saveCursorPosition_=function(o){var t=this.dom_.getDocumentScroll();this.cursorPosition.x=o.clientX+t.x,this.cursorPosition.y=o.clientY+t.y},goog.ui.Tooltip.prototype.handleMouseOver=function(o){var t=this.getAnchorFromElement(o.target);this.activeEl_=t,this.clearHideTimer(),t!=this.anchor&&(this.anchor=t,this.startShowTimer(t),this.checkForParentTooltip_(),this.saveCursorPosition_(o))},goog.ui.Tooltip.prototype.getAnchorFromElement=function(o){try{for(;o&&!this.elements_.contains(o);)o=o.parentNode;return o}catch(o){return null}},goog.ui.Tooltip.prototype.handleMouseMove=function(o){this.saveCursorPosition_(o),this.seenInteraction_=!0},goog.ui.Tooltip.prototype.handleFocus=function(o){var t=this.getAnchorFromElement(o.target);if(this.activeEl_=t,this.seenInteraction_=!0,this.anchor!=t){this.anchor=t;var i=this.getPositioningStrategy(goog.ui.Tooltip.Activation.FOCUS);this.clearHideTimer(),this.startShowTimer(t,i),this.checkForParentTooltip_()}},goog.ui.Tooltip.prototype.getPositioningStrategy=function(o){if(o==goog.ui.Tooltip.Activation.CURSOR){var t=this.cursorPosition.clone();return new goog.ui.Tooltip.CursorTooltipPosition(t)}return new goog.ui.Tooltip.ElementTooltipPosition(this.activeEl_)},goog.ui.Tooltip.prototype.checkForParentTooltip_=function(){if(this.anchor)for(var o,t=0;o=goog.ui.Tooltip.activeInstances_[t];t++)goog.dom.contains(o.getElement(),this.anchor)&&(o.childTooltip_=this,this.parentTooltip_=o)},goog.ui.Tooltip.prototype.handleMouseOutAndBlur=function(o){var t=this.getAnchorFromElement(o.target);t!=this.getAnchorFromElement(o.relatedTarget)&&(t==this.activeEl_&&(this.activeEl_=null),this.clearShowTimer(),this.seenInteraction_=!1,!this.isVisible()||o.relatedTarget&&goog.dom.contains(this.getElement(),o.relatedTarget)?this.anchor=void 0:this.startHideTimer())},goog.ui.Tooltip.prototype.handleTooltipMouseOver=function(o){var t=this.getElement();this.activeEl_!=t&&(this.clearHideTimer(),this.activeEl_=t)},goog.ui.Tooltip.prototype.handleTooltipMouseOut=function(o){var t=this.getElement();this.activeEl_!=t||o.relatedTarget&&goog.dom.contains(t,o.relatedTarget)||(this.activeEl_=null,this.startHideTimer())},goog.ui.Tooltip.prototype.startShowTimer=function(o,t){this.showTimer||(this.showTimer=goog.Timer.callOnce(goog.bind(this.maybeShow,this,o,t),this.showDelayMs_))},goog.ui.Tooltip.prototype.clearShowTimer=function(){this.showTimer&&(goog.Timer.clear(this.showTimer),this.showTimer=void 0)},goog.ui.Tooltip.prototype.startHideTimer=function(){this.getState()==goog.ui.Tooltip.State.SHOWING&&(this.hideTimer=goog.Timer.callOnce(goog.bind(this.maybeHide,this,this.anchor),this.getHideDelayMs()))},goog.ui.Tooltip.prototype.clearHideTimer=function(){this.hideTimer&&(goog.Timer.clear(this.hideTimer),this.hideTimer=void 0)},goog.ui.Tooltip.prototype.disposeInternal=function(){this.setVisible(!1),this.clearShowTimer(),this.detach(),this.getElement()&&goog.dom.removeNode(this.getElement()),this.activeEl_=null,delete this.dom_,goog.ui.Tooltip.superClass_.disposeInternal.call(this)},goog.ui.Tooltip.CursorTooltipPosition=function(o,t){goog.positioning.ViewportPosition.call(this,o,t)},goog.inherits(goog.ui.Tooltip.CursorTooltipPosition,goog.positioning.ViewportPosition),goog.ui.Tooltip.CursorTooltipPosition.prototype.reposition=function(o,t,i){var e=goog.style.getClientViewportElement(o),g=goog.style.getVisibleRectForElement(e),n=i?new goog.math.Box(i.top+10,i.right,i.bottom,i.left+10):new goog.math.Box(10,0,0,10);goog.positioning.positionAtCoordinate(this.coordinate,o,goog.positioning.Corner.TOP_START,n,g,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.FAIL_Y)&goog.positioning.OverflowStatus.FAILED&&goog.positioning.positionAtCoordinate(this.coordinate,o,goog.positioning.Corner.TOP_START,n,g,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y)},goog.ui.Tooltip.ElementTooltipPosition=function(o){goog.positioning.AnchoredPosition.call(this,o,goog.positioning.Corner.BOTTOM_RIGHT)},goog.inherits(goog.ui.Tooltip.ElementTooltipPosition,goog.positioning.AnchoredPosition),goog.ui.Tooltip.ElementTooltipPosition.prototype.reposition=function(o,t,i){var e=new goog.math.Coordinate(10,0);goog.positioning.positionAtAnchor(this.element,this.corner,o,t,e,i,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.FAIL_Y)&goog.positioning.OverflowStatus.FAILED&&goog.positioning.positionAtAnchor(this.element,goog.positioning.Corner.TOP_RIGHT,o,goog.positioning.Corner.BOTTOM_LEFT,e,i,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y)};