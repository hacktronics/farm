goog.provide("goog.ui.Ratings"),goog.provide("goog.ui.Ratings.EventType"),goog.require("goog.a11y.aria"),goog.require("goog.a11y.aria.Role"),goog.require("goog.a11y.aria.State"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.dom.classlist"),goog.require("goog.events.EventType"),goog.require("goog.ui.Component"),goog.ui.Ratings=function(t,e){goog.ui.Component.call(this,e),this.ratings_=t||["1","2","3","4","5"],this.stars_=[],this.isEnabled_=!0,this.highlightedIndex_=-1,this.selectedIndex_=-1,this.attachedFormField_=null},goog.inherits(goog.ui.Ratings,goog.ui.Component),goog.tagUnsealableClass(goog.ui.Ratings),goog.ui.Ratings.CSS_CLASS=goog.getCssName("goog-ratings"),goog.ui.Ratings.EventType={CHANGE:"change",HIGHLIGHT_CHANGE:"highlightchange",HIGHLIGHT:"highlight",UNHIGHLIGHT:"unhighlight"},goog.ui.Ratings.prototype.decorateInternal=function(t){var e=goog.dom.getElementsByTagName(goog.dom.TagName.SELECT,goog.asserts.assert(t))[0];if(!e)throw new Error("Can not decorate "+t+", with Ratings. Must contain select box");this.ratings_.length=0;for(var i=0,g=e.options.length;i<g;i++){var o=e.options[i];this.ratings_.push(o.text)}this.setSelectedIndex(e.selectedIndex),e.style.display="none",this.attachedFormField_=e,this.createDom(),t.insertBefore(this.getElement(),e)},goog.ui.Ratings.prototype.enterDocument=function(){var t=this.getElement();goog.asserts.assert(t,"The DOM element for ratings cannot be null."),goog.ui.Ratings.base(this,"enterDocument"),t.tabIndex=0,goog.dom.classlist.add(t,this.getCssClass()),goog.a11y.aria.setRole(t,goog.a11y.aria.Role.SLIDER),goog.a11y.aria.setState(t,goog.a11y.aria.State.VALUEMIN,0);var e=this.ratings_.length-1;goog.a11y.aria.setState(t,goog.a11y.aria.State.VALUEMAX,e);var i=this.getHandler();i.listen(t,"keydown",this.onKeyDown_);for(var g=0;g<this.ratings_.length;g++){var o=this.getDomHelper().createDom(goog.dom.TagName.SPAN,{title:this.ratings_[g],class:this.getClassName_(g,!1),index:g});this.stars_.push(o),t.appendChild(o)}i.listen(t,goog.events.EventType.CLICK,this.onClick_),i.listen(t,goog.events.EventType.MOUSEOUT,this.onMouseOut_),i.listen(t,goog.events.EventType.MOUSEOVER,this.onMouseOver_),this.highlightIndex_(this.selectedIndex_)},goog.ui.Ratings.prototype.exitDocument=function(){goog.ui.Ratings.superClass_.exitDocument.call(this);for(var t=0;t<this.stars_.length;t++)this.getDomHelper().removeNode(this.stars_[t]);this.stars_.length=0},goog.ui.Ratings.prototype.disposeInternal=function(){goog.ui.Ratings.superClass_.disposeInternal.call(this),this.ratings_.length=0},goog.ui.Ratings.prototype.getCssClass=function(){return goog.ui.Ratings.CSS_CLASS},goog.ui.Ratings.prototype.setSelectedIndex=function(t){if((t=Math.max(-1,Math.min(t,this.ratings_.length-1)))!=this.selectedIndex_){if(this.selectedIndex_=t,this.highlightIndex_(this.selectedIndex_),this.attachedFormField_){this.attachedFormField_.tagName==goog.dom.TagName.SELECT?this.attachedFormField_.selectedIndex=t:this.attachedFormField_.value=this.getValue();var e=this.getElement();goog.asserts.assert(e,"The DOM ratings element cannot be null."),goog.a11y.aria.setState(e,goog.a11y.aria.State.VALUENOW,this.ratings_[t])}this.dispatchEvent(goog.ui.Ratings.EventType.CHANGE)}},goog.ui.Ratings.prototype.getSelectedIndex=function(){return this.selectedIndex_},goog.ui.Ratings.prototype.getValue=function(){return-1==this.selectedIndex_?null:this.ratings_[this.selectedIndex_]},goog.ui.Ratings.prototype.getHighlightedIndex=function(){return this.highlightedIndex_},goog.ui.Ratings.prototype.getHighlightedValue=function(){return-1==this.highlightedIndex_?null:this.ratings_[this.highlightedIndex_]},goog.ui.Ratings.prototype.setRatings=function(t){this.ratings_=t},goog.ui.Ratings.prototype.getRatings=function(){return this.ratings_},goog.ui.Ratings.prototype.setAttachedFormField=function(t){this.attachedFormField_=t},goog.ui.Ratings.prototype.getAttachedFormField=function(){return this.attachedFormField_},goog.ui.Ratings.prototype.setEnabled=function(t){this.isEnabled_=t,t||this.resetHighlights_()},goog.ui.Ratings.prototype.isEnabled=function(){return this.isEnabled_},goog.ui.Ratings.prototype.onMouseOver_=function(t){if(this.isEnabled()&&void 0!==t.target.index){var e=t.target.index;this.highlightedIndex_!=e&&(this.highlightIndex_(e),this.highlightedIndex_=e,this.dispatchEvent(goog.ui.Ratings.EventType.HIGHLIGHT_CHANGE),this.dispatchEvent(goog.ui.Ratings.EventType.HIGHLIGHT))}},goog.ui.Ratings.prototype.onMouseOut_=function(t){t.relatedTarget&&void 0===t.relatedTarget.index&&this.resetHighlights_()},goog.ui.Ratings.prototype.onClick_=function(t){this.isEnabled()&&void 0!==t.target.index&&this.setSelectedIndex(t.target.index)},goog.ui.Ratings.prototype.onKeyDown_=function(t){if(this.isEnabled())switch(t.keyCode){case 27:this.setSelectedIndex(-1);break;case 36:this.setSelectedIndex(0);break;case 35:this.setSelectedIndex(this.ratings_.length);break;case 37:this.setSelectedIndex(this.getSelectedIndex()-1);break;case 39:this.setSelectedIndex(this.getSelectedIndex()+1);break;default:var e=parseInt(String.fromCharCode(t.keyCode),10);isNaN(e)||this.setSelectedIndex(e-1)}},goog.ui.Ratings.prototype.resetHighlights_=function(){this.highlightIndex_(this.selectedIndex_),this.highlightedIndex_=-1,this.dispatchEvent(goog.ui.Ratings.EventType.HIGHLIGHT_CHANGE),this.dispatchEvent(goog.ui.Ratings.EventType.UNHIGHLIGHT)},goog.ui.Ratings.prototype.highlightIndex_=function(t){for(var e,i=0;e=this.stars_[i];i++)goog.dom.classlist.set(e,this.getClassName_(i,i<=t))},goog.ui.Ratings.prototype.getClassName_=function(t,e){var i,g,o=this.getCssClass();return i=0===t?goog.getCssName(o,"firststar"):t==this.ratings_.length-1?goog.getCssName(o,"laststar"):goog.getCssName(o,"midstar"),i=e?goog.getCssName(i,"on"):goog.getCssName(i,"off"),g=this.isEnabled_?goog.getCssName(o,"enabled"):goog.getCssName(o,"disabled"),goog.getCssName(o,"star")+" "+i+" "+g};