goog.provide("goog.ui.HoverCard"),goog.provide("goog.ui.HoverCard.EventType"),goog.provide("goog.ui.HoverCard.TriggerEvent"),goog.require("goog.array"),goog.require("goog.dom"),goog.require("goog.events"),goog.require("goog.events.Event"),goog.require("goog.events.EventType"),goog.require("goog.ui.AdvancedTooltip"),goog.require("goog.ui.PopupBase"),goog.require("goog.ui.Tooltip"),goog.ui.HoverCard=function(o,e,t,r){goog.ui.AdvancedTooltip.call(this,null,null,t),goog.isFunction(o)?this.isAnchor_=o:this.anchors_=o,this.checkDescendants_=0!=e,this.tempAttachedAnchors_=[],this.document_=r||(t?t.getDocument():goog.dom.getDocument()),goog.events.listen(this.document_,goog.events.EventType.MOUSEOVER,this.handleTriggerMouseOver_,!1,this)},goog.inherits(goog.ui.HoverCard,goog.ui.AdvancedTooltip),goog.tagUnsealableClass(goog.ui.HoverCard),goog.ui.HoverCard.EventType={TRIGGER:"trigger",CANCEL_TRIGGER:"canceltrigger",BEFORE_SHOW:goog.ui.PopupBase.EventType.BEFORE_SHOW,SHOW:goog.ui.PopupBase.EventType.SHOW,BEFORE_HIDE:goog.ui.PopupBase.EventType.BEFORE_HIDE,HIDE:goog.ui.PopupBase.EventType.HIDE},goog.ui.HoverCard.prototype.disposeInternal=function(){goog.ui.HoverCard.superClass_.disposeInternal.call(this),goog.events.unlisten(this.document_,goog.events.EventType.MOUSEOVER,this.handleTriggerMouseOver_,!1,this)},goog.ui.HoverCard.prototype.currentAnchor_,goog.ui.HoverCard.prototype.maxSearchSteps_,goog.ui.HoverCard.prototype.isAnchor_=function(o){return o.tagName in this.anchors_&&!!o.getAttribute(this.anchors_[o.tagName])},goog.ui.HoverCard.prototype.handleTriggerMouseOver_=function(o){var e=o.target;if(e)if(this.isAnchor_(e))this.setPosition(null),this.triggerForElement(e);else if(this.checkDescendants_){var t=goog.dom.getAncestor(e,goog.bind(this.isAnchor_,this),!1,this.maxSearchSteps_);t&&(this.setPosition(null),this.triggerForElement(t))}},goog.ui.HoverCard.prototype.triggerForElement=function(o,e,t){if(o!=this.currentAnchor_){if(o!=this.anchor){this.maybeCancelTrigger_();var r=new goog.ui.HoverCard.TriggerEvent(goog.ui.HoverCard.EventType.TRIGGER,this,o,t);if(this.getElements().contains(o)||(this.attach(o),this.tempAttachedAnchors_.push(o)),this.anchor=o,this.onTrigger(r)){var i=e||this.getPosition();this.startShowTimer(o,i)}else this.onCancelTrigger()}}else this.clearHideTimer()},goog.ui.HoverCard.prototype.setCurrentAnchor_=function(o){o!=this.currentAnchor_&&this.detachTempAnchor_(this.currentAnchor_),this.currentAnchor_=o},goog.ui.HoverCard.prototype.detachTempAnchor_=function(o){if(o){var e=goog.array.indexOf(this.tempAttachedAnchors_,o);-1!=e&&(this.detach(o),this.tempAttachedAnchors_.splice(e,1))}},goog.ui.HoverCard.prototype.onTrigger=function(o){return this.dispatchEvent(o)},goog.ui.HoverCard.prototype.cancelTrigger=function(){this.clearShowTimer(),this.onCancelTrigger()},goog.ui.HoverCard.prototype.maybeCancelTrigger_=function(){this.getState()!=goog.ui.Tooltip.State.WAITING_TO_SHOW&&this.getState()!=goog.ui.Tooltip.State.UPDATING||this.cancelTrigger()},goog.ui.HoverCard.prototype.onCancelTrigger=function(){var o=new goog.ui.HoverCard.TriggerEvent(goog.ui.HoverCard.EventType.CANCEL_TRIGGER,this,this.anchor||null);this.dispatchEvent(o),this.detachTempAnchor_(this.anchor),delete this.anchor},goog.ui.HoverCard.prototype.getAnchorElement=function(){return this.currentAnchor_||this.anchor},goog.ui.HoverCard.prototype.onHide=function(){goog.ui.HoverCard.superClass_.onHide.call(this),this.setCurrentAnchor_(null)},goog.ui.HoverCard.prototype.handleMouseOver=function(o){var e=this.getAnchorFromElement(o.target);e&&e!=this.anchor?this.triggerForElement(e):goog.ui.HoverCard.superClass_.handleMouseOver.call(this,o)},goog.ui.HoverCard.prototype.handleMouseOutAndBlur=function(o){var e=this.anchor,t=this.getState();goog.ui.HoverCard.superClass_.handleMouseOutAndBlur.call(this,o),t==this.getState()||t!=goog.ui.Tooltip.State.WAITING_TO_SHOW&&t!=goog.ui.Tooltip.State.UPDATING||(this.anchor=e,this.onCancelTrigger())},goog.ui.HoverCard.prototype.maybeShow=function(o,e){goog.ui.HoverCard.superClass_.maybeShow.call(this,o,e),this.isVisible()?this.setCurrentAnchor_(o):this.cancelTrigger()},goog.ui.HoverCard.prototype.setMaxSearchSteps=function(o){o?this.checkDescendants_&&(this.maxSearchSteps_=o):this.checkDescendants_=!1},goog.ui.HoverCard.TriggerEvent=function(o,e,t,r){goog.events.Event.call(this,o,e),this.anchor=t,this.data=r},goog.inherits(goog.ui.HoverCard.TriggerEvent,goog.events.Event);