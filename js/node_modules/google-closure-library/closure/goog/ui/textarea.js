goog.provide("goog.ui.Textarea"),goog.provide("goog.ui.Textarea.EventType"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.classlist"),goog.require("goog.events.EventType"),goog.require("goog.style"),goog.require("goog.ui.Control"),goog.require("goog.ui.TextareaRenderer"),goog.require("goog.userAgent"),goog.ui.Textarea=function(e,t,o){goog.ui.Control.call(this,e,t||goog.ui.TextareaRenderer.getInstance(),o),this.setHandleMouseEvents(!1),this.setAllowTextSelection(!0),this.hasUserInput_=""!=e,e||this.setContentInternal("")},goog.inherits(goog.ui.Textarea,goog.ui.Control),goog.tagUnsealableClass(goog.ui.Textarea),goog.ui.Textarea.NEEDS_HELP_SHRINKING_=!(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(11)),goog.ui.Textarea.prototype.isResizing_=!1,goog.ui.Textarea.prototype.hasFocusForPlaceholder_=!1,goog.ui.Textarea.prototype.hasUserInput_=!1,goog.ui.Textarea.prototype.height_=0,goog.ui.Textarea.prototype.maxHeight_=0,goog.ui.Textarea.prototype.minHeight_=0,goog.ui.Textarea.prototype.hasDiscoveredTextareaCharacteristics_=!1,goog.ui.Textarea.prototype.needsPaddingBorderFix_=!1,goog.ui.Textarea.prototype.scrollHeightIncludesPadding_=!1,goog.ui.Textarea.prototype.scrollHeightIncludesBorder_=!1,goog.ui.Textarea.prototype.paddingBox_,goog.ui.Textarea.prototype.borderBox_,goog.ui.Textarea.prototype.placeholderText_="",goog.ui.Textarea.EventType={RESIZE:"resize"},goog.ui.Textarea.prototype.setPlaceholder=function(e){this.placeholderText_=e,this.getElement()&&this.restorePlaceholder_()},goog.ui.Textarea.prototype.getPaddingBorderBoxHeight_=function(){return this.paddingBox_.top+this.paddingBox_.bottom+this.borderBox_.top+this.borderBox_.bottom},goog.ui.Textarea.prototype.getMinHeight=function(){return this.minHeight_},goog.ui.Textarea.prototype.getMinHeight_=function(){var e=this.minHeight_,t=this.getElement();return e&&t&&this.needsPaddingBorderFix_&&(e-=this.getPaddingBorderBoxHeight_()),e},goog.ui.Textarea.prototype.setMinHeight=function(e){this.minHeight_=e,this.resize()},goog.ui.Textarea.prototype.getMaxHeight=function(){return this.maxHeight_},goog.ui.Textarea.prototype.getMaxHeight_=function(){var e=this.maxHeight_,t=this.getElement();return e&&t&&this.needsPaddingBorderFix_&&(e-=this.getPaddingBorderBoxHeight_()),e},goog.ui.Textarea.prototype.setMaxHeight=function(e){this.maxHeight_=e,this.resize()},goog.ui.Textarea.prototype.setValue=function(e){this.setContent(String(e))},goog.ui.Textarea.prototype.getValue=function(){return this.getElement().value!=this.placeholderText_||this.supportsNativePlaceholder_()||this.hasUserInput_?this.getElement().value:""},goog.ui.Textarea.prototype.setContent=function(e){goog.ui.Textarea.superClass_.setContent.call(this,e),this.hasUserInput_=""!=e,this.resize()},goog.ui.Textarea.prototype.setEnabled=function(e){goog.ui.Textarea.superClass_.setEnabled.call(this,e),this.getElement().disabled=!e},goog.ui.Textarea.prototype.resize=function(){this.getElement()&&this.grow_()},goog.ui.Textarea.prototype.supportsNativePlaceholder_=function(){return goog.asserts.assert(this.getElement()),"placeholder"in this.getElement()},goog.ui.Textarea.prototype.restorePlaceholder_=function(){this.placeholderText_&&(this.supportsNativePlaceholder_()?this.getElement().placeholder=this.placeholderText_:!this.getElement()||this.hasUserInput_||this.hasFocusForPlaceholder_||(goog.dom.classlist.add(goog.asserts.assert(this.getElement()),goog.ui.Textarea.TEXTAREA_PLACEHOLDER_CLASS),this.getElement().value=this.placeholderText_))},goog.ui.Textarea.prototype.enterDocument=function(){goog.ui.Textarea.base(this,"enterDocument");var e=this.getElement();goog.style.setStyle(e,{overflowY:"hidden",overflowX:"auto",boxSizing:"border-box",MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"}),this.paddingBox_=goog.style.getPaddingBox(e),this.borderBox_=goog.style.getBorderBox(e),this.getHandler().listen(e,goog.events.EventType.SCROLL,this.grow_).listen(e,goog.events.EventType.FOCUS,this.grow_).listen(e,goog.events.EventType.KEYUP,this.grow_).listen(e,goog.events.EventType.MOUSEUP,this.mouseUpListener_).listen(e,goog.events.EventType.BLUR,this.blur_),this.restorePlaceholder_(),this.resize()},goog.ui.Textarea.prototype.getHeight_=function(){this.discoverTextareaCharacteristics_();var e=this.getElement();isNaN(this.paddingBox_.top)&&(this.paddingBox_=goog.style.getPaddingBox(e),this.borderBox_=goog.style.getBorderBox(e));var t=this.getElement().scrollHeight+this.getHorizontalScrollBarHeight_();if(this.needsPaddingBorderFix_)t-=this.getPaddingBorderBoxHeight_();else{if(!this.scrollHeightIncludesPadding_){var o=this.paddingBox_;t+=o.top+o.bottom}if(!this.scrollHeightIncludesBorder_){var i=goog.style.getBorderBox(e);t+=i.top+i.bottom}}return t},goog.ui.Textarea.prototype.setHeight_=function(e){this.height_!=e&&(this.height_=e,this.getElement().style.height=e+"px")},goog.ui.Textarea.prototype.setHeightToEstimate_=function(){var e=this.getElement();e.style.height="auto";var t=e.value.match(/\n/g)||[];e.rows=t.length+1,this.height_=0},goog.ui.Textarea.prototype.getHorizontalScrollBarHeight_=function(){var e=this.getElement(),t=e.offsetHeight-e.clientHeight;if(!this.scrollHeightIncludesPadding_){var o=this.paddingBox_;t-=o.top+o.bottom}if(!this.scrollHeightIncludesBorder_){var i=goog.style.getBorderBox(e);t-=i.top+i.bottom}return t>0?t:0},goog.ui.Textarea.prototype.discoverTextareaCharacteristics_=function(){if(!this.hasDiscoveredTextareaCharacteristics_){var e=this.getElement().cloneNode(!1);goog.style.setStyle(e,{position:"absolute",height:"auto",top:"-9999px",margin:"0",padding:"1px",border:"1px solid #000",overflow:"hidden"}),goog.dom.appendChild(this.getDomHelper().getDocument().body,e);var t=e.scrollHeight;e.style.padding="10px";var o=e.scrollHeight;this.scrollHeightIncludesPadding_=o>t,t=o,e.style.borderWidth="10px";var i=e.scrollHeight;this.scrollHeightIncludesBorder_=i>t,e.style.height="100px",100!=e.offsetHeight&&(this.needsPaddingBorderFix_=!0),goog.dom.removeNode(e),this.hasDiscoveredTextareaCharacteristics_=!0}},goog.ui.Textarea.TEXTAREA_PLACEHOLDER_CLASS=goog.getCssName("textarea-placeholder-input"),goog.ui.Textarea.prototype.blur_=function(e){this.supportsNativePlaceholder_()||(this.hasFocusForPlaceholder_=!1,""==this.getElement().value&&(this.hasUserInput_=!1,this.restorePlaceholder_()))},goog.ui.Textarea.prototype.grow_=function(e){if(!this.isResizing_){var t=this.getElement();!this.supportsNativePlaceholder_()&&e&&e.type==goog.events.EventType.FOCUS&&(t.value==this.placeholderText_&&this.placeholderText_&&!this.hasFocusForPlaceholder_&&(goog.dom.classlist.remove(t,goog.ui.Textarea.TEXTAREA_PLACEHOLDER_CLASS),t.value=""),this.hasFocusForPlaceholder_=!0,this.hasUserInput_=""!=t.value);var o=!1;this.isResizing_=!0;var i=this.height_;if(t.scrollHeight){var g=!1,r=!1,s=this.getHeight_(),a=t.offsetHeight,h=this.getMinHeight_(),n=this.getMaxHeight_();h&&s<h?(this.setHeight_(h),g=!0):n&&s>n?(this.setHeight_(n),t.style.overflowY="",r=!0):a!=s?this.setHeight_(s):this.height_||(this.height_=s),g||r||!goog.ui.Textarea.NEEDS_HELP_SHRINKING_||(o=!0)}else this.setHeightToEstimate_();this.isResizing_=!1,o&&this.shrink_(),i!=this.height_&&this.dispatchEvent(goog.ui.Textarea.EventType.RESIZE)}},goog.ui.Textarea.prototype.shrink_=function(){var e=this.getElement();if(!this.isResizing_){this.isResizing_=!0;var t=e.scrollHeight;if(t){var o=this.getHeight_(),i=this.getMinHeight_();if(!(i&&o<=i)){var g=this.paddingBox_;if(e.style.paddingBottom=g.bottom+1+"px",this.getHeight_()==o){e.style.paddingBottom=g.bottom+t+"px",e.scrollTop=0;var r=this.getHeight_()-t;r>=i?this.setHeight_(r):this.setHeight_(i)}e.style.paddingBottom=g.bottom+"px"}}else this.setHeightToEstimate_();this.isResizing_=!1}},goog.ui.Textarea.prototype.mouseUpListener_=function(e){var t=this.getElement(),o=t.offsetHeight;if(t.filters&&t.filters.length){var i=t.filters.item("DXImageTransform.Microsoft.DropShadow");i&&(o-=i.offX)}o!=this.height_&&(this.minHeight_=o,this.height_=o)};