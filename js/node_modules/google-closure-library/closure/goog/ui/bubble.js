goog.provide("goog.ui.Bubble"),goog.require("goog.Timer"),goog.require("goog.dom.safe"),goog.require("goog.events"),goog.require("goog.events.EventType"),goog.require("goog.html.SafeHtml"),goog.require("goog.math.Box"),goog.require("goog.positioning"),goog.require("goog.positioning.AbsolutePosition"),goog.require("goog.positioning.AnchoredPosition"),goog.require("goog.positioning.Corner"),goog.require("goog.positioning.CornerBit"),goog.require("goog.string.Const"),goog.require("goog.style"),goog.require("goog.ui.Component"),goog.require("goog.ui.Popup"),goog.ui.Bubble=function(o,e,t){goog.ui.Component.call(this,t),"string"==typeof o&&(o=goog.html.SafeHtml.htmlEscape(o)),this.message_=o,this.popup_=new goog.ui.Popup,this.config_=e||goog.ui.Bubble.defaultConfig,this.closeButtonId_=this.makeId("cb"),this.messageId_=this.makeId("mi")},goog.inherits(goog.ui.Bubble,goog.ui.Component),goog.tagUnsealableClass(goog.ui.Bubble),goog.ui.Bubble.prototype.timeout_=null,goog.ui.Bubble.prototype.timerId_=0,goog.ui.Bubble.prototype.listener_=null,goog.ui.Bubble.prototype.createDom=function(){goog.ui.Bubble.superClass_.createDom.call(this);var o=this.getElement();o.style.position="absolute",o.style.visibility="hidden",this.popup_.setElement(o)},goog.ui.Bubble.prototype.attach=function(o){this.setAnchoredPosition_(o,this.computePinnedCorner_(o))},goog.ui.Bubble.prototype.setPinnedCorner=function(o){this.popup_.setPinnedCorner(o)},goog.ui.Bubble.prototype.setPosition=function(o){if(o instanceof goog.positioning.AbsolutePosition)this.popup_.setPosition(o);else{if(!(o instanceof goog.positioning.AnchoredPosition))throw new Error("Bubble only supports absolute and anchored positions!");this.setAnchoredPosition_(o.element,o.corner)}},goog.ui.Bubble.prototype.setTimeout=function(o){this.timeout_=o},goog.ui.Bubble.prototype.setAutoHide=function(o){this.popup_.setAutoHide(o)},goog.ui.Bubble.prototype.setVisible=function(o){o&&!this.popup_.isVisible()&&this.configureElement_(),this.popup_.setVisible(o),this.popup_.isVisible()||this.unconfigureElement_()},goog.ui.Bubble.prototype.isVisible=function(){return this.popup_.isVisible()},goog.ui.Bubble.prototype.disposeInternal=function(){this.unconfigureElement_(),this.popup_.dispose(),this.popup_=null,goog.ui.Bubble.superClass_.disposeInternal.call(this)},goog.ui.Bubble.prototype.configureElement_=function(){if(!this.isInDocument())throw new Error("You must render the bubble before showing it!");var o=this.getElement(),e=this.popup_.getPinnedCorner();if(goog.dom.safe.setInnerHtml(o,this.computeHtmlForCorner_(e)),!(this.message_ instanceof goog.html.SafeHtml)){var t=this.getDomHelper().getElement(this.messageId_);this.getDomHelper().appendChild(t,this.message_)}var i=this.getDomHelper().getElement(this.closeButtonId_);this.listener_=goog.events.listen(i,goog.events.EventType.CLICK,this.hideBubble_,!1,this),this.timeout_&&(this.timerId_=goog.Timer.callOnce(this.hideBubble_,this.timeout_,this))},goog.ui.Bubble.prototype.unconfigureElement_=function(){this.listener_&&(goog.events.unlistenByKey(this.listener_),this.listener_=null),this.timerId_&&(goog.Timer.clear(this.timerId_),this.timerId_=null);var o=this.getElement();o&&(this.getDomHelper().removeChildren(o),goog.dom.safe.setInnerHtml(o,goog.html.SafeHtml.EMPTY))},goog.ui.Bubble.prototype.setAnchoredPosition_=function(o,e){this.popup_.setPinnedCorner(e);var t=this.createMarginForCorner_(e);this.popup_.setMargin(t);var i=goog.positioning.flipCorner(e);this.popup_.setPosition(new goog.positioning.AnchoredPosition(o,i))},goog.ui.Bubble.prototype.hideBubble_=function(){this.setVisible(!1)},goog.ui.Bubble.prototype.getComputedAnchoredPosition=function(o){return new goog.positioning.AnchoredPosition(o,this.computePinnedCorner_(o))},goog.ui.Bubble.prototype.computePinnedCorner_=function(o){var e=this.getDomHelper().getOwnerDocument(o),t=goog.style.getClientViewportElement(e),i=t.offsetWidth,g=t.offsetHeight,s=goog.style.getPageOffset(o),n=goog.style.getSize(o),r=0;return i-s.x-n.width>s.x&&(r+=1),g-s.y-n.height>s.y&&(r+=2),goog.ui.Bubble.corners_[r]},goog.ui.Bubble.prototype.createMarginForCorner_=function(o){var e=new goog.math.Box(0,0,0,0);return o&goog.positioning.CornerBit.RIGHT?e.right-=this.config_.marginShift:e.left-=this.config_.marginShift,e},goog.ui.Bubble.prototype.computeHtmlForCorner_=function(o){var e,t;switch(o){case goog.positioning.Corner.TOP_LEFT:e=this.config_.cssBubbleTopLeftAnchor,t=this.config_.cssBubbleBottomNoAnchor;break;case goog.positioning.Corner.TOP_RIGHT:e=this.config_.cssBubbleTopRightAnchor,t=this.config_.cssBubbleBottomNoAnchor;break;case goog.positioning.Corner.BOTTOM_LEFT:e=this.config_.cssBubbleTopNoAnchor,t=this.config_.cssBubbleBottomLeftAnchor;break;case goog.positioning.Corner.BOTTOM_RIGHT:e=this.config_.cssBubbleTopNoAnchor,t=this.config_.cssBubbleBottomRightAnchor;break;default:throw new Error("This corner type is not supported by bubble!")}var i=null;i=this.message_ instanceof goog.html.SafeHtml?this.message_:goog.html.SafeHtml.create("div",{id:this.messageId_});var g=goog.html.SafeHtml.concat(goog.html.SafeHtml.create("tr",{},goog.html.SafeHtml.create("td",{colspan:4,class:e})),goog.html.SafeHtml.create("tr",{},goog.html.SafeHtml.concat(goog.html.SafeHtml.create("td",{class:this.config_.cssBubbleLeft}),goog.html.SafeHtml.create("td",{class:this.config_.cssBubbleFont,style:goog.string.Const.from("padding:0 4px;background:white")},i),goog.html.SafeHtml.create("td",{id:this.closeButtonId_,class:this.config_.cssCloseButton}),goog.html.SafeHtml.create("td",{class:this.config_.cssBubbleRight}))),goog.html.SafeHtml.create("tr",{},goog.html.SafeHtml.create("td",{colspan:4,class:t})));return goog.html.SafeHtml.create("table",{border:0,cellspacing:0,cellpadding:0,width:this.config_.bubbleWidth,style:goog.string.Const.from("z-index:1")},g)},goog.ui.Bubble.defaultConfig={bubbleWidth:147,marginShift:60,cssBubbleFont:goog.getCssName("goog-bubble-font"),cssCloseButton:goog.getCssName("goog-bubble-close-button"),cssBubbleTopRightAnchor:goog.getCssName("goog-bubble-top-right-anchor"),cssBubbleTopLeftAnchor:goog.getCssName("goog-bubble-top-left-anchor"),cssBubbleTopNoAnchor:goog.getCssName("goog-bubble-top-no-anchor"),cssBubbleBottomRightAnchor:goog.getCssName("goog-bubble-bottom-right-anchor"),cssBubbleBottomLeftAnchor:goog.getCssName("goog-bubble-bottom-left-anchor"),cssBubbleBottomNoAnchor:goog.getCssName("goog-bubble-bottom-no-anchor"),cssBubbleLeft:goog.getCssName("goog-bubble-left"),cssBubbleRight:goog.getCssName("goog-bubble-right")},goog.ui.Bubble.corners_=[goog.positioning.Corner.BOTTOM_RIGHT,goog.positioning.Corner.BOTTOM_LEFT,goog.positioning.Corner.TOP_RIGHT,goog.positioning.Corner.TOP_LEFT];