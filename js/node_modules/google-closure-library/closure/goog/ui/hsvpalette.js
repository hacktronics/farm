goog.provide("goog.ui.HsvPalette"),goog.require("goog.color"),goog.require("goog.dom.InputType"),goog.require("goog.dom.TagName"),goog.require("goog.events"),goog.require("goog.events.EventType"),goog.require("goog.events.InputHandler"),goog.require("goog.style"),goog.require("goog.style.bidi"),goog.require("goog.ui.Component"),goog.require("goog.userAgent"),goog.ui.HsvPalette=function(e,t,o){goog.ui.Component.call(this,e),this.setColorInternal(t||"#f00"),this.className=o||goog.getCssName("goog-hsv-palette"),this.document_=this.getDomHelper().getDocument()},goog.inherits(goog.ui.HsvPalette,goog.ui.Component),goog.tagUnsealableClass(goog.ui.HsvPalette),goog.ui.HsvPalette.MSG_HSV_PALETTE_HEX_COLOR_=goog.getMsg("Hex color"),goog.ui.HsvPalette.prototype.hsImageEl_,goog.ui.HsvPalette.prototype.hsHandleEl_,goog.ui.HsvPalette.prototype.valueBackgroundImageElement,goog.ui.HsvPalette.prototype.vHandleEl_,goog.ui.HsvPalette.prototype.swatchElement,goog.ui.HsvPalette.prototype.inputElement,goog.ui.HsvPalette.prototype.inputHandler_,goog.ui.HsvPalette.prototype.mouseMoveListener,goog.ui.HsvPalette.prototype.mouseUpListener,goog.ui.HsvPalette.prototype.hsv_,goog.ui.HsvPalette.prototype.color,goog.ui.HsvPalette.prototype.getColor=function(){return this.color},goog.ui.HsvPalette.prototype.getAlpha=function(){return 1},goog.ui.HsvPalette.prototype.updateInput=function(){var e;try{e=goog.color.parse(this.inputElement.value).hex}catch(e){}this.color!=e&&(this.inputElement.value=this.color)},goog.ui.HsvPalette.prototype.setColor=function(e,t){e!=this.color&&(this.setColorInternal(e),this.updateUi(),t||this.dispatchEvent(goog.ui.Component.EventType.ACTION))},goog.ui.HsvPalette.prototype.setColorInternal=function(e){var t=goog.color.parse(e).hex,o=goog.color.hexToRgb(t);this.hsv_=goog.color.rgbArrayToHsv(o),this.hsv_[0]=this.hsv_[0]/360,this.color=t},goog.ui.HsvPalette.prototype.setHsv=function(e,t,o){null==e&&null==t&&null==o||(this.setHsv_(e,t,o),this.updateUi(),this.dispatchEvent(goog.ui.Component.EventType.ACTION))},goog.ui.HsvPalette.prototype.setHsv_=function(e,t,o){this.hsv_[0]=null!=e?e:this.hsv_[0],this.hsv_[1]=null!=t?t:this.hsv_[1],this.hsv_[2]=null!=o?o:this.hsv_[2],this.color=goog.color.hsvArrayToHex([360*this.hsv_[0],this.hsv_[1],this.hsv_[2]])},goog.ui.HsvPalette.prototype.canDecorate=function(e){return!1},goog.ui.HsvPalette.prototype.createDom=function(){var e=this.getDomHelper(),t=goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("7")?" "+goog.getCssName(this.className,"noalpha"):"",o=e.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"hs-backdrop"));this.hsHandleEl_=e.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"hs-handle")),this.hsImageEl_=e.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"hs-image"),this.hsHandleEl_),this.valueBackgroundImageElement=e.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"v-image")),this.vHandleEl_=e.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"v-handle")),this.swatchElement=e.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"swatch")),this.inputElement=e.createDom(goog.dom.TagName.INPUT,{class:goog.getCssName(this.className,"input"),"aria-label":goog.ui.HsvPalette.MSG_HSV_PALETTE_HEX_COLOR_,type:goog.dom.InputType.TEXT,dir:"ltr"}),this.inputElement.spellcheck=!1;var s=e.createDom(goog.dom.TagName.LABEL,null,this.inputElement),g=e.createDom(goog.dom.TagName.DIV,this.className+t,o,this.hsImageEl_,this.valueBackgroundImageElement,this.vHandleEl_,this.swatchElement,s);this.setElementInternal(g)},goog.ui.HsvPalette.prototype.enterDocument=function(){goog.ui.HsvPalette.superClass_.enterDocument.call(this),this.updateUi();var e=this.getHandler();e.listen(this.getElement(),goog.events.EventType.MOUSEDOWN,this.handleMouseDown),this.inputHandler_||(this.inputHandler_=new goog.events.InputHandler(this.inputElement)),e.listen(this.inputHandler_,goog.events.InputHandler.EventType.INPUT,this.handleInput)},goog.ui.HsvPalette.prototype.disposeInternal=function(){goog.ui.HsvPalette.superClass_.disposeInternal.call(this),delete this.hsImageEl_,delete this.hsHandleEl_,delete this.valueBackgroundImageElement,delete this.vHandleEl_,delete this.swatchElement,delete this.inputElement,this.inputHandler_&&(this.inputHandler_.dispose(),delete this.inputHandler_),goog.events.unlistenByKey(this.mouseMoveListener),goog.events.unlistenByKey(this.mouseUpListener)},goog.ui.HsvPalette.prototype.updateUi=function(){if(this.isInDocument()){var e=this.hsv_[0],t=this.hsv_[1],o=this.hsv_[2],s=this.hsImageEl_.offsetWidth*e;this.isRightToLeft()&&(s=this.hsImageEl_.offsetWidth-s),s-=Math.ceil(this.hsHandleEl_.offsetWidth/2);var g=this.hsImageEl_.offsetHeight*(1-t);g-=Math.ceil(this.hsHandleEl_.offsetHeight/2),goog.style.bidi.setPosition(this.hsHandleEl_,s,g,this.isRightToLeft()),g=this.valueBackgroundImageElement.offsetTop-Math.floor(this.vHandleEl_.offsetHeight/2)+this.valueBackgroundImageElement.offsetHeight*((255-o)/255),this.vHandleEl_.style.top=g+"px",goog.style.setOpacity(this.hsImageEl_,o/255),goog.style.setStyle(this.valueBackgroundImageElement,"background-color",goog.color.hsvToHex(360*this.hsv_[0],this.hsv_[1],255)),goog.style.setStyle(this.swatchElement,"background-color",this.color),goog.style.setStyle(this.swatchElement,"color",this.hsv_[2]>127.5?"#000":"#fff"),this.updateInput()}},goog.ui.HsvPalette.prototype.handleMouseDown=function(e){if(e.target==this.valueBackgroundImageElement||e.target==this.vHandleEl_){var t=goog.style.getBounds(this.valueBackgroundImageElement);this.handleMouseMoveV_(t,e),this.mouseMoveListener=goog.events.listen(this.document_,goog.events.EventType.MOUSEMOVE,goog.bind(this.handleMouseMoveV_,this,t)),this.mouseUpListener=goog.events.listen(this.document_,goog.events.EventType.MOUSEUP,this.handleMouseUp,!1,this)}else if(e.target==this.hsImageEl_||e.target==this.hsHandleEl_){t=goog.style.getBounds(this.hsImageEl_);this.handleMouseMoveHs_(t,e),this.mouseMoveListener=goog.events.listen(this.document_,goog.events.EventType.MOUSEMOVE,goog.bind(this.handleMouseMoveHs_,this,t)),this.mouseUpListener=goog.events.listen(this.document_,goog.events.EventType.MOUSEUP,this.handleMouseUp,!1,this)}},goog.ui.HsvPalette.prototype.handleMouseMoveV_=function(e,t){t.preventDefault();var o=this.getDomHelper().getDocumentScroll(),s=Math.min(Math.max(o.y+t.clientY,e.top),e.top+e.height),g=Math.round(255*(e.top+e.height-s)/e.height);this.setHsv(null,null,g)},goog.ui.HsvPalette.prototype.handleMouseMoveHs_=function(e,t){t.preventDefault();var o=this.getDomHelper().getDocumentScroll(),s=(Math.min(Math.max(o.x+t.clientX,e.left),e.left+e.width)-e.left)/e.width,g=(-Math.min(Math.max(o.y+t.clientY,e.top),e.top+e.height)+e.top+e.height)/e.height;this.setHsv(s,g,null)},goog.ui.HsvPalette.prototype.handleMouseUp=function(e){goog.events.unlistenByKey(this.mouseMoveListener),goog.events.unlistenByKey(this.mouseUpListener)},goog.ui.HsvPalette.prototype.handleInput=function(e){/^#?[0-9a-f]{6}$/i.test(this.inputElement.value)&&this.setColor(this.inputElement.value)};