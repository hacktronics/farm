goog.provide("goog.ui.Gauge"),goog.provide("goog.ui.GaugeColoredRange"),goog.require("goog.a11y.aria"),goog.require("goog.asserts"),goog.require("goog.dom.TagName"),goog.require("goog.events"),goog.require("goog.fx.Animation"),goog.require("goog.fx.Transition"),goog.require("goog.fx.easing"),goog.require("goog.graphics"),goog.require("goog.graphics.Font"),goog.require("goog.graphics.Path"),goog.require("goog.graphics.SolidFill"),goog.require("goog.math"),goog.require("goog.ui.Component"),goog.require("goog.ui.GaugeTheme"),goog.ui.GaugeColoredRange=function(o,e,t){this.fromValue=o,this.toValue=e,this.backgroundColor=t},goog.ui.Gauge=function(o,e,t){goog.ui.Component.call(this,t),this.width_=o,this.height_=e,this.graphics_=goog.graphics.createGraphics(o,e,null,null,t),this.rangeColors_=[]},goog.inherits(goog.ui.Gauge,goog.ui.Component),goog.ui.Gauge.RED="#ffc0c0",goog.ui.Gauge.GREEN="#c0ffc0",goog.ui.Gauge.YELLOW="#ffffa0",goog.ui.Gauge.FACTOR_RADIUS_FROM_SIZE=.45,goog.ui.Gauge.FACTOR_MAIN_AREA=.9,goog.ui.Gauge.FACTOR_COLOR_RADIUS=.75,goog.ui.Gauge.FACTOR_MAJOR_TICKS=.8,goog.ui.Gauge.FACTOR_MINOR_TICKS=.9,goog.ui.Gauge.FACTOR_NEEDLE_FRONT=.95,goog.ui.Gauge.FACTOR_NEEDLE_BACK=.3,goog.ui.Gauge.FACTOR_NEEDLE_WIDTH=.07,goog.ui.Gauge.FACTOR_NEEDLE_HINGE=.15,goog.ui.Gauge.FACTOR_TITLE_FONT_SIZE=.16,goog.ui.Gauge.FACTOR_TITLE_OFFSET=.35,goog.ui.Gauge.FACTOR_VALUE_FONT_SIZE=.18,goog.ui.Gauge.FACTOR_TICK_LABEL_FONT_SIZE=.14,goog.ui.Gauge.FACTOR_VALUE_OFFSET=.75,goog.ui.Gauge.TITLE_FONT_NAME="arial",goog.ui.Gauge.NEEDLE_MOVE_MAX_STEP=.02,goog.ui.Gauge.NEEDLE_MOVE_TIME=400,goog.ui.Gauge.MAX_EXCEED_POSITION_POSITION=.02,goog.ui.Gauge.prototype.minValue_=0,goog.ui.Gauge.prototype.maxValue_=100,goog.ui.Gauge.prototype.majorTicks_=5,goog.ui.Gauge.prototype.minorTicks_=2,goog.ui.Gauge.prototype.value_=0,goog.ui.Gauge.prototype.formattedValue_=null,goog.ui.Gauge.prototype.theme_=null,goog.ui.Gauge.prototype.titleTop_=null,goog.ui.Gauge.prototype.titleBottom_=null,goog.ui.Gauge.prototype.titleFont_=null,goog.ui.Gauge.prototype.valueFont_=null,goog.ui.Gauge.prototype.tickLabelFont_=null,goog.ui.Gauge.prototype.angleSpan_=270,goog.ui.Gauge.prototype.needleRadius_=0,goog.ui.Gauge.prototype.needleGroup_=null,goog.ui.Gauge.prototype.needleValuePosition_=null,goog.ui.Gauge.prototype.majorTickLabels_=null,goog.ui.Gauge.prototype.animation_=null,goog.ui.Gauge.prototype.getMinimum=function(){return this.minValue_},goog.ui.Gauge.prototype.setMinimum=function(o){this.minValue_=o;var e=this.getElement();e&&goog.a11y.aria.setState(e,"valuemin",o)},goog.ui.Gauge.prototype.getMaximum=function(){return this.maxValue_},goog.ui.Gauge.prototype.setMaximum=function(o){this.maxValue_=o;var e=this.getElement();e&&goog.a11y.aria.setState(e,"valuemax",o)},goog.ui.Gauge.prototype.setValue=function(o,e){this.value_=o,this.formattedValue_=e||null,this.stopAnimation_();var t=this.valueToRangePosition_(o);if(null==this.needleValuePosition_)this.needleValuePosition_=t,this.drawValue_();else{this.animation_=new goog.fx.Animation([this.needleValuePosition_],[t],goog.ui.Gauge.NEEDLE_MOVE_TIME,goog.fx.easing.inAndOut);var g=[goog.fx.Transition.EventType.BEGIN,goog.fx.Animation.EventType.ANIMATE,goog.fx.Transition.EventType.END];goog.events.listen(this.animation_,g,this.onAnimate_,!1,this),goog.events.listen(this.animation_,goog.fx.Transition.EventType.END,this.onAnimateEnd_,!1,this),this.animation_.play(!1)}var i=this.getElement();i&&goog.a11y.aria.setState(i,"valuenow",this.value_)},goog.ui.Gauge.prototype.setTicks=function(o,e){this.majorTicks_=Math.max(1,o),this.minorTicks_=Math.max(1,e),this.draw_()},goog.ui.Gauge.prototype.setMajorTickLabels=function(o){this.majorTickLabels_=o,this.draw_()},goog.ui.Gauge.prototype.setTitleTop=function(o){this.titleTop_=o,this.draw_()},goog.ui.Gauge.prototype.setTitleBottom=function(o){this.titleBottom_=o,this.draw_()},goog.ui.Gauge.prototype.setTitleFont=function(o){this.titleFont_=o,this.draw_()},goog.ui.Gauge.prototype.setValueFont=function(o){this.valueFont_=o,this.drawValue_()},goog.ui.Gauge.prototype.setTheme=function(o){this.theme_=o,this.draw_()},goog.ui.Gauge.prototype.addBackgroundColor=function(o,e,t){this.rangeColors_.push(new goog.ui.GaugeColoredRange(o,e,t)),this.draw_()},goog.ui.Gauge.prototype.createDom=function(){this.setElementInternal(this.getDomHelper().createDom(goog.dom.TagName.DIV,goog.getCssName("goog-gauge"),this.graphics_.getElement()))},goog.ui.Gauge.prototype.clear_=function(){this.graphics_.clear(),this.needleGroup_=null},goog.ui.Gauge.prototype.draw_=function(){if(this.isInDocument()){var o,e;this.clear_();var t=Math.min(this.width_,this.height_),g=Math.round(goog.ui.Gauge.FACTOR_RADIUS_FROM_SIZE*t),i=this.width_/2,a=this.height_/2,u=this.theme_;u||(u=goog.ui.Gauge.prototype.theme_=new goog.ui.GaugeTheme);var n=this.graphics_,r=this.theme_.getExternalBorderStroke(),l=u.getExternalBorderFill(i,a,g);n.drawCircle(i,a,g,r,l),g-=r.getWidth(),g=Math.round(g*goog.ui.Gauge.FACTOR_MAIN_AREA),r=u.getInternalBorderStroke(),l=u.getInternalBorderFill(i,a,g),n.drawCircle(i,a,g,r,l);for(var s=(g-=2*r.getWidth())*goog.ui.Gauge.FACTOR_COLOR_RADIUS,h=0;h<this.rangeColors_.length;h++){var _=this.rangeColors_[h],p=_.fromValue,T=_.toValue,m=new goog.graphics.Path,G=this.valueToAngle_(p),d=this.valueToAngle_(T);m.moveTo(i+goog.math.angleDx(G,g),a+goog.math.angleDy(G,g)),m.arcTo(g,g,G,d-G),m.lineTo(i+goog.math.angleDx(d,s),a+goog.math.angleDy(d,s)),m.arcTo(s,s,d,G-d),m.close(),l=new goog.graphics.SolidFill(_.backgroundColor),n.drawPath(m,null,l)}if(this.titleTop_||this.titleBottom_){var c=this.titleFont_;if(!c){var E=Math.round(g*goog.ui.Gauge.FACTOR_TITLE_FONT_SIZE);c=new goog.graphics.Font(E,goog.ui.Gauge.TITLE_FONT_NAME),this.titleFont_=c}l=new goog.graphics.SolidFill(u.getTitleColor()),this.titleTop_&&(e=a-Math.round(g*goog.ui.Gauge.FACTOR_TITLE_OFFSET),n.drawTextOnLine(this.titleTop_,0,e,this.width_,e,"center",c,null,l)),this.titleBottom_&&(e=a+Math.round(g*goog.ui.Gauge.FACTOR_TITLE_OFFSET),n.drawTextOnLine(this.titleBottom_,0,e,this.width_,e,"center",c,null,l))}var A=this.majorTicks_,F=this.minorTicks_,O=g*goog.ui.Gauge.FACTOR_MAJOR_TICKS,v=g*goog.ui.Gauge.FACTOR_MINOR_TICKS,f=A*F,y=(this.maxValue_-this.minValue_)/f,C=new goog.graphics.Path,I=new goog.graphics.Path,R=new goog.graphics.SolidFill(u.getTickLabelColor()),w=this.tickLabelFont_;w||(w=new goog.graphics.Font(Math.round(g*goog.ui.Gauge.FACTOR_TICK_LABEL_FONT_SIZE),goog.ui.Gauge.TITLE_FONT_NAME));var D=w.size;for(h=0;h<=f;h++){var M=this.valueToAngle_(h*y+this.minValue_),N=h%F==0,S=N?O:v;m=N?C:I;if(o=i+goog.math.angleDx(M,S),e=a+goog.math.angleDy(M,S),m.moveTo(o,e),o=i+goog.math.angleDx(M,g),e=a+goog.math.angleDy(M,g),m.lineTo(o,e),N&&this.majorTickLabels_){var L=Math.floor(h/F),V=this.majorTickLabels_[L];if(V){var x,P;o=i+goog.math.angleDx(M,S-D/2),e=a+goog.math.angleDy(M,S-D/2);var k="center";if(M>280||M<90)k="right",x=0,P=o;else if(M>=90&&M<260)k="left",x=o,P=this.width_;else{var B=Math.min(o,this.width_-o);x=o-B,P=o+B,e+=Math.round(D/4)}n.drawTextOnLine(V,x,e,P,e,k,w,null,R)}}}r=u.getMinorTickStroke(),n.drawPath(I,r,null),r=u.getMajorTickStroke(),n.drawPath(C,r,null),this.stopAnimation_(),this.needleRadius_=g,this.drawValue_()}},goog.ui.Gauge.prototype.onAnimate_=function(o){this.needleValuePosition_=o.x,this.drawValue_()},goog.ui.Gauge.prototype.onAnimateEnd_=function(){this.stopAnimation_()},goog.ui.Gauge.prototype.stopAnimation_=function(){this.animation_&&(goog.events.removeAll(this.animation_),this.animation_.stop(!1),this.animation_=null)},goog.ui.Gauge.prototype.valueToRangePosition_=function(o){var e=this.maxValue_-this.minValue_,t=(o-this.minValue_)/e;return t=Math.max(t,-goog.ui.Gauge.MAX_EXCEED_POSITION_POSITION),t=Math.min(t,1+goog.ui.Gauge.MAX_EXCEED_POSITION_POSITION)},goog.ui.Gauge.prototype.valueToAngle_=function(o){var e=this.valueToRangePosition_(o);return this.valuePositionToAngle_(e)},goog.ui.Gauge.prototype.valuePositionToAngle_=function(o){var e=goog.math.standardAngle((360-this.angleSpan_)/2+90);return this.angleSpan_*o+e},goog.ui.Gauge.prototype.drawValue_=function(){if(this.isInDocument()){var o=this.needleRadius_,e=this.graphics_,t=this.theme_,g=this.width_/2,i=this.height_/2,a=this.valuePositionToAngle_(this.needleValuePosition_),u=Math.round(o*goog.ui.Gauge.FACTOR_NEEDLE_FRONT),n=Math.round(o*goog.ui.Gauge.FACTOR_NEEDLE_BACK),r=goog.math.angleDx(a,u),l=goog.math.angleDy(a,u),s=goog.math.angleDx(a,n),h=goog.math.angleDy(a,n),_=goog.math.standardAngle(a+90),p=o*goog.ui.Gauge.FACTOR_NEEDLE_WIDTH,T=goog.math.angleDx(_,p),m=goog.math.angleDy(_,p),G=new goog.graphics.Path;G.moveTo(g+r,i+l),G.curveTo(g+T,i+m,g-s+T/2,i-h+m/2,g-s,i-h),G.curveTo(g-s-T/2,i-h-m/2,g-T,i-m,g+r,i+l);var d=Math.round(o*goog.ui.Gauge.FACTOR_NEEDLE_HINGE),c=this.needleGroup_;if(c?c.clear():c=this.needleGroup_=e.createGroup(),this.formattedValue_){var E=this.valueFont_;if(!E){var A=Math.round(o*goog.ui.Gauge.FACTOR_VALUE_FONT_SIZE);(E=new goog.graphics.Font(A,goog.ui.Gauge.TITLE_FONT_NAME)).bold=!0,this.valueFont_=E}var F=new goog.graphics.SolidFill(t.getValueColor()),O=i+Math.round(o*goog.ui.Gauge.FACTOR_VALUE_OFFSET);e.drawTextOnLine(this.formattedValue_,0,O,this.width_,O,"center",E,null,F,c)}var v=t.getNeedleStroke();F=t.getNeedleFill(g,i,d);e.drawPath(G,v,F,c),v=t.getHingeStroke(),F=t.getHingeFill(g,i,d),e.drawCircle(g,i,d,v,F,c)}},goog.ui.Gauge.prototype.redraw=function(){this.draw_()},goog.ui.Gauge.prototype.enterDocument=function(){goog.ui.Gauge.superClass_.enterDocument.call(this);var o=this.getElement();goog.asserts.assert(o,"The DOM element for the gauge cannot be null."),goog.a11y.aria.setRole(o,"progressbar"),goog.a11y.aria.setState(o,"live","polite"),goog.a11y.aria.setState(o,"valuemin",this.minValue_),goog.a11y.aria.setState(o,"valuemax",this.maxValue_),goog.a11y.aria.setState(o,"valuenow",this.value_),this.draw_()},goog.ui.Gauge.prototype.exitDocument=function(){goog.ui.Gauge.superClass_.exitDocument.call(this),this.stopAnimation_()},goog.ui.Gauge.prototype.disposeInternal=function(){this.stopAnimation_(),this.graphics_.dispose(),delete this.graphics_,delete this.needleGroup_,delete this.theme_,delete this.rangeColors_,goog.ui.Gauge.superClass_.disposeInternal.call(this)};