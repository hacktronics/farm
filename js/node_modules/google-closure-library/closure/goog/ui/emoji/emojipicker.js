goog.provide("goog.ui.emoji.EmojiPicker"),goog.require("goog.dom.TagName"),goog.require("goog.style"),goog.require("goog.ui.Component"),goog.require("goog.ui.TabPane"),goog.require("goog.ui.emoji.Emoji"),goog.require("goog.ui.emoji.EmojiPalette"),goog.require("goog.ui.emoji.EmojiPaletteRenderer"),goog.require("goog.ui.emoji.ProgressiveEmojiPaletteRenderer"),goog.ui.emoji.EmojiPicker=function(e,o){goog.ui.Component.call(this,o),this.defaultImgUrl_=e,this.emoji_=[],this.pages_=[],this.pageLoadStatus_=[],this.tabPane_=null,this.getHandler().listen(this,goog.ui.Component.EventType.ACTION,this.onEmojiPaletteAction_)},goog.inherits(goog.ui.emoji.EmojiPicker,goog.ui.Component),goog.ui.emoji.EmojiPicker.DEFAULT_NUM_ROWS=5,goog.ui.emoji.EmojiPicker.DEFAULT_NUM_COLS=10,goog.ui.emoji.EmojiPicker.DEFAULT_TAB_LOCATION=goog.ui.TabPane.TabLocation.TOP,goog.ui.emoji.EmojiPicker.prototype.selectedEmoji_,goog.ui.emoji.EmojiPicker.prototype.renderer_,goog.ui.emoji.EmojiPicker.prototype.numRows_=goog.ui.emoji.EmojiPicker.DEFAULT_NUM_ROWS,goog.ui.emoji.EmojiPicker.prototype.numCols_=goog.ui.emoji.EmojiPicker.DEFAULT_NUM_COLS,goog.ui.emoji.EmojiPicker.prototype.autoSizeByColumnCount_=!0,goog.ui.emoji.EmojiPicker.prototype.tabLocation_=goog.ui.emoji.EmojiPicker.DEFAULT_TAB_LOCATION,goog.ui.emoji.EmojiPicker.prototype.focusable_=!0,goog.ui.emoji.EmojiPicker.prototype.defaultImgUrl_,goog.ui.emoji.EmojiPicker.prototype.urlPrefix_,goog.ui.emoji.EmojiPicker.prototype.delayedLoad_=!1,goog.ui.emoji.EmojiPicker.prototype.progressiveRender_=!1,goog.ui.emoji.EmojiPicker.prototype.manualLoadOfAnimatedEmoji_=!1,goog.ui.emoji.EmojiPicker.prototype.activePage_=-1,goog.ui.emoji.EmojiPicker.prototype.addEmojiGroup=function(e,o){this.emoji_.push({title:e,emoji:o})},goog.ui.emoji.EmojiPicker.prototype.getNumRows=function(){return this.numRows_},goog.ui.emoji.EmojiPicker.prototype.getNumColumns=function(){return this.numCols_},goog.ui.emoji.EmojiPicker.prototype.setNumRows=function(e){this.numRows_=e},goog.ui.emoji.EmojiPicker.prototype.setNumColumns=function(e){this.numCols_=e},goog.ui.emoji.EmojiPicker.prototype.setAutoSizeByColumnCount=function(e){this.autoSizeByColumnCount_=e},goog.ui.emoji.EmojiPicker.prototype.setTabLocation=function(e){this.tabLocation_=e},goog.ui.emoji.EmojiPicker.prototype.setDelayedLoad=function(e){this.delayedLoad_=e},goog.ui.emoji.EmojiPicker.prototype.setManualLoadOfAnimatedEmoji=function(e){this.manualLoadOfAnimatedEmoji_=e},goog.ui.emoji.EmojiPicker.prototype.isFocusable=function(){return this.focusable_},goog.ui.emoji.EmojiPicker.prototype.setFocusable=function(e){this.focusable_=e;for(var o=0;o<this.pages_.length;o++)this.pages_[o]&&this.pages_[o].setSupportedState(goog.ui.Component.State.FOCUSED,e)},goog.ui.emoji.EmojiPicker.prototype.setUrlPrefix=function(e){this.urlPrefix_=e},goog.ui.emoji.EmojiPicker.prototype.setProgressiveRender=function(e){this.progressiveRender_=e},goog.ui.emoji.EmojiPicker.prototype.adjustNumRowsIfNecessary_=function(){for(var e=0,o=0;o<this.emoji_.length;o++){var i=this.emoji_[o].emoji.length,t=Math.ceil(i/this.numCols_);t>e&&(e=t)}this.setNumRows(e)},goog.ui.emoji.EmojiPicker.prototype.loadImages=function(){this.delayedLoad_&&(this.loadPage_(0),this.activePage_=0)},goog.ui.emoji.EmojiPicker.prototype.createDom=function(){if(this.setElementInternal(this.getDomHelper().createDom(goog.dom.TagName.DIV)),this.autoSizeByColumnCount_&&this.adjustNumRowsIfNecessary_(),0==this.emoji_.length)throw new Error("Must add some emoji to the picker");if(this.emoji_.length>1){var e=this.getDomHelper().createDom(goog.dom.TagName.DIV);this.getElement().appendChild(e),this.tabPane_=new goog.ui.TabPane(e,this.tabLocation_,this.getDomHelper(),!0)}this.renderer_=this.progressiveRender_?new goog.ui.emoji.ProgressiveEmojiPaletteRenderer(this.defaultImgUrl_):new goog.ui.emoji.EmojiPaletteRenderer(this.defaultImgUrl_);for(var o=0;o<this.emoji_.length;o++){var i=this.emoji_[o].emoji,t=this.delayedLoad_?this.createPlaceholderEmojiPage_(i):this.createEmojiPage_(i,o);this.pages_.push(t)}this.activePage_=0,this.getElement().tabIndex=0},goog.ui.emoji.EmojiPicker.prototype.manuallyLoadAnimatedEmoji=function(){for(var e=0;e<this.pages_.length;e++)this.pages_[e].loadAnimatedEmoji()},goog.ui.emoji.EmojiPicker.prototype.createEmojiPage_=function(e,o){if(this.pageLoadStatus_[o])return null;var i=new goog.ui.emoji.EmojiPalette(e,this.urlPrefix_,this.renderer_,this.getDomHelper());return this.manualLoadOfAnimatedEmoji_||i.loadAnimatedEmoji(),i.setSize(this.numCols_,this.numRows_),i.setSupportedState(goog.ui.Component.State.FOCUSED,this.focusable_),i.createDom(),i.setParent(this),this.pageLoadStatus_[o]=!0,i},goog.ui.emoji.EmojiPicker.prototype.getPlaceholderEmoji_=function(e){for(var o=[],i=0;i<e.length;i++)o.push([this.defaultImgUrl_,e[i][1]]);return o},goog.ui.emoji.EmojiPicker.prototype.createPlaceholderEmojiPage_=function(e){var o=this.getPlaceholderEmoji_(e),i=new goog.ui.emoji.EmojiPalette(o,null,this.renderer_,this.getDomHelper());return i.setSize(this.numCols_,this.numRows_),i.setSupportedState(goog.ui.Component.State.FOCUSED,this.focusable_),i.createDom(),i.setParent(this),i},goog.ui.emoji.EmojiPicker.prototype.canDecorate=function(e){return!1},goog.ui.emoji.EmojiPicker.prototype.enterDocument=function(){goog.ui.emoji.EmojiPicker.superClass_.enterDocument.call(this);for(var e=0;e<this.pages_.length;e++){this.pages_[e].enterDocument();var o=this.pages_[e].getElement();if(this.pages_.length>1){var i=this.emoji_[e].title||e+1;this.tabPane_.addPage(new goog.ui.TabPane.TabPage(o,i,this.getDomHelper()))}else this.getElement().appendChild(o)}this.tabPane_&&(this.getHandler().listen(this.tabPane_,goog.ui.TabPane.Events.CHANGE,this.onPageChanged_),goog.style.setUnselectable(this.tabPane_.getElement(),!0)),this.getElement().unselectable="on"},goog.ui.emoji.EmojiPicker.prototype.exitDocument=function(){goog.ui.emoji.EmojiPicker.superClass_.exitDocument.call(this);for(var e=0;e<this.pages_.length;e++)this.pages_[e].exitDocument()},goog.ui.emoji.EmojiPicker.prototype.disposeInternal=function(){goog.ui.emoji.EmojiPicker.superClass_.disposeInternal.call(this),this.tabPane_&&(this.tabPane_.dispose(),this.tabPane_=null);for(var e=0;e<this.pages_.length;e++)this.pages_[e].dispose();this.pages_.length=0},goog.ui.emoji.EmojiPicker.prototype.getCssClass=function(){return goog.getCssName("goog-ui-emojipicker")},goog.ui.emoji.EmojiPicker.prototype.getSelectedEmoji=function(){return this.urlPrefix_?new goog.ui.emoji.Emoji(this.urlPrefix_+this.selectedEmoji_.getId(),this.selectedEmoji_.getId()):this.selectedEmoji_},goog.ui.emoji.EmojiPicker.prototype.getNumEmojiGroups=function(){return this.emoji_.length},goog.ui.emoji.EmojiPicker.prototype.getPage=function(e){return this.pages_[e]},goog.ui.emoji.EmojiPicker.prototype.getPages=function(){return this.pages_},goog.ui.emoji.EmojiPicker.prototype.getTabPane=function(){return this.tabPane_},goog.ui.emoji.EmojiPicker.prototype.getActivePage_=function(){return this.pages_[this.activePage_]},goog.ui.emoji.EmojiPicker.prototype.onEmojiPaletteAction_=function(e){this.selectedEmoji_=this.getActivePage_().getSelectedEmoji()},goog.ui.emoji.EmojiPicker.prototype.onPageChanged_=function(e){var o=e.page.getIndex();this.loadPage_(o),this.activePage_=o},goog.ui.emoji.EmojiPicker.prototype.loadPage_=function(e){if(e<0||e>this.pages_.length)throw new Error("Index out of bounds");if(!this.pageLoadStatus_[e]){var o=this.pages_[e];this.pages_[e]=this.createEmojiPage_(this.emoji_[e].emoji,e),this.pages_[e].enterDocument();var i=this.pages_[e].getElement();if(this.pages_.length>1){this.tabPane_.removePage(e);var t=this.emoji_[e].title||e+1;this.tabPane_.addPage(new goog.ui.TabPane.TabPage(i,t,this.getDomHelper()),e),this.tabPane_.setSelectedIndex(e)}else{this.getElement().appendChild(i)}o&&o.dispose()}};