goog.provide("goog.ui.emoji.EmojiPalette"),goog.require("goog.events.EventType"),goog.require("goog.net.ImageLoader"),goog.require("goog.ui.Palette"),goog.require("goog.ui.emoji.Emoji"),goog.require("goog.ui.emoji.EmojiPaletteRenderer"),goog.ui.emoji.EmojiPalette=function(e,o,t,i){goog.ui.Palette.call(this,null,t||new goog.ui.emoji.EmojiPaletteRenderer(null),i),this.emojiCells_={},this.emojiMap_={},this.animatedEmoji_=[],this.urlPrefix_=o||"",this.emoji_=this.getEmojiArrayFromProperties_(e),this.setContent(this.emoji_)},goog.inherits(goog.ui.emoji.EmojiPalette,goog.ui.Palette),goog.ui.emoji.EmojiPalette.prototype.urlPrefix_="",goog.ui.emoji.EmojiPalette.prototype.imagesLoaded_=!1,goog.ui.emoji.EmojiPalette.prototype.imageLoader_,goog.ui.emoji.EmojiPalette.prototype.getEmojiArrayFromProperties_=function(e){for(var o=[],t=0;t<e.length;t++){var i=e[t][0],g=e[t][1],m=e[t][2],r=m?m.getUrl():this.urlPrefix_+i,a=this.getRenderer().createPaletteItem(this.getDomHelper(),g,m,r);o.push(a);var n=new goog.ui.emoji.Emoji(i,g);this.emojiCells_[g]=n,this.emojiMap_[g]=t,m&&m.isAnimated()&&this.animatedEmoji_.push([a,n])}return this.animatedEmoji_.length>0&&(this.imageLoader_=new goog.net.ImageLoader),this.imagesLoaded_=!0,o},goog.ui.emoji.EmojiPalette.prototype.loadAnimatedEmoji=function(){if(this.animatedEmoji_.length>0){for(var e=0;e<this.animatedEmoji_.length;e++){var o=this.animatedEmoji_[e][1],t=this.urlPrefix_+o.getUrl();this.imageLoader_.addImage(o.getId(),t)}this.getHandler().listen(this.imageLoader_,goog.events.EventType.LOAD,this.handleImageLoad_),this.imageLoader_.start()}},goog.ui.emoji.EmojiPalette.prototype.handleImageLoad_=function(e){var o=e.target.id,t=e.target.src;if(o&&t){var i=this.emoji_[this.emojiMap_[o]];i&&this.getRenderer().updateAnimatedPaletteItem(i,e.target)}},goog.ui.emoji.EmojiPalette.prototype.getImageLoader=function(){return this.imageLoader_},goog.ui.emoji.EmojiPalette.prototype.disposeInternal=function(){goog.ui.emoji.EmojiPalette.superClass_.disposeInternal.call(this),this.imageLoader_&&(this.imageLoader_.dispose(),this.imageLoader_=null),this.animatedEmoji_=null,this.emojiCells_=null,this.emojiMap_=null,this.emoji_=null},goog.ui.emoji.EmojiPalette.prototype.getGoomojiIdFromElement_=function(e){if(!e)return null;var o=this.getRenderer().getContainingItem(this,e);return o?""!=o.getAttribute(goog.ui.emoji.Emoji.ATTRIBUTE)?o.getAttribute(goog.ui.emoji.Emoji.ATTRIBUTE):o.getAttribute(goog.ui.emoji.Emoji.DATA_ATTRIBUTE):null},goog.ui.emoji.EmojiPalette.prototype.getSelectedEmoji=function(){var e=this.getSelectedItem(),o=this.getGoomojiIdFromElement_(e);return this.emojiCells_[o]},goog.ui.emoji.EmojiPalette.prototype.getNumberOfEmoji=function(){return this.emojiCells_.length},goog.ui.emoji.EmojiPalette.prototype.getEmojiIndex=function(e){return this.emojiMap_[e]};