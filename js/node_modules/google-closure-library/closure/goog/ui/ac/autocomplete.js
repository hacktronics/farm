goog.provide("goog.ui.ac.AutoComplete"),goog.provide("goog.ui.ac.AutoComplete.EventType"),goog.forwardDeclare("goog.ui.ac.InputHandler"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.events"),goog.require("goog.events.EventTarget"),goog.require("goog.object"),goog.require("goog.ui.ac.RenderOptions"),goog.ui.ac.AutoComplete=function(t,e,o){goog.events.EventTarget.call(this),this.matcher_=t,this.selectionHandler_=o,this.renderer_=e,goog.events.listen(e,[goog.ui.ac.AutoComplete.EventType.HILITE,goog.ui.ac.AutoComplete.EventType.SELECT,goog.ui.ac.AutoComplete.EventType.CANCEL_DISMISS,goog.ui.ac.AutoComplete.EventType.DISMISS],this.handleEvent,!1,this),this.token_=null,this.rows_=[],this.hiliteId_=-1,this.firstRowId_=0,this.target_=null,this.dismissTimer_=null,this.inputToAnchorMap_={}},goog.inherits(goog.ui.ac.AutoComplete,goog.events.EventTarget),goog.ui.ac.AutoComplete.prototype.maxMatches_=10,goog.ui.ac.AutoComplete.prototype.autoHilite_=!0,goog.ui.ac.AutoComplete.prototype.allowFreeSelect_=!1,goog.ui.ac.AutoComplete.prototype.wrap_=!1,goog.ui.ac.AutoComplete.prototype.triggerSuggestionsOnUpdate_=!1,goog.ui.ac.AutoComplete.EventType={ROW_HILITE:"rowhilite",HILITE:"hilite",SELECT:"select",DISMISS:"dismiss",CANCEL_DISMISS:"canceldismiss",UPDATE:"update",SUGGESTIONS_UPDATE:"suggestionsupdate"},goog.ui.ac.AutoComplete.Matcher,goog.ui.ac.AutoComplete.prototype.getMatcher=function(){return goog.asserts.assert(this.matcher_)},goog.ui.ac.AutoComplete.prototype.setMatcher=function(t){this.matcher_=t},goog.ui.ac.AutoComplete.prototype.getSelectionHandler=function(){return goog.asserts.assert(this.selectionHandler_)},goog.ui.ac.AutoComplete.prototype.getRenderer=function(){return this.renderer_},goog.ui.ac.AutoComplete.prototype.setRenderer=function(t){this.renderer_=t},goog.ui.ac.AutoComplete.prototype.getToken=function(){return this.token_},goog.ui.ac.AutoComplete.prototype.setTokenInternal=function(t){this.token_=t},goog.ui.ac.AutoComplete.prototype.getSuggestion=function(t){return this.rows_[t]},goog.ui.ac.AutoComplete.prototype.getAllSuggestions=function(){return goog.asserts.assert(this.rows_)},goog.ui.ac.AutoComplete.prototype.getSuggestionCount=function(){return this.rows_.length},goog.ui.ac.AutoComplete.prototype.getHighlightedId=function(){return this.hiliteId_},goog.ui.ac.AutoComplete.prototype.handleEvent=function(t){var e=this.matcher_;if(t.target==this.renderer_)switch(t.type){case goog.ui.ac.AutoComplete.EventType.HILITE:this.hiliteId(t.row);break;case goog.ui.ac.AutoComplete.EventType.SELECT:var o=!1;if("number"==typeof t.row){var i=t.row,s=this.getIndexOfId(i),r=this.rows_[s];o=!!r&&e.isRowDisabled&&e.isRowDisabled(r),r&&!o&&this.hiliteId_!=i&&this.hiliteId(i)}o||this.selectHilited();break;case goog.ui.ac.AutoComplete.EventType.CANCEL_DISMISS:this.cancelDelayedDismiss();break;case goog.ui.ac.AutoComplete.EventType.DISMISS:this.dismissOnDelay()}},goog.ui.ac.AutoComplete.prototype.setMaxMatches=function(t){this.maxMatches_=t},goog.ui.ac.AutoComplete.prototype.setAutoHilite=function(t){this.autoHilite_=t},goog.ui.ac.AutoComplete.prototype.setAllowFreeSelect=function(t){this.allowFreeSelect_=t},goog.ui.ac.AutoComplete.prototype.setWrap=function(t){this.wrap_=t},goog.ui.ac.AutoComplete.prototype.setTriggerSuggestionsOnUpdate=function(t){this.triggerSuggestionsOnUpdate_=t},goog.ui.ac.AutoComplete.prototype.setToken=function(t,e){this.token_!=t&&(this.token_=t,this.matcher_.requestMatchingRows(this.token_,this.maxMatches_,goog.bind(this.matchListener_,this),e),this.cancelDelayedDismiss())},goog.ui.ac.AutoComplete.prototype.getTarget=function(){return this.target_},goog.ui.ac.AutoComplete.prototype.setTarget=function(t){this.target_=t},goog.ui.ac.AutoComplete.prototype.isOpen=function(){return this.renderer_.isVisible()},goog.ui.ac.AutoComplete.prototype.getRowCount=function(){return this.getSuggestionCount()},goog.ui.ac.AutoComplete.prototype.hiliteNext=function(){for(var t=this.firstRowId_+this.rows_.length-1,e=this.hiliteId_,o=0;o<this.rows_.length;o++){if(e>=this.firstRowId_&&e<t)e++;else if(-1==e)e=this.firstRowId_;else{if(this.allowFreeSelect_&&e==t)return this.hiliteId(-1),!1;if(!this.wrap_||e!=t)return!1;e=this.firstRowId_}if(this.hiliteId(e))return!0}return!1},goog.ui.ac.AutoComplete.prototype.hilitePrev=function(){for(var t=this.firstRowId_+this.rows_.length-1,e=this.hiliteId_,o=0;o<this.rows_.length;o++){if(e>this.firstRowId_)e--;else{if(this.allowFreeSelect_&&e==this.firstRowId_)return this.hiliteId(-1),!1;if(!this.wrap_||-1!=e&&e!=this.firstRowId_)return!1;e=t}if(this.hiliteId(e))return!0}return!1},goog.ui.ac.AutoComplete.prototype.hiliteId=function(t){var e=this.getIndexOfId(t),o=this.rows_[e];return!(!!o&&this.matcher_.isRowDisabled&&this.matcher_.isRowDisabled(o))&&(this.hiliteId_=t,this.renderer_.hiliteId(t),-1!=e)},goog.ui.ac.AutoComplete.prototype.hiliteIndex=function(t){return this.hiliteId(this.getIdOfIndex_(t))},goog.ui.ac.AutoComplete.prototype.selectHilited=function(){var t=this.getIndexOfId(this.hiliteId_);if(-1!=t){var e=this.rows_[t],o=this.selectionHandler_.selectRow(e);return this.triggerSuggestionsOnUpdate_?(this.token_=null,this.dismissOnDelay()):this.dismiss(),o||(this.dispatchEvent({type:goog.ui.ac.AutoComplete.EventType.UPDATE,row:e,index:t}),this.triggerSuggestionsOnUpdate_&&this.selectionHandler_.update(!0)),!0}return this.dismiss(),this.dispatchEvent({type:goog.ui.ac.AutoComplete.EventType.UPDATE,row:null,index:null}),!1},goog.ui.ac.AutoComplete.prototype.hasHighlight=function(){return this.isOpen()&&-1!=this.getIndexOfId(this.hiliteId_)},goog.ui.ac.AutoComplete.prototype.dismiss=function(){this.hiliteId_=-1,this.token_=null,this.firstRowId_+=this.rows_.length,this.rows_=[],window.clearTimeout(this.dismissTimer_),this.dismissTimer_=null,this.renderer_.dismiss(),this.dispatchEvent(goog.ui.ac.AutoComplete.EventType.SUGGESTIONS_UPDATE),this.dispatchEvent(goog.ui.ac.AutoComplete.EventType.DISMISS)},goog.ui.ac.AutoComplete.prototype.dismissOnDelay=function(){this.dismissTimer_||(this.dismissTimer_=window.setTimeout(goog.bind(this.dismiss,this),100))},goog.ui.ac.AutoComplete.prototype.immediatelyCancelDelayedDismiss_=function(){return!!this.dismissTimer_&&(window.clearTimeout(this.dismissTimer_),this.dismissTimer_=null,!0)},goog.ui.ac.AutoComplete.prototype.cancelDelayedDismiss=function(){this.immediatelyCancelDelayedDismiss_()||window.setTimeout(goog.bind(this.immediatelyCancelDelayedDismiss_,this),10)},goog.ui.ac.AutoComplete.prototype.disposeInternal=function(){goog.ui.ac.AutoComplete.superClass_.disposeInternal.call(this),delete this.inputToAnchorMap_,this.renderer_.dispose(),this.selectionHandler_.dispose(),this.matcher_=null},goog.ui.ac.AutoComplete.prototype.matchListener_=function(t,e,o){this.token_==t&&this.renderRows(e,o)},goog.ui.ac.AutoComplete.prototype.renderRows=function(t,e){var o="object"==goog.typeOf(e)&&e,i=(o?o.getPreserveHilited():e)?this.getIndexOfId(this.hiliteId_):-1;this.firstRowId_+=this.rows_.length,this.rows_=t;for(var s=[],r=0;r<t.length;++r)s.push({id:this.getIdOfIndex_(r),data:t[r]});var n=null;this.target_&&(n=this.inputToAnchorMap_[goog.getUid(this.target_)]||this.target_),this.renderer_.setAnchorElement(n),this.renderer_.renderRows(s,this.token_,this.target_);var g=this.autoHilite_;o&&void 0!==o.getAutoHilite()&&(g=o.getAutoHilite()),this.hiliteId_=-1,(g||i>=0)&&0!=s.length&&this.token_&&(i>=0?this.hiliteId(this.getIdOfIndex_(i)):this.hiliteNext()),this.dispatchEvent(goog.ui.ac.AutoComplete.EventType.SUGGESTIONS_UPDATE)},goog.ui.ac.AutoComplete.prototype.getIndexOfId=function(t){var e=t-this.firstRowId_;return e<0||e>=this.rows_.length?-1:e},goog.ui.ac.AutoComplete.prototype.getIdOfIndex_=function(t){return this.firstRowId_+t},goog.ui.ac.AutoComplete.prototype.attachInputs=function(t){var e=this.selectionHandler_;e.attachInputs.apply(e,arguments)},goog.ui.ac.AutoComplete.prototype.detachInputs=function(t){var e=this.selectionHandler_;e.detachInputs.apply(e,arguments),goog.array.forEach(arguments,function(t){goog.object.remove(this.inputToAnchorMap_,goog.getUid(t))},this)},goog.ui.ac.AutoComplete.prototype.attachInputWithAnchor=function(t,e){this.inputToAnchorMap_[goog.getUid(t)]=e,this.attachInputs(t)},goog.ui.ac.AutoComplete.prototype.update=function(t){this.selectionHandler_.update(t)};