goog.provide("goog.ui.ac.Renderer"),goog.provide("goog.ui.ac.Renderer.CustomRenderer"),goog.require("goog.a11y.aria"),goog.require("goog.a11y.aria.Role"),goog.require("goog.a11y.aria.State"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dispose"),goog.require("goog.dom"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.TagName"),goog.require("goog.dom.classlist"),goog.require("goog.events"),goog.require("goog.events.EventTarget"),goog.require("goog.events.EventType"),goog.require("goog.fx.dom.FadeInAndShow"),goog.require("goog.fx.dom.FadeOutAndHide"),goog.require("goog.positioning"),goog.require("goog.positioning.Corner"),goog.require("goog.positioning.Overflow"),goog.require("goog.string"),goog.require("goog.style"),goog.require("goog.ui.IdGenerator"),goog.require("goog.ui.ac.AutoComplete"),goog.ui.ac.Renderer=function(e,t,o,i){goog.ui.ac.Renderer.base(this,"constructor"),this.parent_=e||goog.dom.getDocument().body,this.dom_=goog.dom.getDomHelper(this.parent_),this.reposition_=!e,this.element_=null,this.token_="",this.rows_=[],this.rowDivs_=[],this.hilitedRow_=-1,this.startRenderingRows_=-1,this.visible_=!1,this.className=goog.getCssName("ac-renderer"),this.rowClassName=goog.getCssName("ac-row"),this.legacyActiveClassName_=goog.getCssName("active"),this.activeClassName=goog.getCssName("ac-active"),this.highlightedClassName=goog.getCssName("ac-highlighted"),this.customRenderer_=t||null,this.useStandardHighlighting_=null==i||i,this.matchWordBoundary_=!0,this.highlightAllTokens_=!1,this.rightAlign_=!!o,this.topAlign_=!1,this.menuFadeDuration_=0,this.showScrollbarsIfTooLarge_=!1,this.animation_},goog.inherits(goog.ui.ac.Renderer,goog.events.EventTarget),goog.ui.ac.Renderer.prototype.anchorElement_,goog.ui.ac.Renderer.prototype.target_,goog.ui.ac.Renderer.prototype.widthProvider_,goog.ui.ac.Renderer.prototype.maxWidthProvider_,goog.ui.ac.Renderer.prototype.borderWidth_=0,goog.ui.ac.Renderer.prototype.wasHighlightedAtLeastOnce_,goog.ui.ac.Renderer.DELAY_BEFORE_MOUSEOVER=300,goog.ui.ac.Renderer.prototype.getElement=function(){return this.element_},goog.ui.ac.Renderer.prototype.setWidthProvider=function(e,t,o=void 0){this.widthProvider_=e,t&&(this.borderWidth_=t),o&&(this.maxWidthProvider_=o)},goog.ui.ac.Renderer.prototype.setTopAlign=function(e){this.topAlign_=e},goog.ui.ac.Renderer.prototype.getTopAlign=function(){return this.topAlign_},goog.ui.ac.Renderer.prototype.setRightAlign=function(e){this.rightAlign_=e},goog.ui.ac.Renderer.prototype.getRightAlign=function(){return this.rightAlign_},goog.ui.ac.Renderer.prototype.setShowScrollbarsIfTooLarge=function(e){this.showScrollbarsIfTooLarge_=e},goog.ui.ac.Renderer.prototype.setUseStandardHighlighting=function(e){this.useStandardHighlighting_=e},goog.ui.ac.Renderer.prototype.setMatchWordBoundary=function(e){this.matchWordBoundary_=e},goog.ui.ac.Renderer.prototype.setHighlightAllTokens=function(e){this.highlightAllTokens_=e},goog.ui.ac.Renderer.prototype.setMenuFadeDuration=function(e){this.menuFadeDuration_=e},goog.ui.ac.Renderer.prototype.setAnchorElement=function(e){this.anchorElement_=e},goog.ui.ac.Renderer.prototype.getAnchorElement=function(){return this.anchorElement_},goog.ui.ac.Renderer.prototype.renderRows=function(e,t,o){this.token_=t,this.rows_=e,this.hilitedRow_=-1,this.startRenderingRows_=goog.now(),this.target_=o,this.rowDivs_=[],this.redraw()},goog.ui.ac.Renderer.prototype.dismiss=function(){this.visible_&&(this.visible_=!1,this.toggleAriaMarkup_(!1),this.menuFadeDuration_>0?(goog.dispose(this.animation_),this.animation_=new goog.fx.dom.FadeOutAndHide(this.element_,this.menuFadeDuration_),this.animation_.play()):goog.style.setElementShown(this.element_,!1))},goog.ui.ac.Renderer.prototype.show=function(){this.visible_||(this.visible_=!0,this.toggleAriaMarkup_(!0),this.menuFadeDuration_>0?(goog.dispose(this.animation_),this.animation_=new goog.fx.dom.FadeInAndShow(this.element_,this.menuFadeDuration_),this.animation_.play()):goog.style.setElementShown(this.element_,!0))},goog.ui.ac.Renderer.prototype.toggleAriaMarkup_=function(e){this.target_&&(goog.a11y.aria.setState(this.target_,goog.a11y.aria.State.HASPOPUP,e),goog.a11y.aria.setState(goog.asserts.assert(this.element_),goog.a11y.aria.State.EXPANDED,e),goog.a11y.aria.setState(this.target_,goog.a11y.aria.State.EXPANDED,e),e?goog.a11y.aria.setState(this.target_,goog.a11y.aria.State.OWNS,this.element_.id):(goog.a11y.aria.removeState(this.target_,goog.a11y.aria.State.OWNS),goog.a11y.aria.setActiveDescendant(this.target_,null)))},goog.ui.ac.Renderer.prototype.isVisible=function(){return this.visible_},goog.ui.ac.Renderer.prototype.hiliteRow=function(e){var t=e>=0&&e<this.rows_.length?this.rows_[e]:void 0,o=e>=0&&e<this.rowDivs_.length?this.rowDivs_[e]:void 0,i={type:goog.ui.ac.AutoComplete.EventType.ROW_HILITE,rowNode:o,row:t?t.data:null};this.dispatchEvent(i)&&(this.hiliteNone(),this.hilitedRow_=e,o&&(goog.dom.classlist.addAll(o,[this.activeClassName,this.legacyActiveClassName_]),this.target_&&goog.a11y.aria.setActiveDescendant(this.target_,o),goog.style.scrollIntoContainerView(o,this.element_)))},goog.ui.ac.Renderer.prototype.hiliteNone=function(){this.hilitedRow_>=0&&goog.dom.classlist.removeAll(goog.asserts.assert(this.rowDivs_[this.hilitedRow_]),[this.activeClassName,this.legacyActiveClassName_])},goog.ui.ac.Renderer.prototype.hiliteId=function(e){if(-1==e)this.hiliteRow(-1);else for(var t=0;t<this.rows_.length;t++)if(this.rows_[t].id==e)return void this.hiliteRow(t)},goog.ui.ac.Renderer.prototype.setMenuClasses_=function(e){goog.asserts.assert(e),goog.dom.classlist.addAll(e,goog.string.trim(this.className).split(" "))},goog.ui.ac.Renderer.prototype.maybeCreateElement_=function(){if(!this.element_){var e=this.dom_.createDom(goog.dom.TagName.DIV,{style:"display:none"});this.showScrollbarsIfTooLarge_&&(e.style.overflowY="auto"),this.element_=e,this.setMenuClasses_(e),goog.a11y.aria.setRole(e,goog.a11y.aria.Role.LISTBOX),e.id=goog.ui.IdGenerator.getInstance().getNextUniqueId(),this.dom_.appendChild(this.parent_,e),goog.events.listen(e,goog.events.EventType.CLICK,this.handleClick_,!1,this),goog.events.listen(e,goog.events.EventType.MOUSEDOWN,this.handleMouseDown_,!1,this),goog.events.listen(e,goog.events.EventType.MOUSEOVER,this.handleMouseOver_,!1,this)}},goog.ui.ac.Renderer.prototype.redraw=function(){if(this.maybeCreateElement_(),this.topAlign_&&(this.element_.style.visibility="hidden"),this.widthProvider_){var e=this.widthProvider_.clientWidth-this.borderWidth_+"px";this.element_.style.minWidth=e}if(this.maxWidthProvider_){const e=this.maxWidthProvider_.clientWidth-this.borderWidth_+"px";this.element_.style.maxWidth=e}if(this.rowDivs_.length=0,this.dom_.removeChildren(this.element_),this.customRenderer_&&this.customRenderer_.render)this.customRenderer_.render(this,this.element_,this.rows_,this.token_);else{var t=null;goog.array.forEach(this.rows_,function(e){e=this.renderRowHtml(e,this.token_),this.topAlign_?this.element_.insertBefore(e,t):this.dom_.appendChild(this.element_,e),t=e},this)}0!=this.rows_.length?(this.show(),this.reposition(),goog.style.setUnselectable(this.element_,!0)):this.dismiss()},goog.ui.ac.Renderer.prototype.getAnchorCorner=function(){var e=this.rightAlign_?goog.positioning.Corner.BOTTOM_RIGHT:goog.positioning.Corner.BOTTOM_LEFT;return this.topAlign_&&(e=goog.positioning.flipCornerVertical(e)),e},goog.ui.ac.Renderer.prototype.reposition=function(){if(this.target_&&this.reposition_){var e=this.anchorElement_||this.target_,t=this.getAnchorCorner(),o=goog.positioning.Overflow.ADJUST_X_EXCEPT_OFFSCREEN;this.showScrollbarsIfTooLarge_&&(this.element_.style.height="",o|=goog.positioning.Overflow.RESIZE_HEIGHT),goog.positioning.positionAtAnchor(e,t,this.element_,goog.positioning.flipCornerVertical(t),null,null,o),this.topAlign_&&(this.element_.style.visibility="visible")}},goog.ui.ac.Renderer.prototype.setAutoPosition=function(e){this.reposition_=e},goog.ui.ac.Renderer.prototype.getAutoPosition=function(){return this.reposition_},goog.ui.ac.Renderer.prototype.getTarget=function(){return this.target_||null},goog.ui.ac.Renderer.prototype.disposeInternal=function(){this.element_&&(goog.events.unlisten(this.element_,goog.events.EventType.CLICK,this.handleClick_,!1,this),goog.events.unlisten(this.element_,goog.events.EventType.MOUSEDOWN,this.handleMouseDown_,!1,this),goog.events.unlisten(this.element_,goog.events.EventType.MOUSEOVER,this.handleMouseOver_,!1,this),this.dom_.removeNode(this.element_),this.element_=null,this.visible_=!1),goog.dispose(this.animation_),this.parent_=null,goog.ui.ac.Renderer.base(this,"disposeInternal")},goog.ui.ac.Renderer.prototype.renderRowContents_=function(e,t,o){goog.dom.setTextContent(o,e.data.toString())},goog.ui.ac.Renderer.prototype.startHiliteMatchingText_=function(e,t){this.wasHighlightedAtLeastOnce_=!1,this.hiliteMatchingText_(e,t)},goog.ui.ac.Renderer.prototype.hiliteMatchingText_=function(e,t){if(this.highlightAllTokens_||!this.wasHighlightedAtLeastOnce_)if(e.nodeType==goog.dom.NodeType.TEXT){var o=null;goog.isArray(t)&&t.length>1&&!this.highlightAllTokens_&&(o=goog.array.slice(t,1));var i=this.getTokenRegExp_(t);if(0==i.length)return;for(var r=e.nodeValue,g=this.matchWordBoundary_?new RegExp("\\b(?:"+i+")","gi"):new RegExp(i,"gi"),s=[],n=0,a=g.exec(r),h=0;a;)h++,s.push(r.substring(n,a.index)),s.push(r.substring(a.index,g.lastIndex)),n=g.lastIndex,a=g.exec(r);if(s.push(r.substring(n)),s.length>1){for(var l=this.highlightAllTokens_?h:1,d=0;d<l;d++){var u=2*d;e.nodeValue=s[u];var _=this.dom_.createElement(goog.dom.TagName.B);_.className=this.highlightedClassName,this.dom_.appendChild(_,this.dom_.createTextNode(s[u+1])),_=e.parentNode.insertBefore(_,e.nextSibling),e.parentNode.insertBefore(this.dom_.createTextNode(""),_.nextSibling),e=_.nextSibling}var c=goog.array.slice(s,2*l);e.nodeValue=c.join(""),this.wasHighlightedAtLeastOnce_=!0}else o&&this.hiliteMatchingText_(e,o)}else for(var p=e.firstChild;p;){var m=p.nextSibling;this.hiliteMatchingText_(p,t),p=m}},goog.ui.ac.Renderer.prototype.getTokenRegExp_=function(e){var t="";if(!e)return t;(goog.isArray(e)&&(e=goog.array.filter(e,function(e){return!goog.string.isEmptyOrWhitespace(goog.string.makeSafe(e))})),this.highlightAllTokens_)?goog.isArray(e)?t=goog.array.map(e,goog.string.regExpEscape).join("|"):(t=goog.string.collapseWhitespace(e),t=(t=goog.string.regExpEscape(t)).replace(/ /g,"|")):goog.isArray(e)?t=e.length>0?goog.string.regExpEscape(e[0]):"":/^\W/.test(e)||(t=goog.string.regExpEscape(e));return t},goog.ui.ac.Renderer.prototype.renderRowHtml=function(e,t){var o=this.dom_.createDom(goog.dom.TagName.DIV,{className:this.rowClassName,id:goog.ui.IdGenerator.getInstance().getNextUniqueId()});return goog.a11y.aria.setRole(o,goog.a11y.aria.Role.OPTION),this.customRenderer_&&this.customRenderer_.renderRow?this.customRenderer_.renderRow(e,t,o):this.renderRowContents_(e,t,o),t&&this.useStandardHighlighting_&&this.startHiliteMatchingText_(o,t),goog.dom.classlist.add(o,this.rowClassName),this.rowDivs_.push(o),o},goog.ui.ac.Renderer.prototype.getRowFromEventTarget_=function(e){for(;e&&e!=this.element_&&!goog.dom.classlist.contains(e,this.rowClassName);)e=e.parentNode;return e?goog.array.indexOf(this.rowDivs_,e):-1},goog.ui.ac.Renderer.prototype.handleClick_=function(e){var t=this.getRowFromEventTarget_(e.target);t>=0&&this.dispatchEvent({type:goog.ui.ac.AutoComplete.EventType.SELECT,row:this.rows_[t].id}),e.stopPropagation()},goog.ui.ac.Renderer.prototype.handleMouseDown_=function(e){e.stopPropagation(),e.preventDefault()},goog.ui.ac.Renderer.prototype.handleMouseOver_=function(e){var t=this.getRowFromEventTarget_(e.target);if(t>=0){if(goog.now()-this.startRenderingRows_<goog.ui.ac.Renderer.DELAY_BEFORE_MOUSEOVER)return;this.dispatchEvent({type:goog.ui.ac.AutoComplete.EventType.HILITE,row:this.rows_[t].id})}},goog.ui.ac.Renderer.CustomRenderer=function(){},goog.ui.ac.Renderer.CustomRenderer.prototype.render=function(e,t,o,i){},goog.ui.ac.Renderer.CustomRenderer.prototype.renderRow=function(e,t,o){};