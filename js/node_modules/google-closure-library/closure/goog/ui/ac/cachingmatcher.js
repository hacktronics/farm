goog.provide("goog.ui.ac.CachingMatcher"),goog.require("goog.array"),goog.require("goog.async.Throttle"),goog.require("goog.ui.ac.ArrayMatcher"),goog.require("goog.ui.ac.RenderOptions"),goog.ui.ac.CachingMatcher=function(t){this.rows_=[],this.rowStrings_={},this.maxCacheSize_=1e3,this.baseMatcher_=t,this.getMatchesForRows_=goog.ui.ac.ArrayMatcher.getMatchesForRows,this.baseMatcherMaxMatches_=100,this.throttledTriggerBaseMatch_=new goog.async.Throttle(this.triggerBaseMatch_,150,this),this.mostRecentToken_="",this.mostRecentMatchHandler_=null,this.mostRecentMaxMatches_=10,this.mostRecentMatches_=[]},goog.ui.ac.CachingMatcher.prototype.setThrottleTime=function(t){this.throttledTriggerBaseMatch_=new goog.async.Throttle(this.triggerBaseMatch_,t,this)},goog.ui.ac.CachingMatcher.prototype.setBaseMatcherMaxMatches=function(t){this.baseMatcherMaxMatches_=t},goog.ui.ac.CachingMatcher.prototype.setMaxCacheSize=function(t){this.maxCacheSize_=t},goog.ui.ac.CachingMatcher.prototype.setLocalMatcher=function(t){this.getMatchesForRows_=t},goog.ui.ac.CachingMatcher.prototype.requestMatchingRows=function(t,e,o){this.mostRecentMaxMatches_=e,this.mostRecentToken_=t,this.mostRecentMatchHandler_=o,this.throttledTriggerBaseMatch_.fire();var a=this.getMatchesForRows_(t,e,this.rows_);o(t,a),this.mostRecentMatches_=a},goog.ui.ac.CachingMatcher.prototype.clearCache=function(){this.rows_=[],this.rowStrings_={}},goog.ui.ac.CachingMatcher.prototype.addRows_=function(t){goog.array.forEach(t,function(t){this.rowStrings_[" "+t]||(this.rows_.push(t),this.rowStrings_[" "+t]=!0)},this)},goog.ui.ac.CachingMatcher.prototype.clearCacheIfTooLarge_=function(){this.rows_.length>this.maxCacheSize_&&this.clearCache()},goog.ui.ac.CachingMatcher.prototype.triggerBaseMatch_=function(){this.baseMatcher_.requestMatchingRows(this.mostRecentToken_,this.baseMatcherMaxMatches_,goog.bind(this.onBaseMatch_,this))},goog.ui.ac.CachingMatcher.prototype.onBaseMatch_=function(t,e){this.addRows_(e);var o={};goog.array.forEach(this.mostRecentMatches_,function(t){o[" "+t]=!0});var a=this.getMatchesForRows_(this.mostRecentToken_,this.mostRecentMaxMatches_,this.rows_);a=goog.array.filter(a,function(t){return!o[" "+t]}),a=this.mostRecentMatches_.concat(a).slice(0,this.mostRecentMaxMatches_),this.mostRecentMatches_=a;var h=new goog.ui.ac.RenderOptions;h.setPreserveHilited(!0),this.mostRecentMatchHandler_(this.mostRecentToken_,a,h),this.clearCacheIfTooLarge_()};