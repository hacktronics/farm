goog.provide("goog.ui.tree.BaseNode"),goog.provide("goog.ui.tree.BaseNode.EventType"),goog.forwardDeclare("goog.ui.tree.TreeControl"),goog.require("goog.Timer"),goog.require("goog.a11y.aria"),goog.require("goog.a11y.aria.State"),goog.require("goog.asserts"),goog.require("goog.dom.safe"),goog.require("goog.events.Event"),goog.require("goog.events.KeyCodes"),goog.require("goog.html.SafeHtml"),goog.require("goog.html.SafeStyle"),goog.require("goog.string"),goog.require("goog.string.StringBuffer"),goog.require("goog.style"),goog.require("goog.ui.Component"),goog.ui.tree.BaseNode=function(e,t,o){goog.ui.Component.call(this,o),this.config_=t||goog.ui.tree.BaseNode.defaultConfig,this.html_=goog.html.SafeHtml.htmlEscapePreservingNewlines(e),this.iconClass_,this.expandedIconClass_,this.tree,this.previousSibling_,this.nextSibling_,this.firstChild_,this.lastChild_,this.selected_=!1,this.expanded_=!1,this.toolTip_=null,this.afterLabelHtml_=goog.html.SafeHtml.EMPTY,this.isUserCollapsible_=!0,this.depth_=-1},goog.inherits(goog.ui.tree.BaseNode,goog.ui.Component),goog.ui.tree.BaseNode.EventType={BEFORE_EXPAND:"beforeexpand",EXPAND:"expand",BEFORE_COLLAPSE:"beforecollapse",COLLAPSE:"collapse"},goog.ui.tree.BaseNode.allNodes={},goog.ui.tree.BaseNode.prototype.disposeInternal=function(){goog.ui.tree.BaseNode.superClass_.disposeInternal.call(this),this.tree&&(this.tree.removeNode(this),this.tree=null),this.setElementInternal(null)},goog.ui.tree.BaseNode.prototype.initAccessibility=function(){var e=this.getElement();if(e){var t=this.getLabelElement();t&&!t.id&&(t.id=this.getId()+".label"),goog.a11y.aria.setRole(e,"treeitem"),goog.a11y.aria.setState(e,"selected",!1),goog.a11y.aria.setState(e,"level",this.getDepth()),t&&goog.a11y.aria.setState(e,"labelledby",t.id);var o=this.getIconElement();o&&goog.a11y.aria.setRole(o,"presentation");var s=this.getExpandIconElement();s&&goog.a11y.aria.setRole(s,"presentation");var i=this.getChildrenElement();if(i&&(goog.a11y.aria.setRole(i,"group"),i.hasChildNodes())){goog.a11y.aria.setState(e,goog.a11y.aria.State.EXPANDED,!1);for(var n=this.getChildCount(),g=1;g<=n;g++){var a=this.getChildAt(g-1).getElement();goog.asserts.assert(a,"The child element cannot be null"),goog.a11y.aria.setState(a,"setsize",n),goog.a11y.aria.setState(a,"posinset",g)}}}},goog.ui.tree.BaseNode.prototype.createDom=function(){var e=this.getDomHelper().safeHtmlToNode(this.toSafeHtml());this.setElementInternal(e)},goog.ui.tree.BaseNode.prototype.enterDocument=function(){goog.ui.tree.BaseNode.superClass_.enterDocument.call(this),goog.ui.tree.BaseNode.allNodes[this.getId()]=this,this.initAccessibility()},goog.ui.tree.BaseNode.prototype.exitDocument=function(){goog.ui.tree.BaseNode.superClass_.exitDocument.call(this),delete goog.ui.tree.BaseNode.allNodes[this.getId()]},goog.ui.tree.BaseNode.prototype.addChildAt=function(e,t,o){goog.asserts.assert(!e.getParent()),goog.asserts.assertInstanceof(e,goog.ui.tree.BaseNode);var s=this.getChildAt(t-1),i=this.getChildAt(t);goog.ui.tree.BaseNode.superClass_.addChildAt.call(this,e,t),e.previousSibling_=s,e.nextSibling_=i,s?s.nextSibling_=e:this.firstChild_=e,i?i.previousSibling_=e:this.lastChild_=e;var n=this.getTree();n&&e.setTreeInternal(n),e.setDepth_(this.getDepth()+1);var g=this.getElement();if(g&&(this.updateExpandIcon(),goog.a11y.aria.setState(g,goog.a11y.aria.State.EXPANDED,this.getExpanded()),this.getExpanded())){var a=this.getChildrenElement();e.getElement()||e.createDom();var r=e.getElement(),l=i&&i.getElement();a.insertBefore(r,l),this.isInDocument()&&e.enterDocument(),i||(s?s.updateExpandIcon():(goog.style.setElementShown(a,!0),this.setExpanded(this.getExpanded())))}},goog.ui.tree.BaseNode.prototype.add=function(e,t){return goog.asserts.assert(!t||t.getParent()==this,"Can only add nodes before siblings"),e.getParent()&&e.getParent().removeChild(e),this.addChildAt(e,t?this.indexOfChild(t):this.getChildCount()),e},goog.ui.tree.BaseNode.prototype.removeChild=function(e,t){var o=e,s=this.getTree(),i=s?s.getSelectedItem():null;(i==o||o.contains(i))&&(s.hasFocus()?(this.select(),goog.Timer.callOnce(this.onTimeoutSelect_,10,this)):this.select()),goog.ui.tree.BaseNode.superClass_.removeChild.call(this,o),this.lastChild_==o&&(this.lastChild_=o.previousSibling_),this.firstChild_==o&&(this.firstChild_=o.nextSibling_),o.previousSibling_&&(o.previousSibling_.nextSibling_=o.nextSibling_),o.nextSibling_&&(o.nextSibling_.previousSibling_=o.previousSibling_);var n=o.isLastSibling();if(o.tree=null,o.depth_=-1,s&&(s.removeNode(o),this.isInDocument())){var g=this.getChildrenElement();if(o.isInDocument()){var a=o.getElement();g.removeChild(a),o.exitDocument()}if(n){var r=this.getLastChild();r&&r.updateExpandIcon()}if(!this.hasChildren()){g.style.display="none",this.updateExpandIcon(),this.updateIcon_();var l=this.getElement();l&&goog.a11y.aria.removeState(l,goog.a11y.aria.State.EXPANDED)}}return o},goog.ui.tree.BaseNode.prototype.remove=goog.ui.tree.BaseNode.prototype.removeChild,goog.ui.tree.BaseNode.prototype.onTimeoutSelect_=function(){this.select()},goog.ui.tree.BaseNode.prototype.getTree=goog.abstractMethod,goog.ui.tree.BaseNode.prototype.getDepth=function(){var e=this.depth_;return e<0&&(e=this.computeDepth_(),this.setDepth_(e)),e},goog.ui.tree.BaseNode.prototype.computeDepth_=function(){var e=this.getParent();return e?e.getDepth()+1:0},goog.ui.tree.BaseNode.prototype.setDepth_=function(e){if(e!=this.depth_){this.depth_=e;var t=this.getRowElement();if(t){var o=this.getPixelIndent_()+"px";this.isRightToLeft()?t.style.paddingRight=o:t.style.paddingLeft=o}this.forEachChild(function(t){t.setDepth_(e+1)})}},goog.ui.tree.BaseNode.prototype.contains=function(e){for(var t=e;t;){if(t==this)return!0;t=t.getParent()}return!1},goog.ui.tree.BaseNode.EMPTY_CHILDREN_=[],goog.ui.tree.BaseNode.prototype.getChildAt,goog.ui.tree.BaseNode.prototype.getChildren=function(){var e=[];return this.forEachChild(function(t){e.push(t)}),e},goog.ui.tree.BaseNode.prototype.getFirstChild=function(){return this.getChildAt(0)},goog.ui.tree.BaseNode.prototype.getLastChild=function(){return this.getChildAt(this.getChildCount()-1)},goog.ui.tree.BaseNode.prototype.getPreviousSibling=function(){return this.previousSibling_},goog.ui.tree.BaseNode.prototype.getNextSibling=function(){return this.nextSibling_},goog.ui.tree.BaseNode.prototype.isLastSibling=function(){return!this.nextSibling_},goog.ui.tree.BaseNode.prototype.isSelected=function(){return this.selected_},goog.ui.tree.BaseNode.prototype.select=function(){var e=this.getTree();e&&e.setSelectedItem(this)},goog.ui.tree.BaseNode.prototype.deselect=goog.nullFunction,goog.ui.tree.BaseNode.prototype.setSelectedInternal=function(e){if(this.selected_!=e){this.selected_=e,this.updateRow();var t=this.getElement();if(t&&(goog.a11y.aria.setState(t,"selected",e),e)){var o=this.getTree().getElement();goog.asserts.assert(o,"The DOM element for the tree cannot be null"),goog.a11y.aria.setState(o,"activedescendant",this.getId())}}},goog.ui.tree.BaseNode.prototype.getExpanded=function(){return this.expanded_},goog.ui.tree.BaseNode.prototype.setExpandedInternal=function(e){this.expanded_=e},goog.ui.tree.BaseNode.prototype.setExpanded=function(e){var t,o=e!=this.expanded_;if(o&&!this.dispatchEvent(e?goog.ui.tree.BaseNode.EventType.BEFORE_EXPAND:goog.ui.tree.BaseNode.EventType.BEFORE_COLLAPSE))return;this.expanded_=e;var s=this.getTree(),i=this.getElement();if(this.hasChildren()){if(!e&&s&&this.contains(s.getSelectedItem())&&this.select(),i){if((t=this.getChildrenElement())&&(goog.style.setElementShown(t,e),goog.a11y.aria.setState(i,goog.a11y.aria.State.EXPANDED,e),e&&this.isInDocument()&&!t.hasChildNodes())){var n=[];this.forEachChild(function(e){n.push(e.toSafeHtml())}),goog.dom.safe.setInnerHtml(t,goog.html.SafeHtml.concat(n)),this.forEachChild(function(e){e.enterDocument()})}this.updateExpandIcon()}}else(t=this.getChildrenElement())&&goog.style.setElementShown(t,!1);i&&this.updateIcon_(),o&&this.dispatchEvent(e?goog.ui.tree.BaseNode.EventType.EXPAND:goog.ui.tree.BaseNode.EventType.COLLAPSE)},goog.ui.tree.BaseNode.prototype.toggle=function(){this.setExpanded(!this.getExpanded())},goog.ui.tree.BaseNode.prototype.expand=function(){this.setExpanded(!0)},goog.ui.tree.BaseNode.prototype.collapse=function(){this.setExpanded(!1)},goog.ui.tree.BaseNode.prototype.collapseChildren=function(){this.forEachChild(function(e){e.collapseAll()})},goog.ui.tree.BaseNode.prototype.collapseAll=function(){this.collapseChildren(),this.collapse()},goog.ui.tree.BaseNode.prototype.expandChildren=function(){this.forEachChild(function(e){e.expandAll()})},goog.ui.tree.BaseNode.prototype.expandAll=function(){this.expandChildren(),this.expand()},goog.ui.tree.BaseNode.prototype.reveal=function(){var e=this.getParent();e&&(e.setExpanded(!0),e.reveal())},goog.ui.tree.BaseNode.prototype.setIsUserCollapsible=function(e){this.isUserCollapsible_=e,this.isUserCollapsible_||this.expand(),this.getElement()&&this.updateExpandIcon()},goog.ui.tree.BaseNode.prototype.isUserCollapsible=function(){return this.isUserCollapsible_},goog.ui.tree.BaseNode.prototype.toSafeHtml=function(){var e=this.getTree(),t=!e.getShowLines()||e==this.getParent()&&!e.getShowRootLines()?this.config_.cssChildrenNoLines:this.config_.cssChildren,o=this.getExpanded()&&this.hasChildren(),s={class:t,style:this.getLineStyle()},i=[];o&&this.forEachChild(function(e){i.push(e.toSafeHtml())});var n=goog.html.SafeHtml.create("div",s,i);return goog.html.SafeHtml.create("div",{class:this.config_.cssItem,id:this.getId()},[this.getRowSafeHtml(),n])},goog.ui.tree.BaseNode.prototype.getPixelIndent_=function(){return Math.max(0,(this.getDepth()-1)*this.config_.indentWidth)},goog.ui.tree.BaseNode.prototype.getRowSafeHtml=function(){var e={};e["padding-"+(this.isRightToLeft()?"right":"left")]=this.getPixelIndent_()+"px";var t={class:this.getRowClassName(),style:e},o=[this.getExpandIconSafeHtml(),this.getIconSafeHtml(),this.getLabelSafeHtml()];return goog.html.SafeHtml.create("div",t,o)},goog.ui.tree.BaseNode.prototype.getRowClassName=function(){var e;return e=this.isSelected()?" "+this.config_.cssSelectedRow:"",this.config_.cssTreeRow+e},goog.ui.tree.BaseNode.prototype.getLabelSafeHtml=function(){var e=goog.html.SafeHtml.create("span",{class:this.config_.cssItemLabel,title:this.getToolTip()||null},this.getSafeHtml());return goog.html.SafeHtml.concat(e,goog.html.SafeHtml.create("span",{},this.getAfterLabelSafeHtml()))},goog.ui.tree.BaseNode.prototype.getAfterLabelHtml=function(){return goog.html.SafeHtml.unwrap(this.getAfterLabelSafeHtml())},goog.ui.tree.BaseNode.prototype.getAfterLabelSafeHtml=function(){return this.afterLabelHtml_},goog.ui.tree.BaseNode.prototype.setAfterLabelSafeHtml=function(e){this.afterLabelHtml_=e;var t=this.getAfterLabelElement();t&&goog.dom.safe.setInnerHtml(t,e)},goog.ui.tree.BaseNode.prototype.getIconSafeHtml=function(){return goog.html.SafeHtml.create("span",{style:{display:"inline-block"},class:this.getCalculatedIconClass()})},goog.ui.tree.BaseNode.prototype.getCalculatedIconClass=goog.abstractMethod,goog.ui.tree.BaseNode.prototype.getExpandIconSafeHtml=function(){return goog.html.SafeHtml.create("span",{type:"expand",style:{display:"inline-block"},class:this.getExpandIconClass()})},goog.ui.tree.BaseNode.prototype.getExpandIconClass=function(){var e=this.getTree(),t=!e.getShowLines()||e==this.getParent()&&!e.getShowRootLines(),o=this.config_,s=new goog.string.StringBuffer;if(s.append(o.cssTreeIcon," ",o.cssExpandTreeIcon," "),this.hasChildren()){var i=0;switch(e.getShowExpandIcons()&&this.isUserCollapsible_&&(i=this.getExpanded()?2:1),t||(this.isLastSibling()?i+=4:i+=8),i){case 1:s.append(o.cssExpandTreeIconPlus);break;case 2:s.append(o.cssExpandTreeIconMinus);break;case 4:s.append(o.cssExpandTreeIconL);break;case 5:s.append(o.cssExpandTreeIconLPlus);break;case 6:s.append(o.cssExpandTreeIconLMinus);break;case 8:s.append(o.cssExpandTreeIconT);break;case 9:s.append(o.cssExpandTreeIconTPlus);break;case 10:s.append(o.cssExpandTreeIconTMinus);break;default:s.append(o.cssExpandTreeIconBlank)}}else t?s.append(o.cssExpandTreeIconBlank):this.isLastSibling()?s.append(o.cssExpandTreeIconL):s.append(o.cssExpandTreeIconT);return s.toString()},goog.ui.tree.BaseNode.prototype.getLineStyle=function(){var e=this.getExpanded()&&this.hasChildren();return goog.html.SafeStyle.create({"background-position":this.getBackgroundPosition(),display:e?null:"none"})},goog.ui.tree.BaseNode.prototype.getBackgroundPosition=function(){return(this.isLastSibling()?"-100":(this.getDepth()-1)*this.config_.indentWidth)+"px 0"},goog.ui.tree.BaseNode.prototype.getElement=function(){var e=goog.ui.tree.BaseNode.superClass_.getElement.call(this);return e||(e=this.getDomHelper().getElement(this.getId()),this.setElementInternal(e)),e},goog.ui.tree.BaseNode.prototype.getRowElement=function(){var e=this.getElement();return e?e.firstChild:null},goog.ui.tree.BaseNode.prototype.getExpandIconElement=function(){var e=this.getRowElement();return e?e.firstChild:null},goog.ui.tree.BaseNode.prototype.getIconElement=function(){var e=this.getRowElement();return e?e.childNodes[1]:null},goog.ui.tree.BaseNode.prototype.getLabelElement=function(){var e=this.getRowElement();return e&&e.lastChild?e.lastChild.previousSibling:null},goog.ui.tree.BaseNode.prototype.getAfterLabelElement=function(){var e=this.getRowElement();return e?e.lastChild:null},goog.ui.tree.BaseNode.prototype.getChildrenElement=function(){var e=this.getElement();return e?e.lastChild:null},goog.ui.tree.BaseNode.prototype.setIconClass=function(e){this.iconClass_=e,this.isInDocument()&&this.updateIcon_()},goog.ui.tree.BaseNode.prototype.getIconClass=function(){return this.iconClass_},goog.ui.tree.BaseNode.prototype.setExpandedIconClass=function(e){this.expandedIconClass_=e,this.isInDocument()&&this.updateIcon_()},goog.ui.tree.BaseNode.prototype.getExpandedIconClass=function(){return this.expandedIconClass_},goog.ui.tree.BaseNode.prototype.setText=function(e){this.setSafeHtml(goog.html.SafeHtml.htmlEscape(e))},goog.ui.tree.BaseNode.prototype.getText=function(){return goog.string.unescapeEntities(goog.html.SafeHtml.unwrap(this.html_))},goog.ui.tree.BaseNode.prototype.setSafeHtml=function(e){this.html_=e;var t=this.getLabelElement();t&&goog.dom.safe.setInnerHtml(t,e);var o=this.getTree();o&&o.setNode(this)},goog.ui.tree.BaseNode.prototype.getHtml=function(){return goog.html.SafeHtml.unwrap(this.getSafeHtml())},goog.ui.tree.BaseNode.prototype.getSafeHtml=function(){return this.html_},goog.ui.tree.BaseNode.prototype.setToolTip=function(e){this.toolTip_=e;var t=this.getLabelElement();t&&(t.title=e)},goog.ui.tree.BaseNode.prototype.getToolTip=function(){return this.toolTip_},goog.ui.tree.BaseNode.prototype.updateRow=function(){var e=this.getRowElement();e&&(e.className=this.getRowClassName())},goog.ui.tree.BaseNode.prototype.updateExpandIcon=function(){var e=this.getExpandIconElement();e&&(e.className=this.getExpandIconClass());var t=this.getChildrenElement();t&&(t.style.backgroundPosition=this.getBackgroundPosition())},goog.ui.tree.BaseNode.prototype.updateIcon_=function(){this.getIconElement().className=this.getCalculatedIconClass()},goog.ui.tree.BaseNode.prototype.onMouseDown=function(e){"expand"==e.target.getAttribute("type")&&this.hasChildren()?this.isUserCollapsible_&&this.toggle():(this.select(),this.updateRow())},goog.ui.tree.BaseNode.prototype.onClick_=goog.events.Event.preventDefault,goog.ui.tree.BaseNode.prototype.onDoubleClick_=function(e){"expand"==e.target.getAttribute("type")&&this.hasChildren()||this.isUserCollapsible_&&this.toggle()},goog.ui.tree.BaseNode.prototype.onKeyDown=function(e){var t=!0;switch(e.keyCode){case goog.events.KeyCodes.RIGHT:if(e.altKey)break;this.hasChildren()&&(this.getExpanded()?this.getFirstChild().select():this.setExpanded(!0));break;case goog.events.KeyCodes.LEFT:if(e.altKey)break;if(this.hasChildren()&&this.getExpanded()&&this.isUserCollapsible_)this.setExpanded(!1);else{var o=this.getParent(),s=this.getTree();o&&(s.getShowRootNode()||o!=s)&&o.select()}break;case goog.events.KeyCodes.DOWN:var i=this.getNextShownNode();i&&i.select();break;case goog.events.KeyCodes.UP:var n=this.getPreviousShownNode();n&&n.select();break;default:t=!1}t&&(e.preventDefault(),(s=this.getTree())&&s.clearTypeAhead());return t},goog.ui.tree.BaseNode.prototype.getLastShownDescendant=function(){return this.getExpanded()&&this.hasChildren()?this.getLastChild().getLastShownDescendant():this},goog.ui.tree.BaseNode.prototype.getNextShownNode=function(){if(this.hasChildren()&&this.getExpanded())return this.getFirstChild();for(var e,t=this;t!=this.getTree();){if(null!=(e=t.getNextSibling()))return e;t=t.getParent()}return null},goog.ui.tree.BaseNode.prototype.getPreviousShownNode=function(){var e=this.getPreviousSibling();if(null!=e)return e.getLastShownDescendant();var t=this.getParent(),o=this.getTree();return o.getShowRootNode()||t!=o?this==o?null:t:null},goog.ui.tree.BaseNode.prototype.getClientData=goog.ui.tree.BaseNode.prototype.getModel,goog.ui.tree.BaseNode.prototype.setClientData=goog.ui.tree.BaseNode.prototype.setModel,goog.ui.tree.BaseNode.prototype.getConfig=function(){return this.config_},goog.ui.tree.BaseNode.prototype.setTreeInternal=function(e){this.tree!=e&&(this.tree=e,e.setNode(this),this.forEachChild(function(t){t.setTreeInternal(e)}))},goog.ui.tree.BaseNode.defaultConfig={indentWidth:19,cssRoot:goog.getCssName("goog-tree-root")+" "+goog.getCssName("goog-tree-item"),cssHideRoot:goog.getCssName("goog-tree-hide-root"),cssItem:goog.getCssName("goog-tree-item"),cssChildren:goog.getCssName("goog-tree-children"),cssChildrenNoLines:goog.getCssName("goog-tree-children-nolines"),cssTreeRow:goog.getCssName("goog-tree-row"),cssItemLabel:goog.getCssName("goog-tree-item-label"),cssTreeIcon:goog.getCssName("goog-tree-icon"),cssExpandTreeIcon:goog.getCssName("goog-tree-expand-icon"),cssExpandTreeIconPlus:goog.getCssName("goog-tree-expand-icon-plus"),cssExpandTreeIconMinus:goog.getCssName("goog-tree-expand-icon-minus"),cssExpandTreeIconTPlus:goog.getCssName("goog-tree-expand-icon-tplus"),cssExpandTreeIconTMinus:goog.getCssName("goog-tree-expand-icon-tminus"),cssExpandTreeIconLPlus:goog.getCssName("goog-tree-expand-icon-lplus"),cssExpandTreeIconLMinus:goog.getCssName("goog-tree-expand-icon-lminus"),cssExpandTreeIconT:goog.getCssName("goog-tree-expand-icon-t"),cssExpandTreeIconL:goog.getCssName("goog-tree-expand-icon-l"),cssExpandTreeIconBlank:goog.getCssName("goog-tree-expand-icon-blank"),cssExpandedFolderIcon:goog.getCssName("goog-tree-expanded-folder-icon"),cssCollapsedFolderIcon:goog.getCssName("goog-tree-collapsed-folder-icon"),cssFileIcon:goog.getCssName("goog-tree-file-icon"),cssExpandedRootIcon:goog.getCssName("goog-tree-expanded-folder-icon"),cssCollapsedRootIcon:goog.getCssName("goog-tree-collapsed-folder-icon"),cssSelectedRow:goog.getCssName("selected")};