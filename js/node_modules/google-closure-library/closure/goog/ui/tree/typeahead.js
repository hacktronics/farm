goog.provide("goog.ui.tree.TypeAhead"),goog.provide("goog.ui.tree.TypeAhead.Offset"),goog.forwardDeclare("goog.ui.tree.BaseNode"),goog.require("goog.array"),goog.require("goog.events.KeyCodes"),goog.require("goog.string"),goog.require("goog.structs.Trie"),goog.ui.tree.TypeAhead=function(){this.nodeMap_=new goog.structs.Trie,this.buffer_="",this.matchingLabels_=null,this.matchingNodes_=null,this.matchingLabelIndex_=0,this.matchingNodeIndex_=0},goog.ui.tree.TypeAhead.Offset={DOWN:1,UP:-1},goog.ui.tree.TypeAhead.prototype.handleNavigation=function(e){var t=!1;switch(e.keyCode){case goog.events.KeyCodes.DOWN:case goog.events.KeyCodes.UP:e.ctrlKey&&(this.jumpTo_(e.keyCode==goog.events.KeyCodes.DOWN?goog.ui.tree.TypeAhead.Offset.DOWN:goog.ui.tree.TypeAhead.Offset.UP),t=!0);break;case goog.events.KeyCodes.BACKSPACE:var o=this.buffer_.length-1;t=!0,o>0?(this.buffer_=this.buffer_.substring(0,o),this.jumpToLabel_(this.buffer_)):0==o?this.buffer_="":t=!1;break;case goog.events.KeyCodes.ESC:this.buffer_="",t=!0}return t},goog.ui.tree.TypeAhead.prototype.handleTypeAheadChar=function(e){var t=!1;if(!e.ctrlKey&&!e.altKey){var o=String.fromCharCode(e.charCode||e.keyCode).toLowerCase();goog.string.isUnicodeChar(o)&&(" "!=o||this.buffer_)&&(this.buffer_+=o,t=this.jumpToLabel_(this.buffer_))}return t},goog.ui.tree.TypeAhead.prototype.setNodeInMap=function(e){var t=e.getText();if(t&&!goog.string.isEmptyOrWhitespace(goog.string.makeSafe(t))){t=t.toLowerCase();var o=this.nodeMap_.get(t);if(o)o.push(e);else{var i=[e];this.nodeMap_.set(t,i)}}},goog.ui.tree.TypeAhead.prototype.removeNodeFromMap=function(e){var t=e.getText();if(t&&!goog.string.isEmptyOrWhitespace(goog.string.makeSafe(t))){t=t.toLowerCase();var o=this.nodeMap_.get(t);if(o){for(var i=e.getChildCount(),g=0;g<i;g++)this.removeNodeFromMap(e.getChildAt(g));goog.array.remove(o,e),o.length||this.nodeMap_.remove(t)}}},goog.ui.tree.TypeAhead.prototype.jumpToLabel_=function(e){var t=!1,o=this.nodeMap_.getKeys(e);if(o&&o.length){this.matchingNodeIndex_=0,this.matchingLabelIndex_=0;var i=this.nodeMap_.get(o[0]);(t=this.selectMatchingNode_(i))&&(this.matchingLabels_=o)}return t},goog.ui.tree.TypeAhead.prototype.jumpTo_=function(e){var t=!1,o=this.matchingLabels_;if(o){var i=null,g=!1;if(this.matchingNodes_){var a=this.matchingNodeIndex_+e;a>=0&&a<this.matchingNodes_.length?(this.matchingNodeIndex_=a,i=this.matchingNodes_):g=!0}if(!i){var r=this.matchingLabelIndex_+e;r>=0&&r<o.length&&(this.matchingLabelIndex_=r),o.length>this.matchingLabelIndex_&&(i=this.nodeMap_.get(o[this.matchingLabelIndex_])),i&&i.length&&g&&(this.matchingNodeIndex_=e==goog.ui.tree.TypeAhead.Offset.UP?i.length-1:0)}(t=this.selectMatchingNode_(i))&&(this.matchingLabels_=o)}return t},goog.ui.tree.TypeAhead.prototype.selectMatchingNode_=function(e){var t;return e&&(this.matchingNodeIndex_<e.length&&(t=e[this.matchingNodeIndex_],this.matchingNodes_=e),t&&(t.reveal(),t.select())),!!t},goog.ui.tree.TypeAhead.prototype.clear=function(){this.buffer_=""};