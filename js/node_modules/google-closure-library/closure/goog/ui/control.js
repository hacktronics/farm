goog.provide("goog.ui.Control"),goog.require("goog.Disposable"),goog.require("goog.array"),goog.require("goog.dom"),goog.require("goog.events.BrowserEvent"),goog.require("goog.events.Event"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventType"),goog.require("goog.events.KeyCodes"),goog.require("goog.events.KeyHandler"),goog.require("goog.string"),goog.require("goog.ui.Component"),goog.require("goog.ui.ComponentUtil"),goog.require("goog.ui.ControlContent"),goog.require("goog.ui.ControlRenderer"),goog.require("goog.ui.registry"),goog.require("goog.userAgent"),goog.ui.Control=function(t,e,o){goog.ui.Component.call(this,o),this.renderer_=e||goog.ui.registry.getDefaultRenderer(this.constructor),this.setContentInternal(void 0!==t?t:null),this.ariaLabel_=null,this.ieMouseEventSequenceSimulator_},goog.inherits(goog.ui.Control,goog.ui.Component),goog.tagUnsealableClass(goog.ui.Control),goog.ui.Control.registerDecorator=goog.ui.registry.setDecoratorByClassName,goog.ui.Control.getDecorator=goog.ui.registry.getDecorator,goog.ui.Control.prototype.renderer_,goog.ui.Control.prototype.content_=null,goog.ui.Control.prototype.state_=0,goog.ui.Control.prototype.supportedStates_=goog.ui.Component.State.DISABLED|goog.ui.Component.State.HOVER|goog.ui.Component.State.ACTIVE|goog.ui.Component.State.FOCUSED,goog.ui.Control.prototype.autoStates_=goog.ui.Component.State.ALL,goog.ui.Control.prototype.statesWithTransitionEvents_=0,goog.ui.Control.prototype.visible_=!0,goog.ui.Control.prototype.keyHandler_,goog.ui.Control.prototype.extraClassNames_=null,goog.ui.Control.prototype.handleMouseEvents_=!0,goog.ui.Control.prototype.allowTextSelection_=!1,goog.ui.Control.prototype.preferredAriaRole_=null,goog.ui.Control.prototype.isHandleMouseEvents=function(){return this.handleMouseEvents_},goog.ui.Control.prototype.setHandleMouseEvents=function(t){this.isInDocument()&&t!=this.handleMouseEvents_&&this.enableMouseEventHandling_(t),this.handleMouseEvents_=t},goog.ui.Control.prototype.getKeyEventTarget=function(){return this.renderer_.getKeyEventTarget(this)},goog.ui.Control.prototype.getKeyHandler=function(){return this.keyHandler_||(this.keyHandler_=new goog.events.KeyHandler)},goog.ui.Control.prototype.getRenderer=function(){return this.renderer_},goog.ui.Control.prototype.setRenderer=function(t){if(this.isInDocument())throw new Error(goog.ui.Component.Error.ALREADY_RENDERED);this.getElement()&&this.setElementInternal(null),this.renderer_=t},goog.ui.Control.prototype.getExtraClassNames=function(){return this.extraClassNames_},goog.ui.Control.prototype.addClassName=function(t){t&&(this.extraClassNames_?goog.array.contains(this.extraClassNames_,t)||this.extraClassNames_.push(t):this.extraClassNames_=[t],this.renderer_.enableExtraClassName(this,t,!0))},goog.ui.Control.prototype.removeClassName=function(t){t&&this.extraClassNames_&&goog.array.remove(this.extraClassNames_,t)&&(0==this.extraClassNames_.length&&(this.extraClassNames_=null),this.renderer_.enableExtraClassName(this,t,!1))},goog.ui.Control.prototype.enableClassName=function(t,e){e?this.addClassName(t):this.removeClassName(t)},goog.ui.Control.prototype.createDom=function(){var t=this.renderer_.createDom(this);this.setElementInternal(t),this.renderer_.setAriaRole(t,this.getPreferredAriaRole()),this.isAllowTextSelection()||this.renderer_.setAllowTextSelection(t,!1),this.isVisible()||this.renderer_.setVisible(t,!1)},goog.ui.Control.prototype.getPreferredAriaRole=function(){return this.preferredAriaRole_},goog.ui.Control.prototype.setPreferredAriaRole=function(t){this.preferredAriaRole_=t},goog.ui.Control.prototype.getAriaLabel=function(){return this.ariaLabel_},goog.ui.Control.prototype.setAriaLabel=function(t){this.ariaLabel_=t;var e=this.getElement();e&&this.renderer_.setAriaLabel(e,t)},goog.ui.Control.prototype.getContentElement=function(){return this.renderer_.getContentElement(this.getElement())},goog.ui.Control.prototype.canDecorate=function(t){return this.renderer_.canDecorate(t)},goog.ui.Control.prototype.decorateInternal=function(t){t=this.renderer_.decorate(this,t),this.setElementInternal(t),this.renderer_.setAriaRole(t,this.getPreferredAriaRole()),this.isAllowTextSelection()||this.renderer_.setAllowTextSelection(t,!1),this.visible_="none"!=t.style.display},goog.ui.Control.prototype.enterDocument=function(){if(goog.ui.Control.superClass_.enterDocument.call(this),this.renderer_.setAriaStates(this,this.getElementStrict()),this.renderer_.initializeDom(this),this.supportedStates_&~goog.ui.Component.State.DISABLED&&(this.isHandleMouseEvents()&&this.enableMouseEventHandling_(!0),this.isSupportedState(goog.ui.Component.State.FOCUSED))){var t=this.getKeyEventTarget();if(t){var e=this.getKeyHandler();e.attach(t),this.getHandler().listen(e,goog.events.KeyHandler.EventType.KEY,this.handleKeyEvent).listen(t,goog.events.EventType.FOCUS,this.handleFocus).listen(t,goog.events.EventType.BLUR,this.handleBlur)}}},goog.ui.Control.prototype.enableMouseEventHandling_=function(t){var e=goog.ui.ComponentUtil.getMouseEventType(this),o=this.getHandler(),n=this.getElement();t?(o.listen(n,e.MOUSEDOWN,this.handleMouseDown).listen(n,[e.MOUSEUP,e.MOUSECANCEL],this.handleMouseUp).listen(n,goog.events.EventType.MOUSEOVER,this.handleMouseOver).listen(n,goog.events.EventType.MOUSEOUT,this.handleMouseOut),this.pointerEventsEnabled()&&o.listen(n,goog.events.EventType.GOTPOINTERCAPTURE,this.preventPointerCapture_),this.handleContextMenu!=goog.nullFunction&&o.listen(n,goog.events.EventType.CONTEXTMENU,this.handleContextMenu),goog.userAgent.IE&&(goog.userAgent.isVersionOrHigher(9)||o.listen(n,goog.events.EventType.DBLCLICK,this.handleDblClick),this.ieMouseEventSequenceSimulator_||(this.ieMouseEventSequenceSimulator_=new goog.ui.Control.IeMouseEventSequenceSimulator_(this),this.registerDisposable(this.ieMouseEventSequenceSimulator_)))):(o.unlisten(n,e.MOUSEDOWN,this.handleMouseDown).unlisten(n,[e.MOUSEUP,e.MOUSECANCEL],this.handleMouseUp).unlisten(n,goog.events.EventType.MOUSEOVER,this.handleMouseOver).unlisten(n,goog.events.EventType.MOUSEOUT,this.handleMouseOut),this.pointerEventsEnabled()&&o.unlisten(n,goog.events.EventType.GOTPOINTERCAPTURE,this.preventPointerCapture_),this.handleContextMenu!=goog.nullFunction&&o.unlisten(n,goog.events.EventType.CONTEXTMENU,this.handleContextMenu),goog.userAgent.IE&&(goog.userAgent.isVersionOrHigher(9)||o.unlisten(n,goog.events.EventType.DBLCLICK,this.handleDblClick),goog.dispose(this.ieMouseEventSequenceSimulator_),this.ieMouseEventSequenceSimulator_=null))},goog.ui.Control.prototype.exitDocument=function(){goog.ui.Control.superClass_.exitDocument.call(this),this.keyHandler_&&this.keyHandler_.detach(),this.isVisible()&&this.isEnabled()&&this.renderer_.setFocusable(this,!1)},goog.ui.Control.prototype.disposeInternal=function(){goog.ui.Control.superClass_.disposeInternal.call(this),this.keyHandler_&&(this.keyHandler_.dispose(),delete this.keyHandler_),delete this.renderer_,this.content_=null,this.extraClassNames_=null,this.ieMouseEventSequenceSimulator_=null},goog.ui.Control.prototype.getContent=function(){return this.content_},goog.ui.Control.prototype.setContent=function(t){this.renderer_.setContent(this.getElement(),t),this.setContentInternal(t)},goog.ui.Control.prototype.setContentInternal=function(t){this.content_=t},goog.ui.Control.prototype.getCaption=function(){var t=this.getContent();if(!t)return"";var e="string"==typeof t?t:goog.isArray(t)?goog.array.map(t,goog.dom.getRawTextContent).join(""):goog.dom.getTextContent(t);return goog.string.collapseBreakingSpaces(e)},goog.ui.Control.prototype.setCaption=function(t){this.setContent(t)},goog.ui.Control.prototype.setRightToLeft=function(t){goog.ui.Control.superClass_.setRightToLeft.call(this,t);var e=this.getElement();e&&this.renderer_.setRightToLeft(e,t)},goog.ui.Control.prototype.isAllowTextSelection=function(){return this.allowTextSelection_},goog.ui.Control.prototype.setAllowTextSelection=function(t){this.allowTextSelection_=t;var e=this.getElement();e&&this.renderer_.setAllowTextSelection(e,t)},goog.ui.Control.prototype.isVisible=function(){return this.visible_},goog.ui.Control.prototype.setVisible=function(t,e){if(e||this.visible_!=t&&this.dispatchEvent(t?goog.ui.Component.EventType.SHOW:goog.ui.Component.EventType.HIDE)){var o=this.getElement();return o&&this.renderer_.setVisible(o,t),this.isEnabled()&&this.renderer_.setFocusable(this,t),this.visible_=t,!0}return!1},goog.ui.Control.prototype.isEnabled=function(){return!this.hasState(goog.ui.Component.State.DISABLED)},goog.ui.Control.prototype.isParentDisabled_=function(){var t=this.getParent();return!!t&&"function"==typeof t.isEnabled&&!t.isEnabled()},goog.ui.Control.prototype.setEnabled=function(t){!this.isParentDisabled_()&&this.isTransitionAllowed(goog.ui.Component.State.DISABLED,!t)&&(t||(this.setActive(!1),this.setHighlighted(!1)),this.isVisible()&&this.renderer_.setFocusable(this,t),this.setState(goog.ui.Component.State.DISABLED,!t,!0))},goog.ui.Control.prototype.isHighlighted=function(){return this.hasState(goog.ui.Component.State.HOVER)},goog.ui.Control.prototype.setHighlighted=function(t){this.isTransitionAllowed(goog.ui.Component.State.HOVER,t)&&this.setState(goog.ui.Component.State.HOVER,t)},goog.ui.Control.prototype.isActive=function(){return this.hasState(goog.ui.Component.State.ACTIVE)},goog.ui.Control.prototype.setActive=function(t){this.isTransitionAllowed(goog.ui.Component.State.ACTIVE,t)&&this.setState(goog.ui.Component.State.ACTIVE,t)},goog.ui.Control.prototype.isSelected=function(){return this.hasState(goog.ui.Component.State.SELECTED)},goog.ui.Control.prototype.setSelected=function(t){this.isTransitionAllowed(goog.ui.Component.State.SELECTED,t)&&this.setState(goog.ui.Component.State.SELECTED,t)},goog.ui.Control.prototype.isChecked=function(){return this.hasState(goog.ui.Component.State.CHECKED)},goog.ui.Control.prototype.setChecked=function(t){this.isTransitionAllowed(goog.ui.Component.State.CHECKED,t)&&this.setState(goog.ui.Component.State.CHECKED,t)},goog.ui.Control.prototype.isFocused=function(){return this.hasState(goog.ui.Component.State.FOCUSED)},goog.ui.Control.prototype.setFocused=function(t){this.isTransitionAllowed(goog.ui.Component.State.FOCUSED,t)&&this.setState(goog.ui.Component.State.FOCUSED,t)},goog.ui.Control.prototype.isOpen=function(){return this.hasState(goog.ui.Component.State.OPENED)},goog.ui.Control.prototype.setOpen=function(t){this.isTransitionAllowed(goog.ui.Component.State.OPENED,t)&&this.setState(goog.ui.Component.State.OPENED,t)},goog.ui.Control.prototype.getState=function(){return this.state_},goog.ui.Control.prototype.hasState=function(t){return!!(this.state_&t)},goog.ui.Control.prototype.setState=function(t,e,o){o||t!=goog.ui.Component.State.DISABLED?this.isSupportedState(t)&&e!=this.hasState(t)&&(this.renderer_.setState(this,t,e),this.state_=e?this.state_|t:this.state_&~t):this.setEnabled(!e)},goog.ui.Control.prototype.setStateInternal=function(t){this.state_=t},goog.ui.Control.prototype.isSupportedState=function(t){return!!(this.supportedStates_&t)},goog.ui.Control.prototype.setSupportedState=function(t,e){if(this.isInDocument()&&this.hasState(t)&&!e)throw new Error(goog.ui.Component.Error.ALREADY_RENDERED);!e&&this.hasState(t)&&this.setState(t,!1),this.supportedStates_=e?this.supportedStates_|t:this.supportedStates_&~t},goog.ui.Control.prototype.isAutoState=function(t){return!!(this.autoStates_&t)&&this.isSupportedState(t)},goog.ui.Control.prototype.setAutoStates=function(t,e){this.autoStates_=e?this.autoStates_|t:this.autoStates_&~t},goog.ui.Control.prototype.isDispatchTransitionEvents=function(t){return!!(this.statesWithTransitionEvents_&t)&&this.isSupportedState(t)},goog.ui.Control.prototype.setDispatchTransitionEvents=function(t,e){this.statesWithTransitionEvents_=e?this.statesWithTransitionEvents_|t:this.statesWithTransitionEvents_&~t},goog.ui.Control.prototype.isTransitionAllowed=function(t,e){return this.isSupportedState(t)&&this.hasState(t)!=e&&(!(this.statesWithTransitionEvents_&t)||this.dispatchEvent(goog.ui.Component.getStateTransitionEvent(t,e)))&&!this.isDisposed()},goog.ui.Control.prototype.handleMouseOver=function(t){!goog.ui.Control.isMouseEventWithinElement_(t,this.getElement())&&this.dispatchEvent(goog.ui.Component.EventType.ENTER)&&this.isEnabled()&&this.isAutoState(goog.ui.Component.State.HOVER)&&this.setHighlighted(!0)},goog.ui.Control.prototype.handleMouseOut=function(t){!goog.ui.Control.isMouseEventWithinElement_(t,this.getElement())&&this.dispatchEvent(goog.ui.Component.EventType.LEAVE)&&(this.isAutoState(goog.ui.Component.State.ACTIVE)&&this.setActive(!1),this.isAutoState(goog.ui.Component.State.HOVER)&&this.setHighlighted(!1))},goog.ui.Control.prototype.preventPointerCapture_=function(t){var e=t.target;e.releasePointerCapture&&e.releasePointerCapture(t.pointerId)},goog.ui.Control.prototype.handleContextMenu=goog.nullFunction,goog.ui.Control.isMouseEventWithinElement_=function(t,e){return!!t.relatedTarget&&goog.dom.contains(e,t.relatedTarget)},goog.ui.Control.prototype.handleMouseDown=function(t){this.isEnabled()&&(this.isAutoState(goog.ui.Component.State.HOVER)&&this.setHighlighted(!0),t.isMouseActionButton()&&(this.isAutoState(goog.ui.Component.State.ACTIVE)&&this.setActive(!0),this.renderer_&&this.renderer_.isFocusable(this)&&this.getKeyEventTarget().focus())),!this.isAllowTextSelection()&&t.isMouseActionButton()&&t.preventDefault()},goog.ui.Control.prototype.handleMouseUp=function(t){this.isEnabled()&&(this.isAutoState(goog.ui.Component.State.HOVER)&&this.setHighlighted(!0),this.isActive()&&this.performActionInternal(t)&&this.isAutoState(goog.ui.Component.State.ACTIVE)&&this.setActive(!1))},goog.ui.Control.prototype.handleDblClick=function(t){this.isEnabled()&&this.performActionInternal(t)},goog.ui.Control.prototype.performActionInternal=function(t){this.isAutoState(goog.ui.Component.State.CHECKED)&&this.setChecked(!this.isChecked()),this.isAutoState(goog.ui.Component.State.SELECTED)&&this.setSelected(!0),this.isAutoState(goog.ui.Component.State.OPENED)&&this.setOpen(!this.isOpen());var e=new goog.events.Event(goog.ui.Component.EventType.ACTION,this);return t&&(e.altKey=t.altKey,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.platformModifierKey=t.platformModifierKey),this.dispatchEvent(e)},goog.ui.Control.prototype.handleFocus=function(t){this.isAutoState(goog.ui.Component.State.FOCUSED)&&this.setFocused(!0)},goog.ui.Control.prototype.handleBlur=function(t){this.isAutoState(goog.ui.Component.State.ACTIVE)&&this.setActive(!1),this.isAutoState(goog.ui.Component.State.FOCUSED)&&this.setFocused(!1)},goog.ui.Control.prototype.handleKeyEvent=function(t){return!!(this.isVisible()&&this.isEnabled()&&this.handleKeyEventInternal(t))&&(t.preventDefault(),t.stopPropagation(),!0)},goog.ui.Control.prototype.handleKeyEventInternal=function(t){return t.keyCode==goog.events.KeyCodes.ENTER&&this.performActionInternal(t)},goog.ui.registry.setDefaultRenderer(goog.ui.Control,goog.ui.ControlRenderer),goog.ui.registry.setDecoratorByClassName(goog.ui.ControlRenderer.CSS_CLASS,function(){return new goog.ui.Control(null)}),goog.ui.Control.IeMouseEventSequenceSimulator_=function(t){goog.ui.Control.IeMouseEventSequenceSimulator_.base(this,"constructor"),this.control_=t,this.clickExpected_=!1,this.handler_=new goog.events.EventHandler(this),this.registerDisposable(this.handler_);var e=this.control_.getElementStrict(),o=goog.ui.ComponentUtil.getMouseEventType(t);this.handler_.listen(e,o.MOUSEDOWN,this.handleMouseDown_).listen(e,o.MOUSEUP,this.handleMouseUp_).listen(e,goog.events.EventType.CLICK,this.handleClick_)},goog.inherits(goog.ui.Control.IeMouseEventSequenceSimulator_,goog.Disposable),goog.ui.Control.IeMouseEventSequenceSimulator_.SYNTHETIC_EVENTS_=!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),goog.ui.Control.IeMouseEventSequenceSimulator_.prototype.handleMouseDown_=function(){this.clickExpected_=!1},goog.ui.Control.IeMouseEventSequenceSimulator_.prototype.handleMouseUp_=function(){this.clickExpected_=!0},goog.ui.Control.IeMouseEventSequenceSimulator_.makeLeftMouseEvent_=function(t,e){"use strict";if(!goog.ui.Control.IeMouseEventSequenceSimulator_.SYNTHETIC_EVENTS_)return t.button=goog.events.BrowserEvent.MouseButton.LEFT,t.type=e,t;var o=document.createEvent("MouseEvents");return o.initMouseEvent(e,t.bubbles,t.cancelable,t.view||null,t.detail,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,goog.events.BrowserEvent.MouseButton.LEFT,t.relatedTarget||null),o},goog.ui.Control.IeMouseEventSequenceSimulator_.prototype.handleClick_=function(t){if(this.clickExpected_)this.clickExpected_=!1;else{var e=t,o=e.getBrowserEvent(),n=o.button,i=o.type,s=goog.ui.Control.IeMouseEventSequenceSimulator_.makeLeftMouseEvent_(o,goog.events.EventType.MOUSEDOWN);this.control_.handleMouseDown(new goog.events.BrowserEvent(s,e.currentTarget));var r=goog.ui.Control.IeMouseEventSequenceSimulator_.makeLeftMouseEvent_(o,goog.events.EventType.MOUSEUP);this.control_.handleMouseUp(new goog.events.BrowserEvent(r,e.currentTarget)),goog.ui.Control.IeMouseEventSequenceSimulator_.SYNTHETIC_EVENTS_||(o.button=n,o.type=i)}},goog.ui.Control.IeMouseEventSequenceSimulator_.prototype.disposeInternal=function(){this.control_=null,goog.ui.Control.IeMouseEventSequenceSimulator_.base(this,"disposeInternal")};