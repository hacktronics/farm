goog.provide("goog.ui.DatePicker"),goog.provide("goog.ui.DatePicker.Events"),goog.provide("goog.ui.DatePickerEvent"),goog.require("goog.a11y.aria"),goog.require("goog.asserts"),goog.require("goog.date.Date"),goog.require("goog.date.DateRange"),goog.require("goog.date.Interval"),goog.require("goog.dom"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.TagName"),goog.require("goog.dom.classlist"),goog.require("goog.events.Event"),goog.require("goog.events.EventType"),goog.require("goog.events.KeyHandler"),goog.require("goog.i18n.DateTimeFormat"),goog.require("goog.i18n.DateTimePatterns"),goog.require("goog.i18n.DateTimeSymbols"),goog.require("goog.style"),goog.require("goog.ui.Component"),goog.require("goog.ui.DefaultDatePickerRenderer"),goog.require("goog.ui.IdGenerator"),goog.ui.DatePicker=function(e,t,o,a){goog.ui.Component.call(this,o),this.symbols_=t||goog.i18n.DateTimeSymbols,this.wdayNames_=this.symbols_.STANDALONESHORTWEEKDAYS,this.i18nDateFormatterDay_=new goog.i18n.DateTimeFormat("d",this.symbols_),this.i18nDateFormatterDay2_=new goog.i18n.DateTimeFormat("dd",this.symbols_),this.i18nDateFormatterWeek_=new goog.i18n.DateTimeFormat("w",this.symbols_),this.i18nDateFormatterDayAriaLabel_=new goog.i18n.DateTimeFormat("d MMM",this.symbols_);var s=goog.i18n.DateTimePatterns.YEAR_FULL||"y";this.i18nDateFormatterYear_=new goog.i18n.DateTimeFormat(s,this.symbols_);var i=goog.i18n.DateTimePatterns.YEAR_MONTH_FULL||"MMMM y";this.i18nDateFormatterMonthYear_=new goog.i18n.DateTimeFormat(i,this.symbols_),this.renderer_=a||new goog.ui.DefaultDatePickerRenderer(this.getBaseCssClass(),this.getDomHelper()),this.date_=new goog.date.Date(e),this.date_.setFirstWeekCutOffDay(this.symbols_.FIRSTWEEKCUTOFFDAY),this.date_.setFirstDayOfWeek(this.symbols_.FIRSTDAYOFWEEK),this.activeMonth_=this.date_.clone(),this.activeMonth_.setDate(1),this.wdayStyles_=["","","","","","",""],this.wdayStyles_[this.symbols_.WEEKENDRANGE[0]]=goog.getCssName(this.getBaseCssClass(),"wkend-start"),this.wdayStyles_[this.symbols_.WEEKENDRANGE[1]]=goog.getCssName(this.getBaseCssClass(),"wkend-end"),this.keyHandlers_={},this.grid_=[],this.elTable_,this.tableBody_,this.tableFoot_,this.elYear_,this.elMonth_,this.elToday_,this.elNone_,this.menu_,this.menuSelected_,this.selectedCell_,this.menuCallback_,this.lastNumberOfRowsInGrid_=0},goog.inherits(goog.ui.DatePicker,goog.ui.Component),goog.tagUnsealableClass(goog.ui.DatePicker),goog.ui.DatePicker.prototype.showFixedNumWeeks_=!0,goog.ui.DatePicker.prototype.showOtherMonths_=!0,goog.ui.DatePicker.prototype.userSelectableDateRange_=goog.date.DateRange.allTime(),goog.ui.DatePicker.prototype.extraWeekAtEnd_=!0,goog.ui.DatePicker.prototype.showWeekNum_=!0,goog.ui.DatePicker.prototype.showWeekdays_=!0,goog.ui.DatePicker.prototype.allowNone_=!0,goog.ui.DatePicker.prototype.showToday_=!0,goog.ui.DatePicker.prototype.simpleNavigation_=!1,goog.ui.DatePicker.prototype.decoratorFunction_=null,goog.ui.DatePicker.prototype.longDateFormat_=!1,goog.ui.DatePicker.prototype.elNavRow_=null,goog.ui.DatePicker.prototype.elMonthYear_=null,goog.ui.DatePicker.prototype.elFootRow_=null,goog.ui.DatePicker.prototype.cellIdGenerator_=goog.ui.IdGenerator.getInstance(),goog.ui.DatePicker.BASE_CSS_CLASS_=goog.getCssName("goog-date-picker"),goog.ui.DatePicker.YEAR_MENU_RANGE_=5,goog.ui.DatePicker.MAX_NUM_WEEKS_=6,goog.ui.DatePicker.Events={CHANGE:"change",CHANGE_ACTIVE_MONTH:"changeActiveMonth",GRID_SIZE_INCREASE:"gridSizeIncrease",SELECT:"select"},goog.ui.DatePicker.prototype.isCreated=goog.ui.DatePicker.prototype.isInDocument,goog.ui.DatePicker.prototype.getFirstWeekday=function(){return this.activeMonth_.getFirstDayOfWeek()},goog.ui.DatePicker.prototype.getWeekdayClass=function(e){return this.wdayStyles_[e]},goog.ui.DatePicker.prototype.getShowFixedNumWeeks=function(){return this.showFixedNumWeeks_},goog.ui.DatePicker.prototype.getShowOtherMonths=function(){return this.showOtherMonths_},goog.ui.DatePicker.prototype.getExtraWeekAtEnd=function(){return this.extraWeekAtEnd_},goog.ui.DatePicker.prototype.getShowWeekNum=function(){return this.showWeekNum_},goog.ui.DatePicker.prototype.getShowWeekdayNames=function(){return this.showWeekdays_},goog.ui.DatePicker.prototype.getAllowNone=function(){return this.allowNone_},goog.ui.DatePicker.prototype.getShowToday=function(){return this.showToday_},goog.ui.DatePicker.prototype.getBaseCssClass=function(){return goog.ui.DatePicker.BASE_CSS_CLASS_},goog.ui.DatePicker.prototype.setFirstWeekday=function(e){this.activeMonth_.setFirstDayOfWeek(e),this.updateCalendarGrid_(),this.redrawWeekdays_()},goog.ui.DatePicker.prototype.setWeekdayClass=function(e,t){this.wdayStyles_[e]=t,this.redrawCalendarGrid_()},goog.ui.DatePicker.prototype.setShowFixedNumWeeks=function(e){this.showFixedNumWeeks_=e,this.updateCalendarGrid_()},goog.ui.DatePicker.prototype.setShowOtherMonths=function(e){this.showOtherMonths_=e,this.redrawCalendarGrid_()},goog.ui.DatePicker.prototype.setUserSelectableDateRange=function(e){this.userSelectableDateRange_=e},goog.ui.DatePicker.prototype.getUserSelectableDateRange=function(){return this.userSelectableDateRange_},goog.ui.DatePicker.prototype.isUserSelectableDate_=function(e){return this.userSelectableDateRange_.contains(e)},goog.ui.DatePicker.prototype.setUseSimpleNavigationMenu=function(e){this.simpleNavigation_=e,this.updateNavigationRow_(),this.updateCalendarGrid_()},goog.ui.DatePicker.prototype.setExtraWeekAtEnd=function(e){this.extraWeekAtEnd_=e,this.updateCalendarGrid_()},goog.ui.DatePicker.prototype.setShowWeekNum=function(e){this.showWeekNum_=e,this.updateNavigationRow_(),this.updateFooterRow_(),this.updateCalendarGrid_()},goog.ui.DatePicker.prototype.setShowWeekdayNames=function(e){this.showWeekdays_=e,this.redrawWeekdays_(),this.redrawCalendarGrid_()},goog.ui.DatePicker.prototype.setUseNarrowWeekdayNames=function(e){this.wdayNames_=e?this.symbols_.STANDALONENARROWWEEKDAYS:this.symbols_.STANDALONESHORTWEEKDAYS,this.redrawWeekdays_()},goog.ui.DatePicker.prototype.setAllowNone=function(e){this.allowNone_=e,this.elNone_&&this.updateTodayAndNone_()},goog.ui.DatePicker.prototype.setShowToday=function(e){this.showToday_=e,this.elToday_&&this.updateTodayAndNone_()},goog.ui.DatePicker.prototype.updateTodayAndNone_=function(){goog.style.setElementShown(this.elToday_,this.showToday_),goog.style.setElementShown(this.elNone_,this.allowNone_),goog.style.setElementShown(this.tableFoot_,this.showToday_||this.allowNone_)},goog.ui.DatePicker.prototype.setDecorator=function(e){this.decoratorFunction_=e},goog.ui.DatePicker.prototype.setLongDateFormat=function(e){this.longDateFormat_=e,this.redrawCalendarGrid_()},goog.ui.DatePicker.prototype.previousMonth=function(){this.activeMonth_.add(new goog.date.Interval(goog.date.Interval.MONTHS,-1)),this.updateCalendarGrid_(),this.fireChangeActiveMonthEvent_()},goog.ui.DatePicker.prototype.nextMonth=function(){this.activeMonth_.add(new goog.date.Interval(goog.date.Interval.MONTHS,1)),this.updateCalendarGrid_(),this.fireChangeActiveMonthEvent_()},goog.ui.DatePicker.prototype.previousYear=function(){this.activeMonth_.add(new goog.date.Interval(goog.date.Interval.YEARS,-1)),this.updateCalendarGrid_(),this.fireChangeActiveMonthEvent_()},goog.ui.DatePicker.prototype.nextYear=function(){this.activeMonth_.add(new goog.date.Interval(goog.date.Interval.YEARS,1)),this.updateCalendarGrid_(),this.fireChangeActiveMonthEvent_()},goog.ui.DatePicker.prototype.selectToday=function(){this.setDate(new goog.date.Date)},goog.ui.DatePicker.prototype.selectNone=function(){this.allowNone_&&this.setDate(null)},goog.ui.DatePicker.prototype.getActiveMonth=function(){return this.activeMonth_.clone()},goog.ui.DatePicker.prototype.getDate=function(){return this.date_&&this.date_.clone()},goog.ui.DatePicker.prototype.getDateAt=function(e,t){return this.grid_[e]&&this.grid_[e][t]?this.grid_[e][t].clone():null},goog.ui.DatePicker.prototype.getDateElementAt=function(e,t){if(e<0||t<0)return null;var o=e+1;return this.elTable_[o]&&this.elTable_[o][t+1]||null},goog.ui.DatePicker.prototype.setDate=function(e){this.setDate_(e,!0)},goog.ui.DatePicker.prototype.setDate_=function(e,t){var o=e==this.date_||e&&this.date_&&e.getFullYear()==this.date_.getFullYear()&&e.getMonth()==this.date_.getMonth(),a=e==this.date_||o&&e.getDate()==this.date_.getDate();if(this.date_=e&&new goog.date.Date(e),e&&(this.activeMonth_.set(this.date_),this.activeMonth_.setFullYear(this.date_.getFullYear()),this.activeMonth_.setDate(1)),this.updateCalendarGrid_(),t){var s=new goog.ui.DatePickerEvent(goog.ui.DatePicker.Events.SELECT,this,this.date_);this.dispatchEvent(s)}if(!a){var i=new goog.ui.DatePickerEvent(goog.ui.DatePicker.Events.CHANGE,this,this.date_);this.dispatchEvent(i)}o||this.fireChangeActiveMonthEvent_()},goog.ui.DatePicker.prototype.updateNavigationRow_=function(){if(this.elNavRow_){for(var e=this.elNavRow_;e.firstChild;)e.removeChild(e.firstChild);var t=this.symbols_.DATEFORMATS[goog.i18n.DateTimeFormat.Format.FULL_DATE].toLowerCase();if(this.renderer_.renderNavigationRow(e,this.simpleNavigation_,this.showWeekNum_,t),this.simpleNavigation_){this.addPreventDefaultClickHandler_(e,goog.getCssName(this.getBaseCssClass(),"previousMonth"),this.previousMonth);var o=goog.dom.getElementByClass(goog.getCssName(this.getBaseCssClass(),"previousMonth"),e);o&&(goog.a11y.aria.setState(o,goog.a11y.aria.State.HIDDEN,!0),o.tabIndex=-1),this.addPreventDefaultClickHandler_(e,goog.getCssName(this.getBaseCssClass(),"nextMonth"),this.nextMonth);var a=goog.dom.getElementByClass(goog.getCssName(this.getBaseCssClass(),"nextMonth"),e);a&&(goog.a11y.aria.setState(a,goog.a11y.aria.State.HIDDEN,!0),a.tabIndex=-1),this.elMonthYear_=goog.dom.getElementByClass(goog.getCssName(this.getBaseCssClass(),"monthyear"),e)}else this.addPreventDefaultClickHandler_(e,goog.getCssName(this.getBaseCssClass(),"previousMonth"),this.previousMonth),this.addPreventDefaultClickHandler_(e,goog.getCssName(this.getBaseCssClass(),"nextMonth"),this.nextMonth),this.addPreventDefaultClickHandler_(e,goog.getCssName(this.getBaseCssClass(),"month"),this.showMonthMenu_),this.addPreventDefaultClickHandler_(e,goog.getCssName(this.getBaseCssClass(),"previousYear"),this.previousYear),this.addPreventDefaultClickHandler_(e,goog.getCssName(this.getBaseCssClass(),"nextYear"),this.nextYear),this.addPreventDefaultClickHandler_(e,goog.getCssName(this.getBaseCssClass(),"year"),this.showYearMenu_),this.elMonth_=goog.dom.getElementByClass(goog.getCssName(this.getBaseCssClass(),"month"),e),this.elYear_=goog.dom.getDomHelper().getElementByClass(goog.getCssName(this.getBaseCssClass(),"year"),e)}},goog.ui.DatePicker.prototype.addPreventDefaultClickHandler_=function(e,t,o){var a=goog.dom.getElementByClass(t,e);this.getHandler().listen(a,goog.events.EventType.CLICK,function(e){e.preventDefault(),o.call(this,e)})},goog.ui.DatePicker.prototype.updateFooterRow_=function(){if(this.elFootRow_){var e=this.elFootRow_;goog.dom.removeChildren(e),this.renderer_.renderFooterRow(e,this.showWeekNum_),this.addPreventDefaultClickHandler_(e,goog.getCssName(this.getBaseCssClass(),"today-btn"),this.selectToday),this.addPreventDefaultClickHandler_(e,goog.getCssName(this.getBaseCssClass(),"none-btn"),this.selectNone),this.elToday_=goog.dom.getElementByClass(goog.getCssName(this.getBaseCssClass(),"today-btn"),e),this.elNone_=goog.dom.getElementByClass(goog.getCssName(this.getBaseCssClass(),"none-btn"),e),this.updateTodayAndNone_()}},goog.ui.DatePicker.prototype.decorateInternal=function(e){goog.ui.DatePicker.superClass_.decorateInternal.call(this,e),goog.asserts.assert(e),goog.dom.classlist.add(e,this.getBaseCssClass());var t=this.dom_.createDom(goog.dom.TagName.TABLE,{role:"presentation"}),o=this.dom_.createDom(goog.dom.TagName.THEAD),a=this.dom_.createDom(goog.dom.TagName.TBODY,{role:"grid"}),s=this.dom_.createDom(goog.dom.TagName.TFOOT);a.tabIndex=0,this.tableBody_=a,this.tableFoot_=s;var i,r=this.dom_.createDom(goog.dom.TagName.TR,{role:"row"});r.className=goog.getCssName(this.getBaseCssClass(),"head"),this.elNavRow_=r,this.updateNavigationRow_(),o.appendChild(r),this.elTable_=[];for(var g=0;g<7;g++){r=this.dom_.createElement(goog.dom.TagName.TR),this.elTable_[g]=[];for(var n=0;n<8;n++)i=this.dom_.createElement(0==n||0==g?"th":"td"),0!=n&&0!=g||n==g?0!==g&&0!==n&&(goog.a11y.aria.setRole(i,"gridcell"),i.setAttribute("tabindex","-1")):(i.className=0==n?goog.getCssName(this.getBaseCssClass(),"week"):goog.getCssName(this.getBaseCssClass(),"wday"),goog.a11y.aria.setRole(i,0==n?"rowheader":"columnheader")),r.appendChild(i),this.elTable_[g][n]=i;a.appendChild(r)}(r=this.dom_.createElement(goog.dom.TagName.TR)).className=goog.getCssName(this.getBaseCssClass(),"foot"),this.elFootRow_=r,this.updateFooterRow_(),s.appendChild(r),t.cellSpacing="0",t.cellPadding="0",t.appendChild(o),t.appendChild(a),t.appendChild(s),e.appendChild(t),this.redrawWeekdays_(),this.updateCalendarGrid_(),e.tabIndex=0},goog.ui.DatePicker.prototype.createDom=function(){goog.ui.DatePicker.superClass_.createDom.call(this),this.decorateInternal(this.getElement())},goog.ui.DatePicker.prototype.enterDocument=function(){goog.ui.DatePicker.superClass_.enterDocument.call(this);var e=this.getHandler();e.listen(this.tableBody_,goog.events.EventType.CLICK,this.handleGridClick_),e.listen(this.getKeyHandlerForElement_(this.getElement()),goog.events.KeyHandler.EventType.KEY,this.handleGridKeyPress_)},goog.ui.DatePicker.prototype.exitDocument=function(){for(var e in goog.ui.DatePicker.superClass_.exitDocument.call(this),this.destroyMenu_(),this.keyHandlers_)this.keyHandlers_[e].dispose();this.keyHandlers_={}},goog.ui.DatePicker.prototype.create=goog.ui.DatePicker.prototype.decorate,goog.ui.DatePicker.prototype.disposeInternal=function(){goog.ui.DatePicker.superClass_.disposeInternal.call(this),this.elTable_=null,this.tableBody_=null,this.tableFoot_=null,this.elNavRow_=null,this.elFootRow_=null,this.elMonth_=null,this.elMonthYear_=null,this.elYear_=null,this.elToday_=null,this.elNone_=null},goog.ui.DatePicker.prototype.handleGridClick_=function(e){if(e.target.tagName==goog.dom.TagName.TD){var t,o=-2,a=-2;for(t=e.target;t;t=t.previousSibling,o++);for(t=e.target.parentNode;t;t=t.previousSibling,a++);var s=this.grid_[a][o];this.isUserSelectableDate_(s)&&this.setDate(s.clone())}},goog.ui.DatePicker.prototype.handleGridKeyPress_=function(e){var t,o,a;switch(e.keyCode){case 33:e.preventDefault(),t=-1;break;case 34:e.preventDefault(),t=1;break;case 37:e.preventDefault(),o=-1;break;case 39:e.preventDefault(),o=1;break;case 38:e.preventDefault(),o=-7;break;case 40:e.preventDefault(),o=7;break;case 36:e.preventDefault(),this.selectToday();break;case 46:e.preventDefault(),this.selectNone();break;case 13:case 32:e.preventDefault(),this.setDate_(this.date_,!0);default:return}this.date_?(a=this.date_.clone()).add(new goog.date.Interval(0,t,o)):(a=this.activeMonth_.clone()).setDate(1),this.isUserSelectableDate_(a)&&(this.setDate_(a,!1),this.selectedCell_.focus())},goog.ui.DatePicker.prototype.showMonthMenu_=function(e){e.stopPropagation();for(var t=[],o=0;o<12;o++)t.push(this.symbols_.STANDALONEMONTHS[o]);this.createMenu_(this.elMonth_,t,this.handleMonthMenuClick_,this.symbols_.STANDALONEMONTHS[this.activeMonth_.getMonth()])},goog.ui.DatePicker.prototype.showYearMenu_=function(e){e.stopPropagation();for(var t=[],o=this.activeMonth_.getFullYear(),a=this.activeMonth_.clone(),s=-goog.ui.DatePicker.YEAR_MENU_RANGE_;s<=goog.ui.DatePicker.YEAR_MENU_RANGE_;s++)a.setFullYear(o+s),t.push(this.i18nDateFormatterYear_.format(a));this.createMenu_(this.elYear_,t,this.handleYearMenuClick_,this.i18nDateFormatterYear_.format(this.activeMonth_))},goog.ui.DatePicker.prototype.handleMonthMenuClick_=function(e){var t=Number(e.getAttribute("itemIndex"));this.activeMonth_.setMonth(t),this.updateCalendarGrid_(),this.elMonth_.focus&&this.elMonth_.focus()},goog.ui.DatePicker.prototype.handleYearMenuClick_=function(e){if(e.firstChild.nodeType==goog.dom.NodeType.TEXT){var t=Number(e.getAttribute("itemIndex")),o=this.activeMonth_.getFullYear();this.activeMonth_.setFullYear(o+t-goog.ui.DatePicker.YEAR_MENU_RANGE_),this.updateCalendarGrid_()}this.elYear_.focus()},goog.ui.DatePicker.prototype.createMenu_=function(e,t,o,a){this.destroyMenu_();var s=this.dom_.createElement(goog.dom.TagName.DIV);s.className=goog.getCssName(this.getBaseCssClass(),"menu"),this.menuSelected_=null;for(var i=this.dom_.createElement(goog.dom.TagName.UL),r=0;r<t.length;r++){var g=this.dom_.createDom(goog.dom.TagName.LI,null,t[r]);g.setAttribute("itemIndex",r),t[r]==a&&(this.menuSelected_=g),i.appendChild(g)}s.appendChild(i),s.style.left=e.offsetLeft+e.parentNode.offsetLeft+"px",s.style.top=e.offsetTop+"px",s.style.width=e.clientWidth+"px",this.elMonth_.parentNode.appendChild(s),this.menu_=s,this.menuSelected_||(this.menuSelected_=i.firstChild),this.menuSelected_.className=goog.getCssName(this.getBaseCssClass(),"menu-selected"),this.menuCallback_=o;var n=this.getHandler();n.listen(this.menu_,goog.events.EventType.CLICK,this.handleMenuClick_),n.listen(this.getKeyHandlerForElement_(this.menu_),goog.events.KeyHandler.EventType.KEY,this.handleMenuKeyPress_),n.listen(this.dom_.getDocument(),goog.events.EventType.CLICK,this.destroyMenu_),s.tabIndex=0,s.focus()},goog.ui.DatePicker.prototype.handleMenuClick_=function(e){e.stopPropagation(),this.destroyMenu_(),this.menuCallback_&&this.menuCallback_(e.target)},goog.ui.DatePicker.prototype.handleMenuKeyPress_=function(e){var t;e.stopPropagation();var o=this.menuSelected_;switch(e.keyCode){case 35:e.preventDefault(),t=o.parentNode.lastChild;break;case 36:e.preventDefault(),t=o.parentNode.firstChild;break;case 38:e.preventDefault(),t=o.previousSibling;break;case 40:e.preventDefault(),t=o.nextSibling;break;case 13:case 9:case 0:e.preventDefault(),this.destroyMenu_(),this.menuCallback_(o)}t&&t!=o&&(o.className="",t.className=goog.getCssName(this.getBaseCssClass(),"menu-selected"),this.menuSelected_=t)},goog.ui.DatePicker.prototype.destroyMenu_=function(){if(this.menu_){var e=this.getHandler();e.unlisten(this.menu_,goog.events.EventType.CLICK,this.handleMenuClick_),e.unlisten(this.getKeyHandlerForElement_(this.menu_),goog.events.KeyHandler.EventType.KEY,this.handleMenuKeyPress_),e.unlisten(this.dom_.getDocument(),goog.events.EventType.CLICK,this.destroyMenu_),goog.dom.removeNode(this.menu_),delete this.menu_}},goog.ui.DatePicker.prototype.updateCalendarGrid_=function(){if(this.getElement()){var e=this.activeMonth_.clone();e.setDate(1),this.elMonthYear_&&goog.dom.setTextContent(this.elMonthYear_,this.i18nDateFormatterMonthYear_.format(e)),this.elMonth_&&goog.dom.setTextContent(this.elMonth_,this.symbols_.STANDALONEMONTHS[e.getMonth()]),this.elYear_&&goog.dom.setTextContent(this.elYear_,this.i18nDateFormatterYear_.format(e));var t=e.getWeekday(),o=e.getNumberOfDaysInMonth();e.add(new goog.date.Interval(goog.date.Interval.MONTHS,-1)),e.setDate(e.getNumberOfDaysInMonth()-(t-1)),this.showFixedNumWeeks_&&!this.extraWeekAtEnd_&&o+t<33&&e.add(new goog.date.Interval(goog.date.Interval.DAYS,-7));var a=new goog.date.Interval(goog.date.Interval.DAYS,1);this.grid_=[];for(var s=0;s<6;s++){this.grid_[s]=[];for(var i=0;i<7;i++){this.grid_[s][i]=e.clone();var r=e.getFullYear();e.add(a),0==e.getMonth()&&1==e.getDate()&&r++,e.setFullYear(r)}}this.redrawCalendarGrid_()}},goog.ui.DatePicker.prototype.redrawCalendarGrid_=function(){if(this.getElement()){for(var e=this.activeMonth_.getMonth(),t=new goog.date.Date,o=t.getFullYear(),a=t.getMonth(),s=t.getDate(),i=goog.ui.DatePicker.MAX_NUM_WEEKS_,r=0;r<goog.ui.DatePicker.MAX_NUM_WEEKS_;r++){this.showWeekNum_?(goog.dom.setTextContent(this.elTable_[r+1][0],this.i18nDateFormatterWeek_.format(this.grid_[r][0])),goog.dom.classlist.set(this.elTable_[r+1][0],goog.getCssName(this.getBaseCssClass(),"week"))):(goog.dom.setTextContent(this.elTable_[r+1][0],""),goog.dom.classlist.set(this.elTable_[r+1][0],""));for(var g=0;g<7;g++){var n=this.grid_[r][g],h=this.elTable_[r+1][g+1];h.id||(h.id=this.cellIdGenerator_.getNextUniqueId()),goog.asserts.assert(h,"The table DOM element cannot be null."),goog.a11y.aria.setRole(h,"gridcell"),goog.a11y.aria.setLabel(h,this.i18nDateFormatterDayAriaLabel_.format(n));var l=[goog.getCssName(this.getBaseCssClass(),"date")];if(this.isUserSelectableDate_(n)||l.push(goog.getCssName(this.getBaseCssClass(),"unavailable-date")),this.showOtherMonths_||n.getMonth()==e){n.getMonth()!=e&&l.push(goog.getCssName(this.getBaseCssClass(),"other-month"));var d=(g+this.activeMonth_.getFirstDayOfWeek()+7)%7;if(this.wdayStyles_[d]&&l.push(this.wdayStyles_[d]),n.getDate()==s&&n.getMonth()==a&&n.getFullYear()==o&&l.push(goog.getCssName(this.getBaseCssClass(),"today")),this.date_&&n.getDate()==this.date_.getDate()&&n.getMonth()==this.date_.getMonth()&&n.getFullYear()==this.date_.getFullYear()&&(l.push(goog.getCssName(this.getBaseCssClass(),"selected")),goog.asserts.assert(this.tableBody_,"The table body DOM element cannot be null"),this.selectedCell_=h),this.decoratorFunction_){var u=this.decoratorFunction_(n);u&&l.push(u)}var _=this.longDateFormat_?this.i18nDateFormatterDay2_.format(n):this.i18nDateFormatterDay_.format(n);goog.dom.setTextContent(h,_)}else goog.dom.setTextContent(h,"");goog.dom.classlist.set(h,l.join(" "))}if(r>=4){var c=this.elTable_[r+1][0].parentElement||this.elTable_[r+1][0].parentNode,p=this.grid_[r][0].getMonth()==e;goog.style.setElementShown(c,p||this.showFixedNumWeeks_),p||(i=Math.min(i,r))}}var m=(this.showFixedNumWeeks_?goog.ui.DatePicker.MAX_NUM_WEEKS_:i)+(this.showWeekdays_?1:0);this.lastNumberOfRowsInGrid_!=m&&(this.lastNumberOfRowsInGrid_<m&&this.dispatchEvent(goog.ui.DatePicker.Events.GRID_SIZE_INCREASE),this.lastNumberOfRowsInGrid_=m)}},goog.ui.DatePicker.prototype.fireChangeActiveMonthEvent_=function(){var e=new goog.ui.DatePickerEvent(goog.ui.DatePicker.Events.CHANGE_ACTIVE_MONTH,this,this.getActiveMonth());this.dispatchEvent(e)},goog.ui.DatePicker.prototype.redrawWeekdays_=function(){if(this.getElement()){if(this.showWeekdays_)for(var e=0;e<7;e++){var t=this.elTable_[0][e+1],o=(e+this.activeMonth_.getFirstDayOfWeek()+7)%7;goog.dom.setTextContent(t,this.wdayNames_[(o+1)%7])}var a=this.elTable_[0][0].parentElement||this.elTable_[0][0].parentNode;goog.style.setElementShown(a,this.showWeekdays_)}},goog.ui.DatePicker.prototype.getKeyHandlerForElement_=function(e){var t=goog.getUid(e);return t in this.keyHandlers_||(this.keyHandlers_[t]=new goog.events.KeyHandler(e)),this.keyHandlers_[t]},goog.ui.DatePickerEvent=function(e,t,o){goog.events.Event.call(this,e,t),this.date=o},goog.inherits(goog.ui.DatePickerEvent,goog.events.Event);