goog.provide("goog.ui.ScrollFloater"),goog.provide("goog.ui.ScrollFloater.EventType"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.dom.classlist"),goog.require("goog.events.EventType"),goog.require("goog.style"),goog.require("goog.ui.Component"),goog.require("goog.userAgent"),goog.ui.ScrollFloater=function(o,t){var e=o?goog.dom.getDomHelper(o):t;goog.ui.ScrollFloater.base(this,"constructor",e),this.parentElement_=o||this.getDomHelper().getDocument().body,this.originalStyles_={},this.viewportTopOffset_=0,this.containerElement_=null,this.containerBounds_=null,this.originalBounds_=null,this.originalTopOffset_=0,this.originalLeftOffset_=0,this.placeholder_=null,this.scrollingEnabled_=!0,this.pinned_=!1,this.floating_=!1},goog.inherits(goog.ui.ScrollFloater,goog.ui.Component),goog.ui.ScrollFloater.EventType={FLOAT:"float",DOCK:"dock",PIN:"pin"},goog.ui.ScrollFloater.FloatMode_={TOP:0,BOTTOM:1},goog.ui.ScrollFloater.STORED_STYLE_PROPS_=["position","top","left","width","cssFloat"],goog.ui.ScrollFloater.PLACEHOLDER_STYLE_PROPS_=["position","top","left","display","cssFloat","marginTop","marginLeft","marginRight","marginBottom"],goog.ui.ScrollFloater.CSS_CLASS_=goog.getCssName("goog-scrollfloater"),goog.ui.ScrollFloater.prototype.createDom=function(){goog.ui.ScrollFloater.base(this,"createDom"),this.decorateInternal(this.getElement())},goog.ui.ScrollFloater.prototype.decorateInternal=function(o){goog.ui.ScrollFloater.base(this,"decorateInternal",o),goog.asserts.assert(o),goog.dom.classlist.add(o,goog.ui.ScrollFloater.CSS_CLASS_)},goog.ui.ScrollFloater.prototype.enterDocument=function(){goog.ui.ScrollFloater.base(this,"enterDocument"),this.placeholder_||(this.placeholder_=this.getDomHelper().createDom(goog.dom.TagName.DIV,{style:"visibility:hidden"})),this.update(),this.setScrollingEnabled(this.scrollingEnabled_);var o=this.getDomHelper().getWindow();this.getHandler().listen(o,goog.events.EventType.SCROLL,this.handleScroll_).listen(o,goog.events.EventType.RESIZE,this.update)},goog.ui.ScrollFloater.prototype.update=function(){if(this.isInDocument()){this.dock_(),this.containerElement_&&(this.containerBounds_=goog.style.getBounds(this.containerElement_));var o=goog.style.getPageOffset(this.getElement());this.originalBounds_=goog.style.getBounds(this.getElement()),this.originalTopOffset_=o.y,this.originalLeftOffset_=o.x,this.handleScroll_()}},goog.ui.ScrollFloater.prototype.disposeInternal=function(){goog.ui.ScrollFloater.base(this,"disposeInternal"),this.placeholder_=null},goog.ui.ScrollFloater.prototype.setScrollingEnabled=function(o){this.scrollingEnabled_=o,o?(this.applyIeBgHack_(),this.handleScroll_()):this.dock_()},goog.ui.ScrollFloater.prototype.isScrollingEnabled=function(){return this.scrollingEnabled_},goog.ui.ScrollFloater.prototype.isFloating=function(){return this.floating_},goog.ui.ScrollFloater.prototype.isPinned=function(){return this.pinned_},goog.ui.ScrollFloater.prototype.setViewportTopOffset=function(o){this.viewportTopOffset_=o,this.update()},goog.ui.ScrollFloater.prototype.setContainerElement=function(o){this.containerElement_=o,this.update()},goog.ui.ScrollFloater.prototype.handleScroll_=function(o){if(this.scrollingEnabled_){var t=this.getDomHelper().getDocumentScroll().y;if(this.originalBounds_.top-t>=this.viewportTopOffset_)return void this.dock_();var e=this.originalBounds_.height+this.viewportTopOffset_;if(this.containerElement_)if(t>this.containerBounds_.top+this.containerBounds_.height-e)return void this.pin_();var i=this.getDomHelper().getViewportSize().height;if(this.needsIePositionHack_()||e<i)return void this.float_(goog.ui.ScrollFloater.FloatMode_.TOP);this.originalBounds_.height+this.originalTopOffset_>i+t?this.dock_():this.float_(goog.ui.ScrollFloater.FloatMode_.BOTTOM)}},goog.ui.ScrollFloater.prototype.pin_=function(){if((!this.floating_||this.dock_())&&!this.pinned_&&this.dispatchEvent(goog.ui.ScrollFloater.EventType.PIN)){var o=this.getElement();this.storeOriginalStyles_(),o.style.position="relative",o.style.top=this.containerBounds_.height-this.originalBounds_.height-this.originalBounds_.top+this.containerBounds_.top+"px",this.pinned_=!0}},goog.ui.ScrollFloater.prototype.float_=function(o){var t=o==goog.ui.ScrollFloater.FloatMode_.TOP;if((!this.pinned_||this.dock_())&&this.dispatchEvent(goog.ui.ScrollFloater.EventType.FLOAT)){var e=goog.dom.getDocumentScroll().x;if(this.floating_)this.updateFloatingLeftPosition_();else{var i=this.getElement(),l=goog.style.getPageOffsetLeft(i),r=goog.style.getContentBoxSize(i).width;this.storeOriginalStyles_(),goog.style.setSize(this.placeholder_,i.offsetWidth,i.offsetHeight),goog.style.setStyle(i,{left:l-e+"px",width:r+"px",cssFloat:"none"}),i.parentNode==this.parentElement_?i.parentNode.insertBefore(this.placeholder_,i):(i.parentNode.replaceChild(this.placeholder_,i),this.parentElement_.appendChild(i)),this.needsIePositionHack_()?(i.style.position="absolute",i.style.setExpression("top",'document.compatMode=="CSS1Compat"?documentElement.scrollTop:document.body.scrollTop')):(i.style.position="fixed",t?(i.style.top=this.viewportTopOffset_+"px",i.style.bottom="auto"):(i.style.top="auto",i.style.bottom="0")),this.floating_=!0}}},goog.ui.ScrollFloater.prototype.dock_=function(){if(!this.floating_&&!this.pinned_||!this.dispatchEvent(goog.ui.ScrollFloater.EventType.DOCK))return!1;var o=this.getElement();return this.floating_&&(this.restoreOriginalStyles_(),this.needsIePositionHack_()&&o.style.removeExpression("top"),this.placeholder_.parentNode==this.parentElement_?this.placeholder_.parentNode.removeChild(this.placeholder_):this.placeholder_.parentNode.replaceChild(o,this.placeholder_)),this.pinned_&&this.restoreOriginalStyles_(),this.floating_=this.pinned_=!1,!0},goog.ui.ScrollFloater.prototype.updateFloatingLeftPosition_=function(){goog.asserts.assert(this.floating_);var o=goog.dom.getDocumentScroll().x;goog.style.setStyle(this.getElement(),{left:this.originalLeftOffset_-o+"px"})},goog.ui.ScrollFloater.prototype.storeOriginalStyles_=function(){var o=this.getElement();this.originalStyles_={},goog.array.forEach(goog.ui.ScrollFloater.STORED_STYLE_PROPS_,function(t){this.originalStyles_[t]=o.style[t]},this),goog.array.forEach(goog.ui.ScrollFloater.PLACEHOLDER_STYLE_PROPS_,function(t){this.placeholder_.style[t]=o.style[t]||goog.style.getCascadedStyle(o,t)||goog.style.getComputedStyle(o,t)},this)},goog.ui.ScrollFloater.prototype.restoreOriginalStyles_=function(){var o=this.getElement();for(var t in this.originalStyles_)o.style[t]=this.originalStyles_[t]},goog.ui.ScrollFloater.prototype.needsIePositionHack_=function(){return goog.userAgent.IE&&!(goog.userAgent.isVersionOrHigher("7")&&this.getDomHelper().isCss1CompatMode())},goog.ui.ScrollFloater.prototype.applyIeBgHack_=function(){if(this.needsIePositionHack_()){var o=this.getDomHelper().getDocument(),t=goog.style.getClientViewportElement(o);"none"==t.currentStyle.backgroundImage&&(t.style.backgroundImage="https:"==this.getDomHelper().getWindow().location.protocol?"url(https:///)":"url(about:blank)",t.style.backgroundAttachment="fixed")}};