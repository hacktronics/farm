goog.provide("goog.ui.PopupBase"),goog.provide("goog.ui.PopupBase.EventType"),goog.provide("goog.ui.PopupBase.Type"),goog.require("goog.Timer"),goog.require("goog.array"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.events"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventTarget"),goog.require("goog.events.EventType"),goog.require("goog.events.KeyCodes"),goog.require("goog.fx.Transition"),goog.require("goog.style"),goog.require("goog.userAgent"),goog.ui.PopupBase=function(o,e){goog.events.EventTarget.call(this),this.handler_=new goog.events.EventHandler(this),this.setElement(o||null),e&&this.setType(e)},goog.inherits(goog.ui.PopupBase,goog.events.EventTarget),goog.tagUnsealableClass(goog.ui.PopupBase),goog.ui.PopupBase.Type={TOGGLE_DISPLAY:"toggle_display",MOVE_OFFSCREEN:"move_offscreen"},goog.ui.PopupBase.prototype.element_=null,goog.ui.PopupBase.prototype.autoHide_=!0,goog.ui.PopupBase.prototype.autoHidePartners_=null,goog.ui.PopupBase.prototype.autoHideRegion_=null,goog.ui.PopupBase.prototype.isVisible_=!1,goog.ui.PopupBase.prototype.shouldHideAsync_=!1,goog.ui.PopupBase.prototype.lastShowTime_=-1,goog.ui.PopupBase.prototype.lastHideTime_=-1,goog.ui.PopupBase.prototype.hideOnEscape_=!1,goog.ui.PopupBase.prototype.enableCrossIframeDismissal_=!0,goog.ui.PopupBase.prototype.type_=goog.ui.PopupBase.Type.TOGGLE_DISPLAY,goog.ui.PopupBase.prototype.showTransition_,goog.ui.PopupBase.prototype.hideTransition_,goog.ui.PopupBase.EventType={BEFORE_SHOW:"beforeshow",SHOW:"show",BEFORE_HIDE:"beforehide",HIDE:"hide"},goog.ui.PopupBase.DEBOUNCE_DELAY_MS=150,goog.ui.PopupBase.prototype.getType=function(){return this.type_},goog.ui.PopupBase.prototype.setType=function(o){this.type_=o},goog.ui.PopupBase.prototype.shouldHideAsync=function(){return this.shouldHideAsync_},goog.ui.PopupBase.prototype.setShouldHideAsync=function(o){this.shouldHideAsync_=o},goog.ui.PopupBase.prototype.getElement=function(){return this.element_},goog.ui.PopupBase.prototype.setElement=function(o){this.ensureNotVisible_(),this.element_=o},goog.ui.PopupBase.prototype.getAutoHide=function(){return this.autoHide_},goog.ui.PopupBase.prototype.setAutoHide=function(o){this.ensureNotVisible_(),this.autoHide_=o},goog.ui.PopupBase.prototype.addAutoHidePartner=function(o){this.autoHidePartners_||(this.autoHidePartners_=[]),goog.array.insert(this.autoHidePartners_,o)},goog.ui.PopupBase.prototype.removeAutoHidePartner=function(o){this.autoHidePartners_&&goog.array.remove(this.autoHidePartners_,o)},goog.ui.PopupBase.prototype.getHideOnEscape=function(){return this.hideOnEscape_},goog.ui.PopupBase.prototype.setHideOnEscape=function(o){this.ensureNotVisible_(),this.hideOnEscape_=o},goog.ui.PopupBase.prototype.getEnableCrossIframeDismissal=function(){return this.enableCrossIframeDismissal_},goog.ui.PopupBase.prototype.setEnableCrossIframeDismissal=function(o){this.enableCrossIframeDismissal_=o},goog.ui.PopupBase.prototype.getAutoHideRegion=function(){return this.autoHideRegion_},goog.ui.PopupBase.prototype.setAutoHideRegion=function(o){this.autoHideRegion_=o},goog.ui.PopupBase.prototype.setTransition=function(o,e){this.showTransition_=o,this.hideTransition_=e},goog.ui.PopupBase.prototype.getLastShowTime=function(){return this.lastShowTime_},goog.ui.PopupBase.prototype.getLastHideTime=function(){return this.lastHideTime_},goog.ui.PopupBase.prototype.getHandler=function(){return this.handler_},goog.ui.PopupBase.prototype.ensureNotVisible_=function(){if(this.isVisible_)throw new Error("Can not change this state of the popup while showing.")},goog.ui.PopupBase.prototype.isVisible=function(){return this.isVisible_},goog.ui.PopupBase.prototype.isOrWasRecentlyVisible=function(){return this.isVisible_||goog.now()-this.lastHideTime_<goog.ui.PopupBase.DEBOUNCE_DELAY_MS},goog.ui.PopupBase.prototype.setVisible=function(o){this.showTransition_&&this.showTransition_.stop(),this.hideTransition_&&this.hideTransition_.stop(),o?this.show_():this.hide_()},goog.ui.PopupBase.prototype.reposition=goog.nullFunction,goog.ui.PopupBase.prototype.show_=function(){if(!this.isVisible_&&this.onBeforeShow()){if(!this.element_)throw new Error("Caller must call setElement before trying to show the popup");this.reposition();var o=goog.dom.getOwnerDocument(this.element_);if(this.hideOnEscape_&&this.handler_.listen(o,goog.events.EventType.KEYDOWN,this.onDocumentKeyDown_,!0),this.autoHide_)if(this.handler_.listen(o,goog.events.EventType.MOUSEDOWN,this.onDocumentMouseDown_,!0),goog.userAgent.IE){var e;try{e=o.activeElement}catch(o){}for(;e&&e.nodeName==goog.dom.TagName.IFRAME;){try{var t=goog.dom.getFrameContentDocument(e)}catch(o){break}e=(o=t).activeElement}this.handler_.listen(o,goog.events.EventType.MOUSEDOWN,this.onDocumentMouseDown_,!0),this.handler_.listen(o,goog.events.EventType.DEACTIVATE,this.onDocumentBlur_)}else this.handler_.listen(o,goog.events.EventType.BLUR,this.onDocumentBlur_);this.type_==goog.ui.PopupBase.Type.TOGGLE_DISPLAY?this.showPopupElement():this.type_==goog.ui.PopupBase.Type.MOVE_OFFSCREEN&&this.reposition(),this.isVisible_=!0,this.lastShowTime_=goog.now(),this.lastHideTime_=-1,this.showTransition_?(goog.events.listenOnce(this.showTransition_,goog.fx.Transition.EventType.END,this.onShow,!1,this),this.showTransition_.play()):this.onShow()}},goog.ui.PopupBase.prototype.hide_=function(o){return!(!this.isVisible_||!this.onBeforeHide(o))&&(this.handler_&&this.handler_.removeAll(),this.isVisible_=!1,this.lastHideTime_=goog.now(),this.hideTransition_?(goog.events.listenOnce(this.hideTransition_,goog.fx.Transition.EventType.END,goog.partial(this.continueHidingPopup_,o),!1,this),this.hideTransition_.play()):this.continueHidingPopup_(o),!0)},goog.ui.PopupBase.prototype.continueHidingPopup_=function(o){this.type_==goog.ui.PopupBase.Type.TOGGLE_DISPLAY?this.shouldHideAsync_?goog.Timer.callOnce(this.hidePopupElement,0,this):this.hidePopupElement():this.type_==goog.ui.PopupBase.Type.MOVE_OFFSCREEN&&this.moveOffscreen_(),this.onHide(o)},goog.ui.PopupBase.prototype.showPopupElement=function(){this.element_.style.visibility="visible",goog.style.setElementShown(this.element_,!0)},goog.ui.PopupBase.prototype.hidePopupElement=function(){this.element_.style.visibility="hidden",goog.style.setElementShown(this.element_,!1)},goog.ui.PopupBase.prototype.moveOffscreen_=function(){this.element_.style.top="-10000px"},goog.ui.PopupBase.prototype.onBeforeShow=function(){return this.dispatchEvent(goog.ui.PopupBase.EventType.BEFORE_SHOW)},goog.ui.PopupBase.prototype.onShow=function(){this.dispatchEvent(goog.ui.PopupBase.EventType.SHOW)},goog.ui.PopupBase.prototype.onBeforeHide=function(o){return this.dispatchEvent({type:goog.ui.PopupBase.EventType.BEFORE_HIDE,target:o})},goog.ui.PopupBase.prototype.onHide=function(o){this.dispatchEvent({type:goog.ui.PopupBase.EventType.HIDE,target:o})},goog.ui.PopupBase.prototype.onDocumentMouseDown_=function(o){var e=o.target;goog.dom.contains(this.element_,e)||this.isOrWithinAutoHidePartner_(e)||!this.isWithinAutoHideRegion_(e)||this.shouldDebounce_()||this.hide_(e)},goog.ui.PopupBase.prototype.onDocumentKeyDown_=function(o){o.keyCode==goog.events.KeyCodes.ESC&&this.hide_(o.target)&&(o.preventDefault(),o.stopPropagation())},goog.ui.PopupBase.prototype.onDocumentBlur_=function(o){if(this.enableCrossIframeDismissal_){var e=goog.dom.getOwnerDocument(this.element_);if(void 0!==document.activeElement){var t=e.activeElement;if(!t||goog.dom.contains(this.element_,t)||t.tagName==goog.dom.TagName.BODY)return}else if(o.target!=e)return;this.shouldDebounce_()||this.hide_()}},goog.ui.PopupBase.prototype.isOrWithinAutoHidePartner_=function(o){return goog.array.some(this.autoHidePartners_||[],function(e){return o===e||goog.dom.contains(e,o)})},goog.ui.PopupBase.prototype.isWithinAutoHideRegion_=function(o){return!this.autoHideRegion_||goog.dom.contains(this.autoHideRegion_,o)},goog.ui.PopupBase.prototype.shouldDebounce_=function(){return goog.now()-this.lastShowTime_<goog.ui.PopupBase.DEBOUNCE_DELAY_MS},goog.ui.PopupBase.prototype.disposeInternal=function(){goog.ui.PopupBase.base(this,"disposeInternal"),this.handler_.dispose(),goog.dispose(this.showTransition_),goog.dispose(this.hideTransition_),delete this.element_,delete this.handler_,delete this.autoHidePartners_};