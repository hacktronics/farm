goog.provide("goog.ui.PaletteRenderer"),goog.forwardDeclare("goog.ui.Palette"),goog.require("goog.a11y.aria"),goog.require("goog.a11y.aria.Role"),goog.require("goog.a11y.aria.State"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.NodeIterator"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.TagName"),goog.require("goog.dom.classlist"),goog.require("goog.dom.dataset"),goog.require("goog.iter"),goog.require("goog.style"),goog.require("goog.ui.ControlRenderer"),goog.require("goog.userAgent"),goog.ui.PaletteRenderer=function(){goog.ui.ControlRenderer.call(this)},goog.inherits(goog.ui.PaletteRenderer,goog.ui.ControlRenderer),goog.addSingletonGetter(goog.ui.PaletteRenderer),goog.ui.PaletteRenderer.cellId_=0,goog.ui.PaletteRenderer.CSS_CLASS=goog.getCssName("goog-palette"),goog.ui.PaletteRenderer.GRID_WIDTH_ATTRIBUTE="gridWidth",goog.ui.PaletteRenderer.prototype.createDom=function(e){var o=this.getClassNames(e),g=e.getDomHelper().createDom(goog.dom.TagName.DIV,o,this.createGrid(e.getContent(),e.getSize(),e.getDomHelper()));return goog.a11y.aria.setRole(g,goog.a11y.aria.Role.GRID),goog.dom.dataset.set(g,goog.ui.PaletteRenderer.GRID_WIDTH_ATTRIBUTE,e.getSize().width),g},goog.ui.PaletteRenderer.prototype.createGrid=function(e,o,g){for(var t=[],a=0,r=0;a<o.height;a++){for(var i=[],l=0;l<o.width;l++){var s=e&&e[r++];i.push(this.createCell(s,g))}t.push(this.createRow(i,g))}return this.createTable(t,g)},goog.ui.PaletteRenderer.prototype.createTable=function(e,o){var g=o.createDom(goog.dom.TagName.TABLE,goog.getCssName(this.getCssClass(),"table"),o.createDom(goog.dom.TagName.TBODY,goog.getCssName(this.getCssClass(),"body"),e));return g.cellSpacing="0",g.cellPadding="0",g},goog.ui.PaletteRenderer.prototype.createRow=function(e,o){var g=o.createDom(goog.dom.TagName.TR,goog.getCssName(this.getCssClass(),"row"),e);return goog.a11y.aria.setRole(g,goog.a11y.aria.Role.ROW),g},goog.ui.PaletteRenderer.prototype.createCell=function(e,o){var g=o.createDom(goog.dom.TagName.TD,{class:goog.getCssName(this.getCssClass(),"cell"),id:goog.getCssName(this.getCssClass(),"cell-")+goog.ui.PaletteRenderer.cellId_++},e);return goog.a11y.aria.setRole(g,goog.a11y.aria.Role.GRIDCELL),goog.a11y.aria.setState(g,goog.a11y.aria.State.SELECTED,!1),this.maybeUpdateAriaLabel_(g),g},goog.ui.PaletteRenderer.prototype.maybeUpdateAriaLabel_=function(e){if(!goog.dom.getTextContent(e)&&!goog.a11y.aria.getLabel(e)){for(var o,g=new goog.dom.NodeIterator(e),t="";!t&&(o=goog.iter.nextOrValue(g,null));)o.nodeType==goog.dom.NodeType.ELEMENT&&(t=goog.a11y.aria.getLabel(o)||o.title);t&&goog.a11y.aria.setLabel(e,t)}},goog.ui.PaletteRenderer.prototype.canDecorate=function(e){return!1},goog.ui.PaletteRenderer.prototype.decorate=function(e,o){return null},goog.ui.PaletteRenderer.prototype.setContent=function(e,o){var g=o;if(e){var t=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.TBODY,goog.getCssName(this.getCssClass(),"body"),e)[0];if(t){var a=0;if(goog.array.forEach(t.rows,function(e){goog.array.forEach(e.cells,function(e){if(goog.dom.removeChildren(e),goog.a11y.aria.removeState(e,goog.a11y.aria.State.LABEL),g){var o=g[a++];o&&(goog.dom.appendChild(e,o),this.maybeUpdateAriaLabel_(e))}},this)},this),a<g.length){for(var r=[],i=goog.dom.getDomHelper(e),l=goog.dom.dataset.get(e,goog.ui.PaletteRenderer.GRID_WIDTH_ATTRIBUTE);a<g.length;){var s=g[a++];if(r.push(this.createCell(s,i)),r.length==l){var n=this.createRow(r,i);goog.dom.appendChild(t,n),r.length=0}}if(r.length>0){for(;r.length<l;)r.push(this.createCell("",i));n=this.createRow(r,i);goog.dom.appendChild(t,n)}}}goog.style.setUnselectable(e,!0,goog.userAgent.GECKO)}},goog.ui.PaletteRenderer.prototype.getContainingItem=function(e,o){for(var g=e.getElement();o&&o.nodeType==goog.dom.NodeType.ELEMENT&&o!=g;){if(o.tagName==goog.dom.TagName.TD&&goog.dom.classlist.contains(o,goog.getCssName(this.getCssClass(),"cell")))return o.firstChild;o=o.parentNode}return null},goog.ui.PaletteRenderer.prototype.highlightCell=function(e,o,g){if(o){var t=this.getCellForItem(o);goog.asserts.assert(t),goog.dom.classlist.enable(t,goog.getCssName(this.getCssClass(),"cell-hover"),g),g?goog.a11y.aria.setState(e.getElementStrict(),goog.a11y.aria.State.ACTIVEDESCENDANT,t.id):t.id==goog.a11y.aria.getState(e.getElementStrict(),goog.a11y.aria.State.ACTIVEDESCENDANT)&&goog.a11y.aria.removeState(e.getElementStrict(),goog.a11y.aria.State.ACTIVEDESCENDANT)}},goog.ui.PaletteRenderer.prototype.getCellForItem=function(e){return e?e.parentNode:null},goog.ui.PaletteRenderer.prototype.selectCell=function(e,o,g){if(o){var t=o.parentNode;goog.dom.classlist.enable(t,goog.getCssName(this.getCssClass(),"cell-selected"),g),goog.a11y.aria.setState(t,goog.a11y.aria.State.SELECTED,g)}},goog.ui.PaletteRenderer.prototype.getCssClass=function(){return goog.ui.PaletteRenderer.CSS_CLASS};