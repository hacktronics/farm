goog.provide("goog.ui.HsvaPalette"),goog.require("goog.array"),goog.require("goog.color.alpha"),goog.require("goog.dom.TagName"),goog.require("goog.events"),goog.require("goog.events.EventType"),goog.require("goog.style"),goog.require("goog.ui.Component"),goog.require("goog.ui.HsvPalette"),goog.ui.HsvaPalette=function(e,t,o,a){goog.ui.HsvaPalette.base(this,"constructor",e,t,a),this.alpha_=void 0!==o?o:1,this.className=a||goog.getCssName("goog-hsva-palette")},goog.inherits(goog.ui.HsvaPalette,goog.ui.HsvPalette),goog.ui.HsvaPalette.prototype.aImageEl_,goog.ui.HsvaPalette.prototype.aHandleEl_,goog.ui.HsvaPalette.prototype.swatchBackdropEl_,goog.ui.HsvaPalette.prototype.getAlpha=function(){return this.alpha_},goog.ui.HsvaPalette.prototype.setAlpha=function(e){this.setColorAlphaHelper_(this.color,e)},goog.ui.HsvaPalette.prototype.setColor=function(e){this.setColorAlphaHelper_(e,1)},goog.ui.HsvaPalette.prototype.getColorRgbaHex=function(){var e=Math.floor(255*this.alpha_).toString(16);return this.color+(1==e.length?"0"+e:e)},goog.ui.HsvaPalette.prototype.setColorRgbaHex=function(e){var t=goog.ui.HsvaPalette.parseColorRgbaHex_(e);this.setColorAlphaHelper_(t[0],t[1])},goog.ui.HsvaPalette.prototype.setColorAlphaHelper_=function(e,t){var o=this.color!=e,a=this.alpha_!=t;this.alpha_=t,this.color=e,o&&this.setColorInternal(e),(o||a)&&(this.updateUi(),this.dispatchEvent(goog.ui.Component.EventType.ACTION))},goog.ui.HsvaPalette.prototype.createDom=function(){goog.ui.HsvaPalette.base(this,"createDom");var e=this.getDomHelper();this.aImageEl_=e.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"a-image")),this.aHandleEl_=e.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"a-handle")),this.swatchBackdropEl_=e.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"swatch-backdrop"));var t=this.getElement();e.appendChild(t,this.aImageEl_),e.appendChild(t,this.aHandleEl_),e.appendChild(t,this.swatchBackdropEl_)},goog.ui.HsvaPalette.prototype.disposeInternal=function(){goog.ui.HsvaPalette.base(this,"disposeInternal"),delete this.aImageEl_,delete this.aHandleEl_,delete this.swatchBackdropEl_},goog.ui.HsvaPalette.prototype.updateUi=function(){if(goog.ui.HsvaPalette.base(this,"updateUi"),this.isInDocument()){var e=255*this.alpha_,t=this.aImageEl_.offsetTop-Math.floor(this.aHandleEl_.offsetHeight/2)+this.aImageEl_.offsetHeight*((255-e)/255);this.aHandleEl_.style.top=t+"px",this.aImageEl_.style.backgroundColor=this.color,goog.style.setOpacity(this.swatchElement,e/255)}},goog.ui.HsvaPalette.prototype.updateInput=function(){goog.array.equals([this.color,this.alpha_],goog.ui.HsvaPalette.parseUserInput_(this.inputElement.value))||(this.inputElement.value=this.getColorRgbaHex())},goog.ui.HsvaPalette.prototype.handleMouseDown=function(e){if(goog.ui.HsvaPalette.base(this,"handleMouseDown",e),e.target==this.aImageEl_||e.target==this.aHandleEl_){var t=goog.style.getBounds(this.valueBackgroundImageElement);this.handleMouseMoveA_(t,e),this.mouseMoveListener=goog.events.listen(this.getDomHelper().getDocument(),goog.events.EventType.MOUSEMOVE,goog.bind(this.handleMouseMoveA_,this,t)),this.mouseUpListener=goog.events.listen(this.getDomHelper().getDocument(),goog.events.EventType.MOUSEUP,this.handleMouseUp,!1,this)}},goog.ui.HsvaPalette.prototype.handleMouseMoveA_=function(e,t){t.preventDefault();var o=this.getDomHelper().getDocumentScroll(),a=(e.top+e.height-Math.min(Math.max(o.y+t.clientY,e.top),e.top+e.height))/e.height;this.setAlpha(a)},goog.ui.HsvaPalette.prototype.handleInput=function(e){var t=goog.ui.HsvaPalette.parseUserInput_(this.inputElement.value);t&&this.setColorAlphaHelper_(t[0],t[1])},goog.ui.HsvaPalette.parseUserInput_=function(e){return/^#?[0-9a-f]{8}$/i.test(e)?goog.ui.HsvaPalette.parseColorRgbaHex_(e):/^#?[0-9a-f]{6}$/i.test(e)?[e,1]:null},goog.ui.HsvaPalette.parseColorRgbaHex_=function(e){var t=goog.color.alpha.parse(e).hex;return[goog.color.alpha.extractHexColor(t),parseInt(goog.color.alpha.extractAlpha(t),16)/255]};