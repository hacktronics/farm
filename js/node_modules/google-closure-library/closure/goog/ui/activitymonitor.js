goog.provide("goog.ui.ActivityMonitor"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventTarget"),goog.require("goog.events.EventType"),goog.ui.ActivityMonitor=function(t,o){if(goog.events.EventTarget.call(this),this.documents_=[],this.useBubble_=!!o,this.eventHandler_=new goog.events.EventHandler(this),this.isIframe_=window.parent!=window,t)if(goog.isArray(t))for(var e=0;e<t.length;e++)this.addDocument(t[e].getDocument());else this.addDocument(t.getDocument());else this.addDocument(goog.dom.getDomHelper().getDocument());this.lastEventTime_=goog.now()},goog.inherits(goog.ui.ActivityMonitor,goog.events.EventTarget),goog.tagUnsealableClass(goog.ui.ActivityMonitor),goog.ui.ActivityMonitor.prototype.lastEventType_="",goog.ui.ActivityMonitor.prototype.lastMouseX_,goog.ui.ActivityMonitor.prototype.lastMouseY_,goog.ui.ActivityMonitor.prototype.minEventTime_=0,goog.ui.ActivityMonitor.MIN_EVENT_SPACING=3e3,goog.ui.ActivityMonitor.userEventTypesBody_=[goog.events.EventType.CLICK,goog.events.EventType.DBLCLICK,goog.events.EventType.MOUSEDOWN,goog.events.EventType.MOUSEMOVE,goog.events.EventType.MOUSEUP],goog.ui.ActivityMonitor.userTouchEventTypesBody_=[goog.events.EventType.TOUCHEND,goog.events.EventType.TOUCHMOVE,goog.events.EventType.TOUCHSTART],goog.ui.ActivityMonitor.userEventTypesDocuments_=[goog.events.EventType.KEYDOWN,goog.events.EventType.KEYUP],goog.ui.ActivityMonitor.Event={ACTIVITY:"activity"},goog.ui.ActivityMonitor.prototype.disposeInternal=function(){goog.ui.ActivityMonitor.superClass_.disposeInternal.call(this),this.eventHandler_.dispose(),this.eventHandler_=null,delete this.documents_},goog.ui.ActivityMonitor.prototype.addDocument=function(t){if(!goog.array.contains(this.documents_,t)){this.documents_.push(t);var o=!this.useBubble_,e=goog.array.concat(goog.ui.ActivityMonitor.userEventTypesDocuments_,goog.ui.ActivityMonitor.userEventTypesBody_);this.isIframe_||goog.array.extend(e,goog.ui.ActivityMonitor.userTouchEventTypesBody_),this.eventHandler_.listen(t,e,this.handleEvent_,o)}},goog.ui.ActivityMonitor.prototype.removeDocument=function(t){if(!this.isDisposed()){goog.array.remove(this.documents_,t);var o=!this.useBubble_,e=goog.array.concat(goog.ui.ActivityMonitor.userEventTypesDocuments_,goog.ui.ActivityMonitor.userEventTypesBody_);this.isIframe_||goog.array.extend(e,goog.ui.ActivityMonitor.userTouchEventTypesBody_),this.eventHandler_.unlisten(t,e,this.handleEvent_,o)}},goog.ui.ActivityMonitor.prototype.handleEvent_=function(t){var o=!1;if(t.type===goog.events.EventType.MOUSEMOVE)("number"==typeof this.lastMouseX_&&this.lastMouseX_!=t.clientX||"number"==typeof this.lastMouseY_&&this.lastMouseY_!=t.clientY)&&(o=!0),this.lastMouseX_=t.clientX,this.lastMouseY_=t.clientY;else o=!0;if(o){var e=goog.asserts.assertString(t.type);this.updateIdleTime(goog.now(),e)}},goog.ui.ActivityMonitor.prototype.resetTimer=function(){this.updateIdleTime(goog.now(),"manual")},goog.ui.ActivityMonitor.prototype.updateIdleTime=function(t,o){this.lastEventTime_=t,this.lastEventType_=o,t>this.minEventTime_&&(this.dispatchEvent(goog.ui.ActivityMonitor.Event.ACTIVITY),this.minEventTime_=t+goog.ui.ActivityMonitor.MIN_EVENT_SPACING)},goog.ui.ActivityMonitor.prototype.getIdleTime=function(t){return(t||goog.now())-this.lastEventTime_},goog.ui.ActivityMonitor.prototype.getLastEventType=function(){return this.lastEventType_},goog.ui.ActivityMonitor.prototype.getLastEventTime=function(){return this.lastEventTime_};