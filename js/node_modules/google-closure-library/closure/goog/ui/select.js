goog.provide("goog.ui.Select"),goog.require("goog.a11y.aria"),goog.require("goog.a11y.aria.Role"),goog.require("goog.a11y.aria.State"),goog.require("goog.array"),goog.require("goog.events.EventType"),goog.require("goog.ui.Component"),goog.require("goog.ui.IdGenerator"),goog.require("goog.ui.MenuButton"),goog.require("goog.ui.MenuItem"),goog.require("goog.ui.MenuRenderer"),goog.require("goog.ui.SelectionModel"),goog.require("goog.ui.registry"),goog.ui.Select=function(e,t,o,i,l){goog.ui.Select.base(this,"constructor",e,t,o,i,l||new goog.ui.MenuRenderer(goog.a11y.aria.Role.LISTBOX)),this.defaultCaption_=this.getContent(),this.initialAriaLabel_=null,this.setPreferredAriaRole(goog.a11y.aria.Role.LISTBOX)},goog.inherits(goog.ui.Select,goog.ui.MenuButton),goog.tagUnsealableClass(goog.ui.Select),goog.ui.Select.prototype.selectionModel_=null,goog.ui.Select.prototype.enterDocument=function(){goog.ui.Select.superClass_.enterDocument.call(this),this.updateCaption(),this.listenToSelectionModelEvents_()},goog.ui.Select.prototype.decorateInternal=function(e){goog.ui.Select.superClass_.decorateInternal.call(this,e);var t=this.getCaption();t?this.setDefaultCaption(t):this.getSelectedItem()||this.setSelectedIndex(0)},goog.ui.Select.prototype.disposeInternal=function(){goog.ui.Select.superClass_.disposeInternal.call(this),this.selectionModel_&&(this.selectionModel_.dispose(),this.selectionModel_=null),this.defaultCaption_=null},goog.ui.Select.prototype.handleMenuAction=function(e){this.setSelectedItem(e.target),goog.ui.Select.base(this,"handleMenuAction",e),e.stopPropagation(),this.dispatchEvent(goog.ui.Component.EventType.ACTION)},goog.ui.Select.prototype.handleSelectionChange=function(e){var t=this.getSelectedItem();goog.ui.Select.superClass_.setValue.call(this,t&&t.getValue()),this.updateCaption()},goog.ui.Select.prototype.setMenu=function(e){var t=goog.ui.Select.superClass_.setMenu.call(this,e);return e!=t&&(this.selectionModel_&&this.selectionModel_.clear(),e&&(this.selectionModel_?e.forEachChild(function(e,t){this.setCorrectAriaRole_(e),this.selectionModel_.addItem(e)},this):this.createSelectionModel_(e))),t},goog.ui.Select.prototype.getDefaultCaption=function(){return this.defaultCaption_},goog.ui.Select.prototype.setDefaultCaption=function(e){this.defaultCaption_=e,this.updateCaption()},goog.ui.Select.prototype.addItem=function(e){this.setCorrectAriaRole_(e),goog.ui.Select.superClass_.addItem.call(this,e),this.selectionModel_?this.selectionModel_.addItem(e):this.createSelectionModel_(this.getMenu()),this.updateAriaActiveDescendant_()},goog.ui.Select.prototype.addItemAt=function(e,t){this.setCorrectAriaRole_(e),goog.ui.Select.superClass_.addItemAt.call(this,e,t),this.selectionModel_?this.selectionModel_.addItemAt(e,t):this.createSelectionModel_(this.getMenu())},goog.ui.Select.prototype.removeItem=function(e){goog.ui.Select.superClass_.removeItem.call(this,e),this.selectionModel_&&this.selectionModel_.removeItem(e)},goog.ui.Select.prototype.removeItemAt=function(e){goog.ui.Select.superClass_.removeItemAt.call(this,e),this.selectionModel_&&this.selectionModel_.removeItemAt(e)},goog.ui.Select.prototype.setSelectedItem=function(e){if(this.selectionModel_){var t=this.getSelectedItem();this.selectionModel_.setSelectedItem(e),e!=t&&this.dispatchEvent(goog.ui.Component.EventType.CHANGE)}},goog.ui.Select.prototype.setSelectedIndex=function(e){this.selectionModel_&&this.setSelectedItem(this.selectionModel_.getItemAt(e))},goog.ui.Select.prototype.setValue=function(e){if(null!=e&&this.selectionModel_)for(var t,o=0;t=this.selectionModel_.getItemAt(o);o++)if(t&&"function"==typeof t.getValue&&t.getValue()==e)return void this.setSelectedItem(t);this.setSelectedItem(null)},goog.ui.Select.prototype.getValue=function(){var e=this.getSelectedItem();return e?e.getValue():null},goog.ui.Select.prototype.getSelectedItem=function(){return this.selectionModel_?this.selectionModel_.getSelectedItem():null},goog.ui.Select.prototype.getSelectedIndex=function(){return this.selectionModel_?this.selectionModel_.getSelectedIndex():-1},goog.ui.Select.prototype.getSelectionModel=function(){return this.selectionModel_},goog.ui.Select.prototype.createSelectionModel_=function(e){this.selectionModel_=new goog.ui.SelectionModel,e&&e.forEachChild(function(e,t){this.setCorrectAriaRole_(e),this.selectionModel_.addItem(e)},this),this.listenToSelectionModelEvents_()},goog.ui.Select.prototype.listenToSelectionModelEvents_=function(){this.selectionModel_&&this.getHandler().listen(this.selectionModel_,goog.events.EventType.SELECT,this.handleSelectionChange)},goog.ui.Select.prototype.updateCaption=function(){var e=this.getSelectedItem();this.setContent(e?e.getCaption():this.defaultCaption_);var t=this.getRenderer().getContentElement(this.getElement());if(t&&this.getDomHelper().isElement(t)){null==this.initialAriaLabel_&&(this.initialAriaLabel_=goog.a11y.aria.getLabel(t));var o=e?e.getElement():null;goog.a11y.aria.setLabel(t,o?goog.a11y.aria.getLabel(o):this.initialAriaLabel_),this.updateAriaActiveDescendant_()}},goog.ui.Select.prototype.updateAriaActiveDescendant_=function(){var e=this.getRenderer();if(e){var t=e.getContentElement(this.getElement());if(t){var o=this.getElementStrict();if(t.id||(t.id=goog.ui.IdGenerator.getInstance().getNextUniqueId()),goog.a11y.aria.setRole(t,goog.a11y.aria.Role.OPTION),goog.a11y.aria.setState(o,goog.a11y.aria.State.ACTIVEDESCENDANT,t.id),this.selectionModel_){var i=this.selectionModel_.getItems();goog.a11y.aria.setState(t,goog.a11y.aria.State.SETSIZE,this.getNumMenuItems_(i));var l=this.selectionModel_.getSelectedIndex();goog.a11y.aria.setState(t,goog.a11y.aria.State.POSINSET,l>=0?this.getNumMenuItems_(goog.array.slice(i,0,l+1)):0)}}}},goog.ui.Select.prototype.getNumMenuItems_=function(e){return goog.array.count(e,function(e){return e instanceof goog.ui.MenuItem})},goog.ui.Select.prototype.setCorrectAriaRole_=function(e){e.setPreferredAriaRole(e instanceof goog.ui.MenuItem?goog.a11y.aria.Role.OPTION:goog.a11y.aria.Role.SEPARATOR)},goog.ui.Select.prototype.setOpen=function(e,t){goog.ui.Select.superClass_.setOpen.call(this,e,t),this.isOpen()?this.getMenu().setHighlightedIndex(this.getSelectedIndex()):this.updateAriaActiveDescendant_()},goog.ui.registry.setDecoratorByClassName(goog.getCssName("goog-select"),function(){return new goog.ui.Select(null)});