goog.provide("goog.format.HtmlPrettyPrinter"),goog.provide("goog.format.HtmlPrettyPrinter.Buffer"),goog.require("goog.dom.TagName"),goog.require("goog.object"),goog.require("goog.string.StringBuffer"),goog.format.HtmlPrettyPrinter=function(o){this.timeOutMillis_=o&&o>0?o:0},goog.format.HtmlPrettyPrinter.instance_=null,goog.format.HtmlPrettyPrinter.getInstance_=function(){return goog.format.HtmlPrettyPrinter.instance_||(goog.format.HtmlPrettyPrinter.instance_=new goog.format.HtmlPrettyPrinter),goog.format.HtmlPrettyPrinter.instance_},goog.format.HtmlPrettyPrinter.format=function(o){return goog.format.HtmlPrettyPrinter.getInstance_().format(o)},goog.format.HtmlPrettyPrinter.TOKEN_REGEX_=/(?:<!--.*?-->|<!.*?>|<(\/?)(\w+)[^<>]*>|[^<]+|<)/g,goog.format.HtmlPrettyPrinter.NON_PRETTY_PRINTED_TAGS_=goog.object.createSet(goog.dom.TagName.SCRIPT,goog.dom.TagName.STYLE,goog.dom.TagName.PRE,"XMP"),goog.format.HtmlPrettyPrinter.BLOCK_TAGS_=goog.object.createSet(goog.dom.TagName.ADDRESS,goog.dom.TagName.APPLET,goog.dom.TagName.AREA,goog.dom.TagName.BASE,goog.dom.TagName.BASEFONT,goog.dom.TagName.BLOCKQUOTE,goog.dom.TagName.BODY,goog.dom.TagName.CAPTION,goog.dom.TagName.CENTER,goog.dom.TagName.COL,goog.dom.TagName.COLGROUP,goog.dom.TagName.DIR,goog.dom.TagName.DIV,goog.dom.TagName.DL,goog.dom.TagName.FIELDSET,goog.dom.TagName.FORM,goog.dom.TagName.FRAME,goog.dom.TagName.FRAMESET,goog.dom.TagName.H1,goog.dom.TagName.H2,goog.dom.TagName.H3,goog.dom.TagName.H4,goog.dom.TagName.H5,goog.dom.TagName.H6,goog.dom.TagName.HEAD,goog.dom.TagName.HR,goog.dom.TagName.HTML,goog.dom.TagName.IFRAME,goog.dom.TagName.ISINDEX,goog.dom.TagName.LEGEND,goog.dom.TagName.LINK,goog.dom.TagName.MENU,goog.dom.TagName.META,goog.dom.TagName.NOFRAMES,goog.dom.TagName.NOSCRIPT,goog.dom.TagName.OL,goog.dom.TagName.OPTGROUP,goog.dom.TagName.OPTION,goog.dom.TagName.P,goog.dom.TagName.PARAM,goog.dom.TagName.TABLE,goog.dom.TagName.TBODY,goog.dom.TagName.TD,goog.dom.TagName.TFOOT,goog.dom.TagName.TH,goog.dom.TagName.THEAD,goog.dom.TagName.TITLE,goog.dom.TagName.TR,goog.dom.TagName.UL),goog.format.HtmlPrettyPrinter.BREAKS_FLOW_TAGS_=goog.object.createSet(goog.dom.TagName.BR,goog.dom.TagName.DD,goog.dom.TagName.DT,goog.dom.TagName.LI,goog.dom.TagName.NOFRAMES),goog.format.HtmlPrettyPrinter.EMPTY_TAGS_=goog.object.createSet(goog.dom.TagName.BR,goog.dom.TagName.HR,goog.dom.TagName.ISINDEX),goog.format.HtmlPrettyPrinter.prototype.format=function(o){o=(o=o.replace(/^\s*?( *\S)/,"$1")).replace(/\s+$/,"");for(var g,e=this.timeOutMillis_,t=e?goog.now():0,r=new goog.format.HtmlPrettyPrinter.Buffer,a=goog.format.HtmlPrettyPrinter.TOKEN_REGEX_,m=goog.format.HtmlPrettyPrinter.NON_PRETTY_PRINTED_TAGS_,n=goog.format.HtmlPrettyPrinter.BLOCK_TAGS_,T=goog.format.HtmlPrettyPrinter.BREAKS_FLOW_TAGS_,i=goog.format.HtmlPrettyPrinter.EMPTY_TAGS_,N=0,P=[];g=a.exec(o);){var f=g[0];if(3==g.length){var d=g[2];if(d&&(d=d.toUpperCase()),m.hasOwnProperty(d))if("/"==g[1]){var s=P.length;(s?P[s-1]:null)==d?(P.pop(),r.pushToken(!1,f,!P.length)):r.pushToken(!1,f,!1)}else r.pushToken(!P.length,f,!1),P.push(d);else if(P.length)r.pushToken(!1,f,!1);else if(n.hasOwnProperty(d)){var l=i.hasOwnProperty(d),u="/"==g[1];r.pushToken(l||!u,f,l||u)}else if(T.hasOwnProperty(d)){l=i.hasOwnProperty(d),u="/"==g[1];r.pushToken(!1,f,u||l)}else r.pushToken(!1,f,!1)}else r.pushToken(!1,f,!1);var p=a.lastIndex;if(!f||p<=N)throw new Error("Regex failed to make progress through source html.");if(N=p,e&&goog.now()-t>e){r.pushToken(!1,o.substring(a.lastIndex),!1),a.lastIndex=0;break}}r.lineBreak();var _=String(r),E=o.length+r.breakCount;if(_.length!=E)throw new Error("Lost data pretty printing html.");return _},goog.format.HtmlPrettyPrinter.Buffer=function(){this.out_=new goog.string.StringBuffer},goog.format.HtmlPrettyPrinter.Buffer.prototype.breakCount=0,goog.format.HtmlPrettyPrinter.Buffer.prototype.isBeginningOfNewLine_=!0,goog.format.HtmlPrettyPrinter.Buffer.prototype.needsNewLine_=!1,goog.format.HtmlPrettyPrinter.Buffer.prototype.pushToken=function(o,g,e){!this.needsNewLine_&&!o||/^\r?\n/.test(g)||/\/ul/i.test(g)||this.lineBreak(),this.out_.append(g),this.isBeginningOfNewLine_=/\r?\n$/.test(g),this.needsNewLine_=e&&!this.isBeginningOfNewLine_},goog.format.HtmlPrettyPrinter.Buffer.prototype.lineBreak=function(){this.isBeginningOfNewLine_||(this.out_.append("\n"),++this.breakCount)},goog.format.HtmlPrettyPrinter.Buffer.prototype.toString=function(){return this.out_.toString()};