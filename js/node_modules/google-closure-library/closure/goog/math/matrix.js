goog.provide("goog.math.Matrix"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.math"),goog.require("goog.math.Size"),goog.require("goog.string"),goog.math.Matrix=function(t,r){if(t instanceof goog.math.Matrix)this.array_=t.toArray();else if(goog.isArrayLike(t)&&goog.math.Matrix.isValidArray(t))this.array_=goog.array.clone(t);else if(t instanceof goog.math.Size)this.array_=goog.math.Matrix.createZeroPaddedArray_(t.height,t.width);else{if(!("number"==typeof t&&"number"==typeof r&&t>0&&r>0))throw new Error("Invalid argument(s) for Matrix contructor");this.array_=goog.math.Matrix.createZeroPaddedArray_(t,r)}this.size_=new goog.math.Size(this.array_[0].length,this.array_.length)},goog.math.Matrix.createIdentityMatrix=function(t){for(var r=[],i=0;i<t;i++){r[i]=[];for(var o=0;o<t;o++)r[i][o]=i==o?1:0}return new goog.math.Matrix(r)},goog.math.Matrix.forEach=function(t,r,i){for(var o=0;o<t.getSize().height;o++)for(var a=0;a<t.getSize().width;a++)r.call(i,t.array_[o][a],o,a,t)},goog.math.Matrix.isValidArray=function(t){for(var r=0,i=0;i<t.length;i++){if(!goog.isArrayLike(t[i])||r>0&&t[i].length!=r)return!1;for(var o=0;o<t[i].length;o++)if("number"!=typeof t[i][o])return!1;0==r&&(r=t[i].length)}return 0!=r},goog.math.Matrix.map=function(t,r,i){var o=new goog.math.Matrix(t.getSize());return goog.math.Matrix.forEach(t,function(a,e,h){o.array_[e][h]=r.call(i,a,e,h,t)}),o},goog.math.Matrix.createZeroPaddedArray_=function(t,r){for(var i=[],o=0;o<t;o++){i[o]=[];for(var a=0;a<r;a++)i[o][a]=0}return i},goog.math.Matrix.prototype.array_,goog.math.Matrix.prototype.size_,goog.math.Matrix.prototype.add=function(t){if(!goog.math.Size.equals(this.size_,t.getSize()))throw new Error("Matrix summation is only supported on arrays of equal size");return goog.math.Matrix.map(this,function(r,i,o){return r+t.array_[i][o]})},goog.math.Matrix.prototype.appendColumns=function(t){if(this.size_.height!=t.getSize().height)throw new Error("The given matrix has height "+t.size_.height+", but  needs to have height "+this.size_.height+".");var r=new goog.math.Matrix(this.size_.height,this.size_.width+t.size_.width);return goog.math.Matrix.forEach(this,function(t,i,o){r.array_[i][o]=t}),goog.math.Matrix.forEach(t,function(t,i,o){r.array_[i][this.size_.width+o]=t},this),r},goog.math.Matrix.prototype.appendRows=function(t){if(this.size_.width!=t.getSize().width)throw new Error("The given matrix has width "+t.size_.width+", but  needs to have width "+this.size_.width+".");var r=new goog.math.Matrix(this.size_.height+t.size_.height,this.size_.width);return goog.math.Matrix.forEach(this,function(t,i,o){r.array_[i][o]=t}),goog.math.Matrix.forEach(t,function(t,i,o){r.array_[this.size_.height+i][o]=t},this),r},goog.math.Matrix.prototype.equals=function(t,r){if(this.size_.width!=t.size_.width)return!1;if(this.size_.height!=t.size_.height)return!1;for(var i=r||0,o=0;o<this.size_.height;o++)for(var a=0;a<this.size_.width;a++)if(!goog.math.nearlyEquals(this.array_[o][a],t.array_[o][a],i))return!1;return!0},goog.math.Matrix.prototype.getDeterminant=function(){if(!this.isSquare())throw new Error("A determinant can only be take on a square matrix");return this.getDeterminant_()},goog.math.Matrix.prototype.getInverse=function(){if(!this.isSquare())throw new Error("An inverse can only be taken on a square matrix.");if(1==this.getSize().width){var t=this.getValueAt(0,0);return 0==t?null:new goog.math.Matrix([[1/Number(t)]])}var r=goog.math.Matrix.createIdentityMatrix(this.size_.height),i=this.appendColumns(r).getReducedRowEchelonForm();return i.getSubmatrixByCoordinates_(0,0,r.size_.width-1,r.size_.height-1).equals(r)?i.getSubmatrixByCoordinates_(0,r.size_.width):null},goog.math.Matrix.prototype.getReducedRowEchelonForm=function(){for(var t=new goog.math.Matrix(this),r=0,i=0;i<t.size_.height;i++){if(r>=t.size_.width)return t;for(var o=i;0==t.array_[o][r];)if(++o==t.size_.height&&(o=i,++r==t.size_.width))return t;this.swapRows_(o,i);for(var a=t.array_[i][r],e=r;e<t.size_.width;e++)t.array_[i][e]=t.array_[i][e]/a;for(o=0;o<t.size_.height;o++)if(o!=i){var h=t.array_[o][r];for(e=r;e<t.size_.width;e++)t.array_[o][e]-=h*t.array_[i][e]}r++}return t},goog.math.Matrix.prototype.getSize=function(){return this.size_},goog.math.Matrix.prototype.getTranspose=function(){var t=new goog.math.Matrix(this.size_.width,this.size_.height);return goog.math.Matrix.forEach(this,function(r,i,o){t.array_[o][i]=r}),t},goog.math.Matrix.prototype.getValueAt=function(t,r){return this.isInBounds_(t,r)?this.array_[t][r]:null},goog.math.Matrix.prototype.isSquare=function(){return this.size_.width==this.size_.height},goog.math.Matrix.prototype.setValueAt=function(t,r,i){if(!this.isInBounds_(t,r))throw new Error("Index out of bounds when setting matrix value, ("+t+","+r+") in size ("+this.size_.height+","+this.size_.width+")");this.array_[t][r]=i},goog.math.Matrix.prototype.multiply=function(t){if(t instanceof goog.math.Matrix){if(this.size_.width!=t.getSize().height)throw new Error("Invalid matrices for multiplication. Second matrix should have the same number of rows as the first has columns.");return this.matrixMultiply_(t)}if("number"==typeof t)return this.scalarMultiply_(t);throw new Error("A matrix can only be multiplied by a number or another matrix.")},goog.math.Matrix.prototype.subtract=function(t){if(!goog.math.Size.equals(this.size_,t.getSize()))throw new Error("Matrix subtraction is only supported on arrays of equal size.");return goog.math.Matrix.map(this,function(r,i,o){return r-t.array_[i][o]})},goog.math.Matrix.prototype.toArray=function(){return this.array_},goog.DEBUG&&(goog.math.Matrix.prototype.toString=function(){var t=0;goog.math.Matrix.forEach(this,function(r){var i=String(r).length;i>t&&(t=i)});var r=[];return goog.array.forEach(this.array_,function(i,o){r.push("[ "),goog.array.forEach(i,function(i,o){var a=String(i);r.push(goog.string.repeat(" ",t-a.length)+a+" ")}),r.push("]\n")}),r.join("")}),goog.math.Matrix.prototype.getCofactor_=function(t,r){return(t+r%2==0?1:-1)*this.getMinor_(t,r)},goog.math.Matrix.prototype.getDeterminant_=function(){if(1==this.getSize().area())return this.array_[0][0];for(var t=0,r=0;r<this.size_.width;r++)t+=this.array_[0][r]*this.getCofactor_(0,r);return t},goog.math.Matrix.prototype.getMinor_=function(t,r){return this.getSubmatrixByDeletion_(t,r).getDeterminant_()},goog.math.Matrix.prototype.getSubmatrixByCoordinates_=function(t,r,i,o){var a=i||this.size_.height-1,e=o||this.size_.width-1,h=new goog.math.Matrix(a-t+1,e-r+1);return goog.math.Matrix.forEach(h,function(i,o,a){h.array_[o][a]=this.array_[t+o][r+a]},this),h},goog.math.Matrix.prototype.getSubmatrixByDeletion_=function(t,r){var i=new goog.math.Matrix(this.size_.width-1,this.size_.height-1);return goog.math.Matrix.forEach(i,function(o,a,e){i.setValueAt(a,e,this.array_[a>=t?a+1:a][e>=r?e+1:e])},this),i},goog.math.Matrix.prototype.isInBounds_=function(t,r){return t>=0&&t<this.size_.height&&r>=0&&r<this.size_.width},goog.math.Matrix.prototype.matrixMultiply_=function(t){var r=new goog.math.Matrix(this.size_.height,t.getSize().width);return goog.math.Matrix.forEach(r,function(i,o,a){for(var e=0,h=0;h<this.size_.width;h++)e+=goog.asserts.assertNumber(this.getValueAt(o,h))*goog.asserts.assertNumber(t.getValueAt(h,a));r.setValueAt(o,a,e)},this),r},goog.math.Matrix.prototype.scalarMultiply_=function(t){return goog.math.Matrix.map(this,function(r,i,o){return r*t})},goog.math.Matrix.prototype.swapRows_=function(t,r){var i=this.array_[t];this.array_[t]=this.array_[r],this.array_[r]=i};