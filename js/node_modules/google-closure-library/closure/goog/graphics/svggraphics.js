goog.provide("goog.graphics.SvgGraphics"),goog.require("goog.Timer"),goog.require("goog.dom"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventType"),goog.require("goog.graphics.AbstractGraphics"),goog.require("goog.graphics.Font"),goog.require("goog.graphics.LinearGradient"),goog.require("goog.graphics.Path"),goog.require("goog.graphics.SolidFill"),goog.require("goog.graphics.Stroke"),goog.require("goog.graphics.SvgEllipseElement"),goog.require("goog.graphics.SvgGroupElement"),goog.require("goog.graphics.SvgImageElement"),goog.require("goog.graphics.SvgPathElement"),goog.require("goog.graphics.SvgRectElement"),goog.require("goog.graphics.SvgTextElement"),goog.require("goog.math"),goog.require("goog.math.Size"),goog.require("goog.style"),goog.require("goog.userAgent"),goog.graphics.SvgGraphics=function(e,t,o,g,i){goog.graphics.AbstractGraphics.call(this,e,t,o,g,i),this.defs_={},this.useManualViewbox_=goog.userAgent.WEBKIT&&!goog.userAgent.isVersionOrHigher(526),this.handler_=new goog.events.EventHandler(this)},goog.inherits(goog.graphics.SvgGraphics,goog.graphics.AbstractGraphics),goog.graphics.SvgGraphics.SVG_NS_="http://www.w3.org/2000/svg",goog.graphics.SvgGraphics.DEF_ID_PREFIX_="_svgdef_",goog.graphics.SvgGraphics.nextDefId_=0,goog.graphics.SvgGraphics.prototype.defsElement_,goog.graphics.SvgGraphics.prototype.createSvgElement_=function(e,t){var o=this.dom_.getDocument().createElementNS(goog.graphics.SvgGraphics.SVG_NS_,e);return t&&this.setElementAttributes(o,t),o},goog.graphics.SvgGraphics.prototype.setElementAttributes=function(e,t){for(var o in t)e.setAttribute(o,t[o])},goog.graphics.SvgGraphics.prototype.append_=function(e,t){(t||this.canvasElement).getElement().appendChild(e.getElement())},goog.graphics.SvgGraphics.prototype.setElementFill=function(e,t){var o=e.getElement();if(t instanceof goog.graphics.SolidFill)o.setAttribute("fill",t.getColor()),o.setAttribute("fill-opacity",t.getOpacity());else if(t instanceof goog.graphics.LinearGradient){var g="lg-"+t.getX1()+"-"+t.getY1()+"-"+t.getX2()+"-"+t.getY2()+"-"+t.getColor1()+"-"+t.getColor2(),i=this.getDef(g);if(!i){var r=this.createSvgElement_("linearGradient",{x1:t.getX1(),y1:t.getY1(),x2:t.getX2(),y2:t.getY2(),gradientUnits:"userSpaceOnUse"}),s="stop-color:"+t.getColor1();"number"==typeof t.getOpacity1()&&(s+=";stop-opacity:"+t.getOpacity1());var a=this.createSvgElement_("stop",{offset:"0%",style:s});r.appendChild(a),s="stop-color:"+t.getColor2(),"number"==typeof t.getOpacity2()&&(s+=";stop-opacity:"+t.getOpacity2());var h=this.createSvgElement_("stop",{offset:"100%",style:s});r.appendChild(h),i=this.addDef(g,r)}o.setAttribute("fill","url(#"+i+")")}else o.setAttribute("fill","none")},goog.graphics.SvgGraphics.prototype.setElementStroke=function(e,t){var o=e.getElement();if(t){o.setAttribute("stroke",t.getColor()),o.setAttribute("stroke-opacity",t.getOpacity());var g=t.getWidth();"string"==typeof g&&-1!=g.indexOf("px")?o.setAttribute("stroke-width",parseFloat(g)/this.getPixelScaleX()):o.setAttribute("stroke-width",g)}else o.setAttribute("stroke","none")},goog.graphics.SvgGraphics.prototype.setElementTransform=function(e,t,o,g,i,r){e.getElement().setAttribute("transform","translate("+t+","+o+") rotate("+g+" "+i+" "+r+")")},goog.graphics.SvgGraphics.prototype.setElementAffineTransform=function(e,t){var o=t,g=[o.getScaleX(),o.getShearY(),o.getShearX(),o.getScaleY(),o.getTranslateX(),o.getTranslateY()].join(",");e.getElement().setAttribute("transform","matrix("+g+")")},goog.graphics.SvgGraphics.prototype.createDom=function(){var e={width:this.width,height:this.height,overflow:"hidden"},t=this.createSvgElement_("svg",e),o=this.createSvgElement_("g");this.defsElement_=this.createSvgElement_("defs"),this.canvasElement=new goog.graphics.SvgGroupElement(o,this),t.appendChild(this.defsElement_),t.appendChild(o),this.setElementInternal(t),this.setViewBox_()},goog.graphics.SvgGraphics.prototype.setCoordOrigin=function(e,t){this.coordLeft=e,this.coordTop=t,this.setViewBox_()},goog.graphics.SvgGraphics.prototype.setCoordSize=function(e,t){goog.graphics.SvgGraphics.superClass_.setCoordSize.apply(this,arguments),this.setViewBox_()},goog.graphics.SvgGraphics.prototype.getViewBox_=function(){return this.coordLeft+" "+this.coordTop+" "+(this.coordWidth?this.coordWidth+" "+this.coordHeight:"")},goog.graphics.SvgGraphics.prototype.setViewBox_=function(){(this.coordWidth||this.coordLeft||this.coordTop)&&(this.getElement().setAttribute("preserveAspectRatio","none"),this.useManualViewbox_?this.updateManualViewBox_():this.getElement().setAttribute("viewBox",this.getViewBox_()))},goog.graphics.SvgGraphics.prototype.updateManualViewBox_=function(){if(this.isInDocument()&&(this.coordWidth||this.coordLeft||!this.coordTop)){var e=this.getPixelSize();if(0!=e.width){this.getElement().style.visibility="";var t=-this.coordLeft,o=-this.coordTop,g=e.width/this.coordWidth,i=e.height/this.coordHeight;this.canvasElement.getElement().setAttribute("transform","scale("+g+" "+i+") translate("+t+" "+o+")")}else this.getElement().style.visibility="hidden"}},goog.graphics.SvgGraphics.prototype.setSize=function(e,t){goog.style.setSize(this.getElement(),e,t)},goog.graphics.SvgGraphics.prototype.getPixelSize=function(){if(!goog.userAgent.GECKO)return this.isInDocument()?goog.style.getSize(this.getElement()):goog.graphics.SvgGraphics.base(this,"getPixelSize");var e,t,o=this.width,g=this.height,i="string"==typeof o&&-1!=o.indexOf("%"),r="string"==typeof g&&-1!=g.indexOf("%");return this.isInDocument()||!i&&!r?(i&&(e=this.getElement().parentNode,t=goog.style.getSize(e),o=parseFloat(o)*t.width/100),r&&(e=e||this.getElement().parentNode,t=t||goog.style.getSize(e),g=parseFloat(g)*t.height/100),new goog.math.Size(o,g)):null},goog.graphics.SvgGraphics.prototype.clear=function(){this.canvasElement.clear(),goog.dom.removeChildren(this.defsElement_),this.defs_={}},goog.graphics.SvgGraphics.prototype.drawEllipse=function(e,t,o,g,i,r,s){var a=this.createSvgElement_("ellipse",{cx:e,cy:t,rx:o,ry:g}),h=new goog.graphics.SvgEllipseElement(a,this,i,r);return this.append_(h,s),h},goog.graphics.SvgGraphics.prototype.drawRect=function(e,t,o,g,i,r,s){var a=this.createSvgElement_("rect",{x:e,y:t,width:o,height:g}),h=new goog.graphics.SvgRectElement(a,this,i,r);return this.append_(h,s),h},goog.graphics.SvgGraphics.prototype.drawImage=function(e,t,o,g,i,r){var s=this.createSvgElement_("image",{x:e,y:t,width:o,height:g,"image-rendering":"optimizeQuality",preserveAspectRatio:"none"});s.setAttributeNS("http://www.w3.org/1999/xlink","href",i);var a=new goog.graphics.SvgImageElement(s,this);return this.append_(a,r),a},goog.graphics.SvgGraphics.prototype.drawTextOnLine=function(e,t,o,g,i,r,s,a,h,n){var p=Math.round(goog.math.angle(t,o,g,i)),c=g-t,l=i-o,u=Math.round(Math.sqrt(c*c+l*l)),d=s.size,v={"font-family":s.family,"font-size":d},m=Math.round(.85*d),S=Math.round(o-d/2+m),f=t;"center"==r?(f+=Math.round(u/2),v["text-anchor"]="middle"):"right"==r&&(f+=u,v["text-anchor"]="end"),v.x=f,v.y=S,s.bold&&(v["font-weight"]="bold"),s.italic&&(v["font-style"]="italic"),0!=p&&(v.transform="rotate("+p+" "+t+" "+o+")");var E=this.createSvgElement_("text",v);if(E.appendChild(this.dom_.getDocument().createTextNode(e)),null==a&&goog.userAgent.GECKO&&goog.userAgent.MAC){var _="black";h instanceof goog.graphics.SolidFill&&(_=h.getColor()),a=new goog.graphics.Stroke(1,_)}var y=new goog.graphics.SvgTextElement(E,this,a,h);return this.append_(y,n),y},goog.graphics.SvgGraphics.prototype.drawPath=function(e,t,o,g){var i=this.createSvgElement_("path",{d:goog.graphics.SvgGraphics.getSvgPath(e)}),r=new goog.graphics.SvgPathElement(i,this,t,o);return this.append_(r,g),r},goog.graphics.SvgGraphics.getSvgPath=function(e){var t=[];return e.forEachSegment(function(e,o){switch(e){case goog.graphics.Path.Segment.MOVETO:t.push("M"),Array.prototype.push.apply(t,o);break;case goog.graphics.Path.Segment.LINETO:t.push("L"),Array.prototype.push.apply(t,o);break;case goog.graphics.Path.Segment.CURVETO:t.push("C"),Array.prototype.push.apply(t,o);break;case goog.graphics.Path.Segment.ARCTO:var g=o[3];t.push("A",o[0],o[1],0,Math.abs(g)>180?1:0,g>0?1:0,o[4],o[5]);break;case goog.graphics.Path.Segment.CLOSE:t.push("Z")}}),t.join(" ")},goog.graphics.SvgGraphics.prototype.createGroup=function(e){var t=this.createSvgElement_("g");return(e||this.canvasElement).getElement().appendChild(t),new goog.graphics.SvgGroupElement(t,this)},goog.graphics.SvgGraphics.prototype.getTextWidth=function(e,t){throw new Error("unimplemented method")},goog.graphics.SvgGraphics.prototype.addDef=function(e,t){if(e in this.defs_)return this.defs_[e];var o=goog.graphics.SvgGraphics.DEF_ID_PREFIX_+goog.graphics.SvgGraphics.nextDefId_++;return t.setAttribute("id",o),this.defs_[e]=o,this.defsElement_.appendChild(t),o},goog.graphics.SvgGraphics.prototype.getDef=function(e){return e in this.defs_?this.defs_[e]:null},goog.graphics.SvgGraphics.prototype.removeDef=function(e){var t=this.getDef(e);if(t){var o=this.dom_.getElement(t);this.defsElement_.removeChild(o),delete this.defs_[e]}},goog.graphics.SvgGraphics.prototype.enterDocument=function(){var e=this.getPixelSize();if(goog.graphics.SvgGraphics.superClass_.enterDocument.call(this),e||this.dispatchEvent(goog.events.EventType.RESIZE),this.useManualViewbox_){var t=this.width,o=this.height;"string"==typeof t&&-1!=t.indexOf("%")&&"string"==typeof o&&-1!=o.indexOf("%")&&this.handler_.listen(goog.graphics.SvgGraphics.getResizeCheckTimer_(),goog.Timer.TICK,this.updateManualViewBox_),this.updateManualViewBox_()}},goog.graphics.SvgGraphics.prototype.exitDocument=function(){goog.graphics.SvgGraphics.superClass_.exitDocument.call(this),this.useManualViewbox_&&this.handler_.unlisten(goog.graphics.SvgGraphics.getResizeCheckTimer_(),goog.Timer.TICK,this.updateManualViewBox_)},goog.graphics.SvgGraphics.prototype.disposeInternal=function(){delete this.defs_,delete this.defsElement_,delete this.canvasElement,this.handler_.dispose(),delete this.handler_,goog.graphics.SvgGraphics.superClass_.disposeInternal.call(this)},goog.graphics.SvgGraphics.resizeCheckTimer_,goog.graphics.SvgGraphics.getResizeCheckTimer_=function(){return goog.graphics.SvgGraphics.resizeCheckTimer_||(goog.graphics.SvgGraphics.resizeCheckTimer_=new goog.Timer(400),goog.graphics.SvgGraphics.resizeCheckTimer_.start()),goog.graphics.SvgGraphics.resizeCheckTimer_},goog.graphics.SvgGraphics.prototype.isDomClonable=function(){return!0};