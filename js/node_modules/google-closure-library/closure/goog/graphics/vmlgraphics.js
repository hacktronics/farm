if(goog.provide("goog.graphics.VmlGraphics"),goog.require("goog.array"),goog.require("goog.dom.TagName"),goog.require("goog.dom.safe"),goog.require("goog.events"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventType"),goog.require("goog.graphics.AbstractGraphics"),goog.require("goog.graphics.Font"),goog.require("goog.graphics.LinearGradient"),goog.require("goog.graphics.Path"),goog.require("goog.graphics.SolidFill"),goog.require("goog.graphics.VmlEllipseElement"),goog.require("goog.graphics.VmlGroupElement"),goog.require("goog.graphics.VmlImageElement"),goog.require("goog.graphics.VmlPathElement"),goog.require("goog.graphics.VmlRectElement"),goog.require("goog.graphics.VmlTextElement"),goog.require("goog.html.uncheckedconversions"),goog.require("goog.math"),goog.require("goog.math.Size"),goog.require("goog.reflect"),goog.require("goog.string"),goog.require("goog.string.Const"),goog.require("goog.style"),goog.require("goog.userAgent"),goog.graphics.VmlGraphics=function(o,e,t,g,i){goog.graphics.AbstractGraphics.call(this,o,e,t,g,i),this.handler_=new goog.events.EventHandler(this),this.registerDisposable(this.handler_)},goog.inherits(goog.graphics.VmlGraphics,goog.graphics.AbstractGraphics),goog.graphics.VmlGraphics.VML_PREFIX_="g_vml_",goog.graphics.VmlGraphics.VML_NS_="urn:schemas-microsoft-com:vml",goog.graphics.VmlGraphics.VML_IMPORT_="#default#VML",goog.graphics.VmlGraphics.IE8_MODE_=goog.global.document&&goog.global.document.documentMode&&goog.global.document.documentMode>=8,goog.graphics.VmlGraphics.COORD_MULTIPLIER=100,goog.graphics.VmlGraphics.toCssSize=function(o){return"string"==typeof o&&goog.string.endsWith(o,"%")?o:parseFloat(o.toString())+"px"},goog.graphics.VmlGraphics.toPosCoord=function(o){return Math.round((parseFloat(o.toString())-.5)*goog.graphics.VmlGraphics.COORD_MULTIPLIER)},goog.graphics.VmlGraphics.toPosPx=function(o){return goog.graphics.VmlGraphics.toPosCoord(o)+"px"},goog.graphics.VmlGraphics.toSizeCoord=function(o){return Math.round(parseFloat(o.toString())*goog.graphics.VmlGraphics.COORD_MULTIPLIER)},goog.graphics.VmlGraphics.toSizePx=function(o){return goog.graphics.VmlGraphics.toSizeCoord(o)+"px"},goog.graphics.VmlGraphics.setAttribute=function(o,e,t){goog.graphics.VmlGraphics.IE8_MODE_?o[e]=t:o.setAttribute(e,t)},goog.graphics.VmlGraphics.prototype.handler_,goog.graphics.VmlGraphics.prototype.createVmlElement=function(o){var e=this.dom_.createElement(goog.graphics.VmlGraphics.VML_PREFIX_+":"+o);return e.id=goog.string.createUniqueString(),e},goog.graphics.VmlGraphics.prototype.getVmlElement=function(o){return this.dom_.getElement(o)},goog.graphics.VmlGraphics.prototype.updateGraphics_=function(){if(goog.graphics.VmlGraphics.IE8_MODE_&&this.isInDocument()){var o=goog.html.uncheckedconversions.safeHtmlFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Assign innerHTML to itself"),this.getElement().innerHTML);goog.dom.safe.setInnerHtml(this.getElement(),o)}},goog.graphics.VmlGraphics.prototype.append_=function(o,e){(e||this.canvasElement).getElement().appendChild(o.getElement()),this.updateGraphics_()},goog.graphics.VmlGraphics.prototype.setElementFill=function(o,e){var t=o.getElement();if(goog.graphics.VmlGraphics.removeFill_(t),e instanceof goog.graphics.SolidFill)if("transparent"==e.getColor())t.filled=!1;else if(1!=e.getOpacity()){t.filled=!0;var g=this.createVmlElement("fill");g.opacity=Math.round(100*e.getOpacity())+"%",g.color=e.getColor(),t.appendChild(g)}else t.filled=!0,t.fillcolor=e.getColor();else if(e instanceof goog.graphics.LinearGradient){t.filled=!0;var i=this.createVmlElement("fill");i.color=e.getColor1(),i.color2=e.getColor2(),"number"==typeof e.getOpacity1()&&(i.opacity=e.getOpacity1()),"number"==typeof e.getOpacity2()&&(i.opacity2=e.getOpacity2());var r=goog.math.angle(e.getX1(),e.getY1(),e.getX2(),e.getY2());r=Math.round(goog.math.standardAngle(270-r)),i.angle=r,i.type="gradient",t.appendChild(i)}else t.filled=!1;this.updateGraphics_()},goog.graphics.VmlGraphics.prototype.setElementStroke=function(o,e){var t=o.getElement();if(e){t.stroked=!0;var g=e.getWidth();"string"==typeof g&&-1==g.indexOf("px")?g=parseFloat(g):g*=this.getPixelScaleX();var i=t.getElementsByTagName("stroke")[0];i||(i=i||this.createVmlElement("stroke"),t.appendChild(i)),i.opacity=e.getOpacity(),i.weight=g+"px",i.color=e.getColor()}else t.stroked=!1;this.updateGraphics_()},goog.graphics.VmlGraphics.prototype.setElementTransform=function(o,e,t,g,i,r){var a=o.getElement();a.style.left=goog.graphics.VmlGraphics.toPosPx(e),a.style.top=goog.graphics.VmlGraphics.toPosPx(t),(g||a.rotation)&&(a.rotation=g,a.coordsize=goog.graphics.VmlGraphics.toSizeCoord(2*i)+" "+goog.graphics.VmlGraphics.toSizeCoord(2*r))},goog.graphics.VmlGraphics.prototype.setElementAffineTransform=function(o,e){var t=e,g=o.getElement();goog.graphics.VmlGraphics.removeSkew_(g);var i=this.createVmlElement("skew");i.on="true",i.origin=-g.style.pixelLeft/g.style.pixelWidth-.5+","+(-g.style.pixelTop/g.style.pixelHeight-.5),i.offset=t.getTranslateX().toFixed(1)+"px,"+t.getTranslateY().toFixed(1)+"px",i.matrix=[t.getScaleX().toFixed(6),t.getShearX().toFixed(6),t.getShearY().toFixed(6),t.getScaleY().toFixed(6),0,0].join(","),g.appendChild(i),this.updateGraphics_()},goog.graphics.VmlGraphics.removeSkew_=function(o){goog.array.forEach(o.childNodes,function(e){"skew"==e.tagName&&o.removeChild(e)})},goog.graphics.VmlGraphics.removeFill_=function(o){o.fillcolor="",goog.array.forEach(o.childNodes,function(e){"fill"==e.tagName&&o.removeChild(e)})},goog.graphics.VmlGraphics.setPositionAndSize=function(o,e,t,g,i){var r=o.style;r.position="absolute",r.left=goog.graphics.VmlGraphics.toPosPx(e),r.top=goog.graphics.VmlGraphics.toPosPx(t),r.width=goog.graphics.VmlGraphics.toSizePx(g),r.height=goog.graphics.VmlGraphics.toSizePx(i),"shape"==o.tagName&&(o.coordsize=goog.graphics.VmlGraphics.toSizeCoord(g)+" "+goog.graphics.VmlGraphics.toSizeCoord(i))},goog.graphics.VmlGraphics.prototype.createFullSizeElement_=function(o){var e=this.createVmlElement(o),t=this.getCoordSize();return goog.graphics.VmlGraphics.setPositionAndSize(e,0,0,t.width,t.height),e},goog.userAgent.IE)try{goog.reflect.sinkValue(document.namespaces)}catch(o){}goog.graphics.VmlGraphics.prototype.createDom=function(){var o=this.dom_.getDocument();o.namespaces[goog.graphics.VmlGraphics.VML_PREFIX_]||(goog.graphics.VmlGraphics.IE8_MODE_?o.namespaces.add(goog.graphics.VmlGraphics.VML_PREFIX_,goog.graphics.VmlGraphics.VML_NS_,goog.graphics.VmlGraphics.VML_IMPORT_):o.namespaces.add(goog.graphics.VmlGraphics.VML_PREFIX_,goog.graphics.VmlGraphics.VML_NS_),o.createStyleSheet().cssText=goog.graphics.VmlGraphics.VML_PREFIX_+"\\:*{behavior:url(#default#VML)}");var e=this.width,t=this.height,g=this.dom_.createDom(goog.dom.TagName.DIV,{style:"overflow:hidden;position:relative;width:"+goog.graphics.VmlGraphics.toCssSize(e)+";height:"+goog.graphics.VmlGraphics.toCssSize(t)});this.setElementInternal(g);var i=this.createVmlElement("group"),r=i.style;r.position="absolute",r.left=r.top="0",r.width=this.width,r.height=this.height,this.coordWidth?i.coordsize=goog.graphics.VmlGraphics.toSizeCoord(this.coordWidth)+" "+goog.graphics.VmlGraphics.toSizeCoord(this.coordHeight):i.coordsize=goog.graphics.VmlGraphics.toSizeCoord(e)+" "+goog.graphics.VmlGraphics.toSizeCoord(t),void 0!==this.coordLeft?i.coordorigin=goog.graphics.VmlGraphics.toSizeCoord(this.coordLeft)+" "+goog.graphics.VmlGraphics.toSizeCoord(this.coordTop):i.coordorigin="0 0",g.appendChild(i),this.canvasElement=new goog.graphics.VmlGroupElement(i,this),goog.events.listen(g,goog.events.EventType.RESIZE,goog.bind(this.handleContainerResize_,this))},goog.graphics.VmlGraphics.prototype.handleContainerResize_=function(){var o=goog.style.getSize(this.getElement()),e=this.canvasElement.getElement().style;if(o.width)e.width=o.width+"px",e.height=o.height+"px";else{for(var t=this.getElement();t&&t.currentStyle&&"none"!=t.currentStyle.display;)t=t.parentNode;t&&t.currentStyle&&this.handler_.listen(t,"propertychange",this.handleContainerResize_)}this.dispatchEvent(goog.events.EventType.RESIZE)},goog.graphics.VmlGraphics.prototype.handlePropertyChange_=function(o){var e=o.getBrowserEvent().propertyName;"display"!=e&&"className"!=e||(this.handler_.unlisten(o.target,"propertychange",this.handlePropertyChange_),this.handleContainerResize_())},goog.graphics.VmlGraphics.prototype.setCoordOrigin=function(o,e){this.coordLeft=o,this.coordTop=e,this.canvasElement.getElement().coordorigin=goog.graphics.VmlGraphics.toSizeCoord(this.coordLeft)+" "+goog.graphics.VmlGraphics.toSizeCoord(this.coordTop)},goog.graphics.VmlGraphics.prototype.setCoordSize=function(o,e){goog.graphics.VmlGraphics.superClass_.setCoordSize.apply(this,arguments),this.canvasElement.getElement().coordsize=goog.graphics.VmlGraphics.toSizeCoord(o)+" "+goog.graphics.VmlGraphics.toSizeCoord(e)},goog.graphics.VmlGraphics.prototype.setSize=function(o,e){goog.style.setSize(this.getElement(),o,e)},goog.graphics.VmlGraphics.prototype.getPixelSize=function(){var o=this.getElement();return new goog.math.Size(o.style.pixelWidth||o.offsetWidth||1,o.style.pixelHeight||o.offsetHeight||1)},goog.graphics.VmlGraphics.prototype.clear=function(){this.canvasElement.clear()},goog.graphics.VmlGraphics.prototype.drawEllipse=function(o,e,t,g,i,r,a){var s=this.createVmlElement("oval");goog.graphics.VmlGraphics.setPositionAndSize(s,o-t,e-g,2*t,2*g);var h=new goog.graphics.VmlEllipseElement(s,this,o,e,t,g,i,r);return this.append_(h,a),h},goog.graphics.VmlGraphics.prototype.drawRect=function(o,e,t,g,i,r,a){var s=this.createVmlElement("rect");goog.graphics.VmlGraphics.setPositionAndSize(s,o,e,t,g);var h=new goog.graphics.VmlRectElement(s,this,i,r);return this.append_(h,a),h},goog.graphics.VmlGraphics.prototype.drawImage=function(o,e,t,g,i,r){var a=this.createVmlElement("image");goog.graphics.VmlGraphics.setPositionAndSize(a,o,e,t,g),goog.graphics.VmlGraphics.setAttribute(a,"src",i);var s=new goog.graphics.VmlImageElement(a,this);return this.append_(s,r),s},goog.graphics.VmlGraphics.prototype.drawTextOnLine=function(o,e,t,g,i,r,a,s,h,p){var c=this.createFullSizeElement_("shape"),l=this.createVmlElement("path"),n="M"+goog.graphics.VmlGraphics.toPosCoord(e)+","+goog.graphics.VmlGraphics.toPosCoord(t)+"L"+goog.graphics.VmlGraphics.toPosCoord(g)+","+goog.graphics.VmlGraphics.toPosCoord(i)+"E";goog.graphics.VmlGraphics.setAttribute(l,"v",n),goog.graphics.VmlGraphics.setAttribute(l,"textpathok","true");var m=this.createVmlElement("textpath");m.setAttribute("on","true");var d=m.style;d.fontSize=a.size*this.getPixelScaleX(),d.fontFamily=a.family,null!=r&&(d["v-text-align"]=r),a.bold&&(d.fontWeight="bold"),a.italic&&(d.fontStyle="italic"),goog.graphics.VmlGraphics.setAttribute(m,"string",o),c.appendChild(l),c.appendChild(m);var u=new goog.graphics.VmlTextElement(c,this,s,h);return this.append_(u,p),u},goog.graphics.VmlGraphics.prototype.drawPath=function(o,e,t,g){var i=this.createFullSizeElement_("shape");goog.graphics.VmlGraphics.setAttribute(i,"path",goog.graphics.VmlGraphics.getVmlPath(o));var r=new goog.graphics.VmlPathElement(i,this,e,t);return this.append_(r,g),r},goog.graphics.VmlGraphics.getVmlPath=function(o){var e=[];return o.forEachSegment(function(o,t){switch(o){case goog.graphics.Path.Segment.MOVETO:e.push("m"),Array.prototype.push.apply(e,goog.array.map(t,goog.graphics.VmlGraphics.toSizeCoord));break;case goog.graphics.Path.Segment.LINETO:e.push("l"),Array.prototype.push.apply(e,goog.array.map(t,goog.graphics.VmlGraphics.toSizeCoord));break;case goog.graphics.Path.Segment.CURVETO:e.push("c"),Array.prototype.push.apply(e,goog.array.map(t,goog.graphics.VmlGraphics.toSizeCoord));break;case goog.graphics.Path.Segment.CLOSE:e.push("x");break;case goog.graphics.Path.Segment.ARCTO:var g=t[2]+t[3],i=goog.graphics.VmlGraphics.toSizeCoord(t[4]-goog.math.angleDx(g,t[0])),r=goog.graphics.VmlGraphics.toSizeCoord(t[5]-goog.math.angleDy(g,t[1])),a=goog.graphics.VmlGraphics.toSizeCoord(t[0]),s=goog.graphics.VmlGraphics.toSizeCoord(t[1]),h=Math.round(-65536*t[2]),p=Math.round(-65536*t[3]);e.push("ae",i,r,a,s,h,p)}}),e.join(" ")},goog.graphics.VmlGraphics.prototype.createGroup=function(o){var e=this.createFullSizeElement_("group");return(o||this.canvasElement).getElement().appendChild(e),new goog.graphics.VmlGroupElement(e,this)},goog.graphics.VmlGraphics.prototype.getTextWidth=function(o,e){return 0},goog.graphics.VmlGraphics.prototype.enterDocument=function(){goog.graphics.VmlGraphics.superClass_.enterDocument.call(this),this.handleContainerResize_(),this.updateGraphics_()},goog.graphics.VmlGraphics.prototype.disposeInternal=function(){this.canvasElement=null,goog.graphics.VmlGraphics.superClass_.disposeInternal.call(this)};