goog.provide("goog.Timer"),goog.require("goog.Promise"),goog.require("goog.events.EventTarget"),goog.Timer=function(t,e){goog.events.EventTarget.call(this),this.interval_=t||1,this.timerObject_=e||goog.Timer.defaultTimerObject,this.boundTick_=goog.bind(this.tick_,this),this.last_=goog.now()},goog.inherits(goog.Timer,goog.events.EventTarget),goog.Timer.MAX_TIMEOUT_=2147483647,goog.Timer.INVALID_TIMEOUT_ID_=-1,goog.Timer.prototype.enabled=!1,goog.Timer.defaultTimerObject=goog.global,goog.Timer.intervalScale=.8,goog.Timer.prototype.timer_=null,goog.Timer.prototype.getInterval=function(){return this.interval_},goog.Timer.prototype.setInterval=function(t){this.interval_=t,this.timer_&&this.enabled?(this.stop(),this.start()):this.timer_&&this.stop()},goog.Timer.prototype.tick_=function(){if(this.enabled){var t=goog.now()-this.last_;if(t>0&&t<this.interval_*goog.Timer.intervalScale)return void(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_-t));this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null),this.dispatchTick(),this.enabled&&(this.stop(),this.start())}},goog.Timer.prototype.dispatchTick=function(){this.dispatchEvent(goog.Timer.TICK)},goog.Timer.prototype.start=function(){this.enabled=!0,this.timer_||(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=goog.now())},goog.Timer.prototype.stop=function(){this.enabled=!1,this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null)},goog.Timer.prototype.disposeInternal=function(){goog.Timer.superClass_.disposeInternal.call(this),this.stop(),delete this.timerObject_},goog.Timer.TICK="tick",goog.Timer.callOnce=function(t,e,i){if(goog.isFunction(t))i&&(t=goog.bind(t,i));else{if(!t||"function"!=typeof t.handleEvent)throw new Error("Invalid listener argument");t=goog.bind(t.handleEvent,t)}return Number(e)>goog.Timer.MAX_TIMEOUT_?goog.Timer.INVALID_TIMEOUT_ID_:goog.Timer.defaultTimerObject.setTimeout(t,e||0)},goog.Timer.clear=function(t){goog.Timer.defaultTimerObject.clearTimeout(t)},goog.Timer.promise=function(t,e){var i=null;return new goog.Promise(function(o,r){(i=goog.Timer.callOnce(function(){o(e)},t))==goog.Timer.INVALID_TIMEOUT_ID_&&r(new Error("Failed to schedule timer."))}).thenCatch(function(t){throw goog.Timer.clear(i),t})};