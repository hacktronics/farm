goog.provide("goog.editor.plugins.FirstStrong"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.TagIterator"),goog.require("goog.dom.TagName"),goog.require("goog.editor.Command"),goog.require("goog.editor.Field"),goog.require("goog.editor.Plugin"),goog.require("goog.editor.node"),goog.require("goog.editor.range"),goog.require("goog.i18n.bidi"),goog.require("goog.i18n.uChar"),goog.require("goog.iter"),goog.require("goog.userAgent"),goog.editor.plugins.FirstStrong=function(){goog.editor.plugins.FirstStrong.base(this,"constructor"),this.isNewBlock_=!0,this.switchToRtl_=!1,this.switchToLtr_=!1},goog.inherits(goog.editor.plugins.FirstStrong,goog.editor.Plugin),goog.editor.plugins.FirstStrong.prototype.getTrogClassId=function(){return"FirstStrong"},goog.editor.plugins.FirstStrong.prototype.queryCommandValue=function(o){return!1},goog.editor.plugins.FirstStrong.prototype.handleSelectionChange=function(o,t){return this.isNewBlock_=!0,!1},goog.editor.plugins.FirstStrong.INPUT_ATTRIBUTE="fs-input",goog.editor.plugins.FirstStrong.prototype.handleKeyPress=function(o){if(goog.editor.Field.SELECTION_CHANGE_KEYCODES[o.keyCode])return this.isNewBlock_=!0,!1;if(!this.isNewBlock_)return!1;if(o.ctrlKey||o.metaKey)return!1;var t=goog.i18n.uChar.fromCharCode(o.charCode);if(!t||!o.charCode){var g=o.getBrowserEvent();g&&(t=goog.userAgent.IE&&g.getAttribute?g.getAttribute(goog.editor.plugins.FirstStrong.INPUT_ATTRIBUTE):g[goog.editor.plugins.FirstStrong.INPUT_ATTRIBUTE])}if(!t)return!1;var i=goog.i18n.bidi.isLtrChar(t),r=!i&&goog.i18n.bidi.isRtlChar(t);return!(!i&&!r)&&(this.isNewBlock_=!1,this.isNeutralBlock_()&&(this.switchToRtl_=r,this.switchToLtr_=i),!1)},goog.editor.plugins.FirstStrong.prototype.handleKeyUp=function(o){if(this.switchToRtl_)(t=this.getFieldObject()).dispatchChange(!0),t.execCommand(goog.editor.Command.DIR_RTL),this.switchToRtl_=!1;else if(this.switchToLtr_){var t;(t=this.getFieldObject()).dispatchChange(!0),t.execCommand(goog.editor.Command.DIR_LTR),this.switchToLtr_=!1}return!1},goog.editor.plugins.FirstStrong.prototype.getBlockAncestor_=function(){for(var o=this.getFieldObject().getRange().getStartNode();!goog.editor.plugins.FirstStrong.isBlock_(o);)o=o.parentNode;return o},goog.editor.plugins.FirstStrong.prototype.isNeutralBlock_=function(){var o=this.getBlockAncestor_(),t=goog.editor.range.getDeepEndPoint(this.getFieldObject().getRange(),!1).node,g=goog.userAgent.GECKO&&!this.isList_(o)?goog.editor.plugins.FirstStrong.isGeckoBlock_:goog.editor.plugins.FirstStrong.isBlock_,i=this.getTextAround_(o,t,g);return!goog.i18n.bidi.hasAnyLtr(i)&&!goog.i18n.bidi.hasAnyRtl(i)},goog.editor.plugins.FirstStrong.prototype.isList_=function(o){if(!o)return!1;var t=o.tagName;return t==goog.dom.TagName.UL||t==goog.dom.TagName.OL},goog.editor.plugins.FirstStrong.prototype.getTextAround_=function(o,t,g){var i=[],r=!1;return o&&t&&goog.iter.some(new goog.dom.TagIterator(o),function(o){if(o==t)r=!0;else if(g(o)){if(r)return!0;i=[]}return o.nodeType==goog.dom.NodeType.TEXT&&i.push(o.nodeValue),!1}),i.join("")},goog.editor.plugins.FirstStrong.isBlock_=function(o){return!!o&&goog.editor.node.isBlockTag(o)&&o.tagName!=goog.dom.TagName.LI},goog.editor.plugins.FirstStrong.isGeckoBlock_=function(o){return!!o&&(o.tagName==goog.dom.TagName.BR||goog.editor.plugins.FirstStrong.isBlock_(o))};