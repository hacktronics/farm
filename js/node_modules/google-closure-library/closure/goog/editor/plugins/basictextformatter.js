goog.provide("goog.editor.plugins.BasicTextFormatter"),goog.provide("goog.editor.plugins.BasicTextFormatter.COMMAND"),goog.require("goog.array"),goog.require("goog.dom"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.Range"),goog.require("goog.dom.TagName"),goog.require("goog.editor.BrowserFeature"),goog.require("goog.editor.Command"),goog.require("goog.editor.Link"),goog.require("goog.editor.Plugin"),goog.require("goog.editor.node"),goog.require("goog.editor.range"),goog.require("goog.editor.style"),goog.require("goog.iter"),goog.require("goog.iter.StopIteration"),goog.require("goog.log"),goog.require("goog.object"),goog.require("goog.string"),goog.require("goog.string.Unicode"),goog.require("goog.style"),goog.require("goog.ui.editor.messages"),goog.require("goog.userAgent"),goog.editor.plugins.BasicTextFormatter=function(){goog.editor.Plugin.call(this)},goog.inherits(goog.editor.plugins.BasicTextFormatter,goog.editor.Plugin),goog.editor.plugins.BasicTextFormatter.prototype.getTrogClassId=function(){return"BTF"},goog.editor.plugins.BasicTextFormatter.prototype.logger=goog.log.getLogger("goog.editor.plugins.BasicTextFormatter"),goog.editor.plugins.BasicTextFormatter.COMMAND={LINK:"+link",CREATE_LINK:"+createLink",FORMAT_BLOCK:"+formatBlock",INDENT:"+indent",OUTDENT:"+outdent",STRIKE_THROUGH:"+strikeThrough",HORIZONTAL_RULE:"+insertHorizontalRule",SUBSCRIPT:"+subscript",SUPERSCRIPT:"+superscript",UNDERLINE:"+underline",BOLD:"+bold",ITALIC:"+italic",FONT_SIZE:"+fontSize",FONT_FACE:"+fontName",FONT_COLOR:"+foreColor",BACKGROUND_COLOR:"+backColor",ORDERED_LIST:"+insertOrderedList",UNORDERED_LIST:"+insertUnorderedList",JUSTIFY_CENTER:"+justifyCenter",JUSTIFY_FULL:"+justifyFull",JUSTIFY_RIGHT:"+justifyRight",JUSTIFY_LEFT:"+justifyLeft"},goog.editor.plugins.BasicTextFormatter.SUPPORTED_COMMANDS_=goog.object.transpose(goog.editor.plugins.BasicTextFormatter.COMMAND),goog.editor.plugins.BasicTextFormatter.prototype.isSupportedCommand=function(e){return e in goog.editor.plugins.BasicTextFormatter.SUPPORTED_COMMANDS_},goog.editor.plugins.BasicTextFormatter.SILENT_COMMANDS_=[goog.editor.plugins.BasicTextFormatter.COMMAND.CREATE_LINK],goog.editor.plugins.BasicTextFormatter.prototype.isSilentCommand=function(e){return goog.array.contains(goog.editor.plugins.BasicTextFormatter.SILENT_COMMANDS_,e)},goog.editor.plugins.BasicTextFormatter.prototype.getRange_=function(){return this.getFieldObject().getRange()},goog.editor.plugins.BasicTextFormatter.prototype.getDocument_=function(){return this.getFieldDomHelper().getDocument()},goog.editor.plugins.BasicTextFormatter.prototype.execCommandInternal=function(e,o){var t,r,g,i,a,n=arguments[1];switch(e){case goog.editor.plugins.BasicTextFormatter.COMMAND.BACKGROUND_COLOR:null!==n&&(goog.editor.BrowserFeature.EATS_EMPTY_BACKGROUND_COLOR?this.applyBgColorManually_(n):goog.userAgent.OPERA?this.execCommandHelper_("hiliteColor",n):this.execCommandHelper_(e,n));break;case goog.editor.plugins.BasicTextFormatter.COMMAND.CREATE_LINK:a=this.createLink_(arguments[1],arguments[2],arguments[3]);break;case goog.editor.plugins.BasicTextFormatter.COMMAND.LINK:a=this.toggleLink_(n);break;case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_CENTER:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_FULL:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_RIGHT:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_LEFT:this.justify_(e);break;default:if(goog.userAgent.IE&&e==goog.editor.plugins.BasicTextFormatter.COMMAND.FORMAT_BLOCK&&n&&(n="<"+n+">"),e==goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_COLOR&&null===n)break;switch(e){case goog.editor.plugins.BasicTextFormatter.COMMAND.INDENT:case goog.editor.plugins.BasicTextFormatter.COMMAND.OUTDENT:goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&(goog.userAgent.GECKO&&(r=!0),goog.userAgent.OPERA&&(r=e!=goog.editor.plugins.BasicTextFormatter.COMMAND.OUTDENT||!this.getDocument_().queryCommandEnabled("outdent")));case goog.editor.plugins.BasicTextFormatter.COMMAND.ORDERED_LIST:case goog.editor.plugins.BasicTextFormatter.COMMAND.UNORDERED_LIST:goog.editor.BrowserFeature.LEAVES_P_WHEN_REMOVING_LISTS&&this.queryCommandStateInternal_(this.getDocument_(),e)?g=this.getFieldObject().queryCommandValue(goog.editor.Command.DEFAULT_TAG)!=goog.dom.TagName.P:goog.editor.BrowserFeature.CAN_LISTIFY_BR||this.convertBreaksToDivs_(),goog.userAgent.GECKO&&goog.editor.BrowserFeature.FORGETS_FORMATTING_WHEN_LISTIFYING&&!this.queryCommandValue(e)&&(i|=this.beforeInsertListGecko_());case goog.editor.plugins.BasicTextFormatter.COMMAND.FORMAT_BLOCK:t=!!this.getFieldObject().getPluginByClassId("Bidi");break;case goog.editor.plugins.BasicTextFormatter.COMMAND.SUBSCRIPT:case goog.editor.plugins.BasicTextFormatter.COMMAND.SUPERSCRIPT:goog.editor.BrowserFeature.NESTS_SUBSCRIPT_SUPERSCRIPT&&this.applySubscriptSuperscriptWorkarounds_(e);break;case goog.editor.plugins.BasicTextFormatter.COMMAND.UNDERLINE:case goog.editor.plugins.BasicTextFormatter.COMMAND.BOLD:case goog.editor.plugins.BasicTextFormatter.COMMAND.ITALIC:r=goog.userAgent.GECKO&&goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&this.queryCommandValue(e);break;case goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_COLOR:case goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_FACE:r=goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&goog.userAgent.GECKO}this.execCommandHelper_(e,n,t,!!r),i&&this.getDocument_().execCommand("Delete",!1,!0),g&&this.getDocument_().execCommand("FormatBlock",!1,"<div>")}return goog.userAgent.GECKO&&!this.getFieldObject().inModalMode()&&this.focusField_(),a},goog.editor.plugins.BasicTextFormatter.prototype.focusField_=function(){this.getFieldDomHelper().getWindow().focus()},goog.editor.plugins.BasicTextFormatter.prototype.queryCommandValue=function(e){var o;switch(e){case goog.editor.plugins.BasicTextFormatter.COMMAND.LINK:return this.isNodeInState_(goog.dom.TagName.A);case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_CENTER:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_FULL:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_RIGHT:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_LEFT:return this.isJustification_(e);case goog.editor.plugins.BasicTextFormatter.COMMAND.FORMAT_BLOCK:return goog.editor.plugins.BasicTextFormatter.getSelectionBlockState_(this.getFieldObject().getRange());case goog.editor.plugins.BasicTextFormatter.COMMAND.INDENT:case goog.editor.plugins.BasicTextFormatter.COMMAND.OUTDENT:case goog.editor.plugins.BasicTextFormatter.COMMAND.HORIZONTAL_RULE:return!1;case goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_SIZE:case goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_FACE:case goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_COLOR:case goog.editor.plugins.BasicTextFormatter.COMMAND.BACKGROUND_COLOR:return this.queryCommandValueInternal_(this.getDocument_(),e,goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&goog.userAgent.GECKO);case goog.editor.plugins.BasicTextFormatter.COMMAND.UNDERLINE:case goog.editor.plugins.BasicTextFormatter.COMMAND.BOLD:case goog.editor.plugins.BasicTextFormatter.COMMAND.ITALIC:o=goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&goog.userAgent.GECKO;default:return this.queryCommandStateInternal_(this.getDocument_(),e,o)}},goog.editor.plugins.BasicTextFormatter.prototype.prepareContentsHtml=function(e){return goog.editor.BrowserFeature.COLLAPSES_EMPTY_NODES&&e.match(/^\s*<script/i)&&(e="&nbsp;"+e),goog.editor.BrowserFeature.CONVERT_TO_B_AND_I_TAGS&&(e=(e=e.replace(/<(\/?)strong([^\w])/gi,"<$1b$2")).replace(/<(\/?)em([^\w])/gi,"<$1i$2")),e},goog.editor.plugins.BasicTextFormatter.prototype.cleanContentsDom=function(e){for(var o,t=goog.dom.getElementsByTagName(goog.dom.TagName.IMG,e),r=0;o=t[r];r++)goog.editor.BrowserFeature.SHOWS_CUSTOM_ATTRS_IN_INNER_HTML&&(o.removeAttribute("tabIndex"),o.removeAttribute("tabIndexSet"),goog.removeUid(o),o.oldTabIndex,o.oldTabIndex&&(o.tabIndex=o.oldTabIndex))},goog.editor.plugins.BasicTextFormatter.prototype.cleanContentsHtml=function(e){if(goog.editor.BrowserFeature.MOVES_STYLE_TO_HEAD){for(var o=this.getFieldObject().getEditableDomHelper().getElementsByTagNameAndClass(goog.dom.TagName.HEAD),t=[],r=o.length,g=1;g<r;++g)for(var i=goog.dom.getElementsByTagName(goog.dom.TagName.STYLE,o[g]),a=i.length,n=0;n<a;++n)t.push(i[n].outerHTML);return t.join("")+e}return e},goog.editor.plugins.BasicTextFormatter.prototype.handleKeyboardShortcut=function(e,o,t){if(!t)return!1;var r;switch(o){case"b":r=goog.editor.plugins.BasicTextFormatter.COMMAND.BOLD;break;case"i":r=goog.editor.plugins.BasicTextFormatter.COMMAND.ITALIC;break;case"u":r=goog.editor.plugins.BasicTextFormatter.COMMAND.UNDERLINE;break;case"s":return!0}return!!r&&(this.getFieldObject().execCommand(r),!0)},goog.editor.plugins.BasicTextFormatter.BR_REGEXP_=goog.userAgent.IE?/<br([^\/>]*)\/?>/gi:/<br([^\/>]*)\/?>(?!<\/(div|p)>)/gi,goog.editor.plugins.BasicTextFormatter.prototype.convertBreaksToDivs_=function(){if(!goog.userAgent.IE&&!goog.userAgent.OPERA)return!1;var e=this.getRange_(),o=e.getContainerElement(),t=this.getDocument_(),r=this.getFieldDomHelper();if(goog.editor.plugins.BasicTextFormatter.BR_REGEXP_.lastIndex=0,goog.editor.plugins.BasicTextFormatter.BR_REGEXP_.test(o.innerHTML)){var g=e.saveUsingCarets();if(o.tagName==goog.dom.TagName.P)goog.editor.plugins.BasicTextFormatter.convertParagraphToDiv_(o,!0);else{var i="trtempbr",a="temp_br",n=o.innerHTML.replace(goog.editor.plugins.BasicTextFormatter.BR_REGEXP_,"<p$1 "+i+'="'+a+'">');goog.editor.node.replaceInnerHtml(o,n);var s=goog.array.toArray(goog.dom.getElementsByTagName(goog.dom.TagName.P,o));goog.iter.forEach(s,function(e){if(e.getAttribute(i)==a){if(e.removeAttribute(i),goog.string.isBreakingWhitespace(goog.dom.getTextContent(e))){var o=goog.userAgent.IE?t.createTextNode(goog.string.Unicode.NBSP):r.createElement(goog.dom.TagName.BR);e.appendChild(o)}goog.editor.plugins.BasicTextFormatter.convertParagraphToDiv_(e)}})}return g.restore(),!0}return!1},goog.editor.plugins.BasicTextFormatter.convertParagraphToDiv_=function(e,o){if(goog.userAgent.IE||goog.userAgent.OPERA){var t=e.outerHTML.replace(/<(\/?)p/gi,"<$1div");o&&(t=t.replace(goog.editor.plugins.BasicTextFormatter.BR_REGEXP_,"</div><div$1>")),goog.userAgent.OPERA&&!/<\/div>$/i.test(t)&&(t+="</div>"),e.outerHTML=t}},goog.editor.plugins.BasicTextFormatter.convertToRealExecCommand_=function(e){return 0==e.indexOf("+")?e.substring(1):e},goog.editor.plugins.BasicTextFormatter.prototype.justify_=function(e){this.execCommandHelper_(e,null,!1,!0),goog.userAgent.GECKO&&this.execCommandHelper_(e,null,!1,!0),goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&goog.userAgent.GECKO||goog.iter.forEach(this.getFieldObject().getRange(),goog.editor.plugins.BasicTextFormatter.convertContainerToTextAlign_)},goog.editor.plugins.BasicTextFormatter.convertContainerToTextAlign_=function(e){var o=goog.editor.style.getContainer(e);o.align&&(o.style.textAlign=o.align,o.removeAttribute("align"))},goog.editor.plugins.BasicTextFormatter.prototype.execCommandHelper_=function(e,o,t,r){var g,i,a=null;if(t&&(a=this.getFieldObject().queryCommandValue(goog.editor.Command.DIR_RTL)?"rtl":this.getFieldObject().queryCommandValue(goog.editor.Command.DIR_LTR)?"ltr":null),e=goog.editor.plugins.BasicTextFormatter.convertToRealExecCommand_(e),goog.userAgent.IE){var n=this.applyExecCommandIEFixes_(e);g=n[0],i=n[1]}goog.userAgent.WEBKIT&&(g=this.applyExecCommandSafariFixes_(e)),goog.userAgent.GECKO&&this.applyExecCommandGeckoFixes_(e),goog.editor.BrowserFeature.DOESNT_OVERRIDE_FONT_SIZE_IN_STYLE_ATTR&&"fontsize"==e.toLowerCase()&&this.removeFontSizeFromStyleAttrs_();var s=this.getDocument_();r&&goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&(s.execCommand("styleWithCSS",!1,!0),goog.userAgent.OPERA&&this.invalidateInlineCss_()),s.execCommand(e,!1,o),r&&goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&s.execCommand("styleWithCSS",!1,!1),goog.userAgent.WEBKIT&&!goog.userAgent.isVersionOrHigher("526")&&"formatblock"==e.toLowerCase()&&o&&/^[<]?h\d[>]?$/i.test(o)&&this.cleanUpSafariHeadings_(),/insert(un)?orderedlist/i.test(e)&&(goog.userAgent.WEBKIT&&!goog.userAgent.isVersionOrHigher(534)&&this.fixSafariLists_(),goog.userAgent.IE&&(this.fixIELists_(),i&&goog.dom.removeNode(i))),g&&goog.dom.removeNode(g),a&&this.getFieldObject().execCommand(a)},goog.editor.plugins.BasicTextFormatter.prototype.applyBgColorManually_=function(e){var o,t,r=goog.userAgent.GECKO,g=this.getFieldObject().getRange();if(g&&g.isCollapsed()){o=this.getFieldDomHelper().createTextNode(r?" ":"");var i=g.getStartNode();""==(t=i.nodeType==goog.dom.NodeType.ELEMENT?i:i.parentNode).innerHTML?(t.style.textIndent="-10000px",t.appendChild(o)):(t=this.getFieldDomHelper().createDom(goog.dom.TagName.SPAN,{style:"text-indent:-10000px"},o),g.replaceContentsWithNode(t)),goog.dom.Range.createFromNodeContents(o).select()}this.execCommandHelper_("hiliteColor",e,!1,!0),o&&(r&&(o.data=""),t.style.textIndent="")},goog.editor.plugins.BasicTextFormatter.prototype.toggleLink_=function(e){this.getFieldObject().isSelectionEditable()||this.focusField_();var o=this.getRange_(),t=o&&o.getContainerElement(),r=goog.dom.getAncestorByTagNameAndClass(t,goog.dom.TagName.A);if(r&&goog.editor.node.isEditable(r))goog.dom.flattenElement(r);else{var g=this.createLink_(o,"/",e);if(g){if(!this.getFieldObject().execCommand(goog.editor.Command.MODAL_LINK_EDITOR,g)){var i=this.getFieldObject().getAppWindow().prompt(goog.ui.editor.messages.MSG_LINK_TO,"http://");if(!i){var a=goog.editor.range.saveUsingNormalizedCarets(goog.dom.Range.createFromNodeContents(g.getAnchor()));return g.removeLink(),a.restore().select(),null}g.setTextAndUrl(g.getCurrentText()||i,i),g.placeCursorRightOf()}return g}}return null},goog.editor.plugins.BasicTextFormatter.prototype.createLink_=function(e,o,t){var r=null,g=[],i=e&&e.getContainerElement();if(i&&i.tagName==goog.dom.TagName.IMG)return null;if(!e)return null;if(e.isCollapsed()){var a=e.getTextRange(0).getBrowserRangeObject();goog.editor.BrowserFeature.HAS_W3C_RANGES?(r=this.getFieldDomHelper().createElement(goog.dom.TagName.A),a.insertNode(r)):goog.editor.BrowserFeature.HAS_IE_RANGES&&(a.pasteHTML("<a id='newLink'></a>"),(r=this.getFieldDomHelper().getElement("newLink")).removeAttribute("id"))}else{var n=goog.string.createUniqueString();this.execCommandHelper_("CreateLink",n);goog.array.forEach(goog.dom.getElementsByTagName(goog.dom.TagName.A,this.getFieldObject().getElement()),function(e,o,t){goog.string.endsWith(e.href,n)&&g.push(e)}),g.length&&(r=g.pop());if(g.length&&goog.array.every(g,function(e,o,t){return goog.editor.Link.isLikelyUrl(goog.dom.getRawTextContent(e))})){for(var s,d=0;s=g[d];d++)goog.editor.Link.createNewLinkFromText(s,t);g=null}}return goog.editor.Link.createNewLink(r,o,t,g)},goog.editor.plugins.BasicTextFormatter.brokenExecCommandsIE_={indent:1,outdent:1,insertOrderedList:1,insertUnorderedList:1,justifyCenter:1,justifyFull:1,justifyRight:1,justifyLeft:1,ltr:1,rtl:1},goog.editor.plugins.BasicTextFormatter.blockquoteHatingCommandsIE_={insertOrderedList:1,insertUnorderedList:1},goog.editor.plugins.BasicTextFormatter.prototype.applySubscriptSuperscriptWorkarounds_=function(e){if(!this.queryCommandValue(e)){var o=e==goog.editor.plugins.BasicTextFormatter.COMMAND.SUBSCRIPT?goog.editor.plugins.BasicTextFormatter.COMMAND.SUPERSCRIPT:goog.editor.plugins.BasicTextFormatter.COMMAND.SUBSCRIPT,t=goog.editor.plugins.BasicTextFormatter.convertToRealExecCommand_(o);this.queryCommandValue(o)||this.getDocument_().execCommand(t,!1,null),this.getDocument_().execCommand(t,!1,null)}},goog.editor.plugins.BasicTextFormatter.prototype.removeFontSizeFromStyleAttrs_=function(){var e=goog.editor.range.expand(this.getFieldObject().getRange(),this.getFieldObject().getElement());goog.iter.forEach(goog.iter.filter(e,function(o,t,r){return r.isStartTag()&&e.containsNode(o)}),function(e){goog.style.setStyle(e,"font-size",""),goog.userAgent.GECKO&&0==e.style.length&&null!=e.getAttribute("style")&&e.removeAttribute("style")})},goog.editor.plugins.BasicTextFormatter.prototype.applyExecCommandIEFixes_=function(e){var o=[],t=null,r=this.getRange_(),g=this.getFieldDomHelper();if(e in goog.editor.plugins.BasicTextFormatter.blockquoteHatingCommandsIE_){var i=r&&r.getContainerElement();if(i){for(var a,n=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.BLOCKQUOTE,null,i),s=0;s<n.length;s++)if(r.containsNode(n[s])){a=n[s];break}var d=a||goog.dom.getAncestorByTagNameAndClass(i,goog.dom.TagName.BLOCKQUOTE);d&&(t=g.createDom(goog.dom.TagName.DIV,{style:"height:0"}),goog.dom.appendChild(d,t),o.push(t),a?r=goog.dom.Range.createFromNodes(a,0,t,0):r.containsNode(t)&&(r=goog.dom.Range.createFromNodes(r.getStartNode(),r.getStartOffset(),t,0)),r.select())}}var l=this.getFieldObject();if(!l.usesIframe()&&!t&&e in goog.editor.plugins.BasicTextFormatter.brokenExecCommandsIE_){var m=l.getElement();if(r&&r.isCollapsed()&&!goog.dom.getFirstElementChild(m)){var u=r.getTextRange(0).getBrowserRangeObject(),c=u.duplicate();if(c.moveToElementText(m),c.collapse(!1),c.isEqual(u)){var T=g.createTextNode(goog.string.Unicode.NBSP);m.appendChild(T),u.move("character",1),u.move("character",-1),u.select(),o.push(T)}}t=g.createDom(goog.dom.TagName.DIV,{style:"height:0"}),goog.dom.appendChild(m,t),o.push(t)}return o},goog.editor.plugins.BasicTextFormatter.prototype.cleanUpSafariHeadings_=function(){goog.iter.forEach(this.getRange_(),function(e){"Apple-style-span"==e.className&&(e.style.fontSize="",e.style.fontWeight="")})},goog.editor.plugins.BasicTextFormatter.prototype.fixSafariLists_=function(){var e=!1;goog.iter.forEach(this.getRange_(),function(o){var t=o.tagName;if(t==goog.dom.TagName.UL||t==goog.dom.TagName.OL){if(!e)return void(e=!0);var r=goog.dom.getPreviousElementSibling(o);if(!r)return;var g=o.ownerDocument.createRange();if(g.setStartAfter(r),g.setEndBefore(o),!goog.string.isEmptyOrWhitespace(g.toString()))return;if(r.nodeName==o.nodeName){for(;r.lastChild;)o.insertBefore(r.lastChild,o.firstChild);r.parentNode.removeChild(r)}}})},goog.editor.plugins.BasicTextFormatter.orderedListTypes_={1:1,a:1,A:1,i:1,I:1},goog.editor.plugins.BasicTextFormatter.unorderedListTypes_={disc:1,circle:1,square:1},goog.editor.plugins.BasicTextFormatter.prototype.fixIELists_=function(){for(var e=this.getRange_(),o=e&&e.getContainer();o&&o.tagName!=goog.dom.TagName.UL&&o.tagName!=goog.dom.TagName.OL;)o=o.parentNode;if(o&&(o=o.parentNode),o){var t=goog.array.toArray(goog.dom.getElementsByTagName(goog.dom.TagName.UL,o));goog.array.extend(t,goog.array.toArray(goog.dom.getElementsByTagName(goog.dom.TagName.OL,o))),goog.array.forEach(t,function(e){var o=e.type;o&&((e.tagName==goog.dom.TagName.UL?goog.editor.plugins.BasicTextFormatter.unorderedListTypes_:goog.editor.plugins.BasicTextFormatter.orderedListTypes_)[o]||(e.type=""))})}},goog.editor.plugins.BasicTextFormatter.brokenExecCommandsSafari_={justifyCenter:1,justifyFull:1,justifyRight:1,justifyLeft:1,formatBlock:1},goog.editor.plugins.BasicTextFormatter.hangingExecCommandWebkit_={insertOrderedList:1,insertUnorderedList:1},goog.editor.plugins.BasicTextFormatter.prototype.applyExecCommandSafariFixes_=function(e){var o;if(goog.editor.plugins.BasicTextFormatter.brokenExecCommandsSafari_[e]&&(o=this.getFieldDomHelper().createDom(goog.dom.TagName.DIV,{style:"height: 0"},"x"),goog.dom.appendChild(this.getFieldObject().getElement(),o)),!goog.userAgent.isVersionOrHigher(534)&&goog.editor.plugins.BasicTextFormatter.hangingExecCommandWebkit_[e]){var t=this.getFieldObject().getElement();o=this.getFieldDomHelper().createDom(goog.dom.TagName.DIV,{style:"height: 0"},"x"),t.insertBefore(o,t.firstChild)}return o},goog.editor.plugins.BasicTextFormatter.prototype.applyExecCommandGeckoFixes_=function(e){if(goog.userAgent.isVersionOrHigher("1.9")&&"formatblock"==e.toLowerCase()){var o=this.getRange_(),t=o.getStartNode();if(o.isCollapsed()&&t&&t.tagName==goog.dom.TagName.BODY){var r=o.getStartOffset(),g=t.childNodes[r];if(g&&g.tagName==goog.dom.TagName.BR){var i=o.getBrowserRangeObject();i.setStart(g,0),i.setEnd(g,0)}}}},goog.editor.plugins.BasicTextFormatter.prototype.invalidateInlineCss_=function(){var e=[],o=this.getFieldObject().getRange().getContainerElement();do{e.push(o)}while(o=o.parentNode);var t=goog.iter.chain(goog.iter.toIterator(this.getFieldObject().getRange()),goog.iter.toIterator(e)),r=goog.iter.filter(t,goog.editor.style.isContainer);goog.iter.forEach(r,function(e){var o=e.style.outline;e.style.outline="0px solid red",e.style.outline=o})},goog.editor.plugins.BasicTextFormatter.prototype.beforeInsertListGecko_=function(){var e=this.getFieldObject().queryCommandValue(goog.editor.Command.DEFAULT_TAG);if(e==goog.dom.TagName.P||e==goog.dom.TagName.DIV)return!1;var o=this.getRange_();if(o.isCollapsed()&&o.getContainer().nodeType!=goog.dom.NodeType.TEXT){var t=this.getFieldDomHelper().createTextNode(goog.string.Unicode.NBSP);return o.insertNode(t,!1),goog.dom.Range.createFromNodeContents(t).select(),!0}return!1},goog.editor.plugins.BasicTextFormatter.getSelectionBlockState_=function(e){var o=null;return goog.iter.forEach(e,function(e,t,r){if(!r.isEndTag()){var g=goog.editor.style.getContainer(e).tagName;if((o=o||g)!=g)throw o=null,goog.iter.StopIteration;r.skipTag()}}),o},goog.editor.plugins.BasicTextFormatter.SUPPORTED_JUSTIFICATIONS_={center:1,justify:1,right:1,left:1},goog.editor.plugins.BasicTextFormatter.IBidiPlugin=function(){this.getSelectionAlignment},goog.editor.plugins.BasicTextFormatter.prototype.isJustification_=function(e){var o=e.replace("+justify","").toLowerCase();"full"==o&&(o="justify");var t=this.getFieldObject().getPluginByClassId("Bidi");if(t)return o==t.getSelectionAlignment();var r=this.getRange_();if(!r)return!1;var g=r.getContainerElement(),i=goog.array.filter(g.childNodes,function(e){return goog.editor.node.isImportant(e)&&r.containsNode(e,!0)});i=i.length?i:[g];for(var a=0;a<i.length;a++){var n=i[a],s=goog.editor.style.getContainer(n);if(o!=goog.editor.plugins.BasicTextFormatter.getNodeJustification_(s))return!1}return!0},goog.editor.plugins.BasicTextFormatter.getNodeJustification_=function(e){var o=goog.style.getComputedTextAlign(e);return o=o.replace(/^-(moz|webkit)-/,""),goog.editor.plugins.BasicTextFormatter.SUPPORTED_JUSTIFICATIONS_[o]||(o=e.align||"left"),o},goog.editor.plugins.BasicTextFormatter.prototype.isNodeInState_=function(e){var o=this.getRange_(),t=o&&o.getContainerElement(),r=goog.dom.getAncestorByTagNameAndClass(t,e);return!!r&&goog.editor.node.isEditable(r)},goog.editor.plugins.BasicTextFormatter.prototype.queryCommandStateInternal_=function(e,o,t){return this.queryCommandHelper_(!0,e,o,t)},goog.editor.plugins.BasicTextFormatter.prototype.queryCommandValueInternal_=function(e,o,t){return this.queryCommandHelper_(!1,e,o,t)},goog.editor.plugins.BasicTextFormatter.prototype.queryCommandHelper_=function(e,o,t,r){if(t=goog.editor.plugins.BasicTextFormatter.convertToRealExecCommand_(t),r){var g=this.getDocument_();g.execCommand("styleWithCSS",!1,!0)}var i=e?o.queryCommandState(t):o.queryCommandValue(t);return r&&g.execCommand("styleWithCSS",!1,!1),i};