goog.provide("goog.editor.plugins.Blockquote"),goog.require("goog.dom"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.TagName"),goog.require("goog.dom.classlist"),goog.require("goog.editor.BrowserFeature"),goog.require("goog.editor.Command"),goog.require("goog.editor.Plugin"),goog.require("goog.editor.node"),goog.require("goog.functions"),goog.require("goog.log"),goog.editor.plugins.Blockquote=function(o,e){goog.editor.Plugin.call(this),this.requiresClassNameToSplit_=o,this.className_=e||goog.getCssName("tr_bq")},goog.inherits(goog.editor.plugins.Blockquote,goog.editor.Plugin),goog.editor.plugins.Blockquote.SPLIT_COMMAND="+splitBlockquote",goog.editor.plugins.Blockquote.CLASS_ID="Blockquote",goog.editor.plugins.Blockquote.prototype.logger=goog.log.getLogger("goog.editor.plugins.Blockquote"),goog.editor.plugins.Blockquote.prototype.getTrogClassId=function(){return goog.editor.plugins.Blockquote.CLASS_ID},goog.editor.plugins.Blockquote.prototype.isSilentCommand=goog.functions.TRUE,goog.editor.plugins.Blockquote.prototype.isSplittableBlockquote=function(o){return o.tagName==goog.dom.TagName.BLOCKQUOTE&&(!this.requiresClassNameToSplit_||goog.dom.classlist.contains(o,this.className_))},goog.editor.plugins.Blockquote.prototype.isSetupBlockquote=function(o){return o.tagName==goog.dom.TagName.BLOCKQUOTE&&goog.dom.classlist.contains(o,this.className_)},goog.editor.plugins.Blockquote.prototype.isUnsetupBlockquote=function(o){return o.tagName==goog.dom.TagName.BLOCKQUOTE&&!this.isSetupBlockquote(o)},goog.editor.plugins.Blockquote.prototype.getBlockquoteClassName=function(){return this.className_},goog.editor.plugins.Blockquote.findAndRemoveSingleChildAncestor_=function(o,e){var t=goog.editor.node.findHighestMatchingAncestor(o,function(o){return o!=e&&1==o.childNodes.length});t||(t=o),goog.dom.removeNode(t)},goog.editor.plugins.Blockquote.removeAllWhiteSpaceNodes_=function(o){for(var e=0;e<o.length;++e)goog.editor.node.isEmpty(o[e],!0)&&goog.dom.removeNode(o[e])},goog.editor.plugins.Blockquote.prototype.isSupportedCommand=function(o){return o==goog.editor.plugins.Blockquote.SPLIT_COMMAND},goog.editor.plugins.Blockquote.prototype.execCommandInternal=function(o,e){var t=arguments[1];if(o==goog.editor.plugins.Blockquote.SPLIT_COMMAND&&t&&(this.className_||!this.requiresClassNameToSplit_))return goog.editor.BrowserFeature.HAS_W3C_RANGES?this.splitQuotedBlockW3C_(t):this.splitQuotedBlockIE_(t)},goog.editor.plugins.Blockquote.prototype.splitQuotedBlockW3C_=function(o){var e,t,g=o.node,i=goog.editor.node.findTopMostEditableAncestor(g.parentNode,goog.bind(this.isSplittableBlockquote,this)),r=!1;if(i)if(g.nodeType==goog.dom.NodeType.TEXT)if(o.offset==g.length){var n=g.nextSibling;n&&n.tagName==goog.dom.TagName.BR?(g=n,e=n.nextSibling):e=t=g.splitText(o.offset)}else e=g.splitText(o.offset);else g.tagName==goog.dom.TagName.BR?e=g.nextSibling:r=!0;else this.isSetupBlockquote(g)&&(i=g,r=!0);if(r&&(g=this.insertEmptyTextNodeBeforeRange_(),e=this.insertEmptyTextNodeBeforeRange_()),!i)return!1;e=goog.editor.node.splitDomTreeAt(g,e,i),goog.dom.insertSiblingAfter(e,i);var l=this.getFieldDomHelper(),s=this.getFieldObject().queryCommandValue(goog.editor.Command.DEFAULT_TAG)||goog.dom.TagName.DIV,d=l.createElement(s);return d.innerHTML="&nbsp;",i.parentNode.insertBefore(d,e),l.getWindow().getSelection().collapse(d,0),t&&goog.editor.plugins.Blockquote.findAndRemoveSingleChildAncestor_(t,e),goog.editor.plugins.Blockquote.removeAllWhiteSpaceNodes_([i,e]),!0},goog.editor.plugins.Blockquote.prototype.insertEmptyTextNodeBeforeRange_=function(){var o=this.getFieldObject().getRange(),e=this.getFieldDomHelper().createTextNode("");return o.insertNode(e,!0),e},goog.editor.plugins.Blockquote.prototype.splitQuotedBlockIE_=function(o){var e=this.getFieldDomHelper(),t=goog.editor.node.findTopMostEditableAncestor(o.parentNode,goog.bind(this.isSplittableBlockquote,this));if(!t)return!1;var g=o.cloneNode(!1);o.nextSibling&&o.nextSibling.tagName==goog.dom.TagName.BR&&(o=o.nextSibling);var i=goog.editor.node.splitDomTreeAt(o,g,t);goog.dom.insertSiblingAfter(i,t);var r=this.getFieldObject().queryCommandValue(goog.editor.Command.DEFAULT_TAG)||goog.dom.TagName.DIV,n=e.createElement(r);t.parentNode.insertBefore(n,i),n.innerHTML="&nbsp;";var l=e.getDocument().selection.createRange();return l.moveToElementText(o),l.move("character",2),l.select(),goog.dom.removeChildren(n),l.pasteHTML(""),goog.editor.plugins.Blockquote.findAndRemoveSingleChildAncestor_(g,i),goog.editor.plugins.Blockquote.removeAllWhiteSpaceNodes_([t,i]),!0};