goog.setTestOnly("goog.testing.Mock"),goog.provide("goog.testing.Mock"),goog.provide("goog.testing.MockExpectation"),goog.require("goog.Promise"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.object"),goog.require("goog.promise.Resolver"),goog.require("goog.testing.JsUnitException"),goog.require("goog.testing.MockInterface"),goog.require("goog.testing.mockmatchers"),goog.testing.MockExpectation=function(t){this.name=t,this.errorMessages=[]},goog.testing.MockExpectation.prototype.minCalls=1,goog.testing.MockExpectation.prototype.maxCalls=1,goog.testing.MockExpectation.prototype.returnValue,goog.testing.MockExpectation.prototype.exceptionToThrow,goog.testing.MockExpectation.prototype.argumentList,goog.testing.MockExpectation.prototype.actualCalls=0,goog.testing.MockExpectation.prototype.verificationCalls=0,goog.testing.MockExpectation.prototype.toDo,goog.testing.MockExpectation.prototype.addErrorMessage=function(t){this.errorMessages.push(t)},goog.testing.MockExpectation.prototype.getErrorMessage=function(){return this.errorMessages.join("\n")},goog.testing.MockExpectation.prototype.getErrorMessageCount=function(){return this.errorMessages.length},goog.testing.Mock=function(t,o,e){if(!goog.isObject(t)&&!goog.isFunction(t))throw new Error("objectToMock must be an object or constructor.");if(e&&!o&&goog.isFunction(t)){var i=function(){};goog.inherits(i,t),this.$proxy=new i}else{if(e&&o&&goog.isFunction(t))throw new Error("Cannot create a proxy when opt_mockStaticMethods is true");if(e&&!goog.isFunction(t))throw new Error("Must have a constructor to create a proxy")}goog.isFunction(t)&&!o?this.$initializeFunctions_(t.prototype):this.$initializeFunctions_(t),this.$argumentListVerifiers_={},this.waitingForExpectations=null},goog.testing.Mock.LOOSE=1,goog.testing.Mock.STRICT=0,goog.testing.Mock.record=function(t){return goog.asserts.assert(void 0!==t.$recording_,t+" is not a mock.  Did you pass a real object to record()?"),goog.asserts.assert(t.$recording_,"Your mock is in replay mode.  You can only call record(mock) before mock.$replay()"),t},goog.testing.Mock.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.testing.Mock.FUNCTION_PROTOTYPE_FIELDS_=["apply","bind","call"],goog.testing.Mock.prototype.$proxy=null,goog.testing.Mock.prototype.$argumentListVerifiers_,goog.testing.Mock.prototype.$recording_=!0,goog.testing.Mock.prototype.$pendingExpectation,goog.testing.Mock.prototype.$threwException_=null,goog.testing.Mock.prototype.$initializeFunctions_=function(t){var o=goog.object.getAllPropertyNames(t,!1,!1);if(goog.isFunction(t))for(var e=0;e<goog.testing.Mock.FUNCTION_PROTOTYPE_FIELDS_.length;e++){t[i=goog.testing.Mock.FUNCTION_PROTOTYPE_FIELDS_[e]]!==Function.prototype[i]&&o.push(i)}for(e=0;e<goog.testing.Mock.OBJECT_PROTOTYPE_FIELDS_.length;e++){t[i=goog.testing.Mock.OBJECT_PROTOTYPE_FIELDS_[e]]!==Object.prototype[i]&&o.push(i)}for(e=0;e<o.length;e++){var i;"function"==typeof t[i=o[e]]&&(this[i]=goog.bind(this.$mockMethod,this,i),this.$proxy&&(this.$proxy[i]=goog.bind(this.$mockMethod,this,i)))}},goog.testing.Mock.prototype.$registerArgumentListVerifier=function(t,o){return this.$argumentListVerifiers_[t]=o,this},goog.testing.Mock.prototype.$mockMethod=function(t){try{var o=goog.array.slice(arguments,1);return this.$recording_?(this.$pendingExpectation=new goog.testing.MockExpectation(t),this.$pendingExpectation.argumentList=o,this.$recordExpectation(),this):this.$recordCall(t,o)}catch(t){this.$recordAndThrow(t,!0)}},goog.testing.Mock.prototype.$recordExpectation=function(){},goog.testing.Mock.prototype.$recordCall=function(t,o){},goog.testing.Mock.prototype.$maybeThrow=function(t){if(void 0!==t.exceptionToThrow)throw t.exceptionToThrow},goog.testing.Mock.prototype.$do=function(t,o){return void 0===t.toDo?(this.$maybeThrow(t),t.returnValue):t.toDo.apply(this,o)},goog.testing.Mock.prototype.$returns=function(t){return this.$pendingExpectation.returnValue=t,this},goog.testing.Mock.prototype.$throws=function(t){return this.$pendingExpectation.exceptionToThrow=t,this},goog.testing.Mock.prototype.$does=function(t){return this.$pendingExpectation.toDo=t,this},goog.testing.Mock.prototype.$atMostOnce=function(){return this.$pendingExpectation.minCalls=0,this.$pendingExpectation.maxCalls=1,this},goog.testing.Mock.prototype.$atLeastOnce=function(){return this.$pendingExpectation.maxCalls=1/0,this},goog.testing.Mock.prototype.$once=function(){return this.$pendingExpectation.minCalls=1,this.$pendingExpectation.maxCalls=1,this},goog.testing.Mock.prototype.$never=function(){return this.$pendingExpectation.minCalls=0,this.$pendingExpectation.maxCalls=0,this},goog.testing.Mock.prototype.$anyTimes=function(){return this.$pendingExpectation.minCalls=0,this.$pendingExpectation.maxCalls=1/0,this},goog.testing.Mock.prototype.$times=function(t){return this.$pendingExpectation.minCalls=t,this.$pendingExpectation.maxCalls=t,this},goog.testing.Mock.prototype.$replay=function(){this.$recording_=!1},goog.testing.Mock.prototype.$reset=function(){this.$recording_=!0,this.$threwException_=null,delete this.$pendingExpectation,this.waitingForExpectations&&(this.waitingForExpectations=null)},goog.testing.Mock.prototype.$throwException=function(t,o){this.$recordAndThrow(new goog.testing.JsUnitException(t,o))},goog.testing.Mock.prototype.$recordAndThrow=function(t,o){if(this.waitingForExpectations&&this.waitingForExpectations.resolve(),this.$recording_&&(t=new goog.testing.JsUnitException("Threw an exception while in record mode, did you $replay?",t.toString())),t.isJsUnitException){this.$threwException_||(this.$threwException_=t);var e=goog.getObjectByName("goog.testing.TestCase.getActiveTestCase"),i=e&&e();i&&!o&&i.raiseAssertionException(t)}throw t},goog.testing.Mock.prototype.$waitAndVerify=function(){goog.asserts.assert(!this.$recording_,"$waitAndVerify should be called after recording calls."),this.waitingForExpectations=goog.Promise.withResolver();var t=goog.bind(this.$verify,this);return this.waitingForExpectations.promise.then(function(){return new goog.Promise(function(o,e){setTimeout(function(){try{t()}catch(t){e(t)}o()},0)})})},goog.testing.Mock.prototype.$verify=function(){if(this.$threwException_)throw this.$threwException_},goog.testing.Mock.prototype.$verifyCall=function(t,o,e){return t.name==o&&(this.$argumentListVerifiers_.hasOwnProperty(t.name)?this.$argumentListVerifiers_[t.name]:goog.testing.mockmatchers.flexibleArrayMatcher)(t.argumentList,e,t)},goog.testing.Mock.prototype.$argumentsAsString=function(t){for(var o=[],e=0;e<t.length;e++)try{o.push(goog.typeOf(t[e]))}catch(t){o.push("[unknown]")}return"("+o.join(", ")+")"},goog.testing.Mock.prototype.$throwCallException=function(t,o,e){var i=[],n=this.$argumentsAsString(o),g=e?this.$argumentsAsString(e.argumentList):"";e&&e.name==t?i.push("Bad arguments to ",t,"().\n","Actual: ",n,"\n","Expected: ",g,"\n",e.getErrorMessage()):(i.push("Unexpected call to ",t,n,".","\nDid you forget to $replay?"),e&&i.push("\nNext expected call was to ",e.name,g)),this.$throwException(i.join(""))};