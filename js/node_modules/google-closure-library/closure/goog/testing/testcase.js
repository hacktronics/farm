goog.setTestOnly("goog.testing.TestCase"),goog.provide("goog.testing.TestCase"),goog.provide("goog.testing.TestCase.Error"),goog.provide("goog.testing.TestCase.Order"),goog.provide("goog.testing.TestCase.Result"),goog.provide("goog.testing.TestCase.Test"),goog.require("goog.Promise"),goog.require("goog.Thenable"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.object"),goog.require("goog.testing.JsUnitException"),goog.require("goog.testing.asserts"),goog.testing.TestCase=function(t){this.name_=t||"Untitled Test Case",this.shouldAutoDiscoverTests_=!0,this.tests_=[],this.testsToRun_=null,this.testDone_=null,this.order=goog.testing.TestCase.Order.SORTED,this.runNextTestCallback_=goog.nullFunction,this.curTest_=null,this.result_=new goog.testing.TestCase.Result(this),this.thrownAssertionExceptions_=[],this.promiseTimeout=1e3,this.onCompletedCallbacks_=[],this.endTime_,this.testsRanSoFar_=0},goog.testing.TestCase.Order={NATURAL:"natural",RANDOM:"random",SORTED:"sorted"},goog.testing.TestCase.prototype.getName=function(){return this.name_},goog.testing.TestCase.prototype.getCurrentTest=function(){return this.curTest_},goog.testing.TestCase.maxRunTime=200,goog.testing.TestCase.protectedSetTimeout_=goog.global.setTimeout,goog.testing.TestCase.protectedClearTimeout_=goog.global.clearTimeout,goog.testing.TestCase.protectedDate_=Date,goog.testing.TestCase.protectedPerformance_="undefined"!=typeof window&&window.performance&&window.performance.now?performance:null,goog.testing.TestCase.currentTestName=null,goog.testing.TestCase.IS_IE="undefined"==typeof opera&&!!goog.global.navigator&&-1!=goog.global.navigator.userAgent.indexOf("MSIE"),goog.testing.TestCase.prototype.exceptionBeforeTest,goog.testing.TestCase.prototype.started=!1,goog.testing.TestCase.prototype.running=!1,goog.testing.TestCase.prototype.startTime_=0,goog.testing.TestCase.prototype.batchTime_=0,goog.testing.TestCase.prototype.currentTestPointer_=0,goog.testing.TestCase.prototype.add=function(t){if(goog.asserts.assert(t),this.started)throw new Error("Tests cannot be added after execute() has been called. Test: "+t.name);this.tests_.push(t)},goog.testing.TestCase.prototype.addNewTest=function(t,e,s,o){this.add(this.createTest(t,e,s||this,o))},goog.testing.TestCase.prototype.setTests=function(t){this.tests_=t},goog.testing.TestCase.prototype.getTests=function(){return this.tests_},goog.testing.TestCase.prototype.getCount=function(){return this.tests_.length},goog.testing.TestCase.prototype.getActuallyRunCount=function(){return this.testsToRun_?goog.object.getCount(this.testsToRun_):0},goog.testing.TestCase.prototype.next=function(){for(var t;t=this.tests_[this.currentTestPointer_++];)if(!this.testsToRun_||this.testsToRun_[t.name]||this.testsToRun_[this.currentTestPointer_-1])return t;return null},goog.testing.TestCase.prototype.reset=function(){this.currentTestPointer_=0,this.result_=new goog.testing.TestCase.Result(this)},goog.testing.TestCase.prototype.addCompletedCallback=function(t){this.onCompletedCallbacks_.push(t)},goog.testing.TestCase.prototype.setOrder=function(t){this.order=t},goog.testing.TestCase.prototype.setTestsToRun=function(t){this.testsToRun_=t},goog.testing.TestCase.prototype.shouldRunTests=function(){return!0},goog.testing.TestCase.prototype.execute=function(){this.prepareForRun_()&&(this.groupLogsStart(),this.log("Starting tests: "+this.name_),this.cycleTests())},goog.testing.TestCase.prototype.prepareForRun_=function(){return this.started=!0,this.reset(),this.startTime_=this.now(),this.running=!0,this.result_.totalCount=this.getCount(),!!this.shouldRunTests()||(this.log("shouldRunTests() returned false, skipping these tests."),this.result_.testSuppressed=!0,this.finalize(),!1)},goog.testing.TestCase.prototype.finalize=function(){this.saveMessage("Done");try{this.tearDownPage()}catch(t){window.onerror(t.toString(),document.location.href,0,0,t)}this.endTime_=this.now(),this.running=!1,this.result_.runTime=this.endTime_-this.startTime_,this.result_.numFilesLoaded=this.countNumFilesLoaded_(),this.result_.complete=!0,this.testsRanSoFar_++,this.log(this.result_.getSummary()),this.result_.isSuccess()?this.log("Tests complete"):this.log("Tests Failed"),goog.array.forEach(this.onCompletedCallbacks_,function(t){t()}),this.onCompletedCallbacks_=[],this.groupLogsEnd()},goog.testing.TestCase.prototype.saveMessage=function(t){this.result_.messages.push(this.getTimeStamp_()+"  "+t)},goog.testing.TestCase.prototype.isInsideMultiTestRunner=function(){var t=goog.global.top;return t&&void 0!==t._allTests},goog.testing.TestCase.prototype.shouldLogTestProgress=function(){return!goog.global.skipClosureTestProgress&&!this.isInsideMultiTestRunner()},goog.testing.TestCase.prototype.log=function(t){this.shouldLogTestProgress()&&goog.global.console&&("string"==typeof t&&(t=this.getTimeStamp_()+" : "+t),t instanceof Error&&t.stack?goog.global.console.log(t.stack):goog.global.console.log(t))},goog.testing.TestCase.prototype.groupLogsStart=function(){!this.isInsideMultiTestRunner()&&goog.global.console&&goog.global.console.group&&goog.global.console.group("Test #"+(this.testsRanSoFar_+1)+": "+this.name_)},goog.testing.TestCase.prototype.groupLogsEnd=function(){!this.isInsideMultiTestRunner()&&goog.global.console&&goog.global.console.groupEnd&&goog.global.console.groupEnd()},goog.testing.TestCase.prototype.isSuccess=function(){return!!this.result_&&this.result_.isSuccess()},goog.testing.TestCase.prototype.getReport=function(t){var e=[];if(this.running)e.push(this.name_+" [RUNNING]");else if(0==this.result_.runCount)e.push(this.name_+" [NO TESTS RUN]");else{var s=this.result_.isSuccess()?"PASSED":"FAILED";e.push(this.name_+" ["+s+"]")}return goog.global.location&&e.push(this.trimPath_(goog.global.location.href)),e.push(this.result_.getSummary()),t?e.push(".",this.result_.messages.join("\n")):this.result_.isSuccess()||e.push(this.result_.errors.join("\n")),e.push(" "),e.join("\n")},goog.testing.TestCase.prototype.getResult=function(){return this.result_},goog.testing.TestCase.prototype.getRunTime=function(){return this.result_.runTime},goog.testing.TestCase.prototype.getNumFilesLoaded=function(){return this.result_.numFilesLoaded},goog.testing.TestCase.IResult,goog.testing.TestCase.prototype.getTestResults=function(){var t={};return goog.object.forEach(this.result_.resultsByName,function(e,s){if(Object.prototype.hasOwnProperty.call(this.result_.resultsByName,s)){t[s]=[];for(var o=0;o<e.length;o++)t[s].push(e[o].toObject_())}},this),t},goog.testing.TestCase.prototype.runTests=function(){goog.testing.Continuation_.run(this.runSetUpPage_(this.execute))},goog.testing.TestCase.prototype.runTestsReturningPromise=function(){return new goog.Promise(function(t){goog.testing.Continuation_.run(this.runSetUpPage_(function(){this.prepareForRun_()?(this.groupLogsStart(),this.log("Starting tests: "+this.name_),this.saveMessage("Start"),this.batchTime_=this.now(),this.runNextTestCallback_=t,goog.testing.Continuation_.run(this.runNextTest_())):t(this.result_)}))},this)},goog.testing.TestCase.prototype.runSetUpPage_=function(t){return this.invokeFunction_(this.setUpPage,t,function(e){this.exceptionBeforeTest=e,t.call(this)},"setUpPage")},goog.testing.TestCase.prototype.runNextTest_=function(){if(this.curTest_=this.next(),!this.curTest_||!this.running)return this.finalize(),new goog.testing.Continuation_(goog.bind(this.runNextTestCallback_,this,this.result_));var t=!0;try{t=this.shouldRunTestsHelper_()}catch(t){return this.curTest_.name="shouldRunTests for "+this.curTest_.name,new goog.testing.Continuation_(goog.bind(this.finishTestInvocation_,this,t))}return t?(this.curTest_.started(),this.result_.runCount++,this.log("Running test: "+this.curTest_.name),this.maybeFailTestEarly(this.curTest_)?new goog.testing.Continuation_(goog.bind(this.finishTestInvocation_,this)):(goog.testing.TestCase.currentTestName=this.curTest_.name,this.safeSetUp_())):new goog.testing.Continuation_(goog.bind(this.finishTestInvocation_,this))},goog.testing.TestCase.prototype.shouldRunTestsHelper_=function(){for(var t=this.curTest_.objChain.length?this.curTest_.objChain:[this],e=0;e<t.length;e++){var s,o=t[e];if(!goog.isFunction(o.shouldRunTests))return!0;if(goog.isFunction(o.shouldRunTests.$cachedResult)&&!o.shouldRunTests.$cachedResult())return!1;if(function(){try{var t=s=o.shouldRunTests.call(o);o.shouldRunTests.$cachedResult=function(){return t}}catch(t){throw o.shouldRunTests.$cachedResult=function(){throw t},t}}(),!s)return this.result_.suppressedTests.push(this.curTest_.name),!1}return!0},goog.testing.TestCase.prototype.safeSetUp_=function(){var t=this.curTest_.setUps.length?this.curTest_.setUps.slice():[this.setUp];return this.safeSetUpHelper_(t).call(this)},goog.testing.TestCase.prototype.safeSetUpHelper_=function(t){return t.length?goog.bind(this.invokeFunction_,this,t.shift(),this.safeSetUpHelper_(t),this.safeTearDown_,"setUp"):this.safeRunTest_},goog.testing.TestCase.prototype.safeRunTest_=function(){return this.invokeFunction_(goog.bind(this.curTest_.ref,this.curTest_.scope),this.safeTearDown_,this.safeTearDown_,this.curTest_.name)},goog.testing.TestCase.prototype.safeTearDown_=function(t){1==arguments.length&&this.recordError(this.curTest_.name,t);var e=this.curTest_.tearDowns.length?this.curTest_.tearDowns.slice():[this.tearDown];return this.safeTearDownHelper_(e).call(this)},goog.testing.TestCase.prototype.safeTearDownHelper_=function(t){return t.length?goog.bind(this.invokeFunction_,this,t.shift(),this.safeTearDownHelper_(t),this.finishTestInvocation_,"tearDown"):this.finishTestInvocation_},goog.testing.TestCase.prototype.invokeFunction_=function(t,e,s,o){var n=this;this.thrownAssertionExceptions_=[];try{var i=t.call(this);if(goog.Thenable.isImplementedBy(i)||goog.isFunction(i&&i.then)){var r=goog.Promise.resolve(i);return(r=this.rejectIfPromiseTimesOut_(r,n.promiseTimeout,"Timed out while waiting for a promise returned from "+o+" to resolve. Set goog.testing.TestCase.getActiveTestCase().promiseTimeout to adjust the timeout.")).then(function(){n.resetBatchTimeAfterPromise_(),0==n.thrownAssertionExceptions_.length?goog.testing.Continuation_.run(e.call(n)):goog.testing.Continuation_.run(s.call(n,n.reportUnpropagatedAssertionExceptions_(o)))},function(t){n.reportUnpropagatedAssertionExceptions_(o,t),n.resetBatchTimeAfterPromise_(),goog.testing.Continuation_.run(s.call(n,t))}),null}return 0==this.thrownAssertionExceptions_.length?new goog.testing.Continuation_(goog.bind(e,this)):new goog.testing.Continuation_(goog.bind(s,this,this.reportUnpropagatedAssertionExceptions_(o)))}catch(t){return this.reportUnpropagatedAssertionExceptions_(o,t),new goog.testing.Continuation_(goog.bind(s,this,t))}},goog.testing.TestCase.prototype.reportUnpropagatedAssertionExceptions_=function(t,e){var s=this.thrownAssertionExceptions_.slice();goog.array.remove(s,e);var o=s.length;if(o&&e){var n=o+" additional exceptions were swallowed by the test:";this.log(n),this.saveMessage(n)}for(var i=0;i<o;i++)this.recordError(t,s[i]);return new goog.testing.JsUnitException("One or more assertions were raised but not caught by the testing framework. These assertions may have been unintentionally captured by a catch block or a thenCatch resolution of a Promise.")},goog.testing.TestCase.prototype.resetBatchTimeAfterPromise_=function(){this.batchTime_=this.now()},goog.testing.TestCase.prototype.finishTestInvocation_=function(t){return 1==arguments.length&&this.recordError(this.curTest_.name,t),this.curTest_.name in this.result_.resultsByName&&this.result_.resultsByName[this.curTest_.name].length?this.doError(this.curTest_):goog.array.indexOf(this.result_.suppressedTests,this.curTest_.name)>=0?this.doSkipped(this.curTest_):this.doSuccess(this.curTest_),goog.testing.TestCase.currentTestName=null,this.now()-this.batchTime_>goog.testing.TestCase.maxRunTime?(this.saveMessage("Breaking async"),this.timeout(goog.bind(this.startNextBatch_,this),0),null):new goog.testing.Continuation_(goog.bind(this.runNextTest_,this))},goog.testing.TestCase.prototype.startNextBatch_=function(){this.batchTime_=this.now(),goog.testing.Continuation_.run(this.runNextTest_())},goog.testing.TestCase.prototype.orderTests_=function(){switch(this.order){case goog.testing.TestCase.Order.RANDOM:for(var t=this.tests_.length;t>1;){var e=Math.floor(Math.random()*t);t--;var s=this.tests_[t];this.tests_[t]=this.tests_[e],this.tests_[e]=s}break;case goog.testing.TestCase.Order.SORTED:this.tests_.sort(function(t,e){return t.name==e.name?0:t.name<e.name?-1:1})}},goog.testing.TestCase.prototype.getGlobals=function(t){return goog.testing.TestCase.getGlobals(t)},goog.testing.TestCase.getGlobals=function(t){return void 0!==goog.global.RuntimeObject?[goog.global.RuntimeObject((t||"")+"*"),goog.global]:[goog.global]},goog.testing.TestCase.activeTestCase_=null,goog.testing.TestCase.getActiveTestCase=function(){var t=goog.global.G_testRunner;return t&&t.testCase?t.testCase:goog.testing.TestCase.activeTestCase_},goog.testing.TestCase.invalidateAssertionException=function(t){var e=goog.testing.TestCase.getActiveTestCase();e?e.invalidateAssertionException(t):goog.global.console.error("Failed to remove expected exception: no test case is installed.")},goog.testing.TestCase.prototype.setUpPage=function(){},goog.testing.TestCase.prototype.tearDownPage=function(){},goog.testing.TestCase.prototype.setUp=function(){},goog.testing.TestCase.prototype.tearDown=function(){},goog.testing.TestCase.prototype.getAutoDiscoveryPrefix=function(){return"test"},goog.testing.TestCase.prototype.getBatchTime=function(){return this.batchTime_},goog.testing.TestCase.prototype.setBatchTime=function(t){this.batchTime_=t},goog.testing.TestCase.prototype.createTest=function(t,e,s,o){return new goog.testing.TestCase.Test(t,e,s,o)},goog.testing.TestCase.prototype.autoDiscoverLifecycle=function(){this.setLifecycleObj(goog.global)},goog.testing.TestCase.prototype.setLifecycleObj=function(t){t.setUp&&(this.setUp=goog.bind(t.setUp,t)),t.tearDown&&(this.tearDown=goog.bind(t.tearDown,t)),t.setUpPage&&(this.setUpPage=goog.bind(t.setUpPage,t)),t.tearDownPage&&(this.tearDownPage=goog.bind(t.tearDownPage,t)),t.runTests&&(this.runTests=goog.bind(t.runTests,t)),t.shouldRunTests&&(this.shouldRunTests=goog.bind(t.shouldRunTests,t))},goog.testing.TestCase.prototype.setTestObj=function(t){this.tests_.length>0&&fail("Test methods have already been configured.\nTests previously found:\n"+this.tests_.map(function(t){return t.name}).join("\n")+"\nNew tests found:\n"+Object.keys(t).filter(function(t){return t.startsWith("test")}).join("\n")),this.shouldAutoDiscoverTests_=!1,t.getTestName&&(this.name_=t.getTestName()),this.setLifecycleObj(t),this.addTestObj_(t,"",[this])},goog.testing.TestCase.prototype.addTestObj_=function(t,e,s){for(var o=new RegExp("^"+this.getAutoDiscoveryPrefix()),n=goog.object.getAllPropertyNames(t),i=0;i<n.length;i++){var r=n[i];if(o.test(r)){var g;try{g=t[r]}catch(t){g=null}e&&(r=r.slice(this.getAutoDiscoveryPrefix().length));var a=e+(r&&e?"_":"")+r;if(goog.isFunction(g))this.addNewTest(a,g,t,s);else if(goog.isObject(g)&&!goog.array.contains(s,g)){goog.asserts.assertObject(g);var u=s.slice();u.push(g),this.addTestObj_(g,a,u)}}}},goog.testing.TestCase.prototype.autoDiscoverTests=function(){this.autoDiscoverLifecycle();for(var t=this.getAutoDiscoveryPrefix(),e=this.getGlobals(t),s=0;s<e.length;s++){var o=e[s];this.addTestObj_(o,"",[this])}this.orderTests_()},goog.testing.TestCase.prototype.maybeFailTestEarly=function(t){return!!this.exceptionBeforeTest&&(t.name="setUpPage for "+t.name,this.recordError(t.name,this.exceptionBeforeTest),!0)},goog.testing.TestCase.prototype.cycleTests=function(){this.saveMessage("Start"),this.batchTime_=this.now(),this.running&&(this.runNextTestCallback_=goog.nullFunction,goog.testing.Continuation_.run(this.runNextTest_()))},goog.testing.TestCase.prototype.countNumFilesLoaded_=function(){for(var t=goog.dom.getElementsByTagName(goog.dom.TagName.SCRIPT),e=0,s=0,o=t.length;s<o;s++)t[s].src&&e++;return e},goog.testing.TestCase.prototype.timeout=function(t,e){return(0,goog.testing.TestCase.protectedSetTimeout_)(t,e)},goog.testing.TestCase.prototype.clearTimeout=function(t){(0,goog.testing.TestCase.protectedClearTimeout_)(t)},goog.testing.TestCase.prototype.now=function(){return goog.testing.TestCase.now()},goog.testing.TestCase.now=function(){return goog.testing.TestCase.protectedPerformance_?goog.testing.TestCase.protectedPerformance_.now():(new(0,goog.testing.TestCase.protectedDate_)).getTime()},goog.testing.TestCase.prototype.getTimeStamp_=function(){var t=new(0,goog.testing.TestCase.protectedDate_),e="00"+t.getMilliseconds();return e=e.substr(e.length-3),this.pad_(t.getHours())+":"+this.pad_(t.getMinutes())+":"+this.pad_(t.getSeconds())+"."+e},goog.testing.TestCase.prototype.pad_=function(t){return t<10?"0"+t:String(t)},goog.testing.TestCase.prototype.trimPath_=function(t){return t.substring(t.indexOf("google3")+8)},goog.testing.TestCase.prototype.doSuccess=function(t){this.result_.successCount++,t.name in this.result_.resultsByName||(this.result_.resultsByName[t.name]=[]);var e=t.name+" : PASSED";this.saveMessage(e),this.log(e),this.testDone_&&this.doTestDone_(t,[])},goog.testing.TestCase.prototype.doSkipped=function(t){this.result_.skipCount++,t.name in this.result_.resultsByName||(this.result_.resultsByName[t.name]=[]);var e=t.name+" : SKIPPED";this.saveMessage(e),this.log(e),this.testDone_&&this.doTestDone_(t,[])},goog.testing.TestCase.prototype.recordTestError=function(t){this.recordError(this.curTest_?this.curTest_.name:"<No active test>",t)},goog.testing.TestCase.prototype.recordError=function(t,e){if(!(e&&e.isJsUnitException&&e.loggedJsUnitException)){var s=this.logError(t,e);this.result_.errors.push(s),t in this.result_.resultsByName?this.result_.resultsByName[t].push(s):this.result_.resultsByName[t]=[s],e&&e.isJsUnitException&&(e.loggedJsUnitException=!0)}},goog.testing.TestCase.prototype.doError=function(t){var e=t.name+" : FAILED";if(this.log(e),this.saveMessage(e),this.testDone_){for(var s=this.result_.resultsByName[t.name],o=[],n=0;n<s.length;n++)o.push(s[n].toString());this.doTestDone_(t,o)}},goog.testing.TestCase.prototype.raiseAssertionException=function(t){throw this.thrownAssertionExceptions_.push(t),t},goog.testing.TestCase.prototype.invalidateAssertionException=function(t){goog.array.remove(this.thrownAssertionExceptions_,t)},goog.testing.TestCase.prototype.logError=function(t,e){var s=null,o=null;e?(this.log(e),"string"==typeof e?s=e:(s=e.message||e.description||e.toString(),o=e.stack?e.stack:e.stackTrace)):s="An unknown error occurred",o&&(o=(o=o.replace("Error: "+s+"\n","Error\n")).replace(/\n\s*(\bat\b)?\s*(goog\.labs\.testing\.EnvironmentTestCase_\.)?goog\.testing\.(Continuation_\.(prototype\.)?run|TestCase\.(prototype\.)?(execute|cycleTests|startNextBatch_|safeRunTest_|invokeFunction_?))[^\0]*/m,""));var n=new goog.testing.TestCase.Error(t,s,o);return this.saveMessage(n.toString()),n},goog.testing.TestCase.Test=function(t,e,s,o){if(this.name=t,this.ref=e||function(){},this.scope=s||null,this.setUps=[],this.tearDowns=[],this.objChain=o||[],o){for(var n=0;n<o.length;n++)goog.isFunction(o[n].setUp)&&this.setUps.push(goog.bind(o[n].setUp,o[n])),goog.isFunction(o[n].tearDown)&&this.tearDowns.push(goog.bind(o[n].tearDown,o[n]));this.tearDowns.reverse()}this.startTime_,this.stoppedTime_,this.waiting},goog.testing.TestCase.Test.prototype.execute=function(){this.ref.call(this.scope)},goog.testing.TestCase.Test.prototype.started=function(){this.startTime_=goog.testing.TestCase.now()},goog.testing.TestCase.Test.prototype.stopped=function(){this.stoppedTime_=goog.testing.TestCase.now()},goog.testing.TestCase.Test.prototype.getElapsedTime=function(){return this.stoppedTime_-this.startTime_},goog.testing.TestCase.Result=function(t){this.testCase_=t,this.totalCount=0,this.runCount=0,this.successCount=0,this.skipCount=0,this.runTime=0,this.numFilesLoaded=0,this.testSuppressed=!1,this.suppressedTests=[],this.resultsByName={},this.errors=[],this.messages=[],this.complete=!1},goog.testing.TestCase.Result.prototype.isSuccess=function(){return this.complete&&0==this.errors.length},goog.testing.TestCase.Result.prototype.getSummary=function(){var t=this.runCount+" of "+this.totalCount+" tests run in "+this.runTime+"ms.\n";if(this.testSuppressed)t+="Tests not run because shouldRunTests() returned false.";else{var e=this.totalCount-this.successCount-this.skipCount,s="";this.skipCount&&(s+=", "+this.skipCount+" skipped by shouldRunTests()");var o=this.testCase_.getActuallyRunCount();o&&(e=o-this.successCount-this.skipCount,s+=", "+(this.totalCount-o)+" suppressed by querystring"),t+=this.successCount+" passed, "+e+" failed"+s+".\n"+Math.round(this.runTime/this.runCount)+" ms/test. "+this.numFilesLoaded+" files loaded."}return t},goog.testing.TestCase.prototype.setTestDoneCallback=function(t){this.testDone_=t},goog.testing.TestCase.prototype.doTestDone_=function(t,e){t.stopped(),this.testDone_(t,e)},goog.testing.TestCase.initializeTestCase=function(t,e){if(e&&t.setTestDoneCallback(e),t.shouldAutoDiscoverTests_?t.autoDiscoverTests():t.orderTests_(),goog.global.location){var s=goog.global.location.search;t.setTestsToRun(goog.testing.TestCase.parseRunTests_(s))}goog.testing.TestCase.activeTestCase_=t},goog.testing.TestCase.initializeTestRunner=function(t,e){goog.testing.TestCase.initializeTestCase(t,e);var s=goog.global.G_testRunner;if(!s)throw new Error("G_testRunner is undefined. Please ensure goog.testing.jsunit is included.");s.initialize(t)},goog.testing.TestCase.parseRunTests_=function(t){var e=null,s=t.match(/(?:\?|&)runTests=([^?&]+)/i);if(s){e={};for(var o=s[1].split(","),n=0,i=o.length;n<i;n++)e[o[n]]=!0}return e},goog.testing.TestCase.prototype.rejectIfPromiseTimesOut_=function(t,e,s){var o=this,n=this.now();return new goog.Promise(function(i,r){var g=o.timeout(function(){var t=o.now()-n;r(new Error(s+"\nElapsed time: "+t+"ms."))},e);t.then(i,r);var a=goog.bind(o.clearTimeout,o,g);t.then(a,a)})},goog.testing.TestCase.Error=function(t,e,s){if(this.source=t,this.message=e,this.stack=null,s)this.stack=s;else if(Error.captureStackTrace)Error.captureStackTrace(this,goog.testing.TestCase.Error);else{var o=(new Error).stack;o&&(this.stack=o)}},goog.testing.TestCase.Error.prototype.toString=function(){return"ERROR in "+this.source+"\n"+this.message+(this.stack?"\n"+this.stack:"")},goog.testing.TestCase.Error.prototype.toObject_=function(){return{source:this.source,message:this.message,stacktrace:this.stack||""}},goog.testing.Continuation_=function(t){this.fn_=t},goog.testing.Continuation_.run=function(t){for(var e=t&&t.fn_;e;)t=e(),e=t&&t.fn_};