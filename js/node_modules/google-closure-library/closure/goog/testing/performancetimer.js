goog.setTestOnly("goog.testing.PerformanceTimer"),goog.provide("goog.testing.PerformanceTimer"),goog.provide("goog.testing.PerformanceTimer.Task"),goog.require("goog.array"),goog.require("goog.async.Deferred"),goog.require("goog.math"),goog.testing.PerformanceTimer=function(e,t){this.numSamples_=e||10,this.timeoutInterval_=t||5e3,this.discardOutliers_=!1},goog.testing.PerformanceTimer.now_=function(){return!goog.DEBUG&&window.performance&&window.performance.now?window.performance.now():goog.now()},goog.testing.PerformanceTimer.prototype.getNumSamples=function(){return this.numSamples_},goog.testing.PerformanceTimer.prototype.setNumSamples=function(e){this.numSamples_=e},goog.testing.PerformanceTimer.prototype.getTimeoutInterval=function(){return this.timeoutInterval_},goog.testing.PerformanceTimer.prototype.setTimeoutInterval=function(e){this.timeoutInterval_=e},goog.testing.PerformanceTimer.prototype.setDiscardOutliers=function(e){this.discardOutliers_=e},goog.testing.PerformanceTimer.prototype.isDiscardOutliers=function(){return this.discardOutliers_},goog.testing.PerformanceTimer.prototype.run=function(e){return this.runTask(new goog.testing.PerformanceTimer.Task(e))},goog.testing.PerformanceTimer.prototype.runTask=function(e){for(var t=[],o=goog.testing.PerformanceTimer.now_(),r=0,n=e.getTest(),i=e.getSetUp(),g=e.getTearDown(),a=0;a<this.numSamples_&&r<=this.timeoutInterval_;a++){i();var s=goog.testing.PerformanceTimer.now_();n();var m=goog.testing.PerformanceTimer.now_();g(),t[a]=m-s,r=m-o}return this.finishTask_(t)},goog.testing.PerformanceTimer.prototype.finishTask_=function(e){return this.discardOutliers_&&e.length>2&&(goog.array.remove(e,Math.min.apply(null,e)),goog.array.remove(e,Math.max.apply(null,e))),goog.testing.PerformanceTimer.createResults(e)},goog.testing.PerformanceTimer.prototype.runAsyncTask=function(e){var t=goog.testing.PerformanceTimer.now_(),o=e.getTest(),r=e.getSetUp(),n=e.getTearDown(),i=new goog.async.Deferred;return this.runAsyncTaskSample_(o,r,n,i,[],t),i},goog.testing.PerformanceTimer.prototype.runAsyncTaskSample_=function(e,t,o,r,n,i){var g=this;g.handleOptionalDeferred_(t,function(){var a=goog.testing.PerformanceTimer.now_();g.handleOptionalDeferred_(e,function(){var s=goog.testing.PerformanceTimer.now_();g.handleOptionalDeferred_(o,function(){n.push(s-a);var m=s-i;n.length<g.numSamples_&&m<=g.timeoutInterval_?g.runAsyncTaskSample_(e,t,o,r,n,i):r.callback(g.finishTask_(n))})})})},goog.testing.PerformanceTimer.median=function(e){e.sort(function(e,t){return e-t});let t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},goog.testing.PerformanceTimer.prototype.handleOptionalDeferred_=function(e,t){var o=e();o?o.addCallback(t):t()},goog.testing.PerformanceTimer.createResults=function(e){return{average:goog.math.average.apply(null,e),count:e.length,median:goog.testing.PerformanceTimer.median(e),maximum:Math.max.apply(null,e),minimum:Math.min.apply(null,e),standardDeviation:goog.math.standardDeviation.apply(null,e),total:goog.math.sum.apply(null,e)}},goog.testing.PerformanceTimer.TestFunction,goog.testing.PerformanceTimer.Task=function(e){this.test_=e},goog.testing.PerformanceTimer.Task.prototype.setUp_=goog.nullFunction,goog.testing.PerformanceTimer.Task.prototype.tearDown_=goog.nullFunction,goog.testing.PerformanceTimer.Task.prototype.getTest=function(){return this.test_},goog.testing.PerformanceTimer.Task.prototype.withSetUp=function(e){return this.setUp_=e,this},goog.testing.PerformanceTimer.Task.prototype.getSetUp=function(){return this.setUp_},goog.testing.PerformanceTimer.Task.prototype.withTearDown=function(e){return this.tearDown_=e,this},goog.testing.PerformanceTimer.Task.prototype.getTearDown=function(){return this.tearDown_};