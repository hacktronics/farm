goog.setTestOnly("goog.testing.ExpectedFailures"),goog.provide("goog.testing.ExpectedFailures"),goog.require("goog.asserts"),goog.require("goog.debug.DivConsole"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.events"),goog.require("goog.events.EventType"),goog.require("goog.log"),goog.require("goog.style"),goog.require("goog.testing.JsUnitException"),goog.require("goog.testing.TestCase"),goog.require("goog.testing.asserts"),goog.testing.ExpectedFailures=function(){goog.testing.ExpectedFailures.setUpConsole_(),this.reset_()},goog.testing.ExpectedFailures.console_=null,goog.testing.ExpectedFailures.prototype.logger_=goog.log.getLogger("goog.testing.ExpectedFailures"),goog.testing.ExpectedFailures.prototype.expectingFailure_,goog.testing.ExpectedFailures.prototype.failureMessage_,goog.testing.ExpectedFailures.prototype.suppressedFailures_,goog.testing.ExpectedFailures.setUpConsole_=function(){if(!goog.testing.ExpectedFailures.console_){var e=goog.dom.createDom(goog.dom.TagName.DIV,{style:"position: absolute; border-left:1px solid #333;border-bottom:1px solid #333; right: 0; top: 0; width: 1em;height: 1em; cursor: pointer; background-color: #cde;text-align: center; color: black"},"X"),o=goog.dom.createDom(goog.dom.TagName.DIV,{style:"position: absolute; border: 1px solid #333; right: 10px;top : 10px; width: 400px; display: none"},e);document.body.appendChild(o),goog.events.listen(e,goog.events.EventType.CLICK,function(){goog.style.setElementShown(o,!1)}),goog.testing.ExpectedFailures.console_=new goog.debug.DivConsole(o),goog.log.addHandler(goog.testing.ExpectedFailures.prototype.logger_,goog.bind(goog.style.setElementShown,null,o,!0)),goog.log.addHandler(goog.testing.ExpectedFailures.prototype.logger_,goog.bind(goog.testing.ExpectedFailures.console_.addLogRecord,goog.testing.ExpectedFailures.console_))}},goog.testing.ExpectedFailures.prototype.expectFailureFor=function(e,o){this.expectingFailure_=this.expectingFailure_||e,e&&(this.failureMessage_=this.failureMessage_||o||"")},goog.testing.ExpectedFailures.prototype.isExceptionExpected=function(e){return this.expectingFailure_&&e instanceof goog.testing.JsUnitException},goog.testing.ExpectedFailures.prototype.handleException=function(e){if(this.isExceptionExpected(e))return goog.asserts.assertInstanceof(e,goog.testing.JsUnitException),goog.log.info(this.logger_,"Suppressing test failure in "+goog.testing.TestCase.currentTestName+":"+(this.failureMessage_?"\n("+this.failureMessage_+")":""),e),this.suppressedFailures_.push(e),void goog.testing.TestCase.invalidateAssertionException(e);throw e},goog.testing.ExpectedFailures.prototype.run=function(e,o){try{e()}catch(e){this.handleException(e)}o||!this.expectingFailure_||this.suppressedFailures_.length||fail(this.getExpectationMessage_())},goog.testing.ExpectedFailures.prototype.getExpectationMessage_=function(){return"Expected a test failure in '"+goog.testing.TestCase.currentTestName+"' but the test passed."},goog.testing.ExpectedFailures.prototype.handleTearDown=function(){this.expectingFailure_&&!this.suppressedFailures_.length&&goog.log.warning(this.logger_,this.getExpectationMessage_()),this.reset_()},goog.testing.ExpectedFailures.prototype.reset_=function(){this.expectingFailure_=!1,this.failureMessage_="",this.suppressedFailures_=[]};