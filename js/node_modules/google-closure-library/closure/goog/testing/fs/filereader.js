goog.setTestOnly("goog.testing.fs.FileReader"),goog.provide("goog.testing.fs.FileReader"),goog.require("goog.Timer"),goog.require("goog.events.EventTarget"),goog.require("goog.fs.Error"),goog.require("goog.fs.FileReader"),goog.require("goog.testing.fs.Blob"),goog.require("goog.testing.fs.ProgressEvent"),goog.testing.fs.FileReader=function(){goog.testing.fs.FileReader.base(this,"constructor"),this.readyState_=goog.fs.FileReader.ReadyState.INIT},goog.inherits(goog.testing.fs.FileReader,goog.events.EventTarget),goog.testing.fs.FileReader.prototype.error_,goog.testing.fs.FileReader.prototype.aborted_=!1,goog.testing.fs.FileReader.prototype.blob_,goog.testing.fs.FileReader.ReturnType={TEXT:1,BINARY_STRING:2,ARRAY_BUFFER:3,DATA_URL:4},goog.testing.fs.FileReader.prototype.returnType_,goog.testing.fs.FileReader.prototype.getReadyState=function(){return this.readyState_},goog.testing.fs.FileReader.prototype.getError=function(){return this.error_},goog.testing.fs.FileReader.prototype.abort=function(){if(this.readyState_!=goog.fs.FileReader.ReadyState.LOADING){throw new goog.fs.Error({name:"InvalidStateError"},"aborting read")}this.aborted_=!0},goog.testing.fs.FileReader.prototype.getResult=function(){if(this.readyState_==goog.fs.FileReader.ReadyState.DONE&&!this.error_)return this.returnType_==goog.testing.fs.FileReader.ReturnType.TEXT?this.blob_.toString():this.returnType_==goog.testing.fs.FileReader.ReturnType.ARRAY_BUFFER?this.blob_.toArrayBuffer():this.returnType_==goog.testing.fs.FileReader.ReturnType.BINARY_STRING?this.blob_.toString():this.returnType_==goog.testing.fs.FileReader.ReturnType.DATA_URL?this.blob_.toDataUrl():void 0},goog.testing.fs.FileReader.prototype.read_=function(e){if(this.blob_=e,this.readyState_==goog.fs.FileReader.ReadyState.LOADING){throw new goog.fs.Error({name:"InvalidStateError"},"reading file")}this.readyState_=goog.fs.FileReader.ReadyState.LOADING,goog.Timer.callOnce(function(){this.aborted_?this.abort_(e.size):(this.progressEvent_(goog.fs.FileReader.EventType.LOAD_START,0,e.size),this.progressEvent_(goog.fs.FileReader.EventType.LOAD,e.size/2,e.size),this.progressEvent_(goog.fs.FileReader.EventType.LOAD,e.size,e.size),this.readyState_=goog.fs.FileReader.ReadyState.DONE,this.progressEvent_(goog.fs.FileReader.EventType.LOAD,e.size,e.size),this.progressEvent_(goog.fs.FileReader.EventType.LOAD_END,e.size,e.size))},0,this)},goog.testing.fs.FileReader.prototype.readAsBinaryString=function(e){this.returnType_=goog.testing.fs.FileReader.ReturnType.BINARY_STRING,this.read_(e)},goog.testing.fs.FileReader.prototype.readAsArrayBuffer=function(e){this.returnType_=goog.testing.fs.FileReader.ReturnType.ARRAY_BUFFER,this.read_(e)},goog.testing.fs.FileReader.prototype.readAsText=function(e,t){this.returnType_=goog.testing.fs.FileReader.ReturnType.TEXT,this.read_(e)},goog.testing.fs.FileReader.prototype.readAsDataUrl=function(e){this.returnType_=goog.testing.fs.FileReader.ReturnType.DATA_URL,this.read_(e)},goog.testing.fs.FileReader.prototype.abort_=function(e){this.error_=new goog.fs.Error({name:"AbortError"},"reading file"),this.progressEvent_(goog.fs.FileReader.EventType.ERROR,0,e),this.progressEvent_(goog.fs.FileReader.EventType.ABORT,0,e),this.readyState_=goog.fs.FileReader.ReadyState.DONE,this.progressEvent_(goog.fs.FileReader.EventType.LOAD_END,0,e),this.aborted_=!1},goog.testing.fs.FileReader.prototype.progressEvent_=function(e,t,o){this.dispatchEvent(new goog.testing.fs.ProgressEvent(e,t,o))};