goog.setTestOnly("goog.testing.fs.DirectoryEntry"),goog.provide("goog.testing.fs.DirectoryEntry"),goog.provide("goog.testing.fs.Entry"),goog.provide("goog.testing.fs.FileEntry"),goog.forwardDeclare("goog.testing.fs.FileSystem"),goog.require("goog.Timer"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.async.Deferred"),goog.require("goog.fs.DirectoryEntry"),goog.require("goog.fs.DirectoryEntryImpl"),goog.require("goog.fs.Entry"),goog.require("goog.fs.Error"),goog.require("goog.fs.FileEntry"),goog.require("goog.functions"),goog.require("goog.object"),goog.require("goog.string"),goog.require("goog.testing.fs.File"),goog.require("goog.testing.fs.FileWriter"),goog.testing.fs.Entry=function(t,e,o){this.fs_=t,this.name_=o,this.parent=e},goog.testing.fs.Entry.prototype.deleted=!1,goog.testing.fs.Entry.prototype.isFile=goog.abstractMethod,goog.testing.fs.Entry.prototype.isDirectory=goog.abstractMethod,goog.testing.fs.Entry.prototype.getName=function(){return this.name_},goog.testing.fs.Entry.prototype.getFullPath=function(){return""==this.getName()||""==this.parent.getName()?"/"+this.name_:this.parent.getFullPath()+"/"+this.name_},goog.testing.fs.Entry.prototype.getFileSystem=function(){return this.fs_},goog.testing.fs.Entry.prototype.getLastModified=goog.abstractMethod,goog.testing.fs.Entry.prototype.getMetadata=goog.abstractMethod,goog.testing.fs.Entry.prototype.moveTo=function(t,e){var o,r="moving "+this.getFullPath()+" into "+t.getFullPath()+(e?", renaming to "+e:"");return this.checkNotDeleted(r).addCallback(function(){return this.copyTo(t,e)}).addCallback(function(t){return o=t,this.remove()}).addCallback(function(){return o})},goog.testing.fs.Entry.prototype.copyTo=function(t,e){goog.asserts.assert(t instanceof goog.testing.fs.DirectoryEntry);var o="copying "+this.getFullPath()+" into "+t.getFullPath()+(e?", renaming to "+e:""),r=this;return this.checkNotDeleted(o).addCallback(function(){goog.asserts.assert(t instanceof goog.testing.fs.DirectoryEntry);var o=e||r.getName(),i=r.clone();return t.children[o]=i,t.lastModifiedTimestamp_=goog.now(),i.name_=o,i.parent=t,i})},goog.testing.fs.Entry.prototype.clone=goog.abstractMethod,goog.testing.fs.Entry.prototype.toUrl=function(t){return"fakefilesystem:"+this.getFullPath()},goog.testing.fs.Entry.prototype.toUri=goog.testing.fs.Entry.prototype.toUrl,goog.testing.fs.Entry.prototype.wrapEntry=goog.abstractMethod,goog.testing.fs.Entry.prototype.remove=function(){var t="removing "+this.getFullPath(),e=this;return this.checkNotDeleted(t).addCallback(function(){delete this.parent.children[e.getName()],e.parent.lastModifiedTimestamp_=goog.now(),e.deleted=!0})},goog.testing.fs.Entry.prototype.getParent=function(){var t="getting parent of "+this.getFullPath();return this.checkNotDeleted(t).addCallback(function(){return this.parent})},goog.testing.fs.Entry.prototype.checkNotDeleted=function(t){var e=new goog.async.Deferred(void 0,this);return goog.Timer.callOnce(function(){if(this.deleted){var o=new goog.fs.Error({name:"NotFoundError"},t);e.errback(o)}else e.callback()},0,this),e},goog.testing.fs.DirectoryEntry=function(t,e,o,r){goog.testing.fs.DirectoryEntry.base(this,"constructor",t,e||this,o),this.children=r,this.lastModifiedTimestamp_=goog.now()},goog.inherits(goog.testing.fs.DirectoryEntry,goog.testing.fs.Entry),goog.testing.fs.DirectoryEntry.prototype.getMetadata_=function(){return{modificationTime:new Date(this.lastModifiedTimestamp_)}},goog.testing.fs.DirectoryEntry.prototype.isFile=function(){return!1},goog.testing.fs.DirectoryEntry.prototype.isDirectory=function(){return!0},goog.testing.fs.DirectoryEntry.prototype.getLastModified=function(){var t="reading last modified date for "+this.getFullPath();return this.checkNotDeleted(t).addCallback(function(){return new Date(this.lastModifiedTimestamp_)})},goog.testing.fs.DirectoryEntry.prototype.getMetadata=function(){var t="reading metadata for "+this.getFullPath();return this.checkNotDeleted(t).addCallback(function(){return this.getMetadata_()})},goog.testing.fs.DirectoryEntry.prototype.clone=function(){return new goog.testing.fs.DirectoryEntry(this.getFileSystem(),this.parent,this.getName(),this.children)},goog.testing.fs.DirectoryEntry.prototype.remove=function(){if(goog.object.isEmpty(this.children))return this!=this.getFileSystem().getRoot()?goog.testing.fs.DirectoryEntry.base(this,"remove"):goog.async.Deferred.succeed();var t=new goog.async.Deferred;return goog.Timer.callOnce(function(){t.errback(new goog.fs.Error({name:"InvalidModificationError"},"removing "+this.getFullPath()))},0,this),t},goog.testing.fs.DirectoryEntry.prototype.getFile=function(t,e){var o="loading file "+t+" from "+this.getFullPath();return e=e||goog.fs.DirectoryEntry.Behavior.DEFAULT,this.checkNotDeleted(o).addCallback(function(){try{return goog.async.Deferred.succeed(this.getFileSync(t,e))}catch(t){return goog.async.Deferred.fail(t)}})},goog.testing.fs.DirectoryEntry.prototype.getDirectory=function(t,e){var o="loading directory "+t+" from "+this.getFullPath();return e=e||goog.fs.DirectoryEntry.Behavior.DEFAULT,this.checkNotDeleted(o).addCallback(function(){try{return goog.async.Deferred.succeed(this.getDirectorySync(t,e))}catch(t){return goog.async.Deferred.fail(t)}})},goog.testing.fs.DirectoryEntry.prototype.getFileSync=function(t,e,o,r){return e=e||goog.fs.DirectoryEntry.Behavior.DEFAULT,this.getEntry_(t,e,!0,goog.bind(function(t,e){return new goog.testing.fs.FileEntry(this.getFileSystem(),t,e,void 0!==o?o:"",r)},this))},goog.testing.fs.DirectoryEntry.prototype.createFileSync=function(t){return this.getFileSync(t,goog.fs.DirectoryEntry.Behavior.CREATE)},goog.testing.fs.DirectoryEntry.prototype.getDirectorySync=function(t,e){return e=e||goog.fs.DirectoryEntry.Behavior.DEFAULT,this.getEntry_(t,e,!1,goog.bind(function(t,e){return new goog.testing.fs.DirectoryEntry(this.getFileSystem(),t,e,{})},this))},goog.testing.fs.DirectoryEntry.prototype.createDirectorySync=function(t){return this.getDirectorySync(t,goog.fs.DirectoryEntry.Behavior.CREATE)},goog.testing.fs.DirectoryEntry.prototype.getEntry_=function(t,e,o,r){var i=goog.array.filter(t.split("/"),goog.functions.identity),g=goog.array.peek(i)||"",n=goog.string.startsWith(t,"/")?this.getFileSystem().getRoot():this;goog.array.forEach(i.slice(0,-1),function(e){var o=n.children[e];if(!o)throw new goog.fs.Error({name:"NotFoundError"},"loading "+t+" from "+this.getFullPath()+" (directory "+n.getFullPath()+"/"+e+")");n=o},this);var s=g?n.children[g]:n;if(s){if(e==goog.fs.DirectoryEntry.Behavior.CREATE_EXCLUSIVE)throw new goog.fs.Error({name:"InvalidModificationError"},"loading "+t+" from "+this.getFullPath());if(s.isFile()!=o)throw new goog.fs.Error({name:"TypeMismatchError"},"loading "+t+" from "+this.getFullPath());return e==goog.fs.DirectoryEntry.Behavior.CREATE&&(this.lastModifiedTimestamp_=goog.now()),s}if(e==goog.fs.DirectoryEntry.Behavior.DEFAULT)throw new goog.fs.Error({name:"NotFoundError"},"loading "+t+" from "+this.getFullPath());return goog.asserts.assert(e==goog.fs.DirectoryEntry.Behavior.CREATE||e==goog.fs.DirectoryEntry.Behavior.CREATE_EXCLUSIVE),s=r(n,g),n.children[g]=s,this.lastModifiedTimestamp_=goog.now(),s},goog.testing.fs.DirectoryEntry.prototype.hasChild=function(t){return t in this.children},goog.testing.fs.DirectoryEntry.prototype.removeRecursively=function(){var t="removing "+this.getFullPath()+" recursively";return this.checkNotDeleted(t).addCallback(function(){var t=goog.async.Deferred.succeed(null);return goog.object.forEach(this.children,function(e){t.awaitDeferred(e.isDirectory()?e.removeRecursively():e.remove())}),t.addCallback(function(){return this.remove()},this),t})},goog.testing.fs.DirectoryEntry.prototype.listDirectory=function(){var t="listing "+this.getFullPath();return this.checkNotDeleted(t).addCallback(function(){return goog.object.getValues(this.children)})},goog.testing.fs.DirectoryEntry.prototype.createPath=goog.fs.DirectoryEntryImpl.prototype.createPath,goog.testing.fs.FileEntry=function(t,e,o,r,i){goog.testing.fs.FileEntry.base(this,"constructor",t,e,o),this.file_=new goog.testing.fs.File(o,new Date(goog.now()),r,i),this.metadata_={modificationTime:this.file_.lastModifiedDate}},goog.inherits(goog.testing.fs.FileEntry,goog.testing.fs.Entry),goog.testing.fs.FileEntry.prototype.isFile=function(){return!0},goog.testing.fs.FileEntry.prototype.isDirectory=function(){return!1},goog.testing.fs.FileEntry.prototype.clone=function(){return new goog.testing.fs.FileEntry(this.getFileSystem(),this.parent,this.getName(),this.fileSync().toString())},goog.testing.fs.FileEntry.prototype.getLastModified=function(){return this.file().addCallback(function(t){return t.lastModifiedDate})},goog.testing.fs.FileEntry.prototype.getMetadata=function(){var t="getting metadata for "+this.getFullPath();return this.checkNotDeleted(t).addCallback(function(){return this.metadata_})},goog.testing.fs.FileEntry.prototype.createWriter=function(){var t=new goog.async.Deferred;return goog.Timer.callOnce(goog.bind(t.callback,t,new goog.testing.fs.FileWriter(this))),t},goog.testing.fs.FileEntry.prototype.file=function(){var t="getting file for "+this.getFullPath();return this.checkNotDeleted(t).addCallback(function(){return this.fileSync()})},goog.testing.fs.FileEntry.prototype.fileSync=function(){return this.file_};