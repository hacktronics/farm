goog.setTestOnly("goog.testing.fs.FileWriter"),goog.provide("goog.testing.fs.FileWriter"),goog.forwardDeclare("goog.testing.fs.FileEntry"),goog.require("goog.Timer"),goog.require("goog.events.EventTarget"),goog.require("goog.fs.Error"),goog.require("goog.fs.FileSaver"),goog.require("goog.string"),goog.require("goog.testing.fs.Blob"),goog.require("goog.testing.fs.File"),goog.require("goog.testing.fs.ProgressEvent"),goog.testing.fs.FileWriter=function(t){goog.testing.fs.FileWriter.base(this,"constructor"),this.fileEntry_=t,this.file_=t.fileSync(),this.readyState_=goog.fs.FileSaver.ReadyState.INIT},goog.inherits(goog.testing.fs.FileWriter,goog.events.EventTarget),goog.testing.fs.FileWriter.prototype.error_,goog.testing.fs.FileWriter.prototype.aborted_=!1,goog.testing.fs.FileWriter.prototype.position_=0,goog.testing.fs.FileWriter.prototype.getReadyState=function(){return this.readyState_},goog.testing.fs.FileWriter.prototype.getError=function(){return this.error_},goog.testing.fs.FileWriter.prototype.getPosition=function(){return this.position_},goog.testing.fs.FileWriter.prototype.getLength=function(){return this.file_.size},goog.testing.fs.FileWriter.prototype.abort=function(){if(this.readyState_!=goog.fs.FileSaver.ReadyState.WRITING){var t="aborting save of "+this.fileEntry_.getFullPath();throw new goog.fs.Error({name:"InvalidStateError"},t)}this.aborted_=!0},goog.testing.fs.FileWriter.prototype.write=function(t){if(this.readyState_==goog.fs.FileSaver.ReadyState.WRITING){var e="writing to "+this.fileEntry_.getFullPath();throw new goog.fs.Error({name:"InvalidStateError"},e)}this.readyState_=goog.fs.FileSaver.ReadyState.WRITING,goog.Timer.callOnce(function(){if(this.aborted_)this.abort_(t.size);else{this.progressEvent_(goog.fs.FileSaver.EventType.WRITE_START,0,t.size);var e=this.file_.toString();this.file_.setDataInternal(e.substring(0,this.position_)+t.toString()+e.substring(this.position_+t.size,e.length)),this.position_+=t.size,this.progressEvent_(goog.fs.FileSaver.EventType.WRITE,t.size,t.size),this.readyState_=goog.fs.FileSaver.ReadyState.DONE,this.progressEvent_(goog.fs.FileSaver.EventType.WRITE_END,t.size,t.size)}},0,this)},goog.testing.fs.FileWriter.prototype.truncate=function(t){if(this.readyState_==goog.fs.FileSaver.ReadyState.WRITING){var e="truncating "+this.fileEntry_.getFullPath();throw new goog.fs.Error({name:"InvalidStateError"},e)}this.readyState_=goog.fs.FileSaver.ReadyState.WRITING,goog.Timer.callOnce(function(){if(this.aborted_)this.abort_(t);else{this.progressEvent_(goog.fs.FileSaver.EventType.WRITE_START,0,t);var e=this.file_.toString();t>e.length?this.file_.setDataInternal(e+goog.string.repeat("\0",t-e.length)):this.file_.setDataInternal(e.substring(0,t)),this.position_=Math.min(this.position_,t),this.progressEvent_(goog.fs.FileSaver.EventType.WRITE,t,t),this.readyState_=goog.fs.FileSaver.ReadyState.DONE,this.progressEvent_(goog.fs.FileSaver.EventType.WRITE_END,t,t)}},0,this)},goog.testing.fs.FileWriter.prototype.seek=function(t){if(this.readyState_==goog.fs.FileSaver.ReadyState.WRITING){var e="truncating "+this.fileEntry_.getFullPath();throw new goog.fs.Error({name:"InvalidStateError"},e)}this.position_=t<0?Math.max(0,this.file_.size+t):Math.min(t,this.file_.size)},goog.testing.fs.FileWriter.prototype.abort_=function(t){this.error_=new goog.fs.Error({name:"AbortError"},"saving "+this.fileEntry_.getFullPath()),this.progressEvent_(goog.fs.FileSaver.EventType.ERROR,0,t),this.progressEvent_(goog.fs.FileSaver.EventType.ABORT,0,t),this.readyState_=goog.fs.FileSaver.ReadyState.DONE,this.progressEvent_(goog.fs.FileSaver.EventType.WRITE_END,0,t),this.aborted_=!1},goog.testing.fs.FileWriter.prototype.progressEvent_=function(t,e,o){t==goog.fs.FileSaver.EventType.WRITE&&(this.file_.lastModifiedDate=new Date(goog.now())),this.dispatchEvent(new goog.testing.fs.ProgressEvent(t,e,o))};