goog.setTestOnly("goog.testing.StrictMock"),goog.provide("goog.testing.StrictMock"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.structs.Set"),goog.require("goog.testing.Mock"),goog.testing.StrictMock=function(t,i,o){goog.testing.Mock.call(this,t,i,o),this.$expectations_=[],this.awaitingExpectations_=new goog.structs.Set},goog.inherits(goog.testing.StrictMock,goog.testing.Mock),goog.testing.StrictMock.prototype.$recordExpectation=function(){this.$pendingExpectation&&(this.$expectations_.push(this.$pendingExpectation),this.awaitingExpectations_.add(this.$pendingExpectation))},goog.testing.StrictMock.prototype.$recordCall=function(t,i){0==this.$expectations_.length&&this.$throwCallException(t,i);for(var o=this.$expectations_[0];!this.$verifyCall(o,t,i);)o.actualCalls<o.minCalls&&this.$throwCallException(t,i,o),this.$expectations_.shift(),this.awaitingExpectations_.remove(o),this.maybeFinishedWithExpectations_(),this.$expectations_.length<1&&this.$throwCallException(t,i,o),o=this.$expectations_[0];return 0==o.maxCalls&&this.$throwCallException(t,i),o.actualCalls++,o.actualCalls==o.maxCalls&&this.$expectations_.shift(),o.actualCalls>=o.minCalls&&(this.awaitingExpectations_.remove(o),this.maybeFinishedWithExpectations_()),this.$do(o,i)},goog.testing.StrictMock.prototype.$reset=function(){goog.testing.StrictMock.superClass_.$reset.call(this),goog.array.clear(this.$expectations_),this.awaitingExpectations_.clear()},goog.testing.StrictMock.prototype.$waitAndVerify=function(){for(var t=0;t<this.$expectations_.length;t++){var i=this.$expectations_[t];goog.asserts.assert(!isFinite(i.maxCalls)||i.minCalls==i.maxCalls,"Mock expectations cannot have a loose number of expected calls to use $waitAndVerify.")}var o=goog.testing.StrictMock.base(this,"$waitAndVerify");return this.maybeFinishedWithExpectations_(),o},goog.testing.StrictMock.prototype.maybeFinishedWithExpectations_=function(){var t=goog.array.count(this.$expectations_,function(t){return t.actualCalls<t.minCalls});this.waitingForExpectations&&!t&&this.waitingForExpectations.resolve()},goog.testing.StrictMock.prototype.$verify=function(){for(goog.testing.StrictMock.superClass_.$verify.call(this);this.$expectations_.length>0;){var t=this.$expectations_[0];t.actualCalls<t.minCalls?this.$throwException("Missing a call to "+t.name+"\nExpected: "+t.minCalls+" but was: "+t.actualCalls):this.$expectations_.shift()}};