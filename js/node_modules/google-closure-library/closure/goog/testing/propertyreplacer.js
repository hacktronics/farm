goog.setTestOnly("goog.testing.PropertyReplacer"),goog.provide("goog.testing.PropertyReplacer"),goog.require("goog.asserts"),goog.require("goog.userAgent"),goog.testing.PropertyReplacer=function(){this.original_=[]},goog.testing.PropertyReplacer.NO_SUCH_KEY_={},goog.testing.PropertyReplacer.hasKey_=function(e,t){if(!(t in e))return!1;if(Object.prototype.hasOwnProperty.call(e,t))return!0;if(e.constructor==Object&&(!goog.userAgent.OPERA||"[object Object]"==Object.prototype.toString.call(e)))return!1;try{e.constructor.prototype[t]}catch(e){return!0}return!(t in e.constructor.prototype)},goog.testing.PropertyReplacer.deleteKey_=function(e,t){try{if(delete e[t],!goog.testing.PropertyReplacer.hasKey_(e,t))return}catch(e){}if(e[t]=void 0,"undefined"==e[t]&&(e[t]=""),e[t])throw new Error('Cannot delete non configurable property "'+t+'" in '+e)},goog.testing.PropertyReplacer.restoreOriginal_=function(e){e.value==goog.testing.PropertyReplacer.NO_SUCH_KEY_?goog.testing.PropertyReplacer.deleteKey_(e.object,e.key):e.object[e.key]=e.value},goog.testing.PropertyReplacer.prototype.set=function(e,t,o){goog.asserts.assert(e);var r=goog.testing.PropertyReplacer.hasKey_(e,t)?e[t]:goog.testing.PropertyReplacer.NO_SUCH_KEY_;if(this.original_.push({object:e,key:t,value:r}),e[t]=o,e[t]!=o&&o+"px"!=e[t])throw new Error('Cannot overwrite read-only property "'+t+'" in '+e)},goog.testing.PropertyReplacer.prototype.replace=function(e,t,o,r){if(!(t in e))throw new Error('Cannot replace missing property "'+t+'" in '+e);if(!r||null!=e[t]&&null!=o){var g=goog.typeOf(e[t]),n=goog.typeOf(o);if(g!=n)throw new Error('Cannot replace property "'+t+'" in '+e+" with a value of different type (expected "+g+", found "+n+")")}this.set(e,t,o)},goog.testing.PropertyReplacer.prototype.setPath=function(e,t){for(var o=e.split("."),r=goog.global,g=0;g<o.length-1;g++){var n=o[g];if("prototype"==n&&!r[n])throw new Error("Cannot set the prototype of "+o.slice(0,g).join("."));goog.isObject(r[n])||goog.isFunction(r[n])||this.set(r,n,{}),r=r[n]}this.set(r,o[o.length-1],t)},goog.testing.PropertyReplacer.prototype.remove=function(e,t){e&&goog.testing.PropertyReplacer.hasKey_(e,t)&&(this.original_.push({object:e,key:t,value:e[t]}),goog.testing.PropertyReplacer.deleteKey_(e,t))},goog.testing.PropertyReplacer.prototype.restore=function(e,t){for(var o=this.original_.length-1;o>=0;o--){var r=this.original_[o];if(r.object===e&&r.key==t)return goog.testing.PropertyReplacer.restoreOriginal_(r),void this.original_.splice(o,1)}throw new Error('Cannot restore unmodified property "'+t+'" of '+e)},goog.testing.PropertyReplacer.prototype.reset=function(){for(var e=this.original_.length-1;e>=0;e--)goog.testing.PropertyReplacer.restoreOriginal_(this.original_[e]),delete this.original_[e];this.original_.length=0};