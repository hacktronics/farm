goog.setTestOnly("goog.testing.TestRunner"),goog.provide("goog.testing.TestRunner"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.dom.safe"),goog.require("goog.json"),goog.require("goog.testing.TestCase"),goog.require("goog.userAgent"),goog.testing.TestRunner=function(){if(this.errors=[],this.testCase=null,this.initialized=!1,this.logEl_=null,this.errorFilter_=null,this.strict_=!0,this.jsonStringify_=goog.json.serialize,this.uniqueId_=(1e9*Math.random()>>>0)+"-"+window.location.pathname.replace(/.*\//,"").replace(/\.html.*$/,""),!goog.userAgent.IE||goog.userAgent.isVersionOrHigher(11)){var t=this;window.addEventListener("pagehide",function(){t.clearUniqueId()})}},goog.testing.TestRunner.prototype.getSearchString=function(){return window.location.search},goog.testing.TestRunner.prototype.getUniqueId=function(){return this.uniqueId_},goog.testing.TestRunner.prototype.clearUniqueId=function(){this.uniqueId_="pagehide"},goog.testing.TestRunner.prototype.initialize=function(t){if(this.testCase&&this.testCase.running)throw new Error("The test runner is already waiting for a test to complete");this.testCase=t,this.initialized=!0},goog.testing.TestRunner.prototype.setStrict=function(t){this.strict_=t},goog.testing.TestRunner.prototype.isStrict=function(){return this.strict_},goog.testing.TestRunner.prototype.isInitialized=function(){return this.initialized},goog.testing.TestRunner.prototype.isFinished=function(){return this.errors.length>0||this.isComplete()},goog.testing.TestRunner.prototype.isComplete=function(){return this.initialized&&!!this.testCase&&this.testCase.started&&!this.testCase.running},goog.testing.TestRunner.prototype.isSuccess=function(){return!this.hasErrors()&&!!this.testCase&&this.testCase.isSuccess()},goog.testing.TestRunner.prototype.hasErrors=function(){return this.errors.length>0},goog.testing.TestRunner.prototype.logError=function(t){this.isComplete()?this.log("Error after test completed: "+t):this.errorFilter_&&!this.errorFilter_.call(null,t)||this.errors.push(t)},goog.testing.TestRunner.prototype.logTestFailure=function(t){var e=goog.testing.TestCase.currentTestName;if(!this.testCase)throw new Error("Test runner not initialized with a test case. Original exception: "+t.message);this.testCase.logError(e,t)},goog.testing.TestRunner.prototype.setErrorFilter=function(t){this.errorFilter_=t},goog.testing.TestRunner.prototype.getReport=function(t){var e=[];return this.testCase&&e.push(this.testCase.getReport(t)),this.errors.length>0&&(e.push("JavaScript errors detected by test runner:"),e.push.apply(e,this.errors),e.push("\n")),e.join("\n")},goog.testing.TestRunner.prototype.getRunTime=function(){return this.testCase?this.testCase.getRunTime():0},goog.testing.TestRunner.prototype.getNumFilesLoaded=function(){return this.testCase?this.testCase.getNumFilesLoaded():0},goog.testing.TestRunner.prototype.execute=function(){if(!this.testCase)throw new Error("The test runner must be initialized with a test case before execute can be called.");if(this.strict_&&0==this.testCase.getCount())throw new Error("No tests found in given test case: "+this.testCase.getName()+". By default, the test runner fails if a test case has no tests. To modify this behavior, see goog.testing.TestRunner's setStrict() method, or G_testRunner.setStrict()");this.testCase.addCompletedCallback(goog.bind(this.onComplete_,this)),goog.testing.TestRunner.shouldUsePromises_(this.testCase)?this.testCase.runTestsReturningPromise():this.testCase.runTests()},goog.testing.TestRunner.shouldUsePromises_=function(t){return t.constructor===goog.testing.TestCase},goog.testing.TestRunner.TEST_LOG_ID="closureTestRunnerLog",goog.testing.TestRunner.prototype.onComplete_=function(){var t=this.testCase.getReport(!0);if(this.errors.length>0&&(t+="\n"+this.errors.join("\n")),!this.logEl_){var e=document.getElementById(goog.testing.TestRunner.TEST_LOG_ID);null==e&&((e=goog.dom.createElement(goog.dom.TagName.DIV)).id=goog.testing.TestRunner.TEST_LOG_ID,e.dir="ltr",document.body.appendChild(e)),this.logEl_=e}this.writeLog(t);var s=goog.dom.createElement(goog.dom.TagName.A);s.style.display="inline-block",s.style.fontSize="small",s.style.marginBottom="16px",s.href="",s.onclick=goog.bind(function(){return this.execute(),!1},this),s.innerHTML="Run again without reloading",this.logEl_.appendChild(s)},goog.testing.TestRunner.prototype.writeLog=function(t){for(var e=t.split("\n"),s=0;s<e.length;s++){var o,r=e[s],n=/PASSED/.test(r),i=/SKIPPED/.test(r),g=/FAILED/.test(r)||/ERROR/.test(r)||/NO TESTS RUN/.test(r);o=n?"darkgreen":i?"slategray":g?"darkred":"#333";var a=goog.dom.createElement(goog.dom.TagName.DIV);""==r&&(r="\n"),"> "==r.substr(0,2)?a.innerHTML=r:a.appendChild(document.createTextNode(r));var u=/(\S+) (\[[^\]]*] )?: (FAILED|ERROR|PASSED)/.exec(r);if(u){var l="runTests="+u[1],h=window.location.search;if(h){var d=/runTests=([^&]*)/.exec(h);l=d?h.substr(0,d.index)+l+h.substr(d.index+d[0].length):h+"&"+l}else l="?"+l;var c=window.location.href,p=window.location.hash;p&&"#"!=p.charAt(0)&&(p="#"+p),c=c.split("#")[0].split("?")[0]+l+p;var T=goog.dom.createElement(goog.dom.TagName.A);T.innerHTML="(run individually)",T.style.fontSize="0.8em",T.style.color="#888",goog.dom.safe.setAnchorHref(T,c),a.appendChild(document.createTextNode(" ")),a.appendChild(T)}a.style.color=o,a.style.font="normal 100% monospace",a.style.wordWrap="break-word",0==s&&(a.style.padding="20px",a.style.marginBottom="10px",n?(a.style.border="1px solid "+o,a.style.backgroundColor="#eeffee"):g?(a.style.border="5px solid "+o,a.style.backgroundColor="#ffeeee"):(a.style.border="1px solid black",a.style.backgroundColor="#eeeeee"));try{a.style.whiteSpace="pre-wrap"}catch(t){}s<2&&(a.style.fontWeight="bold"),this.logEl_.appendChild(a)}},goog.testing.TestRunner.prototype.log=function(t){this.testCase&&this.testCase.log(t)},goog.testing.TestRunner.prototype.getTestResults=function(){return this.testCase?this.testCase.getTestResults():null},goog.testing.TestRunner.prototype.getTestResultsAsJson=function(){if(this.testCase){var t=this.testCase.getTestResults();if(this.hasErrors()){for(var e=[],s=0;s<this.errors.length;s++)e.push({source:"",message:this.errors[s],stacktrace:""});t.globalErrors=e}return this.jsonStringify_(t)}return null};