goog.setTestOnly("goog.testing.editor.dom"),goog.provide("goog.testing.editor.dom"),goog.require("goog.dom.AbstractRange"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.TagIterator"),goog.require("goog.dom.TagWalkType"),goog.require("goog.iter"),goog.require("goog.string"),goog.require("goog.testing.asserts"),goog.testing.editor.dom.getPreviousNonEmptyTextNode=function(e,o,t){return goog.testing.editor.dom.getPreviousNextNonEmptyTextNodeHelper_(e,o,t,!0)},goog.testing.editor.dom.getNextNonEmptyTextNode=function(e,o,t){return goog.testing.editor.dom.getPreviousNextNonEmptyTextNodeHelper_(e,o,t,!1)},goog.testing.editor.dom.getPreviousNextNonEmptyTextNodeHelper_=function(e,o,t,g){o=o||e.ownerDocument.body;var r,n=new goog.dom.TagIterator(o,g),d=goog.testing.editor.dom.getRelativeDepth_(e,o);if(-1==d)return null;e.nodeType==goog.dom.NodeType.ELEMENT&&(t?r=g?goog.dom.TagWalkType.START_TAG:goog.dom.TagWalkType.END_TAG:d++),n.setPosition(e,r,d);try{n.next()}catch(e){return null}var i=goog.iter.filter(n,goog.testing.editor.dom.isNonEmptyTextNode_);try{return i.next()}catch(e){return null}},goog.testing.editor.dom.isNonEmptyTextNode_=function(e){return!(!e||e.nodeType!=goog.dom.NodeType.TEXT)&&e.length>0},goog.testing.editor.dom.getRelativeDepth_=function(e,o){for(var t=0;e;){if(e==o)return t;e=e.parentNode,t++}return-1},goog.testing.editor.dom.assertRangeBetweenText=function(e,o,t,g){var r=goog.testing.editor.dom.getTextFollowingRange_(t,!0,g);""==e?assertNull("Expected nothing before range but found <"+r+">",r):(assertNotNull("Expected <"+e+"> before range but found nothing",r),assertTrue("Expected <"+e+"> before range but found <"+r+">",goog.string.endsWith(r,e)));var n=goog.testing.editor.dom.getTextFollowingRange_(t,!1,g);""==o?assertNull("Expected nothing after range but found <"+n+">",n):(assertNotNull("Expected <"+o+"> after range but found nothing",n),assertTrue("Expected <"+o+"> after range but found <"+n+">",goog.string.startsWith(n,o)))},goog.testing.editor.dom.getTextFollowingRange_=function(e,o,t){var g,r=o?e.getStartNode():e.getEndNode(),n=o?e.getStartOffset():e.getEndOffset(),d=o?goog.testing.editor.dom.getPreviousNonEmptyTextNode:goog.testing.editor.dom.getNextNonEmptyTextNode;if(r.nodeType==goog.dom.NodeType.TEXT){var i=r.nodeValue;return(o?n>0:n<i.length)?o?i.substr(0,n):i.substr(n):(g=d(r,t))&&g.nodeValue}var s=r.childNodes.length;if(o?n>0:n<s){var u=r.childNodes[o?n-1:n];return goog.testing.editor.dom.isNonEmptyTextNode_(u)?u.nodeValue:(g=d(u,t))&&g.nodeValue}return(g=d(r,t,!0))&&g.nodeValue};