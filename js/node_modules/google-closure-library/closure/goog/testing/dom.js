goog.setTestOnly("goog.testing.dom"),goog.provide("goog.testing.dom"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.AbstractRange"),goog.require("goog.dom.InputType"),goog.require("goog.dom.NodeIterator"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.TagIterator"),goog.require("goog.dom.TagName"),goog.require("goog.dom.classlist"),goog.require("goog.iter"),goog.require("goog.object"),goog.require("goog.string"),goog.require("goog.style"),goog.require("goog.testing.asserts"),goog.require("goog.userAgent"),goog.testing.dom.createEndTagMarker_=function(){var e=goog.dom.createElement(goog.dom.TagName.DIV);return e.id=goog.getUid(e),e},goog.testing.dom.END_TAG_MARKER_=goog.testing.dom.createEndTagMarker_(),goog.testing.dom.assertNodesMatch=function(e,o){var t=0;goog.iter.forEach(e,function(e){o.length<=t&&fail("Got more nodes than expected: "+goog.testing.dom.describeNode_(e));var g=o[t];if(goog.dom.isNodeLike(g))assertEquals("Nodes should match at position "+t,g,e);else if("number"==typeof g)assertEquals("Node types should match at position "+t,g,e.nodeType);else if("#"==g.charAt(0)){assertEquals("Expected element at position "+t,goog.dom.NodeType.ELEMENT,e.nodeType);var s=g.substr(1);assertEquals("IDs should match at position "+t,s,e.id)}else assertEquals("Expected text node at position "+t,goog.dom.NodeType.TEXT,e.nodeType),assertEquals("Node contents should match at position "+t,g,e.nodeValue);t++}),assertEquals("Used entire match array",o.length,t)},goog.testing.dom.exposeNode=function(e){var o=e.nodeName||e.nodeValue;return e.id&&(o+="#"+e.id),o+=':"'+(e.innerHTML||"")+'"'},goog.testing.dom.exposeRange=function(e){return e?goog.testing.dom.exposeNode(e.getStartNode())+":"+e.getStartOffset()+" to "+goog.testing.dom.exposeNode(e.getEndNode())+":"+e.getEndOffset():"null"},goog.testing.dom.checkUserAgents_=function(e){if(goog.string.startsWith(e,"!")){if(goog.string.contains(e," "))throw new Error("Only a single negative user agent may be specified");return!goog.userAgent[e.substr(1)]}for(var o=e.split(" "),t=!1,g=0,s=o.length;g<s;g++){var n=o[g];if(n in goog.userAgent&&(t=!0,goog.userAgent[n]))return!0}return!t},goog.testing.dom.endTagMap_=function(e,o,t){return goog.asserts.assertInstanceof(t,goog.dom.TagIterator),t.isEndTag()?goog.testing.dom.END_TAG_MARKER_:e},goog.testing.dom.nodeFilter_=function(e){if(e.nodeType==goog.dom.NodeType.TEXT){if(goog.string.isBreakingWhitespace(e.nodeValue)&&(!e.previousSibling||e.previousSibling.nodeType!=goog.dom.NodeType.TEXT)&&(!e.nextSibling||e.nextSibling.nodeType!=goog.dom.NodeType.TEXT))return!1;var o=e.nodeValue.match(/^\[\[(.+)\]\]/);return!o||goog.testing.dom.checkUserAgents_(o[1])}var t=e;return!t.className||"string"!=typeof t.className||goog.testing.dom.checkUserAgents_(t.className)},goog.testing.dom.getExpectedText_=function(e){return e.nodeValue.match(/^(\[\[.+\]\])?([\s\S]*)/)[2]},goog.testing.dom.describeNode_=function(e){return e.nodeType==goog.dom.NodeType.TEXT?"[Text: "+e.nodeValue+"]":"<"+e.tagName+(e.id?" #"+e.id:"")+" .../>"},goog.testing.dom.assertHtmlContentsMatch=function(e,o,t){var g=goog.dom.createDom(goog.dom.TagName.DIV);g.innerHTML=e;var s,n="\nExpected\n"+g.innerHTML+"\nActual\n"+o.innerHTML,r=goog.iter.filter(goog.iter.map(new goog.dom.TagIterator(o),goog.testing.dom.endTagMap_),goog.testing.dom.nodeFilter_),a=goog.iter.filter(new goog.dom.NodeIterator(g),goog.testing.dom.nodeFilter_),i=!1,d=function(){for(i||(s=goog.iter.nextOrValue(r,null)),i=!1;s==goog.testing.dom.END_TAG_MARKER_;)s=goog.iter.nextOrValue(r,null)},u=goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),m=!0,l=0;goog.iter.forEach(a,function(e){if(d(),assertNotNull("Finished actual HTML before finishing expected HTML at node number "+l+": "+goog.testing.dom.describeNode_(e)+n,s),e!=g){if(assertEquals("Should have the same node type, got "+goog.testing.dom.describeNode_(s)+" but expected "+goog.testing.dom.describeNode_(e)+"."+n,e.nodeType,s.nodeType),e.nodeType==goog.dom.NodeType.ELEMENT){var o=goog.asserts.assertElement(e),a=goog.asserts.assertElement(s);assertEquals("Tag names should match"+n,o.tagName,a.tagName),assertEquals("Namespaces should match"+n,o.namespaceURI,a.namespaceURI),assertObjectEquals("Should have same styles"+n,goog.style.parseStyleAttribute(o.style.cssText),goog.style.parseStyleAttribute(a.style.cssText)),goog.testing.dom.assertAttributesEqual_(n,o,a,!!t),u&&"inline"!=goog.style.getCascadedStyle(a,"display")&&(m=!0),a.tagName==goog.dom.TagName.TEMPLATE&&a.content&&goog.testing.dom.assertHtmlMatches(o.innerHTML,a.innerHTML,t)}else{var c=s.nodeValue;for(i=!0;(s=goog.iter.nextOrValue(r,null))&&s.nodeType==goog.dom.NodeType.TEXT;)c+=s.nodeValue;u&&(m&&!goog.string.isEmptyOrWhitespace(c)&&(c=goog.string.trimLeft(c)),m=/\s$/.test(c));var p=goog.testing.dom.getExpectedText_(e);if(c&&!goog.string.isBreakingWhitespace(c)||p&&!goog.string.isBreakingWhitespace(p)){var T=c.replace(/\s+/g," "),E=p.replace(/\s+/g," ");assertEquals("Text should match"+n,E,T)}}l++}}),d(),assertNull("Finished expected HTML before finishing actual HTML"+n,goog.iter.nextOrValue(r,null))},goog.testing.dom.assertHtmlMatches=function(e,o,t){var g=goog.dom.createDom(goog.dom.TagName.DIV);g.innerHTML=o,goog.testing.dom.assertHtmlContentsMatch(e,g,t)},goog.testing.dom.findTextNode=function(e,o){var t=new goog.dom.NodeIterator(o);return goog.iter.nextOrValue(goog.iter.filter(t,function(o){return o.nodeType==goog.dom.NodeType.TEXT&&("string"==typeof e?o.nodeValue==e:!!o.nodeValue.match(e))}),null)},goog.testing.dom.assertRangeEquals=function(e,o,t,g,s){assertEquals("Unexpected start node",e,s.getStartNode()),assertEquals("Unexpected end node",t,s.getEndNode()),assertEquals("Unexpected start offset",o,s.getStartOffset()),assertEquals("Unexpected end offset",g,s.getEndOffset())},goog.testing.dom.getAttributeValue_=function(e,o){return(!goog.userAgent.WEBKIT||e.tagName!=goog.dom.TagName.INPUT||e.type!=goog.dom.InputType.RADIO||"checked"!=o)&&((goog.userAgent.IE||goog.userAgent.EDGE)&&"src"==o?e.getAttribute(o):void 0!==e[o]&&typeof e.getAttribute(o)!=typeof e[o]?e[o]:e.getAttribute(o))},goog.testing.dom.assertAttributesEqual_=function(e,o,t,g){g&&goog.testing.dom.compareClassAttribute_(o,t);for(var s=o.attributes,n=t.attributes,r=0,a=s.length;r<a;r++){var i=s[r].name,d=goog.testing.dom.getAttributeValue_(o,i),u=n[i],m=goog.testing.dom.getAttributeValue_(t,i);(d||m)&&("id"==i&&goog.userAgent.IE?goog.testing.dom.compareIdAttributeForIe_(d,u,g,e):goog.testing.dom.ignoreAttribute_(i)||(assertNotUndefined("Expected to find attribute with name "+i+", in element "+goog.testing.dom.describeNode_(t)+e,u),assertEquals("Expected attribute "+i+" has a different value "+e,String(d),String(goog.testing.dom.getAttributeValue_(t,u.name)))))}if(g)for(r=0;r<n.length;r++){var l=n[r].name;(u=n.getNamedItem(l))&&!goog.testing.dom.ignoreAttribute_(l)&&assertNotUndefined("Unexpected attribute with name "+l+" in element "+goog.testing.dom.describeNode_(t)+e,s[l])}},goog.testing.dom.compareClassAttribute_=function(e,o){for(var t=goog.dom.classlist.get(e),g=[],s=0,n=t.length;s<n;s++)t[s]in goog.userAgent||g.push(t[s]);g.sort();var r=goog.array.toArray(goog.dom.classlist.get(o));r.sort(),assertArrayEquals("Expected class was: "+g.join(" ")+", but actual class was: "+o.className+" in node "+goog.testing.dom.describeNode_(o),g,r)},goog.testing.dom.BAD_IE_ATTRIBUTES_=goog.object.createSet("methods","CHECKED","dataFld","dataFormatAs","dataSrc"),goog.testing.dom.ignoreAttribute_=function(e){return"style"==e||"class"==e||"xmlns"==e||goog.userAgent.IE&&goog.testing.dom.BAD_IE_ATTRIBUTES_[e]},goog.testing.dom.compareIdAttributeForIe_=function(e,o,t,g){""===e?t&&assertTrue("Unexpected attribute with name id in element "+g,""==o.value):(assertNotUndefined("Expected to find attribute with name id, in element "+g,o),assertNotEquals("Expected to find attribute with name id, in element "+g,"",o.value),assertEquals("Expected attribute has a different value "+g,e,o.value))};