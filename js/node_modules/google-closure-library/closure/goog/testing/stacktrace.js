goog.setTestOnly("goog.testing.stacktrace"),goog.provide("goog.testing.stacktrace"),goog.provide("goog.testing.stacktrace.Frame"),goog.testing.stacktrace.Frame=function(t,e,g,o){this.context_=t,this.name_=e,this.alias_=g,this.path_=o},goog.testing.stacktrace.Frame.prototype.getName=function(){return this.name_},goog.testing.stacktrace.Frame.prototype.isAnonymous=function(){return!this.name_||"[object Object]"==this.context_},goog.testing.stacktrace.Frame.prototype.toCanonicalString=function(){const t=goog.testing.stacktrace.htmlEscape_,e=goog.testing.stacktrace.maybeDeobfuscateFunctionName_,g=[this.context_?t(this.context_)+".":"",this.name_?t(e(this.name_)):"anonymous",this.alias_?" [as "+t(e(this.alias_))+"]":""];return this.path_&&(g.push(" at "),g.push(t(this.path_))),g.join("")},goog.testing.stacktrace.MAX_DEPTH_=20,goog.testing.stacktrace.MAX_FIREFOX_FRAMESTRING_LENGTH_=5e5,goog.testing.stacktrace.IDENTIFIER_PATTERN_="[a-zA-Z_$][\\w$]*",goog.testing.stacktrace.V8_ALIAS_PATTERN_="(?: \\[as ("+goog.testing.stacktrace.IDENTIFIER_PATTERN_+")\\])?",goog.testing.stacktrace.V8_CONTEXT_PATTERN_="(?:((?:new )?(?:\\[object Object\\]|"+goog.testing.stacktrace.IDENTIFIER_PATTERN_+"(?:\\."+goog.testing.stacktrace.IDENTIFIER_PATTERN_+")*))\\.)?",goog.testing.stacktrace.V8_FUNCTION_NAME_PATTERN_="(?:new )?(?:"+goog.testing.stacktrace.IDENTIFIER_PATTERN_+"|<anonymous>)",goog.testing.stacktrace.V8_FUNCTION_CALL_PATTERN_=" "+goog.testing.stacktrace.V8_CONTEXT_PATTERN_+"("+goog.testing.stacktrace.V8_FUNCTION_NAME_PATTERN_+")"+goog.testing.stacktrace.V8_ALIAS_PATTERN_,goog.testing.stacktrace.URL_PATTERN_="((?:http|https|file)://[^\\s)]+|javascript:.*)",goog.testing.stacktrace.CHROME_URL_PATTERN_=" (?:\\(unknown source\\)|\\(native\\)|\\((.+)\\)|(.+))",goog.testing.stacktrace.V8_STACK_FRAME_REGEXP_=new RegExp("^    at(?:"+goog.testing.stacktrace.V8_FUNCTION_CALL_PATTERN_+")?"+goog.testing.stacktrace.CHROME_URL_PATTERN_+"$"),goog.testing.stacktrace.FIREFOX_FUNCTION_CALL_PATTERN_="("+goog.testing.stacktrace.IDENTIFIER_PATTERN_+"(?:\\."+goog.testing.stacktrace.IDENTIFIER_PATTERN_+")*)?(\\(.*\\))?@",goog.testing.stacktrace.FIREFOX_STACK_FRAME_REGEXP_=new RegExp("^"+goog.testing.stacktrace.FIREFOX_FUNCTION_CALL_PATTERN_+"(?::0|"+goog.testing.stacktrace.URL_PATTERN_+")$"),goog.testing.stacktrace.OPERA_ANONYMOUS_FUNCTION_NAME_PATTERN_="<anonymous function(?:\\: (?:("+goog.testing.stacktrace.IDENTIFIER_PATTERN_+"(?:\\."+goog.testing.stacktrace.IDENTIFIER_PATTERN_+")*)\\.)?("+goog.testing.stacktrace.IDENTIFIER_PATTERN_+"))?>",goog.testing.stacktrace.OPERA_FUNCTION_CALL_PATTERN_="(?:(?:("+goog.testing.stacktrace.IDENTIFIER_PATTERN_+")|"+goog.testing.stacktrace.OPERA_ANONYMOUS_FUNCTION_NAME_PATTERN_+")(\\(.*\\)))?@",goog.testing.stacktrace.OPERA_STACK_FRAME_REGEXP_=new RegExp("^"+goog.testing.stacktrace.OPERA_FUNCTION_CALL_PATTERN_+goog.testing.stacktrace.URL_PATTERN_+"?$"),goog.testing.stacktrace.FUNCTION_SOURCE_REGEXP_=new RegExp("^function ("+goog.testing.stacktrace.IDENTIFIER_PATTERN_+")"),goog.testing.stacktrace.IE_FUNCTION_CALL_PATTERN_="("+goog.testing.stacktrace.IDENTIFIER_PATTERN_+"(?:\\."+goog.testing.stacktrace.IDENTIFIER_PATTERN_+")*(?:\\s+\\w+)*)",goog.testing.stacktrace.IE_STACK_FRAME_REGEXP_=new RegExp("^   at "+goog.testing.stacktrace.IE_FUNCTION_CALL_PATTERN_+"\\s*\\((eval code:[^)]*|Unknown script code:[^)]*|"+goog.testing.stacktrace.URL_PATTERN_+")\\)?$"),goog.testing.stacktrace.followCallChain_=function(){const t=[];let e=arguments.callee.caller,g=0;for(;e&&g<goog.testing.stacktrace.MAX_DEPTH_;){const o=Function.prototype.toString.call(e).match(goog.testing.stacktrace.FUNCTION_SOURCE_REGEXP_),a=o?o[1]:"";t.push(new goog.testing.stacktrace.Frame("",a,"",""));try{e=e.caller}catch(t){break}g++}return t},goog.testing.stacktrace.parseStackFrame_=function(t){let e=t.match(goog.testing.stacktrace.V8_STACK_FRAME_REGEXP_);return e?new goog.testing.stacktrace.Frame(e[1]||"",e[2]||"",e[3]||"",e[4]||e[5]||e[6]||""):t.length>goog.testing.stacktrace.MAX_FIREFOX_FRAMESTRING_LENGTH_?null:(e=t.match(goog.testing.stacktrace.FIREFOX_STACK_FRAME_REGEXP_),e?new goog.testing.stacktrace.Frame("",e[1]||"","",e[3]||""):(e=t.match(goog.testing.stacktrace.OPERA_STACK_FRAME_REGEXP_),e?new goog.testing.stacktrace.Frame(e[2]||"",e[1]||e[3]||"","",e[5]||""):(e=t.match(goog.testing.stacktrace.IE_STACK_FRAME_REGEXP_),e?new goog.testing.stacktrace.Frame("",e[1]||"","",e[2]||""):null)))},goog.testing.stacktrace.deobfuscateFunctionName_,goog.testing.stacktrace.setDeobfuscateFunctionName=function(t){goog.testing.stacktrace.deobfuscateFunctionName_=t},goog.testing.stacktrace.maybeDeobfuscateFunctionName_=function(t){return goog.testing.stacktrace.deobfuscateFunctionName_?goog.testing.stacktrace.deobfuscateFunctionName_(t):t},goog.testing.stacktrace.htmlEscape_=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},goog.testing.stacktrace.framesToString_=function(t){let e=t.length-1;for(;t[e]&&t[e].isAnonymous();)e--;let g=-1;for(let e=0;e<t.length;e++)if(t[e]&&"_assert"==t[e].getName()){g=e;break}const o=[];for(let a=g+1;a<=e;a++)o.push("> "),t[a]?o.push(t[a].toCanonicalString()):o.push("(unknown)"),o.push("\n");return o.join("")},goog.testing.stacktrace.parse_=function(t){const e=t.replace(/\s*$/,"").split("\n"),g=[];for(let t=0;t<e.length;t++)g.push(goog.testing.stacktrace.parseStackFrame_(e[t]));return g},goog.testing.stacktrace.canonicalize=function(t){const e=goog.testing.stacktrace.parse_(t);return goog.testing.stacktrace.framesToString_(e)},goog.testing.stacktrace.getNativeStack_=function(){const t=new Error;if(t.stack)return t.stack;try{null.x()}catch(t){return t.stack}return""},goog.testing.stacktrace.get=function(){const t=goog.testing.stacktrace.getNativeStack_();let e;return e=t?goog.isArray(t)?goog.testing.stacktrace.callSitesToFrames_(t):goog.testing.stacktrace.parse_(t):goog.testing.stacktrace.followCallChain_(),goog.testing.stacktrace.framesToString_(e)},goog.testing.stacktrace.callSitesToFrames_=function(t){const e=[];for(let g=0;g<t.length;g++){const o=t[g],a=o.getFunctionName()||"unknown",c=o.getFileName(),s=c?c+":"+o.getLineNumber()+":"+o.getColumnNumber():"unknown";e.push(new goog.testing.stacktrace.Frame("",a,"",s))}return e},goog.exportSymbol("setDeobfuscateFunctionName",goog.testing.stacktrace.setDeobfuscateFunctionName);