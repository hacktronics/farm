goog.provide("goog.history.Html5History"),goog.provide("goog.history.Html5History.TokenTransformer"),goog.require("goog.asserts"),goog.require("goog.events"),goog.require("goog.events.EventTarget"),goog.require("goog.events.EventType"),goog.require("goog.history.Event"),goog.history.Html5History=function(t,o){goog.events.EventTarget.call(this),goog.asserts.assert(goog.history.Html5History.isSupported(t),"HTML5 history is not supported."),this.window_=t||window,this.transformer_=o||null,this.lastFragment_=null,goog.events.listen(this.window_,goog.events.EventType.POPSTATE,this.onHistoryEvent_,!1,this),goog.events.listen(this.window_,goog.events.EventType.HASHCHANGE,this.onHistoryEvent_,!1,this)},goog.inherits(goog.history.Html5History,goog.events.EventTarget),goog.history.Html5History.isSupported=function(t){var o=t||window;return!(!o.history||!o.history.pushState)},goog.history.Html5History.prototype.enabled_=!1,goog.history.Html5History.prototype.useFragment_=!0,goog.history.Html5History.prototype.pathPrefix_="/",goog.history.Html5History.prototype.setEnabled=function(t){t!=this.enabled_&&(this.enabled_=t,t&&this.dispatchEvent(new goog.history.Event(this.getToken(),!1)))},goog.history.Html5History.prototype.getToken=function(){return this.useFragment_?goog.asserts.assertString(this.getFragment_()):this.transformer_?this.transformer_.retrieveToken(this.pathPrefix_,this.window_.location):this.window_.location.pathname.substr(this.pathPrefix_.length)},goog.history.Html5History.prototype.setToken=function(t,o){t!=this.getToken()&&(this.window_.history.pushState(null,o||this.window_.document.title||"",this.getUrl_(t)),this.dispatchEvent(new goog.history.Event(t,!1)))},goog.history.Html5History.prototype.replaceToken=function(t,o){this.window_.history.replaceState(null,o||this.window_.document.title||"",this.getUrl_(t)),this.dispatchEvent(new goog.history.Event(t,!1))},goog.history.Html5History.prototype.disposeInternal=function(){goog.events.unlisten(this.window_,goog.events.EventType.POPSTATE,this.onHistoryEvent_,!1,this),this.useFragment_&&goog.events.unlisten(this.window_,goog.events.EventType.HASHCHANGE,this.onHistoryEvent_,!1,this)},goog.history.Html5History.prototype.setUseFragment=function(t){this.useFragment_!=t&&(t?goog.events.listen(this.window_,goog.events.EventType.HASHCHANGE,this.onHistoryEvent_,!1,this):goog.events.unlisten(this.window_,goog.events.EventType.HASHCHANGE,this.onHistoryEvent_,!1,this),this.useFragment_=t)},goog.history.Html5History.prototype.setPathPrefix=function(t){this.pathPrefix_=t},goog.history.Html5History.prototype.getPathPrefix=function(){return this.pathPrefix_},goog.history.Html5History.prototype.getFragment_=function(){if(this.useFragment_){var t=this.window_.location.href,o=t.indexOf("#");return o<0?"":t.substring(o+1)}return null},goog.history.Html5History.prototype.getUrl_=function(t){return this.useFragment_?"#"+t:this.transformer_?this.transformer_.createUrl(t,this.pathPrefix_,this.window_.location):this.pathPrefix_+t+this.window_.location.search},goog.history.Html5History.prototype.onHistoryEvent_=function(t){if(this.enabled_){var o=this.getFragment_();t.type!=goog.events.EventType.POPSTATE&&o==this.lastFragment_||(this.lastFragment_=o,this.dispatchEvent(new goog.history.Event(this.getToken(),!0)))}},goog.history.Html5History.TokenTransformer=function(){},goog.history.Html5History.TokenTransformer.prototype.retrieveToken=function(t,o){},goog.history.Html5History.TokenTransformer.prototype.createUrl=function(t,o,e){};