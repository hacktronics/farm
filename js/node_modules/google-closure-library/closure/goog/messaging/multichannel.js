goog.provide("goog.messaging.MultiChannel"),goog.provide("goog.messaging.MultiChannel.VirtualChannel"),goog.require("goog.Disposable"),goog.require("goog.log"),goog.require("goog.messaging.MessageChannel"),goog.require("goog.object"),goog.messaging.MultiChannel=function(e){goog.messaging.MultiChannel.base(this,"constructor"),this.underlyingChannel_=e,this.virtualChannels_={},this.underlyingChannel_.registerDefaultService(goog.bind(this.handleDefault_,this))},goog.inherits(goog.messaging.MultiChannel,goog.Disposable),goog.messaging.MultiChannel.prototype.logger_=goog.log.getLogger("goog.messaging.MultiChannel"),goog.messaging.MultiChannel.prototype.createVirtualChannel=function(e){if(-1!=e.indexOf(":"))throw new Error('Virtual channel name "'+e+'" should not contain colons');if(e in this.virtualChannels_)throw new Error('Virtual channel "'+e+'" was already created for this multichannel.');var n=new goog.messaging.MultiChannel.VirtualChannel(this,e);return this.virtualChannels_[e]=n,n},goog.messaging.MultiChannel.prototype.handleDefault_=function(e,n){var i=e.match(/^([^:]*):(.*)/);if(i){var o=i[1];if(e=i[2],o in this.virtualChannels_){var g=this.virtualChannels_[o];g?g.defaultService_?g.defaultService_(e,n):goog.log.warning(this.logger_,'Service "'+e+'" is not registered on virtual channel "'+o+'"'):goog.log.warning(this.logger_,'Virtual channel "'+o+' has been disposed, but a message was received for it: "'+e+'"')}else goog.log.warning(this.logger_,'Virtual channel "'+o+' does not exist, but a message was received for it: "'+e+'"')}else goog.log.warning(this.logger_,'Invalid service name "'+e+'": no virtual channel specified')},goog.messaging.MultiChannel.prototype.disposeInternal=function(){goog.object.forEach(this.virtualChannels_,function(e){goog.dispose(e)}),goog.dispose(this.underlyingChannel_),delete this.virtualChannels_,delete this.underlyingChannel_},goog.messaging.MultiChannel.VirtualChannel=function(e,n){goog.messaging.MultiChannel.VirtualChannel.base(this,"constructor"),this.parent_=e,this.name_=n},goog.inherits(goog.messaging.MultiChannel.VirtualChannel,goog.Disposable),goog.messaging.MultiChannel.VirtualChannel.prototype.defaultService_,goog.messaging.MultiChannel.VirtualChannel.prototype.logger_=goog.log.getLogger("goog.messaging.MultiChannel.VirtualChannel"),goog.messaging.MultiChannel.VirtualChannel.prototype.connect=function(e){e&&e()},goog.messaging.MultiChannel.VirtualChannel.prototype.isConnected=function(){return!0},goog.messaging.MultiChannel.VirtualChannel.prototype.registerService=function(e,n,i){this.parent_.underlyingChannel_.registerService(this.name_+":"+e,goog.bind(this.doCallback_,this,n),i)},goog.messaging.MultiChannel.VirtualChannel.prototype.registerDefaultService=function(e){this.defaultService_=goog.bind(this.doCallback_,this,e)},goog.messaging.MultiChannel.VirtualChannel.prototype.send=function(e,n){if(this.isDisposed())throw new Error("#send called for disposed VirtualChannel.");this.parent_.underlyingChannel_.send(this.name_+":"+e,n)},goog.messaging.MultiChannel.VirtualChannel.prototype.doCallback_=function(e,n){this.isDisposed()?goog.log.warning(this.logger_,'Virtual channel "'+this.name_+'" received  a message after being disposed.'):e.apply({},Array.prototype.slice.call(arguments,1))},goog.messaging.MultiChannel.VirtualChannel.prototype.disposeInternal=function(){this.parent_.virtualChannels_[this.name_]=null,this.parent_=null};