goog.provide("goog.messaging.PortCaller"),goog.require("goog.Disposable"),goog.require("goog.async.Deferred"),goog.require("goog.messaging.DeferredChannel"),goog.require("goog.messaging.PortChannel"),goog.require("goog.messaging.PortNetwork"),goog.require("goog.object"),goog.messaging.PortCaller=function(o){goog.messaging.PortCaller.base(this,"constructor"),this.operatorPort_=o,this.connections_={},this.operatorPort_.registerService(goog.messaging.PortNetwork.GRANT_CONNECTION_SERVICE,goog.bind(this.connectionGranted_,this),!0)},goog.inherits(goog.messaging.PortCaller,goog.Disposable),goog.messaging.PortCaller.prototype.dial=function(o){if(o in this.connections_)return this.connections_[o].channel;this.operatorPort_.send(goog.messaging.PortNetwork.REQUEST_CONNECTION_SERVICE,o);var e=new goog.async.Deferred,r=new goog.messaging.DeferredChannel(e);return this.connections_[o]={deferred:e,channel:r},r},goog.messaging.PortCaller.prototype.connectionGranted_=function(o){var e=o,r=e.port,g=this.connections_[e.name];if(!g||g.deferred&&!g.deferred.hasFired()){if(!e.success)throw new Error(e.message);r.start();var n=new goog.messaging.PortChannel(r);g?g.deferred.callback(n):this.connections_[e.name]={channel:n,deferred:null}}else r.close()},goog.messaging.PortCaller.prototype.disposeInternal=function(){goog.dispose(this.operatorPort_),goog.object.forEach(this.connections_,goog.dispose),delete this.operatorPort_,delete this.connections_,goog.messaging.PortCaller.base(this,"disposeInternal")};