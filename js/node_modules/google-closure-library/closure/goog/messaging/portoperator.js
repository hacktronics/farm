goog.provide("goog.messaging.PortOperator"),goog.require("goog.Disposable"),goog.require("goog.asserts"),goog.require("goog.log"),goog.require("goog.messaging.PortChannel"),goog.require("goog.messaging.PortNetwork"),goog.require("goog.object"),goog.messaging.PortOperator=function(o){goog.messaging.PortOperator.base(this,"constructor"),this.connections_={},this.switchboard_={},this.name_=o},goog.inherits(goog.messaging.PortOperator,goog.Disposable),goog.messaging.PortOperator.prototype.logger_=goog.log.getLogger("goog.messaging.PortOperator"),goog.messaging.PortOperator.prototype.dial=function(o){return this.connectSelfToPort_(o),this.connections_[o]},goog.messaging.PortOperator.prototype.addPort=function(o,e){this.switchboard_[o]=e,e.registerService(goog.messaging.PortNetwork.REQUEST_CONNECTION_SERVICE,goog.bind(this.requestConnection_,this,o))},goog.messaging.PortOperator.prototype.requestConnection_=function(o,e){var t=e;if(t!=this.name_){var g=this.switchboard_[o],s=this.switchboard_[t];if(goog.asserts.assert(null!=g),!s){var r='Port "'+o+'" requested a connection to port "'+t+"\", which doesn't exist";return goog.log.warning(this.logger_,r),void g.send(goog.messaging.PortNetwork.GRANT_CONNECTION_SERVICE,{success:!1,message:r})}var n=new MessageChannel;g.send(goog.messaging.PortNetwork.GRANT_CONNECTION_SERVICE,{success:!0,name:t,port:n.port1}),s.send(goog.messaging.PortNetwork.GRANT_CONNECTION_SERVICE,{success:!0,name:o,port:n.port2})}else this.connectSelfToPort_(o)},goog.messaging.PortOperator.prototype.connectSelfToPort_=function(o){if(!(o in this.connections_)){var e=this.switchboard_[o];if(!e)throw new Error('Port "'+o+"\" doesn't exist");var t=new MessageChannel;e.send(goog.messaging.PortNetwork.GRANT_CONNECTION_SERVICE,{success:!0,name:this.name_,port:t.port1}),t.port2.start(),this.connections_[o]=new goog.messaging.PortChannel(t.port2)}},goog.messaging.PortOperator.prototype.disposeInternal=function(){goog.object.forEach(this.switchboard_,goog.dispose),goog.object.forEach(this.connections_,goog.dispose),delete this.switchboard_,delete this.connections_,goog.messaging.PortOperator.base(this,"disposeInternal")};