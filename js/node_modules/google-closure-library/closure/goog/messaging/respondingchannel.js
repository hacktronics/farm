goog.provide("goog.messaging.RespondingChannel"),goog.require("goog.Disposable"),goog.require("goog.Promise"),goog.require("goog.log"),goog.require("goog.messaging.MultiChannel"),goog.messaging.RespondingChannel=function(e){goog.messaging.RespondingChannel.base(this,"constructor"),this.messageChannel_=new goog.messaging.MultiChannel(e),this.sigCallbackMap_={},this.privateChannel_=this.messageChannel_.createVirtualChannel(goog.messaging.RespondingChannel.PRIVATE_CHANNEL_),this.publicChannel_=this.messageChannel_.createVirtualChannel(goog.messaging.RespondingChannel.PUBLIC_CHANNEL_),this.privateChannel_.registerService(goog.messaging.RespondingChannel.CALLBACK_SERVICE_,goog.bind(this.callbackServiceHandler_,this),!0)},goog.inherits(goog.messaging.RespondingChannel,goog.Disposable),goog.messaging.RespondingChannel.CALLBACK_SERVICE_="mics",goog.messaging.RespondingChannel.PRIVATE_CHANNEL_="private",goog.messaging.RespondingChannel.PUBLIC_CHANNEL_="public",goog.messaging.RespondingChannel.prototype.nextSignatureIndex_=0,goog.messaging.RespondingChannel.prototype.logger_=goog.log.getLogger("goog.messaging.RespondingChannel"),goog.messaging.RespondingChannel.prototype.getNextSignature_=function(){return this.nextSignatureIndex_++},goog.messaging.RespondingChannel.prototype.disposeInternal=function(){goog.dispose(this.messageChannel_),delete this.messageChannel_,delete this.publicChannel_,delete this.privateChannel_},goog.messaging.RespondingChannel.prototype.send=function(e,n,g){var o=this.getNextSignature_();this.sigCallbackMap_[o]=g;var s={};s.signature=o,s.data=n,this.publicChannel_.send(e,s)},goog.messaging.RespondingChannel.prototype.callbackServiceHandler_=function(e){var n=e.signature,g=e.data;n in this.sigCallbackMap_?((0,this.sigCallbackMap_[n])(g),delete this.sigCallbackMap_[n]):goog.log.warning(this.logger_,"Received signature is invalid")},goog.messaging.RespondingChannel.prototype.registerService=function(e,n){this.publicChannel_.registerService(e,goog.bind(this.callbackProxy_,this,n),!0)},goog.messaging.RespondingChannel.prototype.callbackProxy_=function(e,n){var g=e(n.data),o=n.signature;goog.Promise.resolve(g).then(goog.bind(function(e){this.sendResponse_(e,o)},this))},goog.messaging.RespondingChannel.prototype.sendResponse_=function(e,n){var g={};g.data=e,g.signature=n,this.privateChannel_&&this.privateChannel_.send(goog.messaging.RespondingChannel.CALLBACK_SERVICE_,g)};