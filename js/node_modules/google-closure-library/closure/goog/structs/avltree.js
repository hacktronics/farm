goog.module("goog.structs.AvlTree"),goog.module.declareLegacyNamespace();var Collection=goog.require("goog.structs.Collection"),asserts=goog.require("goog.asserts"),AvlTree=function(t){this.comparator_=t||DEFAULT_COMPARATOR,this.root_=null,this.minNode_=null,this.maxNode_=null},DEFAULT_COMPARATOR=function(t,e){return String(t)<String(e)?-1:String(t)>String(e)?1:0};function height(t){return t?t.height:0}function balanceFactor(t){return t?(t.left?t.left.height:0)-(t.right?t.right.height:0):0}function count(t){return t?t.count:0}AvlTree.prototype.balance_=function(t){var e=balanceFactor(t);return e>1?(balanceFactor(t.left)<0&&(asserts.assert(t.left),this.leftRotate_(t.left)),this.rightRotate_(t)):e<-1?(balanceFactor(t.right)>0&&(asserts.assert(t.right),this.rightRotate_(t.right)),this.leftRotate_(t)):t},AvlTree.prototype.addInternal_=function(t,e){var r=this.comparator_(t,e.value),i=!1;return r>0?e.right?i=this.addInternal_(t,e.right):(e.right=new Node(t,e),i=!0,e==this.maxNode_&&(this.maxNode_=e.right)):r<0&&(e.left?i=this.addInternal_(t,e.left):(e.left=new Node(t,e),i=!0,e==this.minNode_&&(this.minNode_=e.left))),i&&(e.count++,e.height=Math.max(height(e.left),height(e.right))+1,this.balance_(e)),i},AvlTree.prototype.add=function(t){return this.root_?this.addInternal_(t,this.root_):(this.root_=new Node(t),this.minNode_=this.root_,this.maxNode_=this.root_,!0)},AvlTree.prototype.removeInternal_=function(t,e){if(!e)return{value:null,root:null};var r=this.comparator_(e.value,t);if(r>0){var i=this.removeInternal_(t,e.left);e.left=i.root,t=i.value}else if(r<0){i=this.removeInternal_(t,e.right);e.right=i.root,t=i.value}else if(t=e.value,e.left&&e.right){t=e.value;var o=e.right;this.traverse_(function(t){return t.left?o=t.left:null},e.right),asserts.assert(o),e.value=o.value;i=this.removeInternal_(o.value,e.right);e.right=i.root}else{var n=e.left?e.left:e.right;if(!n)return this.maxNode_==e&&(this.maxNode_=e.parent),this.minNode_==e&&(this.minNode_=e.parent),{value:t,root:null};this.maxNode_==e&&(this.maxNode_=n),this.minNode_==e&&(this.minNode_=n),n.parent=e.parent,e=n}return e.count=count(e.left)+count(e.right)+1,e.height=Math.max(height(e.left),height(e.right))+1,{root:this.balance_(e),value:t}},AvlTree.prototype.remove=function(t){var e=this.removeInternal_(t,this.root_);return this.root_=e.root,e.value},AvlTree.prototype.clear=function(){this.root_=null,this.minNode_=null,this.maxNode_=null},AvlTree.prototype.contains=function(t){var e=!1;return this.traverse_(function(r){var i=null,o=this.comparator_(r.value,t);return o>0?i=r.left:o<0?i=r.right:e=!0,i}),e},AvlTree.prototype.indexOf=function(t){var e=-1,r=0;return this.traverse_(function(i){var o=this.comparator_(i.value,t);return o>0?i.left:(i.left&&(r+=i.left.count),o<0?(r++,i.right):(e=r,null))}),e},AvlTree.prototype.getCount=function(){return this.root_?this.root_.count:0},AvlTree.prototype.getKthValue=function(t){return t<0||t>=this.getCount()?null:this.getKthNode_(t).value},AvlTree.prototype.getMinimum=function(){return this.getMinNode_().value},AvlTree.prototype.getMaximum=function(){return this.getMaxNode_().value},AvlTree.prototype.getHeight=function(){return this.root_?this.root_.height:0},AvlTree.prototype.getValues=function(){var t=[];return this.inOrderTraverse(function(e){t.push(e)}),t},AvlTree.prototype.inOrderTraverse=function(t,e){if(this.root_){var r;if(void 0!==e){if(this.traverse_(function(t){var i=null,o=this.comparator_(t.value,e);return o>0?(i=t.left,r=t):o<0?i=t.right:r=t,i}),!r)return}else r=this.getMinNode_();for(var i=r,o=i.left?i.left:i;null!=i;)if(null!=i.left&&i.left!=o&&i.right!=o)i=i.left;else{if(i.right!=o&&t(i.value))return;var n=i;i=null!=i.right&&i.right!=o?i.right:i.parent,o=n}}},AvlTree.prototype.reverseOrderTraverse=function(t,e){if(this.root_){var r;if(void 0!==e){if(this.traverse_(goog.bind(function(t){var i=null,o=this.comparator_(t.value,e);return o>0?i=t.left:o<0?(i=t.right,r=t):r=t,i},this)),!r)return}else r=this.getMaxNode_();for(var i=r,o=r.right?r.right:r;null!=i;)if(null!=i.right&&i.right!=o&&i.left!=o)i=i.right;else{if(i.left!=o&&t(i.value))return;var n=i;i=null!=i.left&&i.left!=o?i.left:i.parent,o=n}}},AvlTree.prototype.traverse_=function(t,e,r){for(var i=e||this.root_,o=r||null;i&&i!=o;)i=t.call(this,i)},AvlTree.prototype.leftRotate_=function(t){t.isLeftChild()?(t.parent.left=t.right,t.right.parent=t.parent):t.isRightChild()?(t.parent.right=t.right,t.right.parent=t.parent):(this.root_=t.right,this.root_.parent=null);var e=t.right;return t.right=t.right.left,null!=t.right&&(t.right.parent=t),e.left=t,t.parent=e,e.count=t.count,t.count-=(e.right?e.right.count:0)+1,t.fixHeight(),e.fixHeight(),e},AvlTree.prototype.rightRotate_=function(t){t.isLeftChild()?(t.parent.left=t.left,t.left.parent=t.parent):t.isRightChild()?(t.parent.right=t.left,t.left.parent=t.parent):(this.root_=t.left,this.root_.parent=null);var e=t.left;return t.left=t.left.right,null!=t.left&&(t.left.parent=t),e.right=t,t.parent=e,e.count=t.count,t.count-=(e.left?e.left.count:0)+1,t.fixHeight(),e.fixHeight(),e},AvlTree.prototype.getKthNode_=function(t,e){var r=e||this.root_,i=r.left?r.left.count:0;return t<i?this.getKthNode_(t,r.left):t==i?r:this.getKthNode_(t-i-1,r.right)},AvlTree.prototype.getMinNode_=function(t){if(!t)return this.minNode_;var e=t;return this.traverse_(function(t){var r=null;return t.left&&(e=t.left,r=t.left),r},t),e},AvlTree.prototype.getMaxNode_=function(t){if(!t)return this.maxNode_;var e=t;return this.traverse_(function(t){var r=null;return t.right&&(e=t.right,r=t.right),r},t),e},AvlTree.prototype.copy=function(t){var e=new AvlTree(this.comparator_);if(!this.root_)return e;var r=this.root_.copy(null,this.comparator_,t);return e.root_=r.root,e.minNode_=r.leftMost,e.maxNode_=r.rightMost,e};var Node=function(t,e){this.value=t,this.parent=e||null,this.count=1,this.left=null,this.right=null,this.height=1};Node.prototype.isRightChild=function(){return!!this.parent&&this.parent.right==this},Node.prototype.isLeftChild=function(){return!!this.parent&&this.parent.left==this},Node.prototype.fixHeight=function(){this.height=Math.max(this.left?this.left.height:0,this.right?this.right.height:0)+1},Node.prototype.copy=function(t,e,r){var i;r?(i=r(this.value),asserts.assert(0===e(this.value,i))):i=this.value;var o=new Node(i,t);o.count=this.count,o.height=this.height;var n=o,h=o;if(this.left){var l=this.left.copy(o,e,r);o.left=l.root,n=l.leftMost}if(this.right){var a=this.right.copy(o,e,r);o.right=a.root,h=a.rightMost}return{root:o,leftMost:n,rightMost:h}},exports=AvlTree;