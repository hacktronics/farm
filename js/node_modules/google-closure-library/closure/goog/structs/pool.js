goog.provide("goog.structs.Pool"),goog.require("goog.Disposable"),goog.require("goog.structs.Queue"),goog.require("goog.structs.Set"),goog.structs.Pool=function(t,o){if(goog.Disposable.call(this),this.minCount_=t||0,this.maxCount_=o||10,this.minCount_>this.maxCount_)throw new Error(goog.structs.Pool.ERROR_MIN_MAX_);this.freeQueue_=new goog.structs.Queue,this.inUseSet_=new goog.structs.Set,this.delay=0,this.lastAccess=null,this.adjustForMinMax()},goog.inherits(goog.structs.Pool,goog.Disposable),goog.structs.Pool.ERROR_MIN_MAX_="[goog.structs.Pool] Min can not be greater than max",goog.structs.Pool.ERROR_DISPOSE_UNRELEASED_OBJS_="[goog.structs.Pool] Objects not released",goog.structs.Pool.prototype.setMinimumCount=function(t){if(t>this.maxCount_)throw new Error(goog.structs.Pool.ERROR_MIN_MAX_);this.minCount_=t,this.adjustForMinMax()},goog.structs.Pool.prototype.setMaximumCount=function(t){if(t<this.minCount_)throw new Error(goog.structs.Pool.ERROR_MIN_MAX_);this.maxCount_=t,this.adjustForMinMax()},goog.structs.Pool.prototype.setDelay=function(t){this.delay=t},goog.structs.Pool.prototype.getObject=function(){var t=goog.now();if(!(null!=this.lastAccess&&t-this.lastAccess<this.delay)){var o=this.removeFreeObject_();return o&&(this.lastAccess=t,this.inUseSet_.add(o)),o}},goog.structs.Pool.prototype.releaseObject=function(t){return!!this.inUseSet_.remove(t)&&(this.addFreeObject(t),!0)},goog.structs.Pool.prototype.removeFreeObject_=function(){for(var t;this.getFreeCount()>0&&(t=this.freeQueue_.dequeue(),!this.objectCanBeReused(t));)this.adjustForMinMax();return!t&&this.getCount()<this.maxCount_&&(t=this.createObject()),t},goog.structs.Pool.prototype.addFreeObject=function(t){this.inUseSet_.remove(t),this.objectCanBeReused(t)&&this.getCount()<this.maxCount_?this.freeQueue_.enqueue(t):this.disposeObject(t)},goog.structs.Pool.prototype.adjustForMinMax=function(){for(var t=this.freeQueue_;this.getCount()<this.minCount_;)t.enqueue(this.createObject());for(;this.getCount()>this.maxCount_&&this.getFreeCount()>0;)this.disposeObject(t.dequeue())},goog.structs.Pool.prototype.createObject=function(){return{}},goog.structs.Pool.prototype.disposeObject=function(t){if("function"==typeof t.dispose)t.dispose();else for(var o in t)t[o]=null},goog.structs.Pool.prototype.objectCanBeReused=function(t){return"function"!=typeof t.canBeReused||t.canBeReused()},goog.structs.Pool.prototype.contains=function(t){return this.freeQueue_.contains(t)||this.inUseSet_.contains(t)},goog.structs.Pool.prototype.getCount=function(){return this.freeQueue_.getCount()+this.inUseSet_.getCount()},goog.structs.Pool.prototype.getInUseCount=function(){return this.inUseSet_.getCount()},goog.structs.Pool.prototype.getFreeCount=function(){return this.freeQueue_.getCount()},goog.structs.Pool.prototype.isEmpty=function(){return this.freeQueue_.isEmpty()&&this.inUseSet_.isEmpty()},goog.structs.Pool.prototype.disposeInternal=function(){if(goog.structs.Pool.superClass_.disposeInternal.call(this),this.getInUseCount()>0)throw new Error(goog.structs.Pool.ERROR_DISPOSE_UNRELEASED_OBJS_);delete this.inUseSet_;for(var t=this.freeQueue_;!t.isEmpty();)this.disposeObject(t.dequeue());delete this.freeQueue_};