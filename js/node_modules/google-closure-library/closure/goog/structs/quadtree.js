goog.provide("goog.structs.QuadTree"),goog.provide("goog.structs.QuadTree.Node"),goog.provide("goog.structs.QuadTree.Point"),goog.require("goog.math.Coordinate"),goog.structs.QuadTree=function(t,e,o,r){this.count_=0,this.root_=new goog.structs.QuadTree.Node(t,e,o-t,r-e)},goog.structs.QuadTree.prototype.getRootNode=function(){return this.root_},goog.structs.QuadTree.prototype.set=function(t,e,o){var r=this.root_;if(t<r.x||e<r.y||t>r.x+r.w||e>r.y+r.h)throw new Error("Out of bounds : ("+t+", "+e+")");this.insert_(r,new goog.structs.QuadTree.Point(t,e,o))&&this.count_++},goog.structs.QuadTree.prototype.get=function(t,e,o){var r=this.find_(this.root_,t,e);return r?r.point.value:o},goog.structs.QuadTree.prototype.remove=function(t,e){var o=this.find_(this.root_,t,e);if(o){var r=o.point.value;return o.point=null,o.nodeType=goog.structs.QuadTree.NodeType.EMPTY,this.balance_(o),this.count_--,r}return null},goog.structs.QuadTree.prototype.contains=function(t,e){return null!=this.get(t,e)},goog.structs.QuadTree.prototype.isEmpty=function(){return this.root_.nodeType==goog.structs.QuadTree.NodeType.EMPTY},goog.structs.QuadTree.prototype.getCount=function(){return this.count_},goog.structs.QuadTree.prototype.clear=function(){this.root_.nw=this.root_.ne=this.root_.sw=this.root_.se=null,this.root_.nodeType=goog.structs.QuadTree.NodeType.EMPTY,this.root_.point=null,this.count_=0},goog.structs.QuadTree.prototype.getKeys=function(){var t=[];return this.traverse_(this.root_,function(e){t.push(new goog.math.Coordinate(e.point.x,e.point.y))}),t},goog.structs.QuadTree.prototype.getValues=function(){var t=[];return this.traverse_(this.root_,function(e){t.push(e.point.value)}),t},goog.structs.QuadTree.prototype.clone=function(){var t=this.root_.x,e=this.root_.y,o=t+this.root_.w,r=e+this.root_.h,s=new goog.structs.QuadTree(t,e,o,r);return this.traverse_(this.root_,function(t){s.set(t.point.x,t.point.y,t.point.value)}),s},goog.structs.QuadTree.prototype.forEach=function(t,e){this.traverse_(this.root_,function(o){var r=new goog.math.Coordinate(o.point.x,o.point.y);t.call(e,o.point.value,r,this)})},goog.structs.QuadTree.prototype.traverse_=function(t,e){switch(t.nodeType){case goog.structs.QuadTree.NodeType.LEAF:e.call(this,t);break;case goog.structs.QuadTree.NodeType.POINTER:this.traverse_(t.ne,e),this.traverse_(t.se,e),this.traverse_(t.sw,e),this.traverse_(t.nw,e)}},goog.structs.QuadTree.prototype.find_=function(t,e,o){switch(t.nodeType){case goog.structs.QuadTree.NodeType.EMPTY:return null;case goog.structs.QuadTree.NodeType.LEAF:return t.point.x==e&&t.point.y==o?t:null;case goog.structs.QuadTree.NodeType.POINTER:return this.find_(this.getQuadrantForPoint_(t,e,o),e,o);default:throw new Error("Invalid nodeType")}},goog.structs.QuadTree.prototype.insert_=function(t,e){switch(t.nodeType){case goog.structs.QuadTree.NodeType.EMPTY:return this.setPointForNode_(t,e),!0;case goog.structs.QuadTree.NodeType.LEAF:return t.point.x==e.x&&t.point.y==e.y?(this.setPointForNode_(t,e),!1):(this.split_(t),this.insert_(t,e));case goog.structs.QuadTree.NodeType.POINTER:return this.insert_(this.getQuadrantForPoint_(t,e.x,e.y),e);default:throw new Error("Invalid nodeType in parent")}},goog.structs.QuadTree.prototype.split_=function(t){var e=t.point;t.point=null,t.nodeType=goog.structs.QuadTree.NodeType.POINTER;var o=t.x,r=t.y,s=t.w/2,u=t.h/2;t.nw=new goog.structs.QuadTree.Node(o,r,s,u,t),t.ne=new goog.structs.QuadTree.Node(o+s,r,s,u,t),t.sw=new goog.structs.QuadTree.Node(o,r+u,s,u,t),t.se=new goog.structs.QuadTree.Node(o+s,r+u,s,u,t),this.insert_(t,e)},goog.structs.QuadTree.prototype.balance_=function(t){switch(t.nodeType){case goog.structs.QuadTree.NodeType.EMPTY:case goog.structs.QuadTree.NodeType.LEAF:t.parent&&this.balance_(t.parent);break;case goog.structs.QuadTree.NodeType.POINTER:var e=t.nw,o=t.ne,r=t.sw,s=t.se,u=null;if(e.nodeType!=goog.structs.QuadTree.NodeType.EMPTY&&(u=e),o.nodeType!=goog.structs.QuadTree.NodeType.EMPTY){if(u)break;u=o}if(r.nodeType!=goog.structs.QuadTree.NodeType.EMPTY){if(u)break;u=r}if(s.nodeType!=goog.structs.QuadTree.NodeType.EMPTY){if(u)break;u=s}if(u){if(u.nodeType==goog.structs.QuadTree.NodeType.POINTER)break;t.nodeType=goog.structs.QuadTree.NodeType.LEAF,t.nw=t.ne=t.sw=t.se=null,t.point=u.point}else t.nodeType=goog.structs.QuadTree.NodeType.EMPTY,t.nw=t.ne=t.sw=t.se=null;t.parent&&this.balance_(t.parent)}},goog.structs.QuadTree.prototype.getQuadrantForPoint_=function(t,e,o){var r=t.x+t.w/2,s=t.y+t.h/2;return e<r?o<s?t.nw:t.sw:o<s?t.ne:t.se},goog.structs.QuadTree.prototype.setPointForNode_=function(t,e){if(t.nodeType==goog.structs.QuadTree.NodeType.POINTER)throw new Error("Can not set point for node of type POINTER");t.nodeType=goog.structs.QuadTree.NodeType.LEAF,t.point=e},goog.structs.QuadTree.NodeType={EMPTY:0,LEAF:1,POINTER:2},goog.structs.QuadTree.Node=function(t,e,o,r,s){this.x=t,this.y=e,this.w=o,this.h=r,this.parent=s||null},goog.structs.QuadTree.Node.prototype.nodeType=goog.structs.QuadTree.NodeType.EMPTY,goog.structs.QuadTree.Node.prototype.nw=null,goog.structs.QuadTree.Node.prototype.ne=null,goog.structs.QuadTree.Node.prototype.sw=null,goog.structs.QuadTree.Node.prototype.se=null,goog.structs.QuadTree.Node.prototype.point=null,goog.structs.QuadTree.Point=function(t,e,o){this.x=t,this.y=e,this.value=void 0!==o?o:null};