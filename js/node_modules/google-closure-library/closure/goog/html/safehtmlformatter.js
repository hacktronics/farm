goog.provide("goog.html.SafeHtmlFormatter"),goog.require("goog.asserts"),goog.require("goog.dom.tags"),goog.require("goog.html.SafeHtml"),goog.require("goog.string"),goog.html.SafeHtmlFormatter=function(){this.replacements_={},this.replacementsCount_=0},goog.html.SafeHtmlFormatter.Replacement,goog.html.SafeHtmlFormatter.prototype.format=function(t){var e=[],o=goog.string.htmlEscape(goog.html.SafeHtmlFormatter.MARKER_),r=goog.string.htmlEscape(t).replace(new RegExp("\\{"+o+"[\\w&#;]+\\}","g"),goog.bind(this.replaceFormattingString_,this,e));return goog.asserts.assert(0==e.length,"Expected no unclosed tags, got <"+e.join(">, <")+">."),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(r,null)},goog.html.SafeHtmlFormatter.prototype.replaceFormattingString_=function(t,e){var o=this.replacements_[e];if(!o)return e;var r="";if(o.startTag&&(r+="<"+o.startTag+o.attributes+">",goog.asserts.ENABLE_ASSERTS&&(goog.dom.tags.isVoidTag(o.startTag.toLowerCase())||t.push(o.startTag.toLowerCase()))),o.html&&(r+=o.html),o.endTag&&(r+="</"+o.endTag+">",goog.asserts.ENABLE_ASSERTS)){var g=t.pop();goog.asserts.assert(g==o.endTag.toLowerCase(),"Expected </"+g+">, got </"+o.endTag+">.")}return r},goog.html.SafeHtmlFormatter.prototype.startTag=function(t,e){return goog.html.SafeHtml.verifyTagName(t),this.storeReplacement_({startTag:t,attributes:goog.html.SafeHtml.stringifyAttributes(t,e)})},goog.html.SafeHtmlFormatter.prototype.endTag=function(t){return goog.html.SafeHtml.verifyTagName(t),this.storeReplacement_({endTag:t})},goog.html.SafeHtmlFormatter.prototype.text=function(t){return this.storeReplacement_({html:goog.string.htmlEscape(t)})},goog.html.SafeHtmlFormatter.prototype.safeHtml=function(t){return this.storeReplacement_({html:goog.html.SafeHtml.unwrap(t)})},goog.html.SafeHtmlFormatter.MARKER_="SafeHtmlFormatter:",goog.html.SafeHtmlFormatter.prototype.storeReplacement_=function(t){this.replacementsCount_++;var e="{"+goog.html.SafeHtmlFormatter.MARKER_+this.replacementsCount_+"_"+goog.string.getRandomString()+"}";return this.replacements_[goog.string.htmlEscape(e)]=t,e};