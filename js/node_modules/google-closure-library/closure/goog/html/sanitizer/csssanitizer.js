goog.provide("goog.html.sanitizer.CssSanitizer"),goog.require("goog.array"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.dom.safe"),goog.require("goog.html.CssSpecificity"),goog.require("goog.html.SafeStyle"),goog.require("goog.html.SafeStyleSheet"),goog.require("goog.html.SafeUrl"),goog.require("goog.html.sanitizer.CssPropertySanitizer"),goog.require("goog.html.sanitizer.noclobber"),goog.require("goog.html.uncheckedconversions"),goog.require("goog.object"),goog.require("goog.string"),goog.require("goog.string.Const"),goog.require("goog.userAgent"),goog.require("goog.userAgent.product"),goog.html.sanitizer.CssSanitizer.SELECTOR_REGEX_=goog.userAgent.IE&&document.documentMode<10?null:new RegExp("\\s*([^\\s'\",]+[^'\",]*(('([^'\\r\\n\\f\\\\]|\\\\[^])*')|(\"([^\"\\r\\n\\f\\\\]|\\\\[^])*\")|[^'\",])*)","g"),goog.html.sanitizer.CHROME_INCLUDE_VENDOR_PREFIX_WHITELIST_=goog.object.createSet("-webkit-border-horizontal-spacing","-webkit-border-vertical-spacing"),goog.html.sanitizer.CssSanitizer.withoutVendorPrefix_=function(e){return goog.userAgent.WEBKIT&&e in goog.html.sanitizer.CHROME_INCLUDE_VENDOR_PREFIX_WHITELIST_?e:e.replace(/^-(?:apple|css|epub|khtml|moz|mso?|o|rim|wap|webkit|xv)-(?=[a-z])/i,"")},goog.html.sanitizer.CssSanitizer.sanitizeStyleSheet_=function(e,t,o){var r=[],i=goog.html.sanitizer.CssSanitizer.getOnlyStyleRules_(goog.array.toArray(e.cssRules));return goog.array.forEach(i,function(e){if(t&&!/[a-zA-Z][\w-:\.]*/.test(t))throw new Error("Invalid container id");if(!(t&&goog.userAgent.product.IE&&10==document.documentMode&&/\\['"]/.test(e.selectorText))){var i=t?e.selectorText.replace(goog.html.sanitizer.CssSanitizer.SELECTOR_REGEX_,"#"+t+" $1"):e.selectorText;r.push(goog.html.SafeStyleSheet.createRule(i,goog.html.sanitizer.CssSanitizer.sanitizeInlineStyle(e.style,o)))}}),goog.html.SafeStyleSheet.concat(r)},goog.html.sanitizer.CssSanitizer.getOnlyStyleRules_=function(e){return goog.array.filter(e,function(e){return e instanceof CSSStyleRule||e.type==CSSRule.STYLE_RULE})},goog.html.sanitizer.CssSanitizer.sanitizeStyleSheetString=function(e,t,o){var r=goog.html.sanitizer.CssSanitizer.safeParseHtmlAndGetInertElement("<style>"+e+"</style>");if(null==r||null==r.sheet)return goog.html.SafeStyleSheet.EMPTY;var i=null!=t?t:null;return goog.html.sanitizer.CssSanitizer.sanitizeStyleSheet_(r.sheet,i,o)},goog.html.sanitizer.CssSanitizer.safeParseHtmlAndGetInertElement=function(e){if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher(10)||"function"!=typeof goog.global.DOMParser)return null;var t=goog.html.uncheckedconversions.safeHtmlFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Never attached to DOM."),"<html><head></head><body>"+e+"</body></html>");return goog.dom.safe.parseFromStringHtml(new DOMParser,t).body.children[0]},goog.html.sanitizer.CssSanitizer.sanitizeInlineStyle=function(e,t){if(!e)return goog.html.SafeStyle.EMPTY;var o=document.createElement("div").style,r=goog.html.sanitizer.CssSanitizer.getCssPropNames_(e);return goog.array.forEach(r,function(r){var i=goog.html.sanitizer.CssSanitizer.withoutVendorPrefix_(r);if(!goog.html.sanitizer.CssSanitizer.isDisallowedPropertyName_(i)){var g=goog.html.sanitizer.noclobber.getCssPropertyValue(e,r),n=goog.html.sanitizer.CssPropertySanitizer.sanitizeProperty(i,g,t);null!=n&&goog.html.sanitizer.noclobber.setCssProperty(o,i,n)}}),goog.html.uncheckedconversions.safeStyleFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Output of CSS sanitizer"),o.cssText||"")},goog.html.sanitizer.CssSanitizer.sanitizeInlineStyleString=function(e,t){if(goog.userAgent.IE&&document.documentMode<10)return new goog.html.SafeStyle;var o=goog.html.sanitizer.CssSanitizer.createInertDocument_().createElement("DIV");return o.style.cssText=e,goog.html.sanitizer.CssSanitizer.sanitizeInlineStyle(o.style,t)},goog.html.sanitizer.CssSanitizer.inlineStyleRules=function(e){var t=goog.html.sanitizer.noclobber.getElementsByTagName(e,"STYLE"),o=goog.array.concatMap(t,function(e){return goog.array.toArray(goog.html.sanitizer.noclobber.getElementStyleSheet(e).cssRules)});(o=goog.html.sanitizer.CssSanitizer.getOnlyStyleRules_(o)).sort(function(e,t){var o=goog.html.CssSpecificity.getSpecificity(e.selectorText),r=goog.html.CssSpecificity.getSpecificity(t.selectorText);return-goog.array.compare3(o,r)});for(var r,i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1);r=i.nextNode();)goog.array.forEach(o,function(e){goog.html.sanitizer.noclobber.elementMatches(r,e.selectorText)&&e.style&&goog.html.sanitizer.CssSanitizer.mergeStyleDeclarations_(r,e.style)});goog.array.forEach(t,goog.dom.removeNode)},goog.html.sanitizer.CssSanitizer.mergeStyleDeclarations_=function(e,t){var o=goog.html.sanitizer.CssSanitizer.getCssPropNames_(e.style),r=goog.html.sanitizer.CssSanitizer.getCssPropNames_(t);goog.array.forEach(r,function(r){if(!(o.indexOf(r)>=0)){var i=goog.html.sanitizer.noclobber.getCssPropertyValue(t,r);goog.html.sanitizer.noclobber.setCssProperty(e.style,r,i)}})},goog.html.sanitizer.CssSanitizer.createInertDocument_=function(){var e=document;return"function"==typeof HTMLTemplateElement&&(e=goog.dom.createElement(goog.dom.TagName.TEMPLATE).content.ownerDocument),e.implementation.createHTMLDocument("")},goog.html.sanitizer.CssSanitizer.getCssPropNames_=function(e){var t=[];return goog.isArrayLike(e)?t=goog.array.toArray(e):(t=goog.object.getKeys(e),goog.array.remove(t,"cssText")),t},goog.html.sanitizer.CssSanitizer.isDisallowedPropertyName_=function(e){return goog.string.startsWith(e,"--")||goog.string.startsWith(e,"var")};