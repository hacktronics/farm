goog.provide("goog.fs.DirectoryEntryImpl"),goog.provide("goog.fs.EntryImpl"),goog.provide("goog.fs.FileEntryImpl"),goog.forwardDeclare("goog.fs.FileSystem"),goog.require("goog.array"),goog.require("goog.async.Deferred"),goog.require("goog.fs.DirectoryEntry"),goog.require("goog.fs.Entry"),goog.require("goog.fs.Error"),goog.require("goog.fs.FileEntry"),goog.require("goog.fs.FileWriter"),goog.require("goog.functions"),goog.require("goog.string"),goog.fs.EntryImpl=function(o,r){this.fs_=o,this.entry_=r},goog.fs.EntryImpl.prototype.isFile=function(){return this.entry_.isFile},goog.fs.EntryImpl.prototype.isDirectory=function(){return this.entry_.isDirectory},goog.fs.EntryImpl.prototype.getName=function(){return this.entry_.name},goog.fs.EntryImpl.prototype.getFullPath=function(){return this.entry_.fullPath},goog.fs.EntryImpl.prototype.getFileSystem=function(){return this.fs_},goog.fs.EntryImpl.prototype.getLastModified=function(){return this.getMetadata().addCallback(function(o){return o.modificationTime})},goog.fs.EntryImpl.prototype.getMetadata=function(){var o=new goog.async.Deferred;return this.entry_.getMetadata(function(r){o.callback(r)},goog.bind(function(r){var t="retrieving metadata for "+this.getFullPath();o.errback(new goog.fs.Error(r,t))},this)),o},goog.fs.EntryImpl.prototype.moveTo=function(o,r){var t=new goog.async.Deferred;return this.entry_.moveTo(o.dir_,r,goog.bind(function(o){t.callback(this.wrapEntry(o))},this),goog.bind(function(e){var g="moving "+this.getFullPath()+" into "+o.getFullPath()+(r?", renaming to "+r:"");t.errback(new goog.fs.Error(e,g))},this)),t},goog.fs.EntryImpl.prototype.copyTo=function(o,r){var t=new goog.async.Deferred;return this.entry_.copyTo(o.dir_,r,goog.bind(function(o){t.callback(this.wrapEntry(o))},this),goog.bind(function(e){var g="copying "+this.getFullPath()+" into "+o.getFullPath()+(r?", renaming to "+r:"");t.errback(new goog.fs.Error(e,g))},this)),t},goog.fs.EntryImpl.prototype.wrapEntry=function(o){return o.isFile?new goog.fs.FileEntryImpl(this.fs_,o):new goog.fs.DirectoryEntryImpl(this.fs_,o)},goog.fs.EntryImpl.prototype.toUrl=function(o){return this.entry_.toURL(o)},goog.fs.EntryImpl.prototype.toUri=goog.fs.EntryImpl.prototype.toUrl,goog.fs.EntryImpl.prototype.remove=function(){var o=new goog.async.Deferred;return this.entry_.remove(goog.bind(o.callback,o,!0),goog.bind(function(r){var t="removing "+this.getFullPath();o.errback(new goog.fs.Error(r,t))},this)),o},goog.fs.EntryImpl.prototype.getParent=function(){var o=new goog.async.Deferred;return this.entry_.getParent(goog.bind(function(r){o.callback(new goog.fs.DirectoryEntryImpl(this.fs_,r))},this),goog.bind(function(r){var t="getting parent of "+this.getFullPath();o.errback(new goog.fs.Error(r,t))},this)),o},goog.fs.DirectoryEntryImpl=function(o,r){goog.fs.DirectoryEntryImpl.base(this,"constructor",o,r),this.dir_=r},goog.inherits(goog.fs.DirectoryEntryImpl,goog.fs.EntryImpl),goog.fs.DirectoryEntryImpl.prototype.getFile=function(o,r){var t=new goog.async.Deferred;return this.dir_.getFile(o,this.getOptions_(r),goog.bind(function(o){t.callback(new goog.fs.FileEntryImpl(this.fs_,o))},this),goog.bind(function(r){var e="loading file "+o+" from "+this.getFullPath();t.errback(new goog.fs.Error(r,e))},this)),t},goog.fs.DirectoryEntryImpl.prototype.getDirectory=function(o,r){var t=new goog.async.Deferred;return this.dir_.getDirectory(o,this.getOptions_(r),goog.bind(function(o){t.callback(new goog.fs.DirectoryEntryImpl(this.fs_,o))},this),goog.bind(function(r){var e="loading directory "+o+" from "+this.getFullPath();t.errback(new goog.fs.Error(r,e))},this)),t},goog.fs.DirectoryEntryImpl.prototype.createPath=function(o){if(goog.string.startsWith(o,"/")){var r=this.getFileSystem().getRoot();if(this.getFullPath()!=r.getFullPath())return r.createPath(o)}var t=goog.array.filter(o.split("/"),goog.functions.identity);return function o(r){if(!t.length)return goog.async.Deferred.succeed(r);var e=t.shift();return(".."==e?r.getParent():"."==e?goog.async.Deferred.succeed(r):r.getDirectory(e,goog.fs.DirectoryEntry.Behavior.CREATE)).addCallback(o)}(this)},goog.fs.DirectoryEntryImpl.prototype.listDirectory=function(){var o=new goog.async.Deferred,r=this.dir_.createReader(),t=[],e=goog.bind(function(r){var t="listing directory "+this.getFullPath();o.errback(new goog.fs.Error(r,t))},this),g=goog.bind(function(n){if(n.length){for(var i,s=0;i=n[s];s++)t.push(this.wrapEntry(i));r.readEntries(g,e)}else o.callback(t)},this);return r.readEntries(g,e),o},goog.fs.DirectoryEntryImpl.prototype.removeRecursively=function(){var o=new goog.async.Deferred;return this.dir_.removeRecursively(goog.bind(o.callback,o,!0),goog.bind(function(r){var t="removing "+this.getFullPath()+" recursively";o.errback(new goog.fs.Error(r,t))},this)),o},goog.fs.DirectoryEntryImpl.prototype.getOptions_=function(o){return o==goog.fs.DirectoryEntry.Behavior.CREATE?{create:!0}:o==goog.fs.DirectoryEntry.Behavior.CREATE_EXCLUSIVE?{create:!0,exclusive:!0}:{}},goog.fs.FileEntryImpl=function(o,r){goog.fs.FileEntryImpl.base(this,"constructor",o,r),this.file_=r},goog.inherits(goog.fs.FileEntryImpl,goog.fs.EntryImpl),goog.fs.FileEntryImpl.prototype.createWriter=function(){var o=new goog.async.Deferred;return this.file_.createWriter(function(r){o.callback(new goog.fs.FileWriter(r))},goog.bind(function(r){var t="creating writer for "+this.getFullPath();o.errback(new goog.fs.Error(r,t))},this)),o},goog.fs.FileEntryImpl.prototype.file=function(){var o=new goog.async.Deferred;return this.file_.file(function(r){o.callback(r)},goog.bind(function(r){var t="getting file for "+this.getFullPath();o.errback(new goog.fs.Error(r,t))},this)),o};