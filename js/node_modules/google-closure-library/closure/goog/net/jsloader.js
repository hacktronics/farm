goog.provide("goog.net.jsloader"),goog.provide("goog.net.jsloader.Error"),goog.provide("goog.net.jsloader.ErrorCode"),goog.provide("goog.net.jsloader.Options"),goog.require("goog.array"),goog.require("goog.async.Deferred"),goog.require("goog.debug.Error"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.dom.safe"),goog.require("goog.html.TrustedResourceUrl"),goog.require("goog.object"),goog.net.jsloader.GLOBAL_VERIFY_OBJS_="closure_verification",goog.net.jsloader.DEFAULT_TIMEOUT=5e3,goog.net.jsloader.Options,goog.net.jsloader.scriptsToLoad_=[],goog.net.jsloader.scriptLoadingDeferred_,goog.net.jsloader.safeLoadMany=function(o,e){if(!o.length)return goog.async.Deferred.succeed(null);var r=goog.net.jsloader.scriptsToLoad_.length;if(goog.array.extend(goog.net.jsloader.scriptsToLoad_,o),r)return goog.net.jsloader.scriptLoadingDeferred_;o=goog.net.jsloader.scriptsToLoad_;var g=function(){var r=o.shift(),t=goog.net.jsloader.safeLoad(r,e);return o.length&&t.addBoth(g),t};return goog.net.jsloader.scriptLoadingDeferred_=g(),goog.net.jsloader.scriptLoadingDeferred_},goog.net.jsloader.safeLoad=function(o,e){var r=e||{},g=r.document||document,t=goog.html.TrustedResourceUrl.unwrap(o),a=goog.dom.createElement(goog.dom.TagName.SCRIPT),n={script_:a,timeout_:void 0},d=new goog.async.Deferred(goog.net.jsloader.cancel_,n),l=null,s=null!=r.timeout?r.timeout:goog.net.jsloader.DEFAULT_TIMEOUT;s>0&&(l=window.setTimeout(function(){goog.net.jsloader.cleanup_(a,!0),d.errback(new goog.net.jsloader.Error(goog.net.jsloader.ErrorCode.TIMEOUT,"Timeout reached for loading script "+t))},s),n.timeout_=l),a.onload=a.onreadystatechange=function(){if(!a.readyState||"loaded"==a.readyState||"complete"==a.readyState){var o=r.cleanupWhenDone||!1;goog.net.jsloader.cleanup_(a,o,l),d.callback(null)}},a.onerror=function(){goog.net.jsloader.cleanup_(a,!0,l),d.errback(new goog.net.jsloader.Error(goog.net.jsloader.ErrorCode.LOAD_ERROR,"Error while loading script "+t))};var i=r.attributes||{};return goog.object.extend(i,{type:"text/javascript",charset:"UTF-8"}),goog.dom.setProperties(a,i),goog.dom.safe.setScriptSrc(a,o),goog.net.jsloader.getScriptParentElement_(g).appendChild(a),d},goog.net.jsloader.safeLoadAndVerify=function(o,e,r){goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_]||(goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_]={});var g=goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_],t=goog.html.TrustedResourceUrl.unwrap(o);if(void 0!==g[e])return goog.async.Deferred.fail(new goog.net.jsloader.Error(goog.net.jsloader.ErrorCode.VERIFY_OBJECT_ALREADY_EXISTS,"Verification object "+e+" already defined."));var a=goog.net.jsloader.safeLoad(o,r),n=new goog.async.Deferred(goog.bind(a.cancel,a));return a.addCallback(function(){var o=g[e];void 0!==o?(n.callback(o),delete g[e]):n.errback(new goog.net.jsloader.Error(goog.net.jsloader.ErrorCode.VERIFY_ERROR,"Script "+t+" loaded, but verification object "+e+" was not defined."))}),a.addErrback(function(o){void 0!==g[e]&&delete g[e],n.errback(o)}),n},goog.net.jsloader.getScriptParentElement_=function(o){var e=goog.dom.getElementsByTagName(goog.dom.TagName.HEAD,o);return!e||goog.array.isEmpty(e)?o.documentElement:e[0]},goog.net.jsloader.cancel_=function(){var o=this;if(o&&o.script_){var e=o.script_;e&&e.tagName==goog.dom.TagName.SCRIPT&&goog.net.jsloader.cleanup_(e,!0,o.timeout_)}},goog.net.jsloader.cleanup_=function(o,e,r){null!=r&&goog.global.clearTimeout(r),o.onload=goog.nullFunction,o.onerror=goog.nullFunction,o.onreadystatechange=goog.nullFunction,e&&window.setTimeout(function(){goog.dom.removeNode(o)},0)},goog.net.jsloader.ErrorCode={LOAD_ERROR:0,TIMEOUT:1,VERIFY_ERROR:2,VERIFY_OBJECT_ALREADY_EXISTS:3},goog.net.jsloader.Error=function(o,e){var r="Jsloader error (code #"+o+")";e&&(r+=": "+e),goog.net.jsloader.Error.base(this,"constructor",r),this.code=o},goog.inherits(goog.net.jsloader.Error,goog.debug.Error);