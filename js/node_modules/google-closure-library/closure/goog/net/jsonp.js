goog.provide("goog.net.Jsonp"),goog.require("goog.html.TrustedResourceUrl"),goog.require("goog.net.jsloader"),goog.require("goog.object"),goog.net.Jsonp=function(o,e){this.uri_=o,this.callbackParamName_=e||"callback",this.timeout_=5e3,this.nonce_=""},goog.net.Jsonp.CALLBACKS="_callbacks_",goog.net.Jsonp.scriptCounter_=0,goog.net.Jsonp.getCallbackId_=function(o){return goog.net.Jsonp.CALLBACKS+"__"+o},goog.net.Jsonp.prototype.setRequestTimeout=function(o){this.timeout_=o},goog.net.Jsonp.prototype.getRequestTimeout=function(){return this.timeout_},goog.net.Jsonp.prototype.setNonce=function(o){this.nonce_=o},goog.net.Jsonp.prototype.send=function(o,e,n,t){var g=o?goog.object.clone(o):{},r=t||"_"+(goog.net.Jsonp.scriptCounter_++).toString(36)+goog.now().toString(36),a=goog.net.Jsonp.getCallbackId_(r);if(e){var i=goog.net.Jsonp.newReplyHandler_(r,e);goog.global[a]=i,g[this.callbackParamName_]=a}var s={timeout:this.timeout_,cleanupWhenDone:!0};this.nonce_&&(s.attributes={nonce:this.nonce_});var c=this.uri_.cloneWithParams(g),l=goog.net.jsloader.safeLoad(c,s),p=goog.net.Jsonp.newErrorHandler_(r,g,n);return l.addErrback(p),{id_:r,deferred_:l}},goog.net.Jsonp.prototype.cancel=function(o){o&&(o.deferred_&&o.deferred_.cancel(),o.id_&&goog.net.Jsonp.cleanup_(o.id_,!1))},goog.net.Jsonp.newErrorHandler_=function(o,e,n){return function(){goog.net.Jsonp.cleanup_(o,!1),n&&n(e)}},goog.net.Jsonp.newReplyHandler_=function(o,e){return function(n){goog.net.Jsonp.cleanup_(o,!0),e.apply(void 0,arguments)}},goog.net.Jsonp.cleanup_=function(o,e){var n=goog.net.Jsonp.getCallbackId_(o);if(goog.global[n])if(e)try{delete goog.global[n]}catch(o){goog.global[n]=void 0}else goog.global[n]=goog.nullFunction};