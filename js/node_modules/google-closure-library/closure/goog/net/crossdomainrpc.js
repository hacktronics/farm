if(goog.provide("goog.net.CrossDomainRpc"),goog.require("goog.Uri"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.dom.safe"),goog.require("goog.events"),goog.require("goog.events.EventTarget"),goog.require("goog.events.EventType"),goog.require("goog.html.SafeHtml"),goog.require("goog.log"),goog.require("goog.net.EventType"),goog.require("goog.net.HttpStatus"),goog.require("goog.string"),goog.require("goog.userAgent"),goog.net.CrossDomainRpc=function(){goog.events.EventTarget.call(this)},goog.inherits(goog.net.CrossDomainRpc,goog.events.EventTarget),goog.net.CrossDomainRpc.RESPONSE_MARKER_="xdrp",goog.net.CrossDomainRpc.useFallBackDummyResource_=!0,goog.net.CrossDomainRpc.prototype.responseHeaders,goog.net.CrossDomainRpc.prototype.responseText,goog.net.CrossDomainRpc.prototype.status,goog.net.CrossDomainRpc.prototype.timeWaitedAfterResponseReady_,goog.net.CrossDomainRpc.prototype.responseTextIsJson_,goog.net.CrossDomainRpc.prototype.responseReady_,goog.net.CrossDomainRpc.prototype.requestFrame_,goog.net.CrossDomainRpc.prototype.loadListenerKey_,goog.net.CrossDomainRpc.isInResponseIframe_=function(){return window.location&&(1==window.location.hash.indexOf(goog.net.CrossDomainRpc.RESPONSE_MARKER_)||1==window.location.search.indexOf(goog.net.CrossDomainRpc.RESPONSE_MARKER_))},goog.net.CrossDomainRpc.isInResponseIframe_())if(goog.userAgent.EDGE_OR_IE)document.execCommand("Stop");else{if(!goog.userAgent.GECKO)throw new Error("stopped");window.stop()}goog.net.CrossDomainRpc.setDummyResourceUri=function(o){goog.net.CrossDomainRpc.dummyResourceUri_=o},goog.net.CrossDomainRpc.setUseFallBackDummyResource=function(o){goog.net.CrossDomainRpc.useFallBackDummyResource_=o},goog.net.CrossDomainRpc.send=function(o,e,n,t,s){var g=new goog.net.CrossDomainRpc;e&&goog.events.listen(g,goog.net.EventType.COMPLETE,e),goog.events.listen(g,goog.net.EventType.READY,g.reset),g.sendRequest(o,n,t,s)},goog.net.CrossDomainRpc.setDebugMode=function(o){goog.net.CrossDomainRpc.debugMode_=o},goog.net.CrossDomainRpc.logger_=goog.log.getLogger("goog.net.CrossDomainRpc"),goog.net.CrossDomainRpc.createInputHtml_=function(o,e){return goog.html.SafeHtml.create("textarea",{name:o},String(e))},goog.net.CrossDomainRpc.getDummyResourceUri_=function(){if(goog.net.CrossDomainRpc.dummyResourceUri_)return goog.net.CrossDomainRpc.dummyResourceUri_;if(goog.userAgent.GECKO)for(var o=goog.dom.getElementsByTagName(goog.dom.TagName.LINK),e=0;e<o.length;e++){var n=o[e];if("stylesheet"==n.rel&&goog.Uri.haveSameDomain(n.href,window.location.href)&&n.href.indexOf("?")<0)return goog.net.CrossDomainRpc.removeHash_(n.href)}var t=goog.dom.getElementsByTagName(goog.dom.TagName.IMG);for(e=0;e<t.length;e++){var s=t[e];if(goog.Uri.haveSameDomain(s.src,window.location.href)&&s.src.indexOf("?")<0)return goog.net.CrossDomainRpc.removeHash_(s.src)}if(!goog.net.CrossDomainRpc.useFallBackDummyResource_)throw new Error("No suitable dummy resource specified or detected for this page");if(goog.userAgent.EDGE_OR_IE)return goog.net.CrossDomainRpc.removeHash_(window.location.href);var g=window.location.href,r=g.indexOf("/",g.indexOf("//")+2);return g.substring(0,r)+"/robots.txt"},goog.net.CrossDomainRpc.removeHash_=function(o){return o.split("#")[0]},goog.net.CrossDomainRpc.nextRequestId_=0,goog.net.CrossDomainRpc.HEADER="xdh:",goog.net.CrossDomainRpc.PARAM="xdp:",goog.net.CrossDomainRpc.PARAM_ECHO="xdpe:",goog.net.CrossDomainRpc.PARAM_ECHO_REQUEST_ID=goog.net.CrossDomainRpc.PARAM_ECHO+"request-id",goog.net.CrossDomainRpc.PARAM_ECHO_DUMMY_URI=goog.net.CrossDomainRpc.PARAM_ECHO+"dummy-uri",goog.net.CrossDomainRpc.REQUEST_MARKER_="xdrq",goog.net.CrossDomainRpc.prototype.sendRequest=function(o,e,n,t){var s=this.requestFrame_=goog.dom.createElement(goog.dom.TagName.IFRAME),g=goog.net.CrossDomainRpc.nextRequestId_++;s.id=goog.net.CrossDomainRpc.REQUEST_MARKER_+"-"+g,goog.net.CrossDomainRpc.debugMode_||(s.style.position="absolute",s.style.top="-5000px",s.style.left="-5000px"),document.body.appendChild(s);var r=[];r.push(goog.net.CrossDomainRpc.createInputHtml_(goog.net.CrossDomainRpc.PARAM_ECHO_REQUEST_ID,g));var i=goog.net.CrossDomainRpc.getDummyResourceUri_();if(goog.log.fine(goog.net.CrossDomainRpc.logger_,"dummyUri: "+i),r.push(goog.net.CrossDomainRpc.createInputHtml_(goog.net.CrossDomainRpc.PARAM_ECHO_DUMMY_URI,i)),n)for(var a in n){var m=n[a];r.push(goog.net.CrossDomainRpc.createInputHtml_(goog.net.CrossDomainRpc.PARAM+a,m))}if(t)for(var a in t){m=t[a];r.push(goog.net.CrossDomainRpc.createInputHtml_(goog.net.CrossDomainRpc.HEADER+a,m))}var R=goog.html.SafeHtml.create("body",{},goog.html.SafeHtml.create("form",{method:"GET"==e?"GET":"POST",action:o},r)),p=goog.dom.getFrameContentDocument(s);p.open(),goog.dom.safe.documentWrite(p,R),p.close(),p.forms[0].submit(),p=null,this.loadListenerKey_=goog.events.listen(s,goog.events.EventType.LOAD,function(){goog.log.fine(goog.net.CrossDomainRpc.logger_,"response ready"),this.responseReady_=!0},!1,this),this.receiveResponse_()},goog.net.CrossDomainRpc.RESPONSE_POLLING_PERIOD_=50,goog.net.CrossDomainRpc.SEND_RESPONSE_TIME_OUT_=500,goog.net.CrossDomainRpc.prototype.receiveResponse_=function(){this.timeWaitedAfterResponseReady_=0;var o=window.setInterval(goog.bind(function(){this.detectResponse_(o)},this),goog.net.CrossDomainRpc.RESPONSE_POLLING_PERIOD_)},goog.net.CrossDomainRpc.prototype.detectResponse_=function(o){var e=this.requestFrame_.contentWindow,n=e.frames.length,t=null;if(n>0&&goog.net.CrossDomainRpc.isResponseInfoFrame_(t=e.frames[n-1])){goog.log.fine(goog.net.CrossDomainRpc.logger_,"xd response ready");var s=goog.net.CrossDomainRpc.getFramePayload_(t).substring(1),g=new goog.Uri.QueryData(s),r=[],i=Number(g.get("n"));goog.log.fine(goog.net.CrossDomainRpc.logger_,"xd response number of chunks: "+i);for(var a=0;a<i;a++){var m=e.frames[a];if(!m||!m.location||!m.location.href)return void goog.log.fine(goog.net.CrossDomainRpc.logger_,"xd response iframe not ready");var R=goog.net.CrossDomainRpc.getFramePayload_(m),p=R.indexOf(goog.net.CrossDomainRpc.PARAM_CHUNK_)+goog.net.CrossDomainRpc.PARAM_CHUNK_.length+1,c=R.substring(p);r.push(c)}window.clearInterval(o);var _=r.join("");goog.userAgent.EDGE_OR_IE||(_=decodeURIComponent(_)),this.status=Number(g.get("status")),this.responseText=_,this.responseTextIsJson_="true"==g.get("isDataJson"),this.responseHeaders=JSON.parse(g.get("headers")),this.dispatchEvent(goog.net.EventType.READY),this.dispatchEvent(goog.net.EventType.COMPLETE)}else this.responseReady_&&(this.timeWaitedAfterResponseReady_+=goog.net.CrossDomainRpc.RESPONSE_POLLING_PERIOD_,this.timeWaitedAfterResponseReady_>goog.net.CrossDomainRpc.SEND_RESPONSE_TIME_OUT_&&(goog.log.fine(goog.net.CrossDomainRpc.logger_,"xd response timed out"),window.clearInterval(o),this.status=goog.net.HttpStatus.INTERNAL_SERVER_ERROR,this.responseText="response timed out",this.dispatchEvent(goog.net.EventType.READY),this.dispatchEvent(goog.net.EventType.ERROR),this.dispatchEvent(goog.net.EventType.COMPLETE)))},goog.net.CrossDomainRpc.isResponseInfoFrame_=function(o){try{return 1==goog.net.CrossDomainRpc.getFramePayload_(o).indexOf(goog.net.CrossDomainRpc.RESPONSE_INFO_MARKER_)}catch(o){return!1}},goog.net.CrossDomainRpc.getFramePayload_=function(o){var e=o.location.href,n=e.indexOf("?"),t=e.indexOf("#"),s=n<0?t:t<0?n:Math.min(n,t);return e.substring(s)},goog.net.CrossDomainRpc.prototype.getResponseJson=function(){return this.responseTextIsJson_?JSON.parse(this.responseText):void 0},goog.net.CrossDomainRpc.prototype.isSuccess=function(){switch(this.status){case goog.net.HttpStatus.OK:case goog.net.HttpStatus.NOT_MODIFIED:return!0;default:return!1}},goog.net.CrossDomainRpc.prototype.reset=function(){goog.net.CrossDomainRpc.debugMode_||(goog.log.fine(goog.net.CrossDomainRpc.logger_,"request frame removed: "+this.requestFrame_.id),goog.events.unlistenByKey(this.loadListenerKey_),this.requestFrame_.parentNode.removeChild(this.requestFrame_)),delete this.requestFrame_},goog.net.CrossDomainRpc.RESPONSE_INFO_MARKER_=goog.net.CrossDomainRpc.RESPONSE_MARKER_+"-info",goog.net.CrossDomainRpc.MAX_CHUNK_SIZE_=goog.userAgent.EDGE_OR_IE?4095:1048576,goog.net.CrossDomainRpc.PARAM_CHUNK_="chunk",goog.net.CrossDomainRpc.CHUNK_PREFIX_=goog.net.CrossDomainRpc.RESPONSE_MARKER_+"=1&"+goog.net.CrossDomainRpc.PARAM_CHUNK_+"=",goog.net.CrossDomainRpc.sendResponse=function(o,e,n,t,s){var g=n[goog.net.CrossDomainRpc.PARAM_ECHO_DUMMY_URI];goog.string.caseInsensitiveStartsWith(g,"http://")||goog.string.caseInsensitiveStartsWith(g,"https://")||(g="http://"+g);var r=goog.net.CrossDomainRpc.MAX_CHUNK_SIZE_-g.length-1-goog.net.CrossDomainRpc.CHUNK_PREFIX_.length-1;goog.userAgent.EDGE_OR_IE||(o=encodeURIComponent(o));var i=Math.ceil(o.length/r);if(0==i)goog.net.CrossDomainRpc.createResponseInfo_(g,i,e,t,s);else for(var a=0,m=function(){++a==i&&goog.net.CrossDomainRpc.createResponseInfo_(g,i,e,t,s)},R=0;R<i;R++){var p=R*r,c=p+r,_=c>o.length?o.substring(p):o.substring(p,c),u=goog.dom.createElement(goog.dom.TagName.IFRAME);u.src=g+goog.net.CrossDomainRpc.getPayloadDelimiter_(g)+goog.net.CrossDomainRpc.CHUNK_PREFIX_+_,document.body.appendChild(u),m()}},goog.net.CrossDomainRpc.createResponseInfo_=function(o,e,n,t,s){var g=goog.dom.createElement(goog.dom.TagName.IFRAME);document.body.appendChild(g),g.src=o+goog.net.CrossDomainRpc.getPayloadDelimiter_(o)+goog.net.CrossDomainRpc.RESPONSE_INFO_MARKER_+"=1&n="+e+"&isDataJson="+n+"&status="+t+"&headers="+encodeURIComponent(s)},goog.net.CrossDomainRpc.getPayloadDelimiter_=function(o){return goog.net.CrossDomainRpc.REFERRER_==o?"?":"#"},goog.net.CrossDomainRpc.removeUriParams_=function(o){var e=o.indexOf("?");e>0&&(o=o.substring(0,e));var n=o.indexOf("#");return n>0&&(o=o.substring(0,n)),o},goog.net.CrossDomainRpc.prototype.getResponseHeader=function(o){return goog.isObject(this.responseHeaders)?this.responseHeaders[o]:void 0},goog.net.CrossDomainRpc.REFERRER_=goog.net.CrossDomainRpc.removeUriParams_(document.referrer);