goog.provide("goog.net.ImageLoader"),goog.require("goog.array"),goog.require("goog.dom"),goog.require("goog.dom.TagName"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventTarget"),goog.require("goog.events.EventType"),goog.require("goog.net.EventType"),goog.require("goog.object"),goog.require("goog.userAgent"),goog.net.ImageLoader=function(e){goog.events.EventTarget.call(this),this.imageIdToRequestMap_={},this.imageIdToImageMap_={},this.handler_=new goog.events.EventHandler(this),this.parent_=e},goog.inherits(goog.net.ImageLoader,goog.events.EventTarget),goog.net.ImageLoader.CorsRequestType={ANONYMOUS:"anonymous",USE_CREDENTIALS:"use-credentials"},goog.net.ImageLoader.ImageRequest_,goog.net.ImageLoader.IMAGE_LOAD_EVENTS_=[goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("11")?goog.net.EventType.READY_STATE_CHANGE:goog.events.EventType.LOAD,goog.net.EventType.ABORT,goog.net.EventType.ERROR],goog.net.ImageLoader.prototype.addImage=function(e,o,t){var g="string"==typeof o?o:o.src;g&&(this.imageIdToRequestMap_[e]={src:g,corsRequestType:void 0!==t?t:null})},goog.net.ImageLoader.prototype.removeImage=function(e){delete this.imageIdToRequestMap_[e];var o=this.imageIdToImageMap_[e];o&&(delete this.imageIdToImageMap_[e],this.handler_.unlisten(o,goog.net.ImageLoader.IMAGE_LOAD_EVENTS_,this.onNetworkEvent_),goog.object.isEmpty(this.imageIdToImageMap_)&&goog.object.isEmpty(this.imageIdToRequestMap_)&&this.dispatchEvent(goog.net.EventType.COMPLETE))},goog.net.ImageLoader.prototype.start=function(){var e=this.imageIdToRequestMap_;goog.array.forEach(goog.object.getKeys(e),function(o){var t=e[o];t&&(delete e[o],this.loadImage_(t,o))},this)},goog.net.ImageLoader.prototype.loadImage_=function(e,o){if(!this.isDisposed()){var t;if(this.parent_)t=goog.dom.getDomHelper(this.parent_).createDom(goog.dom.TagName.IMG);else t=new Image;e.corsRequestType&&(t.crossOrigin=e.corsRequestType),this.handler_.listen(t,goog.net.ImageLoader.IMAGE_LOAD_EVENTS_,this.onNetworkEvent_),this.imageIdToImageMap_[o]=t,t.id=o,t.src=e.src}},goog.net.ImageLoader.prototype.onNetworkEvent_=function(e){var o=e.currentTarget;if(o){if(e.type==goog.net.EventType.READY_STATE_CHANGE){if(o.readyState!=goog.net.EventType.COMPLETE)return;e.type=goog.events.EventType.LOAD}void 0===o.naturalWidth&&(e.type==goog.events.EventType.LOAD?(o.naturalWidth=o.width,o.naturalHeight=o.height):(o.naturalWidth=0,o.naturalHeight=0)),this.dispatchEvent({type:e.type,target:o}),this.isDisposed()||this.removeImage(o.id)}},goog.net.ImageLoader.prototype.disposeInternal=function(){delete this.imageIdToRequestMap_,delete this.imageIdToImageMap_,goog.dispose(this.handler_),goog.net.ImageLoader.superClass_.disposeInternal.call(this)};