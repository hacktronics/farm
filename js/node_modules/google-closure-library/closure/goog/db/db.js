goog.provide("goog.db"),goog.provide("goog.db.BlockedCallback"),goog.provide("goog.db.UpgradeNeededCallback"),goog.require("goog.asserts"),goog.require("goog.async.Deferred"),goog.require("goog.db.Error"),goog.require("goog.db.IndexedDb"),goog.require("goog.db.Transaction"),goog.db.indexedDb_=goog.global.indexedDB||goog.global.mozIndexedDB||goog.global.webkitIndexedDB||goog.global.moz_indexedDB,goog.db.BlockedCallback,goog.db.UpgradeNeededCallback,goog.db.openDatabase=function(o,e,g,n){goog.asserts.assert(void 0!==e==(void 0!==g),"opt_version must be passed to goog.db.openDatabase if and only if opt_onUpgradeNeeded is also passed");var d=new goog.async.Deferred,r=e?goog.db.indexedDb_.open(o,e):goog.db.indexedDb_.open(o);return r.onsuccess=function(o){var e=new goog.db.IndexedDb(o.target.result);d.callback(e)},r.onerror=function(e){var g="opening database "+o;d.errback(goog.db.Error.fromRequest(e.target,g))},r.onupgradeneeded=function(o){if(g){var e=new goog.db.IndexedDb(o.target.result);g(new goog.db.IndexedDb.VersionChangeEvent(o.oldVersion,o.newVersion),e,new goog.db.Transaction(o.target.transaction,e))}},r.onblocked=function(o){n&&n(new goog.db.IndexedDb.VersionChangeEvent(o.oldVersion,o.newVersion))},d},goog.db.deleteDatabase=function(o,e){var g=new goog.async.Deferred,n=goog.db.indexedDb_.deleteDatabase(o);return n.onsuccess=function(o){g.callback()},n.onerror=function(e){var n="deleting database "+o;g.errback(goog.db.Error.fromRequest(e.target,n))},n.onblocked=function(o){e&&e(new goog.db.IndexedDb.VersionChangeEvent(o.oldVersion,o.newVersion))},g};