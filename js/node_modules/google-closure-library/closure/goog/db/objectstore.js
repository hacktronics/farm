goog.provide("goog.db.ObjectStore"),goog.require("goog.async.Deferred"),goog.require("goog.db.Cursor"),goog.require("goog.db.Error"),goog.require("goog.db.Index"),goog.require("goog.db.KeyRange"),goog.require("goog.debug"),goog.db.ObjectStore=function(e){this.store_=e},goog.db.ObjectStore.prototype.getName=function(){return this.store_.name},goog.db.ObjectStore.prototype.insert_=function(e,o,r,t){var g,n=new goog.async.Deferred;try{g=t?this.store_[e](r,t):this.store_[e](r)}catch(e){return o+=goog.debug.deepExpose(r),t&&(o+=", with key "+goog.debug.deepExpose(t)),n.errback(goog.db.Error.fromException(e,o)),n}return g.onsuccess=function(e){n.callback(e.target.result)},g.onerror=function(e){o+=goog.debug.deepExpose(r),t&&(o+=", with key "+goog.debug.deepExpose(t)),n.errback(goog.db.Error.fromRequest(e.target,o))},n},goog.db.ObjectStore.prototype.put=function(e,o){return this.insert_("put","putting into "+this.getName()+" with value",e,o)},goog.db.ObjectStore.prototype.add=function(e,o){return this.insert_("add","adding into "+this.getName()+" with value ",e,o)},goog.db.ObjectStore.prototype.remove=function(e){var o,r=new goog.async.Deferred;try{o=this.store_.delete(e instanceof goog.db.KeyRange?e.range():e)}catch(o){var t="removing from "+this.getName()+" with key "+goog.debug.deepExpose(e);return r.errback(goog.db.Error.fromException(o,t)),r}o.onsuccess=function(e){r.callback()};var g=this;return o.onerror=function(o){var t="removing from "+g.getName()+" with key "+goog.debug.deepExpose(e);r.errback(goog.db.Error.fromRequest(o.target,t))},r},goog.db.ObjectStore.prototype.get=function(e){var o,r=new goog.async.Deferred;try{o=this.store_.get(e)}catch(o){var t="getting from "+this.getName()+" with key "+goog.debug.deepExpose(e);return r.errback(goog.db.Error.fromException(o,t)),r}o.onsuccess=function(e){r.callback(e.target.result)};var g=this;return o.onerror=function(o){var t="getting from "+g.getName()+" with key "+goog.debug.deepExpose(e);r.errback(goog.db.Error.fromRequest(o.target,t))},r},goog.db.ObjectStore.prototype.getAll=function(e,o){return this.getAllInternal_("getAll","getting all from index "+this.getName(),e,o)},goog.db.ObjectStore.prototype.getAllKeys=function(e,o){return this.getAllInternal_("getAllKeys","getting all keys index "+this.getName(),e,o)},goog.db.ObjectStore.prototype.getAllInternal_=function(e,o,r,t){var g;g=void 0===r?void 0:r instanceof goog.db.KeyRange?r.range():goog.db.KeyRange.only(r).range();var n,c=new goog.async.Deferred;try{n=this.store_[e](g,t)}catch(e){return o+=" for range "+(g?goog.debug.deepExpose(g):"<all>"),c.errback(goog.db.Error.fromException(e,o)),c}return n.onsuccess=function(){c.callback(n.result)},n.onerror=function(e){o+=" for range "+(g?goog.debug.deepExpose(g):"<all>"),c.errback(goog.db.Error.fromRequest(e.target,o))},c},goog.db.ObjectStore.prototype.openCursor=function(e,o){return goog.db.Cursor.openCursor(this.store_,e,o)},goog.db.ObjectStore.prototype.clear=function(){var e,o="clearing store "+this.getName(),r=new goog.async.Deferred;try{e=this.store_.clear()}catch(e){return r.errback(goog.db.Error.fromException(e,o)),r}return e.onsuccess=function(e){r.callback()},e.onerror=function(e){r.errback(goog.db.Error.fromRequest(e.target,o))},r},goog.db.ObjectStore.prototype.createIndex=function(e,o,r){try{return new goog.db.Index(this.store_.createIndex(e,o,r))}catch(r){var t="creating new index "+e+" with key path "+o;throw goog.db.Error.fromException(r,t)}},goog.db.ObjectStore.prototype.getIndex=function(e){try{return new goog.db.Index(this.store_.index(e))}catch(r){var o="getting index "+e;throw goog.db.Error.fromException(r,o)}},goog.db.ObjectStore.prototype.deleteIndex=function(e){try{this.store_.deleteIndex(e)}catch(r){var o="deleting index "+e;throw goog.db.Error.fromException(r,o)}},goog.db.ObjectStore.prototype.count=function(e){var o=new goog.async.Deferred;try{var r=e?e.range():null,t=this.store_.count(r);t.onsuccess=function(e){o.callback(e.target.result)};var g=this;t.onerror=function(e){o.errback(goog.db.Error.fromRequest(e.target,g.getName()))}}catch(e){o.errback(goog.db.Error.fromException(e,this.getName()))}return o};