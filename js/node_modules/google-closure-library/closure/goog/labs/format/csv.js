goog.provide("goog.labs.format.csv"),goog.provide("goog.labs.format.csv.ParseError"),goog.provide("goog.labs.format.csv.Token"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.debug.Error"),goog.require("goog.object"),goog.require("goog.string"),goog.require("goog.string.newlines"),goog.labs.format.csv.ENABLE_VERBOSE_DEBUGGING=goog.DEBUG,goog.labs.format.csv.ParseError=function(r,o,e){var n;if(this.position=null,goog.labs.format.csv.ENABLE_VERBOSE_DEBUGGING){n=e||"";var s=goog.labs.format.csv.ParseError.findLineInfo_(r,o);if(s){var t=s.lineIndex+1,g=o-s.line.startLineIndex+1;this.position={line:t,column:g},n+=goog.string.subs(" at line %s column %s",t,g),n+="\n"+goog.labs.format.csv.ParseError.getLineDebugString_(s.line.getContent(),g)}}goog.labs.format.csv.ParseError.base(this,"constructor",n)},goog.inherits(goog.labs.format.csv.ParseError,goog.debug.Error),goog.labs.format.csv.ParseError.prototype.name="ParseError",goog.labs.format.csv.ParseError.findLineInfo_=function(r,o){var e=goog.string.newlines.getLines(r),n=goog.array.findIndex(e,function(r){return r.startLineIndex<=o&&r.endLineIndex>o});return"number"==typeof n?{line:e[n],lineIndex:n}:null},goog.labs.format.csv.ParseError.getLineDebugString_=function(r,o){var e=r+"\n";return e+=goog.string.repeat(" ",o-1)+"^"},goog.labs.format.csv.Token,goog.labs.format.csv.parse=function(r,o,e){var n=0,s=e||",";goog.asserts.assert(1==s.length,"Delimiter must be a single character."),goog.asserts.assert("\r"!=s&&"\n"!=e,"Cannot use newline or carriage return has delimiter.");var t=goog.labs.format.csv.Sentinels_.EOF,g=goog.labs.format.csv.Sentinels_.EOR,a=goog.labs.format.csv.Sentinels_.NEWLINE,i=goog.labs.format.csv.Sentinels_.EMPTY,l=null,f=!1;function u(r){goog.labs.format.csv.assertToken_(r),goog.asserts.assert(null===l),l=r}function c(){if(null!=l){var o=l;return l=null,o}if(n>=r.length)return t;var e=r.charAt(n++);goog.labs.format.csv.assertToken_(e);var s=!1;return"\n"==e?s=!0:"\r"==e&&(n<r.length&&"\n"==r.charAt(n)&&n++,s=!0),s?a:e}function b(){var e=n,l=f;f=!1;var v=c();if(v==i)return g;if(v==t||v==a)return l?(u(i),""):g;if('"'==v)return function(){for(var e=n,i=null,l=c();l!=t;l=c())if('"'==l){if(i=n-1,'"'==(l=c())){i=null;continue}if(l==s||l==t||l==a){l==a&&u(l),l==s&&(f=!0);break}if(o){var v='"'+r.substring(e,n),m=b();return m==g?(u(a),v):v+m}throw new goog.labs.format.csv.ParseError(r,n-1,'Unexpected character "'+l+'" after quote mark')}if(null===i){if(!o)throw new goog.labs.format.csv.ParseError(r,r.length-1,"Unexpected end of text after open quote");i=r.length}return r.substring(e,i).replace(/""/g,'"')}();for(;;){if(v==t||v==a){u(v);break}if(v==s){f=!0;break}if('"'==v&&!o)throw new goog.labs.format.csv.ParseError(r,n-1,"Unexpected quote mark");v=c()}return(v==t?r.substring(e):r.substring(e,n-1)).replace(/[\r\n]+/g,"")}function v(){if(n>=r.length)return t;for(var o=[],e=b();e!=g;e=b())o.push(e);return o}for(var m=[],E=v();E!=t;E=v())m.push(E);return m},goog.labs.format.csv.Sentinels_={EMPTY:{},EOF:{},EOR:{},NEWLINE:{}},goog.labs.format.csv.isCharacterString_=function(r){return"string"==typeof r&&1==r.length},goog.labs.format.csv.assertToken_=function(r){"string"==typeof r?(goog.asserts.assertString(r),goog.asserts.assert(goog.labs.format.csv.isCharacterString_(r),"Should be a string of length 1 or a sentinel.")):goog.asserts.assert(goog.object.containsValue(goog.labs.format.csv.Sentinels_,r),"Should be a string of length 1 or a sentinel.")};