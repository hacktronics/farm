goog.provide("goog.labs.testing.JsonFuzzing"),goog.require("goog.string"),goog.require("goog.testing.PseudoRandom"),goog.labs.testing.JsonFuzzing=function(n,t){this.options_=n||{jsonSize:10,numFields:5,arraySize:5,maxDepth:5},this.random_=new goog.testing.PseudoRandom(t),this.maxDepth_=this.options_.maxDepth},goog.labs.testing.JsonFuzzing.Options,goog.labs.testing.JsonFuzzing.prototype.newArray=function(){for(var n=[],t=this.options_.jsonSize,o=this.nextInt(1,t),e=0;e<o;e++)n.push(this.nextElm_(0));return n},goog.labs.testing.JsonFuzzing.prototype.nextInt=function(n,t){var o=this.random_.random();return Math.floor(o*(t-n))+n},goog.labs.testing.JsonFuzzing.prototype.nextElmType_=function(){return this.random_.random()<.5?0:1},goog.labs.testing.JsonFuzzing.FieldType_={MESSAGE:0,ARRAY:1,STRING:2,NUMBER:3,BOOLEAN:4,NULL:5},goog.labs.testing.JsonFuzzing.prototype.nextFieldType_=function(){var n=goog.labs.testing.JsonFuzzing.FieldType_,t=this.random_.random();return t<.5?n.MESSAGE:t<.6?n.ARRAY:t<.7?n.STRING:t<.8?n.NUMBER:t<.9?n.BOOLEAN:n.NULL},goog.labs.testing.JsonFuzzing.prototype.nextElm_=function(n){switch(this.nextElmType_()){case 0:return this.nextMessage_(n);case 1:return this.nextArray_(n);default:throw new Error("invalid elm type encounted.")}},goog.labs.testing.JsonFuzzing.prototype.nextMessage_=function(n){if(n>this.maxDepth_)return{};for(var t=this.options_.numFields,o=this.nextInt(0,t),e={},s=0;s<o;s++)switch(this.nextFieldType_()){case 0:e["f"+s]=this.nextMessage_(n++);continue;case 1:e["f"+s]=this.nextArray_(n++);continue;case 2:e["f"+s]=goog.string.getRandomString();continue;case 3:e["f"+s]=this.nextNumber_();continue;case 4:e["f"+s]=this.nextBoolean_();continue;case 5:e["f"+s]=null;continue;default:throw new Error("invalid field type encounted.")}return e},goog.labs.testing.JsonFuzzing.prototype.nextArray_=function(n){if(n>this.maxDepth_)return[];for(var t=this.options_.arraySize,o=this.nextInt(0,t),e=[],s=0;s<o;s++)switch(this.nextFieldType_()){case 0:e.push(this.nextMessage_(n++));continue;case 1:e.push(this.nextArray_(n++));continue;case 2:e.push(goog.string.getRandomString());continue;case 3:e.push(this.nextNumber_());continue;case 4:e.push(this.nextBoolean_());continue;case 5:e.push(null);continue;default:throw new Error("invalid field type encounted.")}return e},goog.labs.testing.JsonFuzzing.prototype.nextBoolean_=function(){return this.random_.random()<.5},goog.labs.testing.JsonFuzzing.prototype.nextNumber_=function(){var n=this.random_.random(),t=this.random_.random();return t<.5&&(n*=1e3),(t=this.random_.random())<.5&&(n=Math.floor(n)),(t=this.random_.random())<.5&&(n*=-1),n};