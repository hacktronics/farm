goog.provide("goog.labs.net.xhr"),goog.provide("goog.labs.net.xhr.Error"),goog.provide("goog.labs.net.xhr.HttpError"),goog.provide("goog.labs.net.xhr.Options"),goog.provide("goog.labs.net.xhr.PostData"),goog.provide("goog.labs.net.xhr.ResponseType"),goog.provide("goog.labs.net.xhr.TimeoutError"),goog.require("goog.Promise"),goog.require("goog.asserts"),goog.require("goog.debug.Error"),goog.require("goog.net.HttpStatus"),goog.require("goog.net.XmlHttp"),goog.require("goog.object"),goog.require("goog.string"),goog.require("goog.uri.utils"),goog.require("goog.userAgent"),goog.scope(function(){var o=goog.userAgent,e=goog.labs.net.xhr,r=goog.net.HttpStatus;e.Options,e.PostData,e.CONTENT_TYPE_HEADER="Content-Type",e.FORM_CONTENT_TYPE="application/x-www-form-urlencoded;charset=utf-8",e.ResponseType={ARRAYBUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},e.get=function(o,r){return e.send("GET",o,null,r).then(function(o){return o.responseText})},e.post=function(o,r,t){return e.send("POST",o,r,t).then(function(o){return o.responseText})},e.getJson=function(o,r){return e.send("GET",o,null,r).then(function(o){return e.parseJson_(o.responseText,r)})},e.getBlob=function(o,r){goog.asserts.assert("Blob"in goog.global,"getBlob is not supported in this browser.");var t=r?goog.object.clone(r):{};return t.responseType=e.ResponseType.BLOB,e.send("GET",o,null,t).then(function(o){return o.response})},e.getBytes=function(r,t){goog.asserts.assert(!o.IE||o.isDocumentModeOrHigher(9),"getBytes is not supported in this browser.");var n=t?goog.object.clone(t):{};return n.responseType=e.ResponseType.ARRAYBUFFER,e.send("GET",r,null,n).then(function(o){if(o.response)return new Uint8Array(o.response);if(goog.global.VBArray)return new goog.global.VBArray(o.responseBody).toArray();throw new e.Error("getBytes is not supported in this browser.",r,o)})},e.postJson=function(o,r,t){return e.send("POST",o,r,t).then(function(o){return e.parseJson_(o.responseText,t)})},e.send=function(o,t,n,s){var g=s||{},i=g.xmlHttpFactory?g.xmlHttpFactory.createInstance():goog.net.XmlHttp();return new goog.Promise(function(s,u){var a,p;try{i.open(o,t,!0)}catch(o){u(new e.Error("Error opening XHR: "+o.message,t,i))}if(i.onreadystatechange=function(){i.readyState==goog.net.XmlHttp.ReadyState.COMPLETE&&(goog.global.clearTimeout(a),r.isSuccess(i.status)||0===i.status&&!e.isEffectiveSchemeHttp_(t)?s(i):u(new e.HttpError(i.status,t,i)))},i.onerror=function(){u(new e.Error("Network error",t,i))},g.headers){for(var c in g.headers){var l=g.headers[c];null!=l&&i.setRequestHeader(c,l)}p=g.headers[e.CONTENT_TYPE_HEADER]}var E=goog.global.FormData&&n instanceof goog.global.FormData;"POST"!=o||void 0!==p||E||i.setRequestHeader(e.CONTENT_TYPE_HEADER,e.FORM_CONTENT_TYPE),g.withCredentials&&(i.withCredentials=g.withCredentials),g.responseType&&(i.responseType=g.responseType),g.mimeType&&i.overrideMimeType(g.mimeType),g.timeoutMs>0&&(a=goog.global.setTimeout(function(){i.onreadystatechange=goog.nullFunction,i.abort(),u(new e.TimeoutError(t,i))},g.timeoutMs));try{i.send(n)}catch(o){i.onreadystatechange=goog.nullFunction,goog.global.clearTimeout(a),u(new e.Error("Error sending XHR: "+o.message,t,i))}}).thenCatch(function(o){throw o instanceof goog.Promise.CancellationError&&i.abort(),o})},e.isEffectiveSchemeHttp_=function(o){var e=goog.uri.utils.getEffectiveScheme(o);return"http"==e||"https"==e||""==e},e.parseJson=function(o,r){return e.parseJson_(o,{xssiPrefix:r})},e.parseJson_=function(o,r){var t=o;return r&&r.xssiPrefix&&(t=e.stripXssiPrefix_(r.xssiPrefix,t)),JSON.parse(t)},e.stripXssiPrefix_=function(o,e){return goog.string.startsWith(e,o)&&(e=e.substring(o.length)),e},e.Error=function(o,r,t){e.Error.base(this,"constructor",o+", url="+r),this.url=r,this.xhr=t},goog.inherits(e.Error,goog.debug.Error),e.Error.prototype.name="XhrError",e.HttpError=function(o,r,t){e.HttpError.base(this,"constructor","Request Failed, status="+o,r,t),this.status=o},goog.inherits(e.HttpError,e.Error),e.HttpError.prototype.name="XhrHttpError",e.TimeoutError=function(o,r){e.TimeoutError.base(this,"constructor","Request timed out",o,r)},goog.inherits(e.TimeoutError,e.Error),e.TimeoutError.prototype.name="XhrTimeoutError"});