goog.provide("goog.labs.net.webChannel.WireV8"),goog.forwardDeclare("goog.structs.Map"),goog.require("goog.asserts"),goog.require("goog.json"),goog.require("goog.json.NativeJsonProcessor"),goog.require("goog.labs.net.webChannel.Wire"),goog.require("goog.structs"),goog.labs.net.webChannel.WireV8=function(){this.parser_=new goog.json.NativeJsonProcessor},goog.scope(function(){var o=goog.labs.net.webChannel.WireV8;goog.labs.net.webChannel.Wire;o.prototype.encodeMessage=function(o,e,r){var s=r||"";try{goog.structs.forEach(o,function(o,r){var g=o;goog.isObject(o)&&(g=goog.json.serialize(o)),e.push(s+r+"="+encodeURIComponent(g))})}catch(o){throw e.push(s+"type="+encodeURIComponent("_badmap")),o}},o.prototype.encodeMessageQueue=function(o,e,r){for(var s=-1;;){var g=["count="+e];-1==s?e>0?(s=o[0].mapId,g.push("ofs="+s)):s=0:g.push("ofs="+s);for(var n=!0,a=0;a<e;a++){var t=o[a].mapId,i=o[a].map;if((t-=s)<0)s=Math.max(0,o[a].mapId-100),n=!1;else try{this.encodeMessage(i,g,"req"+t+"_")}catch(o){r&&r(i)}}if(n)return g.join("&")}},o.prototype.decodeMessage=function(o){var e=this.parser_.parse(o);return goog.asserts.assert(goog.isArray(e)),e}});