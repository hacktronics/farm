goog.module("goog.labs.net.webChannel.ForwardChannelRequestPool"),goog.module.declareLegacyNamespace();var ChannelRequest=goog.require("goog.labs.net.webChannel.ChannelRequest"),Set=goog.require("goog.structs.Set"),Wire=goog.require("goog.labs.net.webChannel.Wire"),array=goog.require("goog.array"),googString=goog.require("goog.string"),ForwardChannelRequestPool=function(e){this.maxPoolSizeConfigured_=e||ForwardChannelRequestPool.MAX_POOL_SIZE_,this.maxSize_=ForwardChannelRequestPool.isSpdyOrHttp2Enabled_()?this.maxPoolSizeConfigured_:1,this.requestPool_=null,this.maxSize_>1&&(this.requestPool_=new Set),this.request_=null,this.pendingMessages_=[]};ForwardChannelRequestPool.MAX_POOL_SIZE_=10,ForwardChannelRequestPool.isSpdyOrHttp2Enabled_=function(){if(goog.global.PerformanceNavigationTiming){var e=goog.global.performance.getEntriesByType("navigation");return e.length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol)}return!!(goog.global.chrome&&goog.global.chrome.loadTimes&&goog.global.chrome.loadTimes()&&goog.global.chrome.loadTimes().wasFetchedViaSpdy)},ForwardChannelRequestPool.prototype.applyClientProtocol=function(e){this.requestPool_||(googString.contains(e,"spdy")||googString.contains(e,"quic")||googString.contains(e,"h2"))&&(this.maxSize_=this.maxPoolSizeConfigured_,this.requestPool_=new Set,this.request_&&(this.addRequest(this.request_),this.request_=null))},ForwardChannelRequestPool.prototype.isFull=function(){return!!this.request_||!!this.requestPool_&&this.requestPool_.getCount()>=this.maxSize_},ForwardChannelRequestPool.prototype.getMaxSize=function(){return this.maxSize_},ForwardChannelRequestPool.prototype.getRequestCount=function(){return this.request_?1:this.requestPool_?this.requestPool_.getCount():0},ForwardChannelRequestPool.prototype.hasRequest=function(e){return this.request_?this.request_==e:!!this.requestPool_&&this.requestPool_.contains(e)},ForwardChannelRequestPool.prototype.addRequest=function(e){this.requestPool_?this.requestPool_.add(e):this.request_=e},ForwardChannelRequestPool.prototype.removeRequest=function(e){return this.request_&&this.request_==e?(this.request_=null,!0):!(!this.requestPool_||!this.requestPool_.contains(e))&&(this.requestPool_.remove(e),!0)},ForwardChannelRequestPool.prototype.cancel=function(){if(this.pendingMessages_=this.getPendingMessages(),this.request_)return this.request_.cancel(),void(this.request_=null);this.requestPool_&&!this.requestPool_.isEmpty()&&(array.forEach(this.requestPool_.getValues(),function(e){e.cancel()}),this.requestPool_.clear())},ForwardChannelRequestPool.prototype.hasPendingRequest=function(){return null!=this.request_||null!=this.requestPool_&&!this.requestPool_.isEmpty()},ForwardChannelRequestPool.prototype.getPendingMessages=function(){if(null!=this.request_)return this.pendingMessages_.concat(this.request_.getPendingMessages());if(null!=this.requestPool_&&!this.requestPool_.isEmpty()){var e=this.pendingMessages_;return array.forEach(this.requestPool_.getValues(),function(o){e=e.concat(o.getPendingMessages())}),e}return array.clone(this.pendingMessages_)},ForwardChannelRequestPool.prototype.addPendingMessages=function(e){this.pendingMessages_=this.pendingMessages_.concat(e)},ForwardChannelRequestPool.prototype.clearPendingMessages=function(){this.pendingMessages_.length=0},ForwardChannelRequestPool.prototype.forceComplete=function(e){return null!=this.request_?(this.request_.cancel(),e(this.request_),!0):!(!this.requestPool_||this.requestPool_.isEmpty())&&(array.forEach(this.requestPool_.getValues(),function(o){o.cancel(),e(o)}),!0)},exports=ForwardChannelRequestPool;