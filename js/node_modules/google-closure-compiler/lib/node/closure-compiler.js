"use strict";const spawn=require("child_process").spawn,compilerPath=require("google-closure-compiler-java"),path=require("path"),contribPath=path.resolve(__dirname,"../../contrib");class Compiler{constructor(t,r){if(this.commandArguments=[],this.extraCommandArgs=r,Compiler.JAR_PATH&&(this.JAR_PATH=Compiler.JAR_PATH),Array.isArray(t))this.commandArguments=this.commandArguments.concat(t.slice());else for(let r in t)if(Array.isArray(t[r]))for(let e=0;e<t[r].length;e++)this.commandArguments.push(this.formatArgument(r,t[r][e]));else this.commandArguments.push(this.formatArgument(r,t[r]))}run(t){this.JAR_PATH&&(this.commandArguments.unshift("-jar",Compiler.JAR_PATH),this.extraCommandArgs&&this.commandArguments.unshift(...this.extraCommandArgs)),this.logger&&this.logger(this.getFullCommand()+"\n");let r=spawn(this.javaPath,this.commandArguments,this.spawnOptions),e="",o="";return t&&(r.stdout&&(r.stdout.setEncoding("utf8"),r.stdout.on("data",t=>{e+=t}),r.stdout.on("error",t=>{o+=t.toString()})),r.stderr&&(r.stderr.setEncoding("utf8"),r.stderr.on("data",t=>{o+=t})),r.on("close",r=>{0!==r&&(o=this.prependFullCommand(o)),t(r,e,o)}),r.on("error",r=>{t(1,e,this.prependFullCommand("Process spawn error. Is java in the path?\n"+r.message))})),r}getFullCommand(){return this.javaPath+" "+this.commandArguments.join(" ")}prependFullCommand(t){return this.getFullCommand()+"\n\n"+t+"\n\n"}formatArgument(t,r){let e=t.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`);return e=e.replace(/^--/,""),null==r?`--${e}`:`--${e}=${r}`}}Compiler.JAR_PATH=compilerPath,Compiler.prototype.javaPath="java",Compiler.prototype.logger=null,Compiler.prototype.spawnOptions=void 0,Compiler.COMPILER_PATH=compilerPath,Compiler.CONTRIB_PATH=contribPath,module.exports=Compiler;